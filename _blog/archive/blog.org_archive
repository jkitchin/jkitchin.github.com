#    -*- mode: org -*-


Archived entries from file c:/Users/jkitchin/Dropbox/blogofile-jkitchin.github.com/_blog/blog.org


* jorg-bib features
  :PROPERTIES:
  :ARCHIVE_TIME: 2014-06-24 Tue 21:35
  :ARCHIVE_FILE: ~/Dropbox/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

1. Integration with reftex. You type C-c ] and select keys from reftex and insert a cite link. If you type it again on a citation, the new entries are appended to the end.

2. Clickable cite links. If you have a citation link like cite:key1,key2,key3 you can click on key1 and open the bibliography file to key1, and you can click on key2 and have it open at key 2. This link would export in latex as \cite{key1,key2,key3}. Other cite formats, e.g. citep, citep*, etc... are defined too, but are relatively untested.

3. citation tooltips. If clicking is too disruptive, you can run a command and get a tooltip of the citation under point.

4. clickable label links. clicking checks the buffer for another label by the same name.

5. Clickable ref links. Clicking on the ref:label takes you to the label, and provides C-c & to get back to that point.

6. A bibliographystyle and bibliography link. The bibliography link opens the bibtex file that was clicked on.

7. Code to make a clickable list of figures and tables.

8. Code to extract the bibtex entries cited in an org-file to a text block at the end of the org-file

9. variables to point to a notes file and pdf directory, and functions to jump to your notes and the pdf file from a bibtex entry.

10. a function to build a complete pdf bibliography from your bibtex file. This is handy for checking the entries are spelled correctly, etc...

11. A little function and python script to upload a bibtex entry to citeulike.

[[cite:bernard-1991-ac]]

bibliography:../../bibliography/references.bib


* Bug report 2 for org-mode
  :PROPERTIES:
  :ARCHIVE_TIME: 2014-10-22 Wed 10:44
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

Here is a named table
#+tblname: tbl-data
| x | y |
|---+---|
| 1 | 1 |
| 2 | 4 |
| 3 | 9 |

Here is a named src-block with a defined var
#+name: print-table
#+BEGIN_SRC python :var data=tbl-data :results value
return data
#+END_SRC


Now, we illustrate that the src-block does have :parameters.
#+name: get-properties
#+BEGIN_SRC emacs-lisp
(save-excursion
  (re-search-backward "#\\+name: print-table")
  (buffer-substring
   (org-element-property :begin (org-element-at-point))
   (org-element-property :end (org-element-at-point))))
#+END_SRC

#+RESULTS: get-properties
: #+name: print-table
: #+BEGIN_SRC python :var data=tbl-data :results value
: return data
: #+END_SRC
:
:

In the export machinery, though it appears the src-block is not the same.

#+BEGIN_SRC emacs-lisp :results output :exports none
(defun my-src-block (src-block contents info)

  (princ (buffer-substring
	  (org-element-property :begin src-block)
	  (org-element-property :end src-block)))

    (org-export-format-code-default src-block info))

(org-export-define-derived-backend 'my-html 'html
  :translate-alist '((src-block . my-src-block)))

(org-export-to-file 'my-html "custom-src-table-export.html")
#+END_SRC
#+RESULTS:
#+begin_example
#+name: print-table
#+BEGIN_SRC python
return data
#+END_SRC


#+name: get-properties
#+BEGIN_SRC emacs-lisp
(save-excursion
  (re-search-backward "#\\+name: print-table")
  (buffer-substring
   (org-element-property :begin (org-element-at-point))
   (org-element-property :end (org-element-at-point))))
#+END_SRC

#+end_example

The parameters seem to be gone.

* Bug report for org-mode
  :PROPERTIES:
  :ARCHIVE_TIME: 2014-10-22 Wed 10:44
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

Here is a named table
#+tblname: tbl-data
| x | y |
|---+---|
| 1 | 1 |
| 2 | 4 |
| 3 | 9 |

Here is a named src-block with a defined var
#+name: print-table
#+BEGIN_SRC python :var data=tbl-data :results value
return data
#+END_SRC




#+RESULTS: print-table
| 1 | 1 |
| 2 | 4 |
| 3 | 9 |

Now, we illustrate that the src-block does have :parameters.
#+name: get-properties
#+BEGIN_SRC emacs-lisp
(save-excursion
(re-search-backward "#\\+name: print-table")
(org-element-property :parameters (org-element-at-point)))
#+END_SRC

#+RESULTS: get-properties
: :var data=tbl-data :results value

In the export machinery, though it appears the src-block does not.


#+BEGIN_SRC emacs-lisp :results output
(defun my-src-block (src-block contents info)

  (princ (concat
	  (format "[language: %s]\n" (org-element-property :language src-block))
	  (format "name: %s\n" (org-element-property :name src-block))
	  (format "parameters: %s\n\n" (org-element-property :parameters src-block))))
    (org-export-format-code-default src-block info))

(org-export-define-derived-backend 'my-html 'html
  :translate-alist '((src-block . my-src-block)))

(org-export-to-file 'my-html "custom-src-table-export.html")
#+END_SRC
#+RESULTS:
#+begin_example
[language: python]
name: print-table
parameters: nil

[language: emacs-lisp]
name: get-properties
parameters: nil

[language: emacs-lisp]
name: nil
parameters: nil

#+end_example

The parameters are nil in each case, even though we know the print-table block should have parameters. I think that is a bug.

* Odd behavior in python src-blocks in org-mode
  :PROPERTIES:
  :ARCHIVE_TIME: 2014-10-22 Wed 12:03
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(org-babel-do-load-languages
 'org-babel-load-languages
 '((emacs-lisp . t)
   (python . t)))

(setq org-confirm-babel-evaluate nil)
#+END_SRC

#+RESULTS:

This block should raise an error (and does) because k is not defined.
#+BEGIN_SRC python
def f(y, x):
    return k * y

print(f(1, 0))
#+END_SRC

#+RESULTS:

It raises this error.

#+BEGIN_EXAMPLE
Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
  File "<stdin>", line 2, in f
NameError: global name 'k' is not defined
#+END_EXAMPLE

However, this code block actually executes, and gives the wrong answer! If I open the source block in Python mode, it does not run without error.

#+BEGIN_SRC python :results output
from scipy.integrate import odeint

def f(y, x):
    return k * y

print(odeint(f, 1, [0, 1]))
#+END_SRC

#+RESULTS:
: [[ 1.]
:  [ 1.]]

Here is the correct answer.

#+BEGIN_SRC python :results output
from scipy.integrate import odeint

k = -1
def f(y, x):
    return k * y

print(odeint(f, 1, [0, 1]))
#+END_SRC

#+RESULTS:
: [[ 1.        ]
:  [ 0.36787947]]

#+BEGIN_SRC python :results output
def f(x):
    return x == (not x)

print f(None)
print not None
#+END_SRC

#+RESULTS:
: False
: True

#+BEGIN_SRC emacs-lisp
(setq org-babel-python-command "python -m pycse.sandbox")
#+END_SRC
#+BEGIN_SRC python
from scipy.integrate import odeint

k = -1

def f(y, x):
    return -k * y

print(odeint(f, 1, [0, 1]))
#+END_SRC

#+RESULTS:
: [[ 1.        ]
:  [ 2.71828193]]
:
:







* ARCHIVE bug in setting properties?	 :archive:
 :PROPERTIES:
 :categories: education
 :ANSWER:   4
 :ARCHIVE_TIME: 2014-11-30 Sun 17:15
 :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
 :ARCHIVE_CATEGORY: blog
 :END:

#+BEGIN_SRC emacs-lisp
(format "** %s
  :PROPERTIES:
  :ID: %s
:categories: test
  :END:
%s" "A headline" "some id" "some body text")
#+END_SRC
#+RESULTS:
: ** A headline
:   :PROPERTIES:
:   :ID: some id
:   :END:
: some body text




* numpy float64 comparisons
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 10:58
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC python
from __future__ import division
import numpy as np

class Unit(np.ndarray):
    __array_priority__ = 2
    def __new__(cls, input_array, exponents=None, label=None):
        obj = np.asarray(input_array).view(cls)
        obj.exponents = np.array(exponents)
        obj.label = label

        return obj

    def __eq__(self, other):
        'implement a==b for units'
        if not isinstance(other, Unit):
            raise Exception(['you should not compare objects'
                             ' with different units.'
                             ' {0} == {1}'.format(self, other)])

        return (np.all(self.exponents == other.exponents)
                and np.all(np.array(self) == np.array(other)))



# these all raise exceptions
print 2 == Unit(2, [1, 0, 0, 0, 0, 0, 0])
print Unit(2, [1, 0, 0, 0, 0, 0, 0]) == 2

print np.float(2) == Unit(2, [1, 0, 0, 0, 0, 0, 0])
print Unit(2, [1, 0, 0, 0, 0, 0, 0]) == np.float(2)

print np.float32(2) == Unit(2, [1, 0, 0, 0, 0, 0, 0])
print Unit(2, [1, 0, 0, 0, 0, 0, 0]) == np.float32(2)

print Unit(2, [1, 0, 0, 0, 0, 0, 0]) == np.float64(2)


# this should raise an exception, but it does not
print np.float64(2) == Unit(2, [1, 0, 0, 0, 0, 0, 0])



#+END_SRC

#+RESULTS:

* Making an index and glossary in org-mode
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 11:01
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
#+LATEX_CLASS: cmu-article
#+LATEX_HEADER: \usepackage{makeidx}
#+LATEX_HEADER: \usepackage{glossaries}
#+LATEX_HEADER: \usepackage{hyperref}
#+LATEX_HEADER: \makeindex
#+LATEX_HEADER: \makeglossaries



index:keyword

some text

index:index!link

more text
index:hello
index:hello!Peter
[[index:hello!Sam@\textsl{Sam}]]
[[index:Lin@\textbf{Lin}]]
[[index:Joe|textit]]
[[index:Lin@\textbf{Lin}]]
[[index:Peter|see {hello}]]
[[index:Jen|seealso{Jenny}]]

index:encodings!input!cp850


** A glossary



[[newglossaryentry:computer][name=computer, description=is a programmable machine that receives input, stores and manipulates data, and provides output in a useful format.]]


\newacronym[longplural=Frames per Second]{fpsLabel}{FPS}{Frame per Second}

See  gls:computer


\printglossary[title=List of Terms,toctitle=Terms and abbreviations]

** index

printindex:nopotions

* bug report
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 11:03
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
[[https://mail.google.com/mail/u/0/#inbox/1498a1077371921f][Small bug in org-ref - johnrkitchin@gmail.com - Gmail]]

Dear Dr. Kitchin,

I found a small problem in org-ref in combination with org-mode #+label
function.


1.)
#+CAPTION: Test caption
#+LABEL: fig:test_label3
#+ATTR_LATEX: :width 0.7\textwidth
[[file:test_figure.pdf]]

This way figure ref:fig:test_label3 will be referenced correctly in LaTeX
output (\ref), but not found by org-ref-complete-link function, meaning
there is no auto-completion.


#+BEGIN_SRC emacs-lisp
(org-ref-get-labels)
#+END_SRC

#+RESULTS:
|   | fig:test_label | fig | \s- | test1 | test | code-example | \\ | code:ref-snippet | load-snippets | fig:test_label3 | fig:cos | fig:a | fig:b | fig12 | tbldata | my-table | tbl-data | tbl-1 | tbl-2 | python-table | first-table | tbl-with-caption | cos-data | users | gradebook | beginner |

2.)
#+CAPTION: Test caption
#+LABEL: fig:test_label    ---- no space between label:fig!!
#+ATTR_LATEX: :width 0.7\textwidth
[[file:test_figure.pdf]]

This way figure ref:fig:test_label will NOT be referenced in LaTeX
output, but will be found by org-ref-complete-link function, because the
missing empty space leads to misinterpretation of #+label: on export.

Inserting a space behind label in the org-ref-get-labels function solves
the problem for me.

#+begin_src emacs-lisp
(defun org-ref-get-labels ()
  "returns a list of labels in the buffer that you can make a ref link
to. this is used to auto-complete ref links."
  (save-excursion
    (save-restriction
      (widen)
      (goto-char (point-min))
      (let ((matches '()))
        (while (re-search-forward "label: \\([a-zA-z0-9:-]*\\)" (point-max) t)
 ; inserted space behind label:
          (add-to-list 'matches (match-string-no-properties 1) t))
        (append matches (org-ref-get-latex-labels) (org-ref-get-tblnames)
(org-ref-get-custom-ids))))))
#+end_src


#+begin_src emacs-lisp
(defun org-ref-complete-link (&optional arg)
  "Completion function for ref links"
  (let ((label))
    (setq label (completing-read "label: " (org-ref-get-labels)))
    (format "ref:%s" label)))
#+end_src

I only know the org-ref reference function - or is there a proper
org-ref-create label function.

Greetings

* New links for researcherID and orcid
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 11:03
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
These are pretty trivial links, but they still might be useful if these get more common.

#+BEGIN_SRC emacs-lisp :results silent
(org-add-link-type
 "orcid"
 (lambda (link-string)
   (browse-url
    (format "http://orcid.org/%s" link-string))))

(org-add-link-type
 "ResearcherID"
 (lambda (link-string)
   (browse-url
    (format "http://www.researcherid.com/rid/%s" link-string))))
#+END_SRC

ResearcherID:A-2363-2010

orcid:0000-0003-2625-9232

* Extracting a DOI from a pdf
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 11:04
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(with-temp-buffer
#+END_SRC

10.1002/(SICI)1522-2594(199911)42:5<952::AID-MRM16>3.0.CO;2-S

<</URI(http://dx.doi.org/10.1080/095008396180911)/S/URI>>

"\\(10[.][0-9]\\{4,\\}\\(?:[.][0-9]+\\)*/[0-9a-z]+\\)"

b(10[.][0-9]{4,}(?:[.][0-9]+)*/(?:(?!["&\'])\S)+)\b

(?:doi[\s.:]{0,2})?(10[.][^/]+/[^\s"]+).

This sort of works
"\\(10[.][0-9]\\{4,\\}\\(?:[.][0-9]+\\)*/\\s(?[^[:space:]]*\\)\\s)?\\b"

I am not sure how to enforce balanced parens, or to close the paren in the second example.

http://www.emacswiki.org/RegularExpression

This is too difficult to solve for now.

* get scaled positions of an atom in ase
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 11:04
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC python
from ase import Atom, Atoms

atoms = Atoms([Atom('H', [1, 1, 1]), Atom('O', [2, 2, 2])], cell=(3, 3, 3))
atoms[0].a = 0.5
atoms[0].b = 0.5
atoms[0].c = 0.5

print atoms[0].a
print atoms[0].x
#print atoms[1].scaled_position
#+END_SRC

#+RESULTS:
: 0.5
: 1.5

* Making your emacs buffer flash
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 11:05
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(let ((bg (face-attribute 'default :background)))
  (dotimes (i 1)
    (set-face-attribute 'default nil :background "lightgreen")
    (sleep-for 0.1)
    (set-face-attribute 'default nil :background bg)
    (sleep-for 0.1)))
#+END_SRC

#+RESULTS:

(setq visible-bell t)

(message "brrp")
(setq ring-bell-function nil)
(ding)

* TODO VASP in emacs
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-01-18 Sun 11:08
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :ARCHIVE_TODO: TODO
  :END:
#+BEGIN_EXAMPLE
PREC = Normal              #  precision normal
ENCUT = 300                #  cutoff used throughout all calculations
LREAL = .FALSE.            #  real space projection yes / no
ISMEAR = 0                 #  method to determine partial occupancies
#+END_EXAMPLE

[[./images/vanilla-incar.png]]

Now with vasp-mode:

[[./images/vasp-mode-incar.png]]

* jeldoc - a function to generate documentation from emacs-lisp files
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-03-17 Tue 21:33
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp :results output
(defun jeldoc (library)
  "Generate an org buffer containing the requires, variables and functions defined in LIBRARY.
LIBRARY must be loaded before running this function."

  (interactive
   (list (completing-read "Library to generate org-doc for: "
			  (-flatten
			   (delq nil
				 (mapcar
				  (lambda (x)
				    (delq nil
					  (mapcar
					   (lambda (y)
					     (when (and (consp y)
							(eq (car y) 'provide))
					       (cdr y)))
					   x)))
				  load-history))))))

  (let* ((lib-file (locate-library library))
	 ;; these are the things defined in the library
	 (elements (cdr
		    (assoc
		     (locate-library library)
		     load-history)))
	 ;; variables
	 (vars (-filter 'symbolp elements))
	 ;; things the library requires
	 (requires
	  (mapcar 'cdr
		  (-filter (lambda (x)
			     (and (consp x)
				  (eq 'require (car x))))
			   elements)))
	 ;; functions defined in the library
	 (funcs (mapcar
		 'cdr
		 (-filter (lambda (x)
			    (and (consp x)
				 (eq 'defun (car x))))
			  elements))))

    (switch-to-buffer "*org-doc*")
    (erase-buffer)
    (insert (format "#+TITLE: Documentation for %s
,#+OPTIONS: toc:nil
\\maketitle
\\tableofcontents

%s

" library  (cond
	    ;; regular lisp file
	    ((string= "el" (file-name-extension lib-file))
	     (format "Source code: [[file:%s][%s]]" lib-file library))
	    ;; compiled file. these are not easy to read so we try plain el file
	    ((and (string= "elc" (file-name-extension lib-file))
		  (file-exists-p
		   (concat (file-name-sans-extension lib-file) ".el")))
	     (format "Source code: [[file:%s][%s]]"
		     (concat (file-name-sans-extension lib-file) ".el")
		     library))
	    ;; catch anything we cannot figure out
	    (t
	     (format "Source code: file:%s" lib-file)))))


    (insert "* Requires\n\n")
    ;; insert link to generate a jeldoc buffer for each require
    (dolist (req requires)
      (insert (format "- [[elisp:(jeldoc \"%s\")][%s]]\n" req req)))

    (insert "* Custom Variables\n\n")
    (dolist (var (sort (-filter 'custom-variable-p vars) 'string-lessp))
      (insert (format "** %s
Documentation: %s

Value:
%S\n\n"
		      var
		      (documentation-property var 'variable-documentation)
		      (symbol-value var)
		      )))

    (insert "* Regular Variables\n\n")
    (dolist (var (sort (-filter (lambda (x) (not (custom-variable-p x)))
				vars)
		       'string-lessp))
      (insert (format "** %s
Documentation: %s

Value:
%S\n\n"
		      var
		      (documentation-property var 'variable-documentation)
		      (symbol-value var)
		      )))

    (insert "* Interactive Functions\n\n")

    (dolist (func (sort (-filter 'commandp funcs) 'string-lessp))
      (insert (format "** %s %s
Documentation: %s

Code:
,#+BEGIN_SRC emacs-lisp
%s
,#+END_SRC

"
		      func
		      (or (help-function-arglist func) "")
		      (documentation func)
		      ;; code defining the function
		      (save-window-excursion
			;; we do not have c-source, so check if func
			;; is defined in a c file here.
			(if
			    (string= "c"
				     (file-name-extension
				      (find-lisp-object-file-name
				       func
				       (symbol-function func))))
			    (symbol-function func)
			  ;;else
			  (condition-case nil
			      (let ((bp (find-function-noselect func t)))
				(set-buffer (car bp))
				(goto-char (cdr bp))
				(when (sexp-at-point)
				  (mark-sexp)
				  (buffer-substring (point) (mark))))
			    (error func))
			  )))))

    (insert "* Non-interactive Functions\n\n")

    (dolist (func (sort (-filter (lambda (x) (not (commandp x)))
				 funcs)
			'string-lessp))
      (insert (format "** %s %s
Documentation: %s

Code:
,#+BEGIN_SRC emacs-lisp
%s
,#+END_SRC

"
		      func
		      (or (help-function-arglist func) "")
		      (documentation func)
		      ;; code defining the function
		      (save-window-excursion
			;; we do not have c-source, so check if func
			;; is defined in a c file here.
			(if
			    (string= "c"
				     (file-name-extension
				      (find-lisp-object-file-name
				       func
				       (symbol-function func))))
			    (symbol-function func)
			  ;;else
			  (condition-case nil
			      (let ((bp (find-function-noselect func t)))
				(set-buffer (car bp))
				(goto-char (cdr bp))
				(when (sexp-at-point)
				  (mark-sexp)
				  (buffer-substring (point) (mark))))
			    (error func))
			    )))))
    (org-mode)

    ;; replace `' with links to describe function or variable, unless
    ;; they are in a code block, then leave them alone.
    (goto-char (point-min))
    (while (re-search-forward "`\\([^' ]*\\)'" nil t)
      (let ((result (match-string 1))
	    (bg (match-beginning 1))
	    (end (match-end 1)))
	;; checking for code block changes match data, so
	;; we save it here.
	(unless (save-match-data
		  (eq 'src-block (car (org-element-at-point))))
	  (cond
	   ;; known function
	   ((fboundp (intern result))
	    (setf (buffer-substring bg end)
		  (format "[[elisp:(describe-function '%s)][%s]]"
			  result result)))
	   ;; known variable
	   ((boundp (intern result))
	    (setf (buffer-substring bg end)
		  (format "[[elisp:(describe-variable '%s)][%s]]"
			  result result)))
	   ;; unknown quoted thing, just return it back
	   (t
	    result)))))
    ;; finally jump to Requires section
    (org-open-link-from-string "[[*Requires]]")))
#+END_SRC

* Indexing an old email archive
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-08 Wed 09:55
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

I get 8-10 GB of email every year. A lot I delete, but somewhere between 2-4GB stays each year. To reduce the amount of email in my Gmail account, I have been archiving emails older than 2 years old into a folder, and I now have a little over 8 GB of mail from 2011 through 2013. Today, we look at indexing these emails with swish-e so I can search them.

#+BEGIN_SRC sh
du -hs ~/Maildir-archive
#+END_SRC
#+RESULTS:
: 8.2G	/Users/jkitchin/Maildir-archive

#+BEGIN_SRC python
import email
from xml.sax.saxutils import escape, quoteattr

with open('../../Maildir-archive/2013/cur/1420920834_0.31077.vpn-128-237-146-134.library.vpn.cmu.edu,U=12121,FMD5=8038da89e49ac5eabb489cfc6cea9fc1:2,S') as f:
    msg = email.message_from_file(f)
    print dir(msg)
    print msg.keys()
    # print msg.as_string()   # for swishdefault
    print msg.is_multipart()
    print msg.get_payload()
    print msg.get_filename()

    if msg.is_multipart():
        print 'multipart'
        for part in msg.walk():
            ctype = part.get_content_type()
            print ctype, part.get_filename()
#            if ctype in ['image/jpeg', 'image/png']:
#                open(part.get_filename(), 'wb').write(part.get_payload(decode=True))
#+END_SRC
#+RESULTS:
#+begin_example
['__contains__', '__delitem__', '__doc__', '__getitem__', '__init__', '__len__', '__module__', '__setitem__', '__str__', '_charset', '_default_type', '_get_params_preserve', '_headers', '_payload', '_unixfrom', 'add_header', 'as_string', 'attach', 'defects', 'del_param', 'epilogue', 'get', 'get_all', 'get_boundary', 'get_charset', 'get_charsets', 'get_content_charset', 'get_content_maintype', 'get_content_subtype', 'get_content_type', 'get_default_type', 'get_filename', 'get_param', 'get_params', 'get_payload', 'get_unixfrom', 'has_key', 'is_multipart', 'items', 'keys', 'preamble', 'replace_header', 'set_boundary', 'set_charset', 'set_default_type', 'set_param', 'set_payload', 'set_type', 'set_unixfrom', 'values', 'walk']
['MIME-Version', 'Sender', 'Received', 'Date', 'Delivered-To', 'X-Google-Sender-Auth', 'Message-ID', 'Subject', 'From', 'To', 'Content-Type']
True
[<email.message.Message instance at 0x102136a70>, <email.message.Message instance at 0x102136c20>]
None
multipart
multipart/mixed None
multipart/alternative None
text/plain None
text/html None
application/zip tpd-scaling.zip
#+end_example

#+BEGIN_SRC python
def printtag(name,closing=False):
    if closing:
        return '</{}>'.format(name)
    else:
        return '<{}>'.format(name)


def tag(name, content):
    return '{0}{1}{2}'.format(printtag(name),
                             content,
                             printtag(name, closing=True))

import email

with open('../../Maildir-archive/2013/cur/1420920833_1.31077.vpn-128-237-146-134.library.vpn.cmu.edu,U=12137,FMD5=8038da89e49ac5eabb489cfc6cea9fc1:2,S') as f:
    msg = email.message_from_file(f)
    headers = [tag(key.lower(), msg[key]) for key in msg.keys()]
    swishdefault = tag('swishdefault', msg.as_string())
    print keys
#+END_SRC
#+RESULTS:
: ['<delivered-to>johnrkitchin@gmail.com</delivered-to>', '<received>by 10.114.98.198 with SMTP id ek6csp723877ldb;\n        Mon, 31 Dec 2012 21:00:34 -0800 (PST)</received>', '<x-received>by 10.58.214.231 with SMTP id od7mr68944632vec.44.1357016433643;\n        Mon, 31 Dec 2012 21:00:33 -0800 (PST)</x-received>', '<return-path><jkitchin@cmu.edu></return-path>', '<received>by 10.114.98.198 with SMTP id ek6csp723877ldb;\n        Mon, 31 Dec 2012 21:00:34 -0800 (PST)</received>', '<received-spf>pass (google.com: best guess record for domain of jkitchin@cmu.edu designates 128.2.10.212 as permitted sender) client-ip=128.2.10.212;</received-spf>', '<authentication-results>mx.google.com; spf=pass (google.com: best guess record for domain of jkitchin@cmu.edu designates 128.2.10.212 as permitted sender) smtp.mail=jkitchin@cmu.edu</authentication-results>', '<received>by 10.114.98.198 with SMTP id ek6csp723877ldb;\n        Mon, 31 Dec 2012 21:00:34 -0800 (PST)</received>', '<date>Tue, 1 Jan 2013 00:00:32 -0500</date>', '<message-id><201301010500.r0150WwD005971@relay.andrew.cmu.edu></message-id>', '<content-type>multipart/alternative;\n boundary="===============6718222350745897845=="</content-type>', '<mime-version>1.0</mime-version>', '<to>jkitchin@cmu.edu</to>', '<from>jkitchin@cmu.edu</from>', '<subject>Torque report 2012-12-01 to 2013-01-01</subject>', '<x-scanned-by>MIMEDefang 2.60 on 128.2.10.212</x-scanned-by>']

* Clickable twitter improvements
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-08 Wed 11:47
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

John Kitchin @johnkitchin @mess  @johnkitchin @johnkitchin  @SannaLab @WE3Lab

@prtk_m

This often works, but not always right away.

#+BEGIN_SRC emacs-lisp
(get-most-recent-tweet "prtk_m")
#+END_SRC

#+RESULTS:
: 07/01/15 22:30 PM - The story behind @AcademicsSay http://t.co/eidyj7Zb3M <-- makes it even better!



[[elisp:(highlight-twitter-handles)]]

[[elisp:unhighlight-twitter-handles]]

* Load emacs with no output
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-09 Thu 08:10
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
I would like to figure this out so I can load my initialization files for indexing. right now they put out a ton of output that I think will mess up the indexer.

This did not work.
#+BEGIN_SRC emacs-lisp :tangle emacs-batch.el :tangle-mode (identity #o755)
:;exec emacs -batch -l $0 "$@"

(defun nomessage (arg &rest args) nil)

(advice-add 'message :around #'nomessage)

(load-file "~/Dropbox/kitchingroup/jmax/init.el")
#+END_SRC

#+BEGIN_SRC emacs-lisp :tangle emacs-batch.el :tangle-mode (identity #o755)
:;exec emacs -batch -l $0 "$@"
(defun message (arg &rest args) nil)

(with-output-to-string
  (load-file "~/Dropbox/kitchingroup/jmax/init.el"))
#+END_SRC

#+BEGIN_SRC emacs-lisp
(defun nomessage (arg &rest args) nil)

(advice-add 'message :around #'nomessage)
(advice-remove 'message #'nomessage)
(message "test")

;(org-add-link-type "test" nil nil)
#+END_SRC

#+RESULTS:
: test

* helm-brew
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-09 Thu 19:10
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

These are installed brew packages
#+BEGIN_SRC emacs-lisp
(shell-command-to-string "brew list")
#+END_SRC

brew cat

#+BEGIN_SRC sh
brew --cellar
#+END_SRC

#+RESULTS:
: /usr/local/Cellar

#+BEGIN_SRC sh
brew --prefix
#+END_SRC
#+RESULTS:
: /usr/local

#+BEGIN_SRC sh
brew --cache
#+END_SRC

#+RESULTS:
: /Library/Caches/Homebrew


#+BEGIN_SRC sh
brew --repository
#+END_SRC

#+RESULTS:
: /usr/local

#+BEGIN_SRC sh
brew search emacs
#+END_SRC

#+RESULTS:
: emacs
: emacs-clang-complete-async
: Caskroom/cask/emacs

#+BEGIN_SRC sh
ls $(brew --prefix)/Library/Formula
#+END_SRC


#+BEGIN_SRC emacs-lisp
(let (formula cmd desc)

  (loop for formularb in (split-string
			  (shell-command-to-string
			   "ls $(brew --prefix)/Library/Formula") "\n")

	do
	(setq formula (replace-regexp-in-string "\\.rb" "" formularb))
	(setq cmd (format "grep desc %s" (expand-file-name
					  formularb
					  (s-trim  (shell-command-to-string
						    "brew --prefix")))))

	(setq desc (shell-command-to-string cmd))
         collect (list formula desc)))
#+END_SRC
#+RESULTS:
| a2ps.rb | a52dec.rb | aacgain.rb | aalib.rb | aamath.rb | aap.rb | aardvark_shell_utils.rb | abcde.rb | abcl.rb | abcm2ps.rb | abcmidi.rb | abduco.rb | abi-compliance-checker.rb | abnfgen.rb | abook.rb | ace.rb | aces_container.rb | ack.rb | acme.rb | acpica.rb | activemq-cpp.rb | activemq.rb | admesh.rb | adns.rb | adplug.rb | advancecomp.rb | aescrypt-packetizer.rb | aescrypt.rb | aeskeyfind.rb | aespipe.rb | afflib.rb | afio.rb | afl-fuzz.rb | afsctool.rb | aften.rb | agda.rb | aget.rb | aggregate.rb | aha.rb | ahcpd.rb | aiccu.rb | aircrack-ng.rb | akka.rb | alac.rb | aldo.rb | algernon.rb | algol68g.rb | align.rb | allegro.rb | alpine.rb | alure.rb | amap.rb | amtterm.rb | analog.rb | android-ndk.rb | android-platform-tools.rb | android-sdk.rb | ansible.rb | ansifilter.rb | ant-contrib.rb | ant.rb | antigen.rb | antiword.rb | antlr.rb | anttweakbar.rb | aoeui.rb | apache-drill.rb | apache-forrest.rb | apache-opennlp.rb | apache-spark.rb | apachetop.rb | ape.rb | apel.rb | apg.rb | apgdiff.rb | apib.rb | apktool.rb | apngasm.rb | apollo.rb | app-engine-java-sdk.rb | apparix.rb | appscale-tools.rb | apr-util.rb | apr.rb | apt-cacher-ng.rb | apt-dater.rb | aptly.rb | aqbanking.rb | arabica.rb | arangodb.rb | archey.rb | argp-standalone.rb | argtable.rb | argus-clients.rb | argus.rb | argyll-cms.rb | aria2.rb | arm.rb | arp-scan.rb | arp-sk.rb | arping.rb | arpoison.rb | arpon.rb | arss.rb | artifactory.rb | ascii.rb | asciidoc.rb | asciinema.rb | asciitex.rb | asm6.rb | asn1c.rb | aspcud.rb | aspell.rb | assimp.rb | astyle.rb | at-spi2-atk.rb | at-spi2-core.rb | atdtool.rb | aterm.rb | atf.rb | atk.rb | atkmm.rb | atomicparsley.rb | atool.rb | ats2-postiats.rb | aubio.rb | audiofile.rb | augeas.rb | auto-scaling.rb | autobench.rb | autoconf-archive.rb | autoconf.rb | autoenv.rb | autogen.rb | autojump.rb | automake.rb | automoc4.rb | automysqlbackup.rb | autopano-sift-c.rb | autopsy.rb | autossh.rb | autotrace.rb | avce00.rb | avian.rb | avidemux.rb | aview.rb | avra.rb | avrdude.rb | avro-c.rb | avro-cpp.rb | avro-tools.rb | aws-cfn-tools.rb | aws-cloudsearch.rb | aws-elasticache.rb | aws-elasticbeanstalk.rb | aws-sns-cli.rb | awscli.rb | axel.rb | b43-fwcutter.rb | babeld.rb | babl.rb | backupninja.rb | bacula-fd.rb | bagit.rb | balance.rb | bam.rb | bar.rb | baresip.rb | base64.rb | basex.rb | bash-completion.rb | bash-git-prompt.rb | bash.rb | bashdb.rb | bashish.rb | batik.rb | bats.rb | bazaar.rb | bbcolors.rb | bbe.rb | bbftp-client.rb | bchunk.rb | bcpp.rb | bcrypt.rb | bdw-gc.rb | beansdb.rb | beanstalk.rb | bear.rb | beecrypt.rb | berkeley-db.rb | berkeley-db4.rb | betty.rb | bfg.rb | bgpq3.rb | bgrep.rb | bib-tool.rb | bibclean.rb | bibtex2html.rb | bibtexconv.rb | bibutils.rb | bigdata.rb | bigloo.rb | bind.rb | binutils.rb | binwalk.rb | bip.rb | bison.rb | bitchx.rb | bitlbee.rb | bittwist.rb | blahtexml.rb | blazeblogger.rb | blink1.rb | blitz.rb | blitzwave.rb | blockhash.rb | bltool.rb | blucat.rb | blueutil.rb | bmake.rb | bmon.rb | bogofilter.rb | bokken.rb | bonnie++.rb | boost-bcp.rb | boost-build.rb | boost-python.rb | boost.rb | boot-clj.rb | boot2docker.rb | botan.rb | box2d.rb | boxes.rb | bpm-tools.rb | brag.rb | brew-gem.rb | brew-pip.rb | briss.rb | bro.rb | browser.rb | bsdconv.rb | bsdiff.rb | bsdmake.rb | bsdsfv.rb | bsponmpi.rb | btparse.rb | btpd.rb | buildapp.rb | bulk_extractor.rb | bullet.rb | bup.rb | burl.rb | burp.rb | bvi.rb | bwctl.rb | bwm-ng.rb | byacc.rb | byobu.rb | c-ares.rb | c-kermit.rb | cabal-install.rb | cabextract.rb | cabocha.rb | cadaver.rb | caddy.rb | cadubi.rb | cairo.rb | cairomm.rb | calabash.rb | calc.rb | calcurse.rb | camellia.rb | camlistore.rb | camlp4.rb | camlp5.rb | capnp.rb | capstone.rb | carthage.rb | cask.rb | casperjs.rb | cassandra.rb | cattle.rb | caudec.rb | cayley.rb | cbmbasic.rb | cc65.rb | ccache.rb | ccal.rb | ccat.rb | ccd2iso.rb | ccextractor.rb | cclive.rb | ccm.rb | cconv.rb | ccrypt.rb | cctools-headers.rb | cctools.rb | ccze.rb | cd-discid.rb | cdargs.rb | cdb.rb | cdecl.rb | cdimgtools.rb | cdk.rb | cdlabelgen.rb | cdparanoia.rb | cdpr.rb | cdrdao.rb | cdrtools.rb | center-im.rb | cereal.rb | ceylon.rb | cf.rb | cfengine.rb | cfitsio.rb | cflow.rb | cfv.rb | cgal.rb | cgdb.rb | cgrep.rb | cgvg.rb | chapel.rb | charm-tools.rb | chcase.rb | cheat.rb | check.rb | check_postgres.rb | checkbashisms.rb | checkstyle.rb | cherokee.rb | chgems.rb | chibi-scheme.rb | chicken.rb | chinadns-c.rb | chipmunk.rb | chisel.rb | chkrootkit.rb | chmlib.rb | chordii.rb | chromaprint.rb | chrome-cli.rb | chromedriver.rb | chruby-fish.rb | chruby.rb | chuck.rb | cidrmerge.rb | cifer.rb | cig.rb | cimg.rb | cityhash.rb | cjdns.rb | cksfv.rb | clamav.rb | clamz.rb | clang-format.rb | clang-omp.rb | clasp.rb | class-dump.rb | classads.rb | clay.rb | clean.rb | clens.rb | cless.rb | clhep.rb | clib.rb | cliclick.rb | clipper.rb | clipsafe.rb | clisp.rb | cln.rb | cloc.rb | clockywock.rb | clojurescript.rb | cloog.rb | closure-compiler.rb | closure-linter.rb | cloud-watch.rb | cloudbees-sdk.rb | clozure-cl.rb | clpbar.rb | clucene.rb | clutter-gst.rb | clutter-gtk.rb | clutter.rb | cmake.rb | cmatrix.rb | cmigemo.rb | cmocka.rb | cmockery.rb | cmockery2.rb | cmu-pocketsphinx.rb | cmu-sphinxbase.rb | cmuclmtk.rb | cmus.rb | cntlm.rb | coccinelle.rb | cocot.rb | coda-cli.rb | codequery.rb | cogl.rb | coin.rb | collada-dom.rb | collectd.rb | colordiff.rb | colormake.rb | colorsvn.rb | colortail.rb | commonmark.rb | compcert.rb | compface.rb | concurrencykit.rb | confuse.rb | conserver.rb | contacts.rb | convertlit.rb | convmv.rb | cookiecutter.rb | coq.rb | coreutils.rb | corkscrew.rb | couchdb-lucene.rb | couchdb.rb | couchpotatoserver.rb | cowpatty.rb | cowsay.rb | cpanminus.rb | cpansearch.rb | cpmtools.rb | cpp-netlib.rb | cppcheck.rb | cppdom.rb | cppformat.rb | cppi.rb | cpptest.rb | cppunit.rb | cpputest.rb | cproto.rb | cpulimit.rb | cputhrottle.rb | cracklib-words.rb | cracklib.rb | crash.rb | creduce.rb | crf++.rb | crm114.rb | cronolog.rb | crosstool-ng.rb | crunch.rb | crush-tools.rb | cryptol.rb | cryptopp.rb | crystal.rb | crystax-ndk.rb | cscope.rb | csfml.rb | csmith.rb | cspice.rb | css-crush.rb | cssembed.rb | csshx.rb | csup.rb | csv-fix.rb | csvprintf.rb | csync.rb | ctags.rb | ctail.rb | ctemplate.rb | ctl.rb | ctorrent.rb | ctunnel.rb | cuetools.rb | cunit.rb | cups-pdf.rb | curaengine.rb | curl.rb | curlish.rb | curlpp.rb | cutter.rb | cuty_capt.rb | cvc4.rb | cvs.rb | cvs2svn.rb | cvsps.rb | cvsutils.rb | cvsync.rb | cweb.rb | cxxtest.rb | cyassl.rb | czmq.rb | d-bus.rb | daemon.rb | daemonize.rb | daemonlogger.rb | daemontools.rb | dante.rb | daq.rb | dar.rb | darcs.rb | dark-mode.rb | darkhttpd.rb | darkice.rb | darkstat.rb | dash.rb | dasm.rb | dateutils.rb | datomic.rb | davix.rb | davmail.rb | dbacl.rb | dbus-glib.rb | dc3dd.rb | dcal.rb | dcd.rb | dcfldd.rb | dcled.rb | dcmtk.rb | dcraw.rb | ddar.rb | ddate.rb | ddclient.rb | ddrescue.rb | debianutils.rb | deheader.rb | deis.rb | deisctl.rb | deja-gnu.rb | delta.rb | denominator.rb | depqbf.rb | detox.rb | devil.rb | devtodo.rb | dex.rb | dex2jar.rb | dfc.rb | dfu-programmer.rb | dfu-util.rb | dhcpdump.rb | dhcping.rb | dhex.rb | di.rb | dialog.rb | dict.rb | diction.rb | dieharder.rb | diff-pdf.rb | diffuse.rb | dirac.rb | dircproxy.rb | direnv.rb | dirmngr.rb | dirt.rb | disco.rb | discodex.rb | discount.rb | disktype.rb | distcc.rb | distribution.rb | ditaa.rb | djbdns.rb | djview4.rb | djvu2pdf.rb | djvulibre.rb | dmalloc.rb | dmd.rb | dmtx-utils.rb | dns2tcp.rb | dnscrypt-proxy.rb | dnscrypt-wrapper.rb | dnsmap.rb | dnsmasq.rb | dnsperf.rb | dnsrend.rb | dnstop.rb | dnstracer.rb | docbook-xsl.rb | docbook.rb | docbook2x.rb | docker-machine.rb | docker-swarm.rb | docker.rb | dockutil.rb | doitlive.rb | dos2unix.rb | double-conversion.rb | doublecpp.rb | doubledown.rb | dovecot.rb | doxygen.rb | doxymacs.rb | dpkg.rb | drake.rb | drip.rb | dropbear.rb | dsd.rb | dsh.rb | dsocks.rb | dtach.rb | dtc.rb | dterm.rb | dtrx.rb | dub.rb | duck.rb | duff.rb | duo_unix.rb | duplicity.rb | duply.rb | duti.rb | dvd+rw-tools.rb | dvdauthor.rb | dvdbackup.rb | dvdrtools.rb | dvorak7min.rb | dvtm.rb | dwarf.rb | dwatch.rb | dwdiff.rb | dxflib.rb | dyld-headers.rb | dylibbundler.rb | dynamips.rb | dynamodb-local.rb | e2fsprogs.rb | easy-git.rb | ebook-tools.rb | ec2-ami-tools.rb | ec2-api-tools.rb | ecasound.rb | echoping.rb | echoprint-codegen.rb | ecj.rb | ecl.rb | ecm.rb | edelta.rb | editorconfig.rb | ee.rb | eet.rb | efl.rb | eigen.rb | eina.rb | ejabberd.rb | ejdb.rb | ekg2.rb | ekhtml.rb | elasticsearch.rb | elb-tools.rb | elementary.rb | elinks.rb | elixir-build.rb | elixir.rb | emacs-clang-complete-async.rb | emacs.rb | embryo.rb | embulk.rb | emscripten.rb | enca.rb | enchant.rb | enet.rb | engine_pkcs11.rb | enscript.rb | ent.rb | entr.rb | envchain.rb | envv.rb | eot-utils.rb | epeg.rb | epic5.rb | eprover.rb | epsilon.rb | epstool.rb | epubcheck.rb | erlang.rb | es.rb | esniper.rb | esound.rb | espeak.rb | etcd.rb | etl.rb | ettercap.rb | euca2ools.rb | euler-py.rb | evas-generic-loaders.rb | evas.rb | eventlog.rb | ex-vi.rb | exact-image.rb | exempi.rb | exenv.rb | exif.rb | exiftags.rb | exiftool.rb | exim.rb | exiv2.rb | exodriver.rb | expat.rb | eye-d3.rb | ezlupdate.rb | ezstream.rb | f3.rb | faac.rb | faad2.rb | fabric.rb | fail2ban.rb | fakeroot.rb | falcon.rb | fantom.rb | fasd.rb | fastbit.rb | fastjar.rb | fatsort.rb | fb-adb.rb | fb-client.rb | fbida.rb | fcgi.rb | fcgiwrap.rb | fcrackzip.rb | fdclone.rb | fdk-aac.rb | fdupes.rb | fetch-crl.rb | fex.rb | ffe.rb | ffind.rb | ffmbc.rb | ffmpeg.rb | ffmpeg2theora.rb | ffmpegthumbnailer.rb | ffms2.rb | ffts.rb | fftw.rb | fibjs.rb | ficy.rb | fig.rb | figlet.rb | finatra.rb | findbugs.rb | findutils.rb | fio.rb | fish.rb | fits.rb | fizsh.rb | flac.rb | flac123.rb | flactag.rb | flake.rb | flashrom.rb | flasm.rb | flatbuffers.rb | flawfinder.rb | fleet-db.rb | fleetctl.rb | flex.rb | flickcurl.rb | flow-tools.rb | flow.rb | flowgrind.rb | fltk.rb | fluid-synth.rb | flvmeta.rb | flvstreamer.rb | flyway.rb | fmdiff.rb | fon-flash-cli.rb | fondu.rb | fontconfig.rb | fontforge.rb | fop.rb | forego.rb | foremost.rb | fortune.rb | fossil.rb | fourstore.rb | fpc.rb | fping.rb | fpp.rb | frag_find.rb | fragroute.rb | freealut.rb | freediameter.rb | freeimage.rb | freeipmi.rb | freeling.rb | freeradius-server.rb | freeswitch.rb | freetds.rb | freetype.rb | freexl.rb | frege.rb | frei0r.rb | frescobaldi.rb | fribidi.rb | fsevent_watch.rb | fsh.rb | fsharp.rb | fsw.rb | fswatch.rb | ftgl.rb | ftimes.rb | ftjam.rb | funcoeszz.rb | fuseki.rb | fuzzy-find.rb | fwknop.rb | fzf.rb | g2.rb | gabedit.rb | gaffitter.rb | galen.rb | gambit-scheme.rb | game-music-emu.rb | gammaray.rb | gammu.rb | ganglia.rb | gant.rb | garmintools.rb | gauche.rb | gauge.rb | gaul.rb | gawk.rb | gbdfed.rb | gcab.rb | gcal.rb | gcc.rb | gconf.rb | gcore.rb | gcovr.rb | gcutil.rb | gd.rb | gdal-grass.rb | gdal.rb | gdbm.rb | gdk-pixbuf.rb | gdmap.rb | gdnsd.rb | gdrive.rb | gearman.rb | gecode.rb | gegl.rb | genders.rb | gengetopt.rb | genstats.rb | geocouch.rb | geogit.rb | geographiclib.rb | geoip.rb | geoipupdate.rb | geos.rb | geoserver.rb | get-flash-videos.rb | getdns.rb | getmail.rb | gettext.rb | getxbook.rb | gexiv2.rb | gflags.rb | gforth.rb | gh.rb | ghc.rb | ghi.rb | ghostscript.rb | gibbslda.rb | gibo.rb | gifify.rb | giflib.rb | giflossy.rb | gifsicle.rb | ginac.rb | gist.rb | gistit.rb | git-annex.rb | git-archive-all.rb | git-cal.rb | git-cola.rb | git-crypt.rb | git-encrypt.rb | git-extras.rb | git-fixup.rb | git-flow-avh.rb | git-flow.rb | git-ftp.rb | git-gerrit.rb | git-hooks.rb | git-imerge.rb | git-integration.rb | git-lfs.rb | git-multipush.rb | git-now.rb | git-number.rb | git-octopus.rb | git-open.rb | git-plus.rb | git-review.rb | git-sh.rb | git-ssh.rb | git-stree.rb | git-subrepo.rb | git-test.rb | git-tf.rb | git-tracker.rb | git-url-sub.rb | git.rb | gitbucket.rb | giter8.rb | github-release.rb | gitslave.rb | gitup.rb | gl2ps.rb | glassfish.rb | glbinding.rb | glew.rb | glib-networking.rb | glib.rb | glibmm.rb | glide.rb | glm.rb | global.rb | globus-toolkit.rb | glog.rb | gloox.rb | glui.rb | gmail-backup.rb | gmediaserver.rb | gmime.rb | gmp.rb | gmtl.rb | gnatsd.rb | gnome-common.rb | gnome-doc-utils.rb | gnome-icon-theme.rb | gnu-apl.rb | gnu-barcode.rb | gnu-cobol.rb | gnu-getopt.rb | gnu-indent.rb | gnu-prolog.rb | gnu-sed.rb | gnu-smalltalk.rb | gnu-tar.rb | gnu-time.rb | gnu-typist.rb | gnu-units.rb | gnu-which.rb | gnupg-pkcs11-scd.rb | gnupg.rb | gnupg2.rb | gnuplot.rb | gnustep-make.rb | gnutls.rb | go-app-engine-32.rb | go-app-engine-64.rb | go.rb | goaccess.rb | gobject-introspection.rb | gocr.rb | goffice.rb | golo.rb | goocanvas.rb | google-app-engine.rb | google-perftools.rb | google-sparsehash.rb | google-sql-tool.rb | googlecl.rb | goolabs.rb | gost.rb | gosu.rb | gource.rb | gpac.rb | gpg-agent.rb | gpgme.rb | gphoto2.rb | gplcver.rb | gpm.rb | gpp.rb | gpsbabel.rb | gpsd.rb | gpsim.rb | gptfdisk.rb | gptsync.rb | gputils.rb | gqlplus.rb | gqview.rb | gradle.rb | grails.rb | grap.rb | graphicsmagick.rb | graphviz.rb | grass.rb | grc.rb | grepcidr.rb | grib-api.rb | griffon.rb | gringo.rb | grok.rb | groonga-normalizer-mysql.rb | groonga.rb | groovy.rb | groovysdk.rb | groovyserv.rb | growly.rb | grsync.rb | gsasl.rb | gsettings-desktop-schemas.rb | gsl.rb | gsoap.rb | gssdp.rb | gssh.rb | gst-libav.rb | gst-plugins-bad.rb | gst-plugins-base.rb | gst-plugins-good.rb | gst-plugins-ugly.rb | gst-python.rb | gst-validate.rb | gstreamer.rb | gti.rb | gtk+.rb | gtk+3.rb | gtk-doc.rb | gtk-engines.rb | gtk-gnutella.rb | gtk-mac-integration.rb | gtk-murrine-engine.rb | gtkdatabox.rb | gtkextra.rb | gtkglext.rb | gtkmm.rb | gtkmm3.rb | gtksourceview.rb | gtksourceview3.rb | gtkspell3.rb | gtmess.rb | gts.rb | guile.rb | gumbo-parser.rb | gupnp-av.rb | gupnp-tools.rb | gupnp.rb | gvp.rb | gwenhywfar.rb | gws.rb | gwt.rb | gwyddion.rb | gzrt.rb | h2.rb | h264bitstream.rb | h2o.rb | hachoir-metadata.rb | hackrf.rb | hadoop.rb | halibut.rb | hamlib.rb | hamsterdb.rb | haproxy.rb | harbour.rb | hardlink-osx.rb | hardlink.rb | harfbuzz.rb | hashcash.rb | hashpump.rb | haxe.rb | hbase.rb | headphones.rb | hebcal.rb | hello.rb | help2man.rb | henplus.rb | hercules.rb | heroku-toolbelt.rb | herrie.rb | hevea.rb | hexcurse.rb | hexedit.rb | hfsutils.rb | hg-flow.rb | hh.rb | hicolor-icon-theme.rb | hidapi.rb | highlight.rb | highlighting-kate.rb | hilite.rb | hiredis.rb | hive.rb | hoedown.rb | homebank.rb | honcho.rb | honeyd.rb | horndis.rb | hornetq.rb | hostdb.rb | hping.rb | hqx.rb | hr.rb | ht.rb | html-xml-utils.rb | html2text.rb | htmlcleaner.rb | htmlcompressor.rb | htmlcxx.rb | htmldoc.rb | htop-osx.rb | htpdate.rb | http-parser.rb | http_load.rb | httperf.rb | httpie.rb | httping.rb | httpry.rb | httptunnel.rb | httrack.rb | hub.rb | hubflow.rb | hugo.rb | hunspell.rb | hydra.rb | hyperestraier.rb | hyperspec.rb | i2util.rb | iat.rb | ical-buddy.rb | icarus-verilog.rb | icbirc.rb | icdiff.rb | ice.rb | icecast.rb | icecream.rb | icon-naming-utils.rb | icon.rb | icoutils.rb | icu4c.rb | id3ed.rb | id3lib.rb | id3tool.rb | id3v2.rb | idcomments.rb | ideviceinstaller.rb | idnits.rb | idris.rb | idutils.rb | ievms.rb | ifstat.rb | iftop.rb | ii.rb | ike-scan.rb | ilmbase.rb | imagejs.rb | imagemagick.rb | imagesnap.rb | imageworsener.rb | imap-uw.rb | imapfilter.rb | imapsync.rb | imlib2.rb | influxdb.rb | iniparser.rb | innoextract.rb | innotop.rb | ino.rb | inspircd.rb | intercal.rb | internetarchive.rb | intltool.rb | io.rb | iodine.rb | iojs.rb | ioke.rb | ioping.rb | ios-class-guard.rb | ios-sim.rb | ios-webkit-debug-proxy.rb | iozone.rb | ip_relay.rb | ipbt.rb | ipcalc.rb | ipe.rb | iperf.rb | iperf3.rb | iphotoexport.rb | ipinfo.rb | ipmitool.rb | ipmiutil.rb | iprint.rb | ipsumdump.rb | ipv6calc.rb | ipv6toolkit.rb | ircd-hybrid.rb | ircd-irc2.rb | ircii.rb | irods.rb | irrlicht.rb | irrtoolset.rb | irssi.rb | isc-dhcp.rb | isl.rb | iso-codes.rb | ispc.rb | ispell.rb | isync.rb | itex2mml.rb | itpp.rb | itstool.rb | ivy.rb | jack.rb | jags.rb | jailkit.rb | jam.rb | jansson.rb | jasmin.rb | jasper.rb | javarepl.rb | jbake.rb | jbig2dec.rb | jbig2enc.rb | jbigkit.rb | jboss-as.rb | jboss-forge.rb | jcal.rb | jdnssec-tools.rb | jed.rb | jemalloc.rb | jena.rb | jenkins-job-builder.rb | jenkins.rb | jenv.rb | jerm.rb | jetty-runner.rb | jetty.rb | jhead.rb | jhiccup.rb | jigdo.rb | jing.rb | jless.rb | jlog.rb | jmeter.rb | jmxtrans.rb | jnettop.rb | joe.rb | john-jumbo.rb | john.rb | jooby-bootstrap.rb | jove.rb | jp2a.rb | jpeg-archive.rb | jpeg-turbo.rb | jpeg.rb | jpeginfo.rb | jpegoptim.rb | jpegrescan.rb | jq.rb | jrnl.rb | jruby.rb | js-test-driver.rb | jsawk.rb | jsdoc-toolkit.rb | jsdoc3.rb | jshon.rb | jslint4java.rb | jsmin.rb | json-c.rb | json-fortran.rb | json-glib.rb | json_spirit.rb | jsoncpp.rb | jsonpp.rb | jsvc.rb | judy.rb | juise.rb | juju-quickstart.rb | juju.rb | julius.rb | juman.rb | jvgrep.rb | jvmtop.rb | jython.rb | kafka.rb | kafkacat.rb | kakasi.rb | kanif.rb | karn.rb | kawa.rb | kbtin.rb | kdiff3.rb | keepassc.rb | kes.rb | kestrel.rb | kettle.rb | keybase.rb | keychain.rb | kibana.rb | kimwitu++.rb | kitchen-sync.rb | kite.rb | kjell.rb | knock.rb | knot.rb | known_hosts.rb | konoha.rb | kore.rb | kotlin-compiler.rb | kqwait.rb | ksh.rb | kstart.rb | ktoblzcheck.rb | kubernetes-cli.rb | kvazaar.rb | kyoto-cabinet.rb | kyoto-tycoon.rb | kytea.rb | kyua.rb | l-smash.rb | lablgtk.rb | lame.rb | languagetool.rb | lasi.rb | lastfmfpclient.rb | lastfmlib.rb | lastpass-cli.rb | laszip.rb | latex2html.rb | latex2rtf.rb | launch.rb | launch4j.rb | launchdns.rb | lbdb.rb | lbzip2.rb | lcab.rb | lcdf-typetools.rb | lcdproc.rb | lci.rb | lcov.rb | lcrack.rb | ld64.rb | ldapvi.rb | ldc.rb | ldns.rb | le.rb | leafnode.rb | ledger.rb | ledit.rb | legit.rb | leiningen.rb | lemon.rb | lensfun.rb | leptonica.rb | lesspipe.rb | lesstif.rb | leveldb.rb | lfe.rb | lft.rb | lftp.rb | lha.rb | lhasa.rb | lib3ds.rb | libaacs.rb | libagg.rb | libantlr3c.rb | libao.rb | libarchive.rb | libart.rb | libass.rb | libassuan.rb | libatomic_ops.rb | libav.rb | libb2.rb | libbind.rb | libbinio.rb | libbluray.rb | libbpg.rb | libbs2b.rb | libbson.rb | libbtbb.rb | libcaca.rb | libcanberra.rb | libcapn.rb | libcddb.rb | libcdio.rb | libcdr.rb | libcec.rb | libcello.rb | libcmph.rb | libcoap.rb | libconfig.rb | libcouchbase.rb | libcppa.rb | libcroco.rb | libcsv.rb | libcue.rb | libcuefile.rb | libdaemon.rb | libdap.rb | libdbi.rb | libdbusmenu-qt.rb | libdc1394.rb | libdca.rb | libdiscid.rb | libdmtx.rb | libdnet.rb | libdrawtext.rb | libdshconfig.rb | libdsk.rb | libdv.rb | libdvbpsi.rb | libdvdcss.rb | libdvdnav.rb | libdvdread.rb | libebml.rb | libebur128.rb | libechonest.rb | libelf.rb | libepoxy.rb | libestr.rb | libetonyek.rb | libev.rb | libevent.rb | libewf.rb | libexif.rb | libexosip.rb | libextractor.rb | libfaketime.rb | libffi.rb | libfishsound.rb | libfixbuf.rb | libflowmanager.rb | libforensic1394.rb | libfreefare.rb | libfreehand.rb | libfreenect.rb | libftdi.rb | libftdi0.rb | libgadu.rb | libgaiagraphics.rb | libgcrypt.rb | libgda.rb | libgee.rb | libgeotiff.rb | libgetdata.rb | libgfshare.rb | libghthash.rb | libgit2-glib.rb | libgit2.rb | libglade.rb | libglademm.rb | libgnomecanvas.rb | libgnomecanvasmm.rb | libgpg-error.rb | libgphoto2.rb | libgroove.rb | libgsf.rb | libgsm.rb | libgtop.rb | libgxps.rb | libharu.rb | libhdhomerun.rb | libhid.rb | libical.rb | libicns.rb | libid3tag.rb | libident.rb | libidl.rb | libidn.rb | libimobiledevice.rb | libinfinity.rb | libiomp.rb | libiptcdata.rb | libiscsi.rb | libjson-rpc-cpp.rb | libkate.rb | libkml.rb | libksba.rb | liblacewing.rb | liblas.rb | liblastfm.rb | liblinear.rb | liblo.rb | liblockfile.rb | liblqr.rb | libltc.rb | liblunar.rb | liblwgeom.rb | libmaa.rb | libmagic.rb | libmarisa.rb | libmatroska.rb | libmaxminddb.rb | libmemcached.rb | libmetalink.rb | libmicrohttpd.rb | libmikmod.rb | libming.rb | libmms.rb | libmodbus.rb | libmodplug.rb | libmongoclient.rb | libmonome.rb | libmowgli.rb | libmp3splt.rb | libmpc.rb | libmpd.rb | libmpdclient.rb | libmpeg2.rb | libmrss.rb | libmspub.rb | libmtp.rb | libmusicbrainz.rb | libmxml.rb | libnatpmp.rb | libnet.rb | libnfc.rb | libnfs.rb | libnice.rb | libnids.rb | libntlm.rb | libnxml.rb | liboauth.rb | libodbc++.rb | libodfgen.rb | libofx.rb | libogg.rb | liboil.rb | libopendkim.rb | libopennet.rb | liboping.rb | libopkele.rb | libosip.rb | libotr.rb | libowfat.rb | libp11.rb | libpagemaker.rb | libpano.rb | libpcl.rb | libpgm.rb | libplist.rb | libpng.rb | libpointing.rb | libpoker-eval.rb | libpqxx.rb | libpst.rb | libpuzzle.rb | libqalculate.rb | libqglviewer.rb | libquicktime.rb | libquvi.rb | librasterlite.rb | libraw.rb | librcsc.rb | librdkafka.rb | libre.rb | libreadline-java.rb | librem.rb | libreplaygain.rb | libresample.rb | libressl.rb | librevenge.rb | librsvg.rb | librsync.rb | librtlsdr.rb | libsamplerate.rb | libsass.rb | libscrypt.rb | libsecret.rb | libshout.rb | libsigc++.rb | libsigsegv.rb | libslax.rb | libsmf.rb | libsmi.rb | libsndfile.rb | libsodium.rb | libsoup.rb | libsoxr.rb | libspatialite.rb | libspiro.rb | libssh.rb | libssh2.rb | libstfl.rb | libstrophe.rb | libstxxl.rb | libsvg-cairo.rb | libsvg.rb | libsvm.rb | libswiften.rb | libtar.rb | libtasn1.rb | libtecla.rb | libtermkey.rb | libtess2.rb | libtextcat.rb | libtiff.rb | libtins.rb | libtomcrypt.rb | libtommath.rb | libtool.rb | libtorrent-rasterbar.rb | libtorrent.rb | libtrace.rb | libunistring.rb | libunwind-headers.rb | libupnp.rb | libusb-compat.rb | libusb.rb | libusrsctp.rb | libutf.rb | libuv.rb | libuvc.rb | libvbucket.rb | libvidstab.rb | libvirt.rb | libvisio.rb | libvo-aacenc.rb | libvoikko.rb | libvorbis.rb | libvpx.rb | libwbxml.rb | libwebsockets.rb | libwmf.rb | libwpd.rb | libwpg.rb | libwps.rb | libxc.rb | libxdg-basedir.rb | libxdiff.rb | libxmi.rb | libxml++.rb | libxml2.rb | libxmlsec1.rb | libxmp-lite.rb | libxmp.rb | libxslt.rb | libxspf.rb | libyaml.rb | libyubikey.rb | libzdb.rb | libzip.rb | libzzip.rb | lifelines.rb | lightning.rb | lighttpd.rb | lilv.rb | link-grammar.rb | linklint.rb | links.rb | liquibase.rb | liquidprompt.rb | litmus.rb | little-cms.rb | little-cms2.rb | lldpd.rb | llvm.rb | lmdb.rb | lnav.rb | lockrun.rb | log4c.rb | log4cplus.rb | log4cpp.rb | log4cxx.rb | log4shib.rb | logcheck.rb | logentries.rb | logrotate.rb | logstalgia.rb | logstash.rb | logtalk.rb | lolcode.rb | lorem.rb | loudmouth.rb | lout.rb | lpc21isp.rb | lrdf.rb | lrzip.rb | lrzsz.rb | lsdvd.rb | lsh.rb | lsyncd.rb | ltc-tools.rb | ltl2ba.rb | lua.rb | lua51.rb | luabind.rb | luajit.rb | luciddb.rb | lutok.rb | luvit.rb | luyten.rb | lv.rb | lv2.rb | lwtools.rb | lxsplit.rb | lynis.rb | lynx.rb | lysp.rb | lz4.rb | lzip.rb | lzlib.rb | lzo.rb | lzop.rb | mac-robber.rb | mackup.rb | macvim.rb | mad.rb | madplay.rb | magit.rb | mahout.rb | mailcheck.rb | mailutils.rb | mairix.rb | makedepend.rb | makefile2graph.rb | makeicns.rb | makensis.rb | makepkg.rb | makepp.rb | makeself.rb | mal4s.rb | malaga.rb | malbolge.rb | man2html.rb | mandoc.rb | mapnik.rb | mapserver.rb | mariadb.rb | markdown.rb | marst.rb | masscan.rb | mat.rb | matlab2tikz.rb | maven-shell.rb | maven.rb | mawk.rb | mbelib.rb | mboxgrep.rb | mcabber.rb | mcpp.rb | mcrypt.rb | md.rb | md5deep.rb | md5sha1sum.rb | mda-lv2.rb | mdbtools.rb | mdf2iso.rb | mdk.rb | mdp.rb | mdr.rb | mdxmini.rb | mecab-ipadic.rb | mecab-jumandic.rb | mecab-ko-dic.rb | mecab-ko.rb | mecab-unidic.rb | mecab.rb | media-info.rb | mediatomb.rb | megacmd.rb | megatools.rb | memcache-top.rb | memcached.rb | memcacheq.rb | memo.rb | memtester.rb | menhir.rb | mercurial.rb | mercury.rb | mergelog.rb | mergepbx.rb | mesos.rb | metaproxy.rb | metashell.rb | mfcuk.rb | mfoc.rb | mftrace.rb | mg.rb | mhash.rb | midgard2.rb | midicsv.rb | midnight-commander.rb | mighttpd2.rb | mikmod.rb | mimms.rb | minbif.rb | minicom.rb | minidjvu.rb | minidlna.rb | minimodem.rb | minisat.rb | minised.rb | miniupnpc.rb | minizinc.rb | minizip.rb | minuit2.rb | miredo.rb | miruo.rb | mitie.rb | mitmproxy.rb | mjpegtools.rb | mkclean.rb | mkcue.rb | mksh.rb | mktorrent.rb | mkvalidator.rb | mkvdts2ac3.rb | mkvtomp4.rb | mkvtoolnix.rb | mldonkey.rb | mlogger.rb | mlt.rb | mm-common.rb | mmix.rb | mmsrip.rb | mmv.rb | mobile-shell.rb | mobiledevice.rb | moc.rb | mockserver.rb | moco.rb | modman.rb | modules.rb | moe.rb | mogenerator.rb | mon.rb | monetdb.rb | mongo-c.rb | mongodb.rb | mongoose.rb | mongrel2.rb | mongroup.rb | monit.rb | monkeysphere.rb | mono.rb | monotone.rb | montage.rb | moreutils.rb | mosquitto.rb | most.rb | movgrab.rb | mozilla-addon-sdk.rb | mozjpeg.rb | mp3blaster.rb | mp3cat.rb | mp3check.rb | mp3gain.rb | mp3info.rb | mp3splt.rb | mp3val.rb | mp3wrap.rb | mp4v2.rb | mpack.rb | mpc.rb | mpck.rb | mpd.rb | mpdas.rb | mpdscribble.rb | mpdviz.rb | mpegdemux.rb | mpfi.rb | mpfr.rb | mpg123.rb | mpg321.rb | mpgtx.rb | mpich2.rb | mplayer.rb | mplayershell.rb | mpop.rb | mpssh.rb | mpw.rb | mr.rb | mrtg.rb | mruby.rb | msdl.rb | msgpack.rb | msitools.rb | msktutil.rb | msmtp.rb | mspdebug.rb | mtools.rb | mtr.rb | mu.rb | multimarkdown.rb | multirust.rb | multitail.rb | muparser.rb | mupdf-tools.rb | musepack.rb | mussh.rb | mutt.rb | mvnvm.rb | mvptree.rb | mypy.rb | mysql++.rb | mysql-cluster.rb | mysql-connector-c++.rb | mysql-connector-c.rb | mysql-connector-odbc.rb | mysql-proxy.rb | mysql-sandbox.rb | mysql-search-replace.rb | mysql.rb | mysqltuner.rb | mytop.rb | n.rb | nacl.rb | nagios-plugins.rb | nagios.rb | nailgun.rb | namazu.rb | namebench.rb | nanomsg.rb | nanopb-generator.rb | nant.rb | narwhal.rb | nasm.rb | natalie.rb | naturaldocs.rb | nave.rb | nbimg.rb | ncdc.rb | ncdu.rb | ncftp.rb | ncmpc.rb | ncmpcpp.rb | ncp.rb | ncrack.rb | ndiff.rb | ndpi.rb | negfix8.rb | neko.rb | neo4j.rb | neon.rb | nesc.rb | net-snmp.rb | net6.rb | netcat.rb | netcat6.rb | netpbm.rb | netperf.rb | nettle.rb | newlisp.rb | newsbeuter.rb | newt.rb | nexus.rb | nfcutils.rb | nfdump.rb | nghttp2.rb | nginx.rb | ngircd.rb | ngrep.rb | ngrok.rb | ngspice.rb | nickle.rb | nicovideo-dl.rb | nikto.rb | nimrod.rb | ninja-ide.rb | ninja.rb | nkf.rb | nload.rb | nmap.rb | node.rb | nodebrew.rb | nodenv.rb | nordugrid-arc.rb | normalize.rb | notmuch.rb | noweb.rb | npth.rb | nrg2iso.rb | nrpe.rb | nsd.rb | nspr.rb | nsq.rb | nss.rb | ntl.rb | ntopng.rb | nu.rb | num-utils.rb | nut.rb | nutcracker.rb | nuttcp.rb | nvi.rb | nvm.rb | nylon.rb | nzbget.rb | oath-toolkit.rb | objc-codegenutils.rb | objc-run.rb | objective-caml.rb | ocamlsdl.rb | ocp.rb | ocrad.rb | ode.rb | odo.rb | odt2txt.rb | offline-imap.rb | oggz.rb | ogmtools.rb | ohcount.rb | ola.rb | olsrd.rb | omega.rb | omniorb.rb | ondir.rb | one-ml.rb | onepass.rb | onetime.rb | oniguruma.rb | ooniprobe.rb | opam.rb | open-babel.rb | open-cobol.rb | open-mesh.rb | open-mpi.rb | open-ocd.rb | open-scene-graph.rb | open-sp.rb | open-vcdiff.rb | open-zwave.rb | openal-soft.rb | opencbm.rb | opencc.rb | opencolorio.rb | openconnect.rb | opencore-amr.rb | opendbx.rb | opendetex.rb | openexr.rb | openh264.rb | openhmd.rb | openjpeg.rb | openlitespeed.rb | openrtsp.rb | opensaml.rb | opensc.rb | openslide.rb | openslp.rb | openssl.rb | openvpn.rb | openwsman.rb | ophcrack.rb | optipng.rb | opus-tools.rb | opus.rb | opusfile.rb | orbit.rb | orc.rb | orfeo.rb | orientdb.rb | orpie.rb | ortp.rb | oscats.rb | osh.rb | osm-pbf.rb | osm2pgrouting.rb | osm2pgsql.rb | osmosis.rb | osquery.rb | osslsigncode.rb | ossp-uuid.rb | osxfuse.rb | osxutils.rb | owamp.rb | owfs.rb | p0f.rb | p11-kit.rb | p7zip.rb | pacapt.rb | packer.rb | pacvim.rb | pakchois.rb | pam_yubico.rb | pandoc-citeproc.rb | pandoc.rb | pango.rb | pangomm.rb | pangox-compat.rb | paperkey.rb | paps.rb | paq8px.rb | par.rb | par2.rb | par2tbb.rb | parallel.rb | parrot.rb | partio.rb | pass.rb | passenger.rb | passpie.rb | pastebinit.rb | patchutils.rb | pax-construct.rb | pax-runner.rb | pazpar2.rb | pbc-sig.rb | pbc.rb | pbrt.rb | pbzip2.rb | pcal.rb | pcap_dnsproxy.rb | pce.rb | pcre++.rb | pcre.rb | pcre2.rb | pcsc-lite.rb | pdal.rb | pdf-redact-tools.rb | pdf-tools.rb | pdf2htmlex.rb | pdf2json.rb | pdfcrack.rb | pdfgrep.rb | pdflib-lite.rb | pdftohtml.rb | pdksh.rb | pdns.rb | pdnsd.rb | pdnsrec.rb | pdsh.rb | peco.rb | peervpn.rb | peg-markdown.rb | peg.rb | perceptualdiff.rb | percona-server.rb | percona-toolkit.rb | perl-build.rb | perl.rb | perlmagick.rb | pev.rb | pex.rb | pg_top.rb | pgbadger.rb | pgbouncer.rb | pgcli.rb | pgdbf.rb | pgformatter.rb | pgloader.rb | pgpdump.rb | pgpool-ii.rb | pgrouting.rb | pgtap.rb | pgtune.rb | phantomjs.rb | phash.rb | phoon.rb | phoronix-test-suite.rb | physfs.rb | pianobar.rb | pianod.rb | picoc.rb | picocom.rb | picolisp.rb | pidcat.rb | pidgin.rb | pidof.rb | pig.rb | pigz.rb | pike.rb | pillar.rb | pincaster.rb | pinentry-mac.rb | pinentry.rb | pipebench.rb | pipemeter.rb | pit.rb | pius.rb | pixman.rb | pixz.rb | pjproject.rb | pk.rb | pkcrack.rb | pkcs11-helper.rb | pkg-config.rb | pkgdiff.rb | pktanon.rb | pla.rb | plan9port.rb | plantuml.rb | platypus.rb | plenv.rb | plod.rb | plotutils.rb | plowshare.rb | plplot.rb | plt-racket.rb | plustache.rb | plzip.rb | pmccabe.rb | pmd.rb | pmdmini.rb | pms.rb | png++.rb | png2ico.rb | pngcheck.rb | pngcrush.rb | pngnq.rb | pngpaste.rb | pngquant.rb | poco.rb | podiff.rb | podofo.rb | points2grid.rb | polarssl.rb | polipo.rb | polygen.rb | polyml.rb | ponyc.rb | ponysay.rb | poppler.rb | popt.rb | portaudio.rb | portmidi.rb | poster.rb | postgis.rb | postgres-xc.rb | postgresql.rb | postmark.rb | potrace.rb | pound.rb | povray.rb | pow.rb | powerman.rb | ppss.rb | pre-commit.rb | predictionio.rb | premake.rb | prettyping.rb | primesieve.rb | prips.rb | privoxy.rb | probatron4j.rb | proctools.rb | profanity.rb | proftpd.rb | proguard.rb | proj.rb | proof-general.rb | protobuf-c.rb | protobuf-swift.rb | protobuf.rb | proxychains-ng.rb | proxytunnel.rb | ps2eps.rb | psftools.rb | psgrep.rb | psqlodbc.rb | pssh.rb | pstoedit.rb | pstree.rb | psutils.rb | ptex.rb | pth.rb | ptunnel.rb | puf.rb | pulledpork.rb | pulseaudio.rb | pup.rb | pure-ftpd.rb | purescript.rb | pushpin.rb | putmail-queue.rb | putmail.rb | putty.rb | pv.rb | pwgen.rb | pwnat.rb | pwntools.rb | pwsafe.rb | pxz.rb | py2cairo.rb | py3cairo.rb | pyenv-ccache.rb | pyenv-pip-migrate.rb | pyenv-virtualenv.rb | pyenv-virtualenvwrapper.rb | pyenv-which-ext.rb | pyenv.rb | pyexiv2.rb | pygobject.rb | pygobject3.rb | pygtk.rb | pygtkglext.rb | pygtksourceview.rb | pylucene.rb | pypy.rb | pypy3.rb | pyqt.rb | pyqt5.rb | pyqwt.rb | pyside-tools.rb | pyside.rb | python.rb | python3.rb | q.rb | qbs.rb | qca.rb | qcachegrind.rb | qd.rb | qdbm.rb | qemu.rb | qi.rb | qjson.rb | qpdf.rb | qprint.rb | qrencode.rb | qscintilla2.rb | qstat.rb | qt.rb | qt5.rb | qtfaststart.rb | qtplay.rb | quantlib.rb | quassel.rb | quazip.rb | queequeg.rb | quex.rb | quilt.rb | quotatool.rb | quvi.rb | qwt.rb | qwtpolar.rb | qxmpp.rb | r3.rb | rabbitmq-c.rb | rabbitmq.rb | radamsa.rb | radare2.rb | ragel.rb | rainbarf.rb | rakudo-star.rb | rancid.rb | randomize-lines.rb | ranger.rb | rapidjson.rb | raptor.rb | rarian.rb | rasqal.rb | rats.rb | rbenv-aliases.rb | rbenv-binstubs.rb | rbenv-bundle-exec.rb | rbenv-bundler-ruby-version.rb | rbenv-bundler.rb | rbenv-communal-gems.rb | rbenv-ctags.rb | rbenv-default-gems.rb | rbenv-gem-rehash.rb | rbenv-gemset.rb | rbenv-readline.rb | rbenv-use.rb | rbenv-vars.rb | rbenv-whatis.rb | rbenv.rb | rc.rb | rcs.rb | rcssserver.rb | rdate.rb | rdfind.rb | rdiff-backup.rb | rds-command-line-tools.rb | rdup.rb | re2.rb | re2c.rb | readline.rb | readosm.rb | reattach-to-user-namespace.rb | reaver.rb | rebar.rb | reclass.rb | recode.rb | recoverjpeg.rb | recutils.rb | redir.rb | redis.rb | redland.rb | redo.rb | redpen.rb | redshift.rb | redsocks.rb | redstore.rb | regex-opt.rb | regina-rexx.rb | regldg.rb | remake.rb | remarshal.rb | remctl.rb | remind.rb | ren.rb | rename.rb | renameutils.rb | reop.rb | repl.rb | repo.rb | reposurgeon.rb | rest-shell.rb | restund.rb | resty.rb | rethinkdb.rb | rexster-console.rb | rexster.rb | rfcdiff.rb | rfcmarkup.rb | rfcstrip.rb | rgbds.rb | rhash.rb | rhino.rb | riak.rb | riemann-client.rb | riemann.rb | rig.rb | rinetd.rb | ringojs.rb | ripmime.rb | rkflashtool.rb | rkhunter.rb | rlog.rb | rlwrap.rb | rmate.rb | rmcast.rb | rmtrash.rb | rnv.rb | robodoc.rb | rock.rb | rocket.rb | rocksdb.rb | rolldice.rb | roundup.rb | rp.rb | rpg.rb | rpl.rb | rpm.rb | rpm2cpio.rb | rrdtool.rb | rsense.rb | rsnapshot.rb | rssh.rb | rsstail.rb | rsyslog.rb | rt-audio.rb | rtf2latex2e.rb | rtmpdump.rb | rtorrent.rb | rtpbreak.rb | rubber.rb | ruby-build.rb | ruby-install.rb | ruby.rb | runcocoa.rb | runit.rb | rush.rb | rust.rb | ry.rb | rzip.rb | s-lang.rb | s3cmd.rb | s3sync.rb | safe-rm.rb | saltstack.rb | sam2p.rb | samba.rb | sane-backends.rb | sary.rb | sassc.rb | savana.rb | saxon-b.rb | saxon.rb | sbcl.rb | sblim-sfcc.rb | sbt.rb | sbtenv.rb | sbuild.rb | sc68.rb | scala.rb | scalaenv.rb | scalariform.rb | scalastyle.rb | scale2x.rb | scamper.rb | scheme48.rb | schroedinger.rb | scm-manager.rb | scons.rb | screenbrightness.rb | screenfetch.rb | screenresolution.rb | scriptcs.rb | scrollkeeper.rb | scrub.rb | scrypt.rb | scsh.rb | sdcc.rb | sdcv.rb | sdf.rb | sdhash.rb | sdl.rb | sdl2.rb | sdl2_gfx.rb | sdl2_image.rb | sdl2_mixer.rb | sdl2_net.rb | sdl2_ttf.rb | sdl_gfx.rb | sdl_image.rb | sdl_mixer.rb | sdl_net.rb | sdl_rtf.rb | sdl_sound.rb | sdl_ttf.rb | sec.rb | sedna.rb | seexpr.rb | selecta.rb | selenium-server-standalone.rb | sendemail.rb | ser2net.rb | serd.rb | serialosc.rb | sersniff.rb | setweblocthumb.rb | sf-pwgen.rb | sfcgal.rb | sfk.rb | sflowtool.rb | sfml.rb | sgrep.rb | sha2.rb | shadowsocks-libev.rb | shakespeare.rb | shapelib.rb | shared-mime-info.rb | shellcheck.rb | shellinabox.rb | shiboken.rb | shivavg.rb | shmcat.rb | shmux.rb | shntool.rb | shocco.rb | shorten.rb | shpotify.rb | shrewsoft-vpn-client.rb | shtool.rb | shunit2.rb | sic.rb | sickbeard.rb | siege.rb | signify-osx.rb | signing-party.rb | silc-client.rb | silk.rb | simgrid.rb | simh.rb | simple-amqp-client.rb | simple-tiles.rb | since.rb | sip.rb | sipcalc.rb | sipp.rb | sipsak.rb | sisc-scheme.rb | sispmctl.rb | skinny.rb | skipfish.rb | skktools.rb | skytools.rb | sl.rb | sleepwatcher.rb | sleuthkit.rb | slimerjs.rb | sloccount.rb | slony.rb | slowhttptest.rb | slrn.rb | slurm.rb | smake.rb | smali.rb | smartmontools.rb | smartypants.rb | smlnj.rb | snap7.rb | snappy.rb | snappystream.rb | snapraid.rb | sngrep.rb | snobol4.rb | snort.rb | snow.rb | snownews.rb | sntop.rb | snzip.rb | socat.rb | soccerwindow2.rb | soci.rb | sofia-sip.rb | softhsm.rb | solid.rb | solr.rb | somagic-tools.rb | somagic.rb | sonar-runner.rb | sonar.rb | sord.rb | sound-touch.rb | source-highlight.rb | sourcekitten.rb | sox.rb | spark.rb | sparkey.rb | sparse.rb | spatialindex.rb | spatialite-gui.rb | spatialite-tools.rb | spawn-fcgi.rb | spdylay.rb | speech-tools.rb | speedtest_cli.rb | speex.rb | sphinx.rb | spidermonkey.rb | spim.rb | spin.rb | spiped.rb | splint.rb | spoof-mac.rb | spring-loaded.rb | spring-roo.rb | sproxy.rb | sqlcipher.rb | sqlite-analyzer.rb | sqlite.rb | sqlitebrowser.rb | sqliteman.rb | sqlmap.rb | sqoop.rb | sqsh.rb | sqtop.rb | squashfs.rb | squid.rb | squirrel.rb | sratom.rb | src.rb | srclib.rb | srecord.rb | srmio.rb | srtp.rb | ssdb.rb | ssdeep.rb | ssed.rb | ssh-copy-id.rb | sshguard.rb | sshrc.rb | sshtrix.rb | sshuttle.rb | ssldump.rb | sslh.rb | sslmate.rb | sslyze.rb | ssreflect.rb | ssss.rb | sstp-client.rb | st.rb | stanford-parser.rb | star.rb | stash-cli.rb | stgit.rb | stk.rb | stklos.rb | stlink.rb | stlviewer.rb | stoken.rb | stone.rb | storm.rb | stormssh.rb | stow.rb | streamripper.rb | stress.rb | strongswan.rb | stunnel.rb | stuntman.rb | style-check.rb | sub2srt.rb | subliminal.rb | submarine.rb | subnetcalc.rb | subversion.rb | suomi-malaga-voikko.rb | supersonic.rb | surfraw.rb | suricata.rb | svdlibc.rb | svg2pdf.rb | svg2png.rb | svtplay-dl.rb | swaks.rb | swatchbooker.rb | swfmill.rb | swftools.rb | swiftlint.rb | swig.rb | swish-e.rb | switchaudio-osx.rb | sword.rb | syck.rb | sync_gateway.rb | syncthing.rb | synfig.rb | synfigstudio.rb | synscan.rb | syntaxerl.rb | sysbench.rb | sysdig.rb | szip.rb | szl.rb | t1lib.rb | t1utils.rb | ta-lib.rb | tachyon.rb | tag.rb | taglib.rb | taktuk.rb | tal.rb | talk-filters.rb | talloc.rb | tarsnap.rb | task-spooler.rb | task.rb | taskd.rb | tasksh.rb | tbb.rb | tcc.rb | tclap.rb | tcpflow.rb | tcping.rb | tcpreplay.rb | tcpsplit.rb | tcptrace.rb | tcptraceroute.rb | tcptrack.rb | tcptunnel.rb | tcsh.rb | td.rb | teapot.rb | tee-clc.rb | teem.rb | teensy_loader_cli.rb | tegh.rb | telegraf.rb | telepathy-gabble.rb | telepathy-glib.rb | telepathy-idle.rb | telepathy-mission-control.rb | tenyr.rb | term.rb | terminal-notifier.rb | termrec.rb | termshare.rb | terraform.rb | tesseract.rb | testdisk.rb | tevent.rb | texapp.rb | texi2html.rb | texinfo.rb | texmath.rb | thc-pptp-bruter.rb | the_platinum_searcher.rb | the_silver_searcher.rb | thefuck.rb | theharvester.rb | theora.rb | thrift.rb | thrulay.rb | tidy-html5.rb | tidyp.rb | tiff2png.rb | tig.rb | tika.rb | timedog.rb | timelimit.rb | timidity.rb | tin.rb | tinc.rb | tintin.rb | tiny-fugue.rb | tinycdb.rb | tinyproxy.rb | tinyscheme.rb | tinysvm.rb | tinyxml.rb | tinyxml2.rb | tippecanoe.rb | titan-server.rb | tivodecode.rb | tkdiff.rb | tlassemble.rb | tlsdate.rb | tmpreaper.rb | tmpwatch.rb | tmux-cssh.rb | tmux-mem-cpu-load.rb | tmux.rb | tn5250.rb | tnef.rb | tnote.rb | todo-txt.rb | tofrodos.rb | toilet.rb | tokyo-cabinet.rb | tokyo-dystopia.rb | tokyo-tyrant.rb | tomcat-native.rb | tomcat.rb | tomee-jax-rs.rb | tomee-plume.rb | tomee-plus.rb | tomee-webprofile.rb | topgit.rb | tor.rb | torrentcheck.rb | torsocks.rb | tpl.rb | tpp.rb | tracebox.rb | tractorgen.rb | trafficserver.rb | trafshow.rb | trang.rb | transcrypt.rb | translate-toolkit.rb | transmission.rb | trash.rb | tre.rb | tree.rb | treecc.rb | treeline.rb | trr.rb | truecrack.rb | tsung.rb | tta.rb | ttf2eot.rb | ttf2pt1.rb | ttfautohint.rb | tth.rb | tty-clock.rb | ttylog.rb | ttyrec.rb | ttytter.rb | tuntap.rb | tutum.rb | tvnamer.rb | twemcache.rb | two-lame.rb | txt2man.rb | txt2tags.rb | typesafe-activator.rb | typespeed.rb | u-boot-tools.rb | uade.rb | uberftp.rb | uchardet.rb | ucl.rb | ucommon.rb | ucspi-tcp.rb | ucspi-tools.rb | udis86.rb | udns.rb | udptunnel.rb | udpxy.rb | udunits.rb | ufraw.rb | uim.rb | unac.rb | unar.rb | unarj.rb | unbound.rb | uncrustify.rb | unfs3.rb | uni2ascii.rb | unifdef.rb | unison.rb | unittest-cpp.rb | unittest.rb | unixodbc.rb | unoconv.rb | unp.rb | unpaper.rb | unrar.rb | unrtf.rb | unshield.rb | unyaffs.rb | uptimed.rb | upx.rb | uriparser.rb | urlview.rb | uru.rb | usbmuxd.rb | userspace-rcu.rb | utimer.rb | uudeview.rb | uwsgi.rb | v.rb | v8.rb | vala.rb | valabind.rb | valgrind.rb | validns.rb | valkyrie.rb | varnish.rb | vassh.rb | vault-cli.rb | vavrdiasm.rb | vbindiff.rb | vc4asm.rb | vcdimager.rb | vcodex.rb | vcprompt.rb | vcsh.rb | vde.rb | vegeta.rb | vera++.rb | verilator.rb | vert.x.rb | vf.rb | vgmstream.rb | vice.rb | vifm.rb | vilistextum.rb | vim.rb | vimpager.rb | vimpc.rb | vip.rb | virtualhost.sh.rb | virtualpg.rb | virtuoso.rb | visionmedia-watch.rb | visitors.rb | visualnetkit.rb | vit.rb | vmalloc.rb | vncsnapshot.rb | vnstat.rb | vnu.rb | volatility.rb | voldemort.rb | voltdb.rb | voms.rb | vorbis-tools.rb | vorbisgain.rb | vowpal-wabbit.rb | vpcs.rb | vpnc.rb | vramsteg.rb | vrpn.rb | vsftpd.rb | vstr.rb | vtclock.rb | vte.rb | vte3.rb | vttest.rb | w-calc.rb | w3m.rb | wait_on.rb | wakatime-cli.rb | wakeonlan.rb | waon.rb | watch-sim.rb | watch.rb | watchman.rb | wavpack.rb | wbox.rb | wdiff.rb | web100clt.rb | webalizer.rb | webfs.rb | webkit2png.rb | webp.rb | weechat.rb | weighttp.rb | wellington.rb | wemux.rb | wget.rb | wgetpaste.rb | whatmask.rb | when.rb | whereami.rb | whirr.rb | whitedb.rb | whohas.rb | why3.rb | wifi-password.rb | wiggle.rb | wildfly-as.rb | wimlib.rb | wine.rb | winetricks.rb | winexe.rb | wireshark.rb | wirouter_keyrec.rb | with-readline.rb | wla-dx.rb | wordnet.rb | wordplay.rb | wps2odt.rb | wput.rb | wrangler.rb | writerperfect.rb | wrk-trello.rb | wrk.rb | wry.rb | wslay.rb | wsmancli.rb | wtf.rb | wv.rb | wv2.rb | wwwoffle.rb | wxmac.rb | wxpython.rb | wy60.rb | wyrd.rb | x11vnc.rb | x264.rb | x265.rb | xa.rb | xapian.rb | xar-mackyle.rb | xaric.rb | xastir.rb | xbee-comm.rb | xcproj.rb | xctool.rb | xdelta.rb | xerces-c.rb | xlslib.rb | xml-coreutils.rb | xml-security-c.rb | xml-tooling-c.rb | xml2.rb | xmlcatmgr.rb | xmlformat.rb | xmlrpc-c.rb | xmlsh.rb | xmlstarlet.rb | xmlto.rb | xmltoman.rb | xmp.rb | xonsh.rb | xorriso.rb | xplanet.rb | xplanetfx.rb | xqilla.rb | xrootd.rb | xsane.rb | xsp.rb | xspin.rb | xstow.rb | xsw.rb | xtail.rb | xtitle.rb | xulrunner.rb | xvid.rb | xz.rb | yacas.rb | yaf.rb | yafc.rb | yajl.rb | yamcha.rb | yamdi.rb | yaml-cpp.rb | yap.rb | yara.rb | yash.rb | yasm.rb | yaws.rb | yaz.rb | yaze-ag.rb | yazpp.rb | yconalyzer.rb | ydict.rb | yeti.rb | ykclient.rb | ykpers.rb | yle-dl.rb | youtube-dl.rb | yubico-piv-tool.rb | yuicompressor.rb | yydecode.rb | z.rb | z80asm.rb | z80dasm.rb | zabbix.rb | zbackup.rb | zbar.rb | zdelta.rb | zebra.rb | zeromq.rb | zile.rb | zinc.rb | zint.rb | zmap.rb | znc.rb | zookeeper.rb | zopfli.rb | zorba.rb | zpaq.rb | zpython.rb | zsh-completions.rb | zsh-history-substring-search.rb | zsh-lovers.rb | zsh-syntax-highlighting.rb | zsh.rb | zshdb.rb | zssh.rb | zsync.rb | zurl.rb | zxcc.rb | zzuf.rb |

* TODO Indexing org-files to find headlines :tag1:tag2:
  :PROPERTIES:
  :categories: emacs,org
  :date:     today
  :ARCHIVE_TIME: 2015-07-09 Thu 21:03
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :ARCHIVE_TODO: TODO
  :END:

The idea here is to index every headline and store them in a data structure to enable fast searching. One issue is fidelity: how to keep the index synchronized?


#+BEGIN_SRC emacs-lisp
(org-element-map (org-element-parse-buffer)
    'headline
  (lambda (x)
   (list
    (org-element-property :title x)
    (org-element-property :level x)
    (org-element-property :begin x)
    (save-excursion
      (goto-char     (org-element-property :begin x))
      (org-entry-properties))
    (org-element-property :tags x)
    (org-element-property :todo-keyword x)
    (org-element-property :todo-type x))))
#+END_SRC

#+RESULTS:
| (Indexing org-files to find headlines) | 1 | 1 | ((TODO . TODO) (FILE . /Users/jkitchin/blogofile-jkitchin.github.com/_blog/blog.org) (TAGS . :tag1:tag2:) (ALLTAGS . :tag1:tag2:) (BLOCKED . ) (categories . emacs,org) (date . today) (CATEGORY . blog)) | (tag1 tag2) | TODO | todo |

#+BEGIN_SRC emacs-lisp
 (f-entries "emacs-jasp" (lambda (x)
		 (string=
		  "org"
		  (file-name-extension x)))
	   t)
#+END_SRC

#+RESULTS:
| /Users/jkitchin/blogofile-jkitchin.github.com/_blog/emacs-jasp/using-jasp-el.org | /Users/jkitchin/blogofile-jkitchin.github.com/_blog/emacs-jasp/emacs-jasp.org |

(filename headline TODO (properties) (tags)))

Return the components of the current heading.
This is a list with the following elements:
- the level as an integer
- the reduced level, different if `org-odd-levels-only' is set.
- the TODO keyword, or nil
- the priority character, like ?A, or nil if no priority is given
- the headline text itself, or the tags string if no headline text
- the tags string, or nil.

#+BEGIN_SRC emacs-lisp
(loop for fname in (f-entries "." (lambda (x)
				    (string=
				     "org"
				     (file-name-extension x))))
      collect (with-current-buffer (find-file-noselect fname)
		(condition-case cerr
		    (org-map-entries 'org-heading-components))
		(error (format "%s\n%s" fname cerr))))
#+END_SRC

* TODO [#B] Using -s prog with swish-e :test:tree:
  :PROPERTIES:
  :categories: emacs,orgmode,swishe
  :ARCHIVE_TIME: 2015-07-09 Thu 21:03
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :ARCHIVE_TODO: TODO
  :END:
This should speed up things.

We can find entries ending in .org like this:

#+BEGIN_SRC emacs-lisp
(org-element-map (org-element-parse-buffer) 'headline
  (lambda (h) (org-element-map h 'node-property
  (lambda (p)
    (cons (org-element-property :key p)
	  (org-element-property :value p))))))


#+END_SRC

#+RESULTS:
| (categories . emacs,orgmode,swishe) |

#+BEGIN_SRC emacs-lisp
(length (f-entries "." (lambda (x)
		 (string=
		  "org"
		  (file-name-extension x)))
	   t))
#+END_SRC

#+RESULTS:
: 123

Then, we should loop over each file to generate text to stdout.

#+caption: to be determined
[[./11-eos.png]]

[[file:blog.org][some description]]

http://google.com

cite:dauenhauer-2006-renew
#+BEGIN_SRC emacs-lisp
(tag 'links ()
     (mapconcat
      'identity
      (org-element-map (org-element-parse-buffer) 'link
	(lambda (link)
	  (tag 'link
	       `((type . ,(xml-escape-string (org-element-property :type link)))
		 (path . ,(xml-escape-string (org-element-property :path link)))
		 (raw-link . ,(xml-escape-string
			       (org-element-property :raw-link link))))
	       ;; captions are in the parent paragraph.
	       (when (org-element-property
		      :caption
		      (org-element-property :parent link))
		 (tag 'caption ()
		      (xml-escape-string
		       (mapconcat
			(lambda (x)
			  (mapconcat 'car x " "))
			(org-element-property
			 :caption
			 (org-element-property :parent link))
			" "))))
	       (when (org-element-property :contents-begin link)
		 (buffer-substring (org-element-property :contents-begin link)
				   (org-element-property :contents-end link))))
	  ))
      ""))

#+END_SRC

#+RESULTS:
: <links><link type="file" path="./11-eos.png" raw-link="./11-eos.png"><caption>to be determined</caption></link><link type="file" path="blog.org" raw-link="file:blog.org">some description</link><link type="http" path="//google.com" raw-link="http://google.com"></link><link type="cite" path="dauenhauer-2006-renew" raw-link="cite:dauenhauer-2006-renew"></link></links>

#+ATTR_LATEX: :width 400
#+LABEL: lab:src
#+caption: element inspector
#+name: a source block
#+BEGIN_SRC emacs-lisp
(defun inspect-element-at-point () (interactive)
       (let ((elem (org-element-context)))
	 (switch-to-buffer "*org-element-inspector*")
	 (erase-buffer)
	 (insert (format "%s" (pp-to-string elem)))
	 (defface highlight-regexp-face
	   '((t (:foreground "dark red")))
	   "face for highlight-regexp.")
	 (highlight-regexp ":[a-zA-Z-_]*\\>"
			   'highlight-regexp-face)))
#+END_SRC

#+RESULTS: a
: inspect-element-at-point

#+RESULTS:
: inspect-element-at-point


#+BEGIN_SRC emacs-lisp :tangle ~/Dropbox/kitchingroup/jmax/swish-org-xml.el
(defun print-tag (name attrs &optional closingp)
  "Print an xml tag with symbol NAME and ATTRS (a cons list of (attribute . value)).
if CLOSINGP print the closing tag instead."
  (format
   "<%s%s%s>"
   (if closingp "/" "")
   name
   (if (and attrs (not closingp))
       (concat
	" "
	(mapconcat
	 (lambda (x)
	   (format "%s=\"%s\""
		   (car x)
		   (xml-escape-string (cdr x))))
	 attrs
	 " "))
     "")))

(defmacro tag (name attributes &rest body)
  `(format "%s%s%s"
	   (print-tag ,name ,attributes nil)
           (concat
	   ,@body)
	   (print-tag ,name nil t)))

(defun file-keywords-xml ()
  (tag 'file-keywords ()
       (mapconcat
	'identity
	(org-element-map (org-element-parse-buffer 'element) 'keyword
	  (lambda (keyword)
	    (tag (xml-escape-string (org-element-property :key keyword)) ()
		 (xml-escape-string (org-element-property :value keyword)))))
	"")))


(defun headline-xml ()
  (mapconcat
   'identity (org-element-map
		 (org-element-parse-buffer)
		 'headline
	       (lambda (headline)

		 (let ((title (org-element-property :title headline))
		       ;(priority (org-element-property :priority headline))
		       ;(tags (org-element-property :tags headline))
		       ;(todo-type  (org-element-property :todo-type headline))
		       ;(todo-keyword (org-element-property :todo-keyword headline))
		       (properties (save-excursion
				     (goto-char
				      (org-element-property :begin headline))
				     (org-entry-properties))))
		   (tag 'headline ()
			(tag 'title () (mapconcat 'identity title " "))
			;(when tags
			 ; (tag 'tags () (mapconcat 'identity tags " ")))
			;(when priority
			 ; (tag 'priority () (char-to-string priority)))
			;(when todo-type
			 ; (tag 'todo-type () (format "%s" todo-type)))
			;(when todo-keyword
			 ; (tag 'todo-keyword () todo-keyword))
			(when properties
			  (tag 'properties ()
			       (mapconcat
				'identity
				(loop for (p . v) in properties
				      collect (tag p () v))
				"")))))))
   ""))

(defun table-xml ()
  (tag
   'tables ()
   (mapconcat 'identity
	      (org-element-map
		  (org-element-parse-buffer)
		  'table
		(lambda (table)
		  (let* ((caption (mapconcat
				   (lambda (x)
				     (mapconcat 'car x " "))
				   (org-element-property :caption table) ""))
			 (begin (org-element-property :begin table))
			 (end (org-element-property :end table))
			 (contents (buffer-substring begin end)))
		    (tag 'table ()
			 (tag 'caption () (xml-escape-string caption))
			 (tag 'table-contents () (xml-escape-string contents))))))
	      "")))

(defun src-block-xml ()
  "Return xml string of src-blocks in the buffer, wrapped in <src-blocks>"
  (tag 'src-blocks ()
       (mapconcat 'identity
		  (org-element-map
		      (org-element-parse-buffer)
		      'src-block
		    (lambda (element)
		      (tag
		       'src-block
		       `((language . ,(xml-escape-string
				       (org-element-property :language element)))
			 (switches . ,(xml-escape-string
				       (format
					"%s"
					(org-element-property :switches element))))
			 (parameters . ,(xml-escape-string
					 (format
					  "%s"
					  (org-element-property :parameters element)))))
		       (when (org-element-property :name element)
			 (tag 'name () (xml-escape-string
					(org-element-property :name element))))
		       (when (org-element-property :caption element)
			 (tag 'caption ()
			      (mapconcat
			       (lambda (x)
				 (mapconcat 'car x " "))
			       (org-element-property :caption element) "")))
		       (tag 'code ()
			    (xml-escape-string
			     (org-element-property :value element))))))
		  "")))

(defun links-xml ()
  (tag 'links ()
     (mapconcat
      'identity
      (org-element-map (org-element-parse-buffer) 'link
	(lambda (link)
	  (tag 'link
	       `((type . ,(xml-escape-string (org-element-property :type link)))
		 (path . ,(xml-escape-string (org-element-property :path link)))
		 (raw-link . ,(xml-escape-string
			       (org-element-property :raw-link link))))
	       ;; captions are in the parent paragraph.
	       (when (org-element-property
		      :caption
		      (org-element-property :parent link))
		 (tag 'caption ()
		      (xml-escape-string
		       (mapconcat
			(lambda (x)
			  (mapconcat 'car x " "))
			(org-element-property
			 :caption
			 (org-element-property :parent link))
			" "))))
	       (when (org-element-property :contents-begin link)
		 (buffer-substring (org-element-property :contents-begin link)
				   (org-element-property :contents-end link))))
	  ))
      "")))

(defun document-xml ()
  (tag 'document ()
       (concat
	(file-keywords-xml)
	(headline-xml)
	(table-xml)
	(src-block-xml)
	(links-xml)
	(xml-escape-string
	 (buffer-string)))))

(defun process-file (fname)
  (let* ((buf (find-file-noselect fname))
	 (xml (replace-regexp-in-string
	       "[^[:ascii:]]" ""
	       (document-xml)))))
  (format "Path-Name: %s
Content-Length: %s

%s" fname (length xml) xml))

#+END_SRC

#+RESULTS:
: src-block-xml

#+caption: some text
#+caption: some more text
| x & 3| y |
|---+---|
| 1 | 2 |
| 3 | 4 |

#+AUTHOR: John Kitchin
#+BEGIN_SRC emacs-lisp
(file-keywords-xml)
#+END_SRC

#+RESULTS:
: <file-keywords><AUTHOR>John Kitchin</AUTHOR></file-keywords>



#+BEGIN_SRC emacs-lisp
(table-xml)
#+END_SRC

#+RESULTS:
: <tables><table><caption>some more textsome text</caption><table-contents>#+caption: some text
: #+caption: some more text
: | x &amp; 3| y |
: |---+---|
: | 1 | 2 |
: | 3 | 4 |
:
:
: </table-contents></table></tables>


#+BEGIN_SRC emacs-lisp
(headline-xml)
#+END_SRC

#+RESULTS:
: <headline><title>Using -s prog with swish-e</title><properties><TODO>TODO</TODO><PRIORITY>B</PRIORITY><FILE>/Users/jkitchin/blogofile-jkitchin.github.com/_blog/blog.org</FILE><TAGS>:test:tree:</TAGS><ALLTAGS>:test:tree:</ALLTAGS><BLOCKED></BLOCKED><categories>emacs,orgmode,swishe</categories><CATEGORY>blog</CATEGORY></properties></headline>

#+BEGIN_SRC emacs-lisp :tangle swish-org.el :tangle-mode (identity #o755)
:;exec emacs -batch -l $0 "$@"
(require 'org)
(require 'xml)
(require 'cl)

(add-to-list 'load-path "~/Dropbox/kitchingroup/jmax/elpa/f-20140828.716")
(add-to-list 'load-path "~/Dropbox/kitchingroup/jmax/elpa/s-20140910.334")
(add-to-list 'load-path "~/Dropbox/kitchingroup/jmax/elpa/dash-20141201.2206")
(require 'f)

(add-to-list 'load-path "~/Dropbox/kitchingroup/jmax")
(require 'swish-org-xml)

(loop for dir in '("/Users/jkitchin/blogofile-jkitchin.github.com/_blog"
		   "/Users/jkitchin/blogofile-jkitchin.github.com/_site")
      do
      (loop for fname in (f-entries
			  dir
			  (lambda (x)
			    (string=  "org"  (file-name-extension x)))
			  t)
	    do (ignore-errors
		 (princ (process-file fname)))))
#+END_SRC
#+RESULTS:
: process-file

#+BEGIN_SRC sh
swish-e -c swish-org2xml.conf -S prog -i ./swish-org.el
#+END_SRC

#+BEGIN_SRC emacs-lisp
(process-file "/Users/jkitchin/blogofile-jkitchin.github.com/_blog/using-org-ref.org")
#+END_SRC

#+RESULTS:
#+begin_example
Path-Name: /Users/jkitchin/blogofile-jkitchin.github.com/_blog/using-org-ref.org
Content-Length: 3345

<src-blocks><src-block language="emacs-lisp"><contents>(org-babel-load-file &quot;org-ref.org&quot;)
</contents></src-block><src-block language="emacs-lisp"><contents>(setq org-ref-bibliography-notes &quot;~/Dropbox/bibliography/notes.org&quot;
      org-ref-default-bibliography &apos;(&quot;~/Dropbox/bibliography/references.bib&quot;)
      org-ref-pdf-directory &quot;~/Dropbox/bibliography/bibtex-pdfs/&quot;)
</contents></src-block><src-block language="emacs-lisp"><contents>(setq org-ref-insert-cite-key &quot;C-c )&quot;)
</contents></src-block><src-block language="emacs-lisp"><contents>(setq org-ref-default-citation-link &quot;autocite&quot;)
</contents></src-block><src-block language="emacs-lisp"><contents>(org-ref-define-citation-link &quot;citez&quot; ?z)
</contents></src-block><src-block language="emacs-lisp"><contents>(defun org-ref-cite-link-format (keyword desc format)
   (cond
    ((eq format &apos;html) (format &quot;(&lt;cite&gt;%s&lt;/cite&gt;)&quot; path))
    ((eq format &apos;latex)
     (concat &quot;\\cite&quot; (when desc (format &quot;[%s]&quot; desc)) &quot;{&quot;
	     (mapconcat (lambda (key) key) (org-ref-split-and-strip-string keyword) &quot;,&quot;)
	     &quot;}&quot;))))

(org-add-link-type
 &quot;cite&quot;
 &apos;org-ref-cite-onclick-minibuffer-menu ;; clicking function
 &apos;org-ref-cite-link-format) ;; formatting function
</contents></src-block><src-block language="bibtex"><contents>
@article{doi:10.1021/ie500588j,
author = {Okada, Tomohiko and Ozono, Shoya and Okamoto, Masami and Takeda, Yohei and Minamisawa, Hikari M. and Haeiwa, Tetsuji and Sakai, Toshio and Mishima, Shozi},
title = {Magnetic Rattle-Type CoreShell Particles Containing Iron Compounds with Acid Tolerance by Dense Silica},
journal = {Industrial &amp; Engineering Chemistry Research},
volume = {0},
number = {0},
pages = {null},
year = {0},
doi = {10.1021/ie500588j},

URL = {http://pubs.acs.org/doi/abs/10.1021/ie500588j},
eprint = {http://pubs.acs.org/doi/pdf/10.1021/ie500588j}
}

</contents></src-block><src-block language="bibtex"><contents>@article{okada-2014-magnet-rattl,
  author =	 {Okada, Tomohiko and Ozono, Shoya and Okamoto, Masami
                  and Takeda, Yohei and Minamisawa, Hikari M. and
                  Haeiwa, Tetsuji and Sakai, Toshio and Mishima,
                  Shozi},
  title =	 {Magnetic Rattle-Type Core-Shell Particles Containing
                  Iron Compounds with Acid Tolerance by Dense Silica},
  journal =	 {Industrial \&amp; Engineering Chemistry Research},
  volume =	 0,
  pages =	 {null},
  year =	 2014,
  doi =		 {10.1021/ie500588j},
  number =	 0,
  url =		 {http://pubs.acs.org/doi/abs/10.1021/ie500588j},
  eprint =	 {http://pubs.acs.org/doi/pdf/10.1021/ie500588j},
}


</contents></src-block><src-block language="emacs-lisp"><contents>;; variables that control bibtex key format for auto-generation
;; I want firstauthor-year-title-words
;; this usually makes a legitimate filename to store pdfs under.
(setq bibtex-autokey-year-length 4
      bibtex-autokey-name-year-separator &quot;-&quot;
      bibtex-autokey-year-title-separator &quot;-&quot;
      bibtex-autokey-titleword-separator &quot;-&quot;
      bibtex-autokey-titlewords 2
      bibtex-autokey-titlewords-stretch 1
      bibtex-autokey-titleword-length 5)
</contents></src-block></src-blocks>
#+end_example

Now,

A configuration

#+BEGIN_SRC text :tangle swish-org2xml.conf
# Example configuration file

# Tell Swish-e what to directories to index
IndexDir /Users/jkitchin/blogofile-jkitchin.github.com/_blog
IndexDir /Users/jkitchin/blogofile-jkitchin.github.com/_site

# where to save the index
IndexFile /Users/jkitchin/blogofile-jkitchin.github.com/_blog/index-swish-org.swish-e

# What to index
IndexOnly .org

# Tell Swish-e that .txt files are to use the XML parser.
IndexContents XML* .org

# index all tags for searching
UndefinedMetaTags auto
UndefinedXMLAttributes auto
#+END_SRC

The indexing command:

#+BEGIN_SRC sh
swish-e -S prog -i ./swish-org.el
#+END_SRC

* volatile helm-swish-e
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-09 Thu 21:15
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

odd. does not always find everything in volatile mode.
#+BEGIN_SRC emacs-lisp
(defun swish-e-suggest () (message helm-pattern)
  (helm-swish-e-candidates helm-pattern))

(setq swish-e-source  `((name . ,(format "swish-e: %s" helm-input))
			(candidates . (lambda () (funcall 'swish-e-suggest)))
			(action . (("open" . (lambda (f)
					       (find-file (car f))))))
			(volatile)))

(helm-other-buffer 'swish-e-source "*swish-e*")

(helm :sources '(swish-e-source))
#+END_SRC

* old acronym code			 :ARCHIVE:
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-09 Thu 21:17
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(defun highlight-tla ()
  "Highlight three letter acronyms."
  ;; First we have to get them.
  (save-excursion
    (goto-char (point-min))
    (while (re-search-forward "\\(?1:\\(?2:[A-Z]\\)[a-z]+\\) \\(?3:\\(?4:[A-Z]\\)[a-z]+\\) \\(?5:\\(?6:[A-Z]\\)[a-z]+\\) (\\(?8:\\2\\4\\6\\))" nil t)
      (let ((TLA (match-string 8))
	    (definition (match-string 0)))
	(button-lock-set-button
	 TLA
	 nil
	 :help-echo definition)))))

(highlight-tla)
#+END_SRC
#+RESULTS:

TLA is a DFT


#+BEGIN_SRC emacs-lisp
(require 'rx)
(defun highlight-tla-2 ()
  "Highlight three letter acronyms."
  ;; First we have to get them.
  (save-excursion
    (goto-char (point-min))
    (while (re-search-forward
	    (rx
	     ;; group the three words into group 1
	     (group-n
	      1
	      ;; first word, with first letter grouped
	      (group-n
	       2
	       upper)
	       (1+ letter)
	      (1+ space)
	      (group-n
	       3
	       upper)
	       (1+ letter)
	      (1+ space)
	      (group-n
	       4
	       upper)
	       (1+ letter))
	     (1+ space)
	     (group-n
	      5
	      "(" (backref 2) (backref 3) (backref 4) ")"))
	    nil t)
      (let ((TLA (match-string 5))
	    (definition (match-string 1)))
        (message-box "%s: %s" TLA definition)
	(button-lock-set-button
	 TLA
	 nil				; no click function
	 :help-echo definition)))))

(highlight-tla-2)
#+END_SRC
#+RESULTS:

Density Tunctional Theory (DTT)  DTT  DFT

* Is an external http(s) link valid?
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-09 Thu 21:18
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp
(condition-case err
  (url-http-file-exists-p "http://bad.url")
 (error nil))
#+END_SRC

#+RESULTS:

#+BEGIN_SRC emacs-lisp
(condition-case err
  (url-http-file-exists-p "http://kitchingroup.cheme.cmu.edu")
 (error nil))
#+END_SRC

#+RESULTS:
: t

* A helm interface to org-contacts
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:23
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(defun oc-email (_)
 (interactive)
 (message-box "%s"
	      (mapconcat
	       (lambda (x)
		 (cdr (assoc "EMAIL" (elt x 1))))
	       (helm-marked-candidates :with-wildcard t)
	       ",")))


(defun oc-open-entry (selection)
 (let ((mark (car selection)))
   (switch-to-buffer (marker-buffer mark))
   (goto-char (marker-position mark))
   (show-subtree)))


(defun oc-open-url (selection)
  (let ((url (cdr (assoc "URL" (elt selection 1)))))
    (when url
      (browse-url url))))


(defvar helm-source-org-contacts
  '((name                            . "Contacts")
    (candidates                      . org-contaqcts-db)
    (action . (("Email"              . oc-email)
	       ("web"                . oc-open-url)
               ("Show entry"         . oc-open-entry))))
  "Source for searching in org-contacts.")

(defun helm-org-contacts ()
  "Search BibTeX entries."
  (interactive)
  (helm :sources '(helm-source-org-contacts)
        :candidate-number-limit 500))
#+END_SRC

#+RESULTS:
: helm-org-contacts

* org-ref-helm
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:24
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
Inspired by [[https://github.com/tmalsburg/helm-bibtex][helm-bibtex]], here I explore a way to insert citations using some helm-bibtex machinery. The gist of helm-bibtex is it scans your bib files, offers spectacular search and select capability, and then your choice of actions on those. The default action is to open the pdf, but I want the default action to be to insert a link.

#+BEGIN_SRC emacs-lisp
(require 'helm-bibtex)

(defun helm-bibtex-format-org-ref (keys)
  "insert selected KEYS as cite link. Append KEYS if you are on a link."
  (let ((el (org-element-context)))
    (message "%s" el)
    (if (eq 'link (car el))
	(progn
	  (goto-char (org-element-property :end el))
	  (concat "," (s-join "," keys)))
      (concat "cite:" (s-join "," keys)))))

(setq helm-bibtex-format-citation-functions
      '((org-mode . helm-bibtex-format-org-ref)))


(defvar org-ref-helm-source-bibtex
  '((name                                      . "BibTeX entries")
    (init                                      . helm-bibtex-init)
    (candidates                                . helm-bibtex-candidates)
    (filtered-candidate-transformer            . helm-bibtex-candidates-formatter)
    (action . (("Insert citation"              . helm-bibtex-insert-citation)
	       ("Open PDF file (if present)"   . helm-bibtex-open-pdf)
               ("Open URL or DOI in browser"   . helm-bibtex-open-url-or-doi)
               ("Insert reference"             . helm-bibtex-insert-reference)
               ("Insert BibTeX key"            . helm-bibtex-insert-key)
               ("Insert BibTeX entry"          . helm-bibtex-insert-bibtex)
               ("Attach PDF to email"          . helm-bibtex-add-PDF-attachment)
               ("Edit notes"                   . helm-bibtex-edit-notes)
               ("Show entry"                   . helm-bibtex-show-entry))))
  "Source for searching in BibTeX files.")

;;;###autoload
(defun org-ref-helm-bibtex ()
  "Search BibTeX entries."
  (interactive)
  (helm :sources '(org-ref-helm-source-bibtex helm-source-fallback-options)
        :full-frame t
        :candidate-number-limit 500))
#+END_SRC

#+RESULTS:
: org-ref-helm-bibtex

* Find org-files that mention a citation
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:24
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:




I want to find all my org-files in some tree that cite this paper cite:kitchin-2004-role.

#+BEGIN_SRC emacs-lisp
(rgrep "kitchin-2004-role\\(;\\|:\\|.\\|,\\| \\)" "*.org" "~/Dropbox/CMU/manuscripts")
#+END_SRC

#+RESULTS:

kitchin-2004-role-strain



#+BEGIN_SRC emacs-lisp
(switch-to-buffer (grep-find "find ~/Dropbox/CMU/manuscripts -type f -name \"*.org\" -exec grep -nH -e  \"kresse-1996-effic\\(;\\|:\\|.\\|,\\| \\)\" {} +"))
#+END_SRC
#+RESULTS:
: #<buffer *grep*>

cite:kresse-1996-effic


#+BEGIN_SRC emacs-lisp
(switch-to-buffer (grep-find "find ~/Dropbox/CMU/manuscripts -type f -name \"*.org\" -exec grep -nH -e  \"kitchin-\" {} +"))
#+END_SRC
#+RESULTS:
: #<buffer *grep*>

From techela
#+BEGIN_SRC emacs-lisp
(multi-occur (mapcar 'find-file-noselect
		     (-filter
		      'file-exists-p
		      (files-in-below-directory
		       "~/Dropbox/CMU/manuscripts")))
	     "kitchin-2004-strain")
#+END_SRC
#+RESULTS:
: t

This returns t, it does not work!
#+BEGIN_SRC emacs-lisp
(multi-occur (mapcar 'find-file-noselect
		     (f-entries "~/Dropbox/CMU/manuscripts"
				(lambda (f) (string= (f-filename f) "manuscript.org")) t))
	     "kitchin-2004-strain")
#+END_SRC

#+RESULTS:
: t

#+BEGIN_SRC emacs-lisp
(helm-multi-occur (mapcar 'find-file-noselect
		     (f-entries "~/Dropbox/CMU/manuscripts"
				(lambda (f) (string= (f-filename f) "manuscript.org")) t)))
#+END_SRC

* crossref + doi
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:24
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

[[http://www.crossref.org/][crossref.org]]

#+BEGIN_SRC emacs-lisp
(let ((url-request-method "GET")
      (json-object-type 'plist)
      (json-data))
  (with-current-buffer
      (url-retrieve-synchronously
       "http://search.crossref.org/dois?q=john+kitchin+catalysis&&rows=3")
      (setq json-data (buffer-substring url-http-end-of-headers (point-max)))
      (json-read-from-string json-data)))
#+END_SRC
#+RESULTS:
: [(:year "2012" :coins "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1007%2Fs11244-012-9808-0&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Preface%3A+Trends+in+Computational+Catalysis&amp;rft.jtitle=Topics+in+Catalysis&amp;rft.date=2012&amp;rft.volume=55&amp;rft.issue=5-6&amp;rft.spage=227&amp;rft.epage=228&amp;rft.aufirst=John&amp;rft.aulast=Kitchin&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=John+Kitchin" :fullCitation "John Kitchin, 2012, 'Preface: Trends in Computational Catalysis', <i>Topics in Catalysis</i>, vol. 55, no. 5-6, pp. 227-228" :title "Preface: Trends in Computational Catalysis" :normalizedScore 100 :score 3.5252514 :doi "http://dx.doi.org/10.1007/s11244-012-9808-0") (:year "2012" :coins "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1039%2F9781849734776-00083&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Coverage+dependent+adsorption+properties+of+atomic+adsorbates+on+late+transition+metal+surfaces&amp;rft.jtitle=Catalysis&amp;rft.date=2012&amp;rft.spage=83&amp;rft.epage=115&amp;rft.aufirst=Spencer&amp;rft.aulast=Miller&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Abook&amp;rft.genre=bookitem&amp;rft.au=Spencer+Miller&amp;rft.au=+Carmeline+Dsilva&amp;rft.au=+John+R.+Kitchin" :fullCitation "Spencer Miller, Carmeline Dsilva, John R. Kitchin, 2012, 'Coverage dependent adsorption properties of atomic adsorbates on late transition metal surfaces', <i>Catalysis</i>, pp. 83-115" :title "Coverage dependent adsorption properties of atomic adsorbates on late transition metal surfaces" :normalizedScore 85 :score 3.021644 :doi "http://dx.doi.org/10.1039/9781849734776-00083") (:year "2014" :coins "ctx_ver=Z39.88-2004&amp;rft_id=info%3Adoi%2Fhttp%3A%2F%2Fdx.doi.org%2F10.1016%2Fj.catcom.2013.10.028&amp;rfr_id=info%3Asid%2Fcrossref.org%3Asearch&amp;rft.atitle=Relating+the+electronic+structure+and+reactivity+of+the+3d+transition+metal+monoxide+surfaces&amp;rft.jtitle=Catalysis+Communications&amp;rft.date=2014&amp;rft.volume=52&amp;rft.spage=60&amp;rft.epage=64&amp;rft.aufirst=Zhongnan&amp;rft.aulast=Xu&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.au=Zhongnan+Xu&amp;rft.au=+John+R.+Kitchin" :fullCitation "Zhongnan Xu, John R. Kitchin, 2014, 'Relating the electronic structure and reactivity of the 3d transition metal monoxide surfaces', <i>Catalysis Communications</i>, vol. 52, pp. 60-64" :title "Relating the electronic structure and reactivity of the 3d transition metal monoxide surfaces" :normalizedScore 85 :score 3.021644 :doi "http://dx.doi.org/10.1016/j.catcom.2013.10.028")]

#+BEGIN_SRC emacs-lisp
(url-hexify-string "10.1016/j.catcom.2013.10.028")
#+END_SRC
#+RESULTS:
: 10.1016%2Fj.catcom.2013.10.028

#+BEGIN_SRC emacs-lisp
(url-unhex-string "10.1016%2Fj.catcom.2013.10.028")
#+END_SRC
#+RESULTS:
: 10.1016/j.catcom.2013.10.028

#+BEGIN_SRC emacs-lisp
(defun cross-ref-search ()
  (interactive)
  (browse-url
   (format
    "http://search.crossref.org/?q=%s"
    (if (use-region-p)
	(url-hexify-string (buffer-substring
			    (region-beginning)
			    (region-end)))
      (read-string "string: ")))))
#+END_SRC

* More doi utility functions
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:25
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(defun doi-utils-google-scholar (doi)
 "DOI can be any query."
 (interactive "sDOI: ")
 (browse-url (format "http://scholar.google.com/scholar?hl=en&q=%s" (url-hexify-string doi))))

(doi-utils-google-scholar "10.1021/jp047349j")
#+END_SRC

#+RESULTS:
: #<process open http://scholar.google.com/scholar?hl=en&q=10.1021%2Fjp047349j>

#+BEGIN_SRC emacs-lisp
(defun doi-utils-crossref (doi)
 (interactive "sDOI: ")
 (browse-url (format "http://search.crossref.org/?q=%s" (url-hexify-string doi))))

(doi-utils-crossref "10.1021/jp047349j")
#+END_SRC

#+RESULTS:
: #<process open http://search.crossref.org/?q=10.1021%2Fjp047349j>

http://wokinfo.com/products_tools/products/related/webservices/

I requested access for this ip address: 128.2.54.215
[[google:my ip address]]

soap
http://search.isiknowledge.com/esti/wokmws/ws/


#+BEGIN_SRC emacs-lisp
(defun doi-utils-ads (query)
 "run QUERY in the Harvard abstract simple search."
 (interactive "sQuery: ")
 (browse-url (format "http://adsabs.harvard.edu/cgi-bin/nph-basic_connect?qsearch=%s&version=1" (url-hexify-string doi))))

(doi-utils-ads "kitchin and barteau")
#+END_SRC

#+RESULTS:
: #<process open http://adsabs.harvard.edu/cgi-bin/nph-basic_connect?qsearch=kitchin%20and%20barteau&version=1>

* Setting up gnus for email
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:27
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
I have used gmail for a long time. There is a lot I like about it. Email for me is information that comes to me that I need to read, handle in some way, and then move on to the next thing. I do not store things in email, and I do not file or tag emails; I rely on gmail's search ability to find email if I ever need to (which I find is very rare). I aim for a zero-inbox with email, because that means there is nothing there I need to handle.

My typical workflow is to open my inbox, and read the new mails. If I can delete them immediately, I do that. If I can respond immediately, I do that and archive the email. If I need some time to reply, I store a link to the email in my todo list with a deadline (in org-mode, of course), and archive the email. If it will only be a day or so until I can reply, I sometimes leave it in my inbox and reply later. This works pretty well, and I usually have less than one screen of emails at any given time.

I have wanted to read email in emacs for a long time, because it would streamline the storing of links to emails, and I would not have to switch between firefox and emacs to do that. It would also make writing emails simpler for me. I already use gnus to read some newsgroups, so I want to also start reading email in it. gnus has some different ideas about mail, so I am trying to learn how to make it do what I want. By default, gnus only shows unread messages. I need it to show me all the messages in the inbox.

I also want some communication between gnus and gmail. If I delete a mail in gnus, I want it deleted in gmail. If I archive it in gnus, I want it archived in gmail. And, I want the send+archive behavior I like in gmail to work in gnus.

| open email               | RET     |
| reply                    |         |
| reply-all                |         |
| forward                  |         |
| send                     | C-c C-c |
| send and archive         |         |
| delete mail              |         |
| archive mail             |         |
| mark unread              | M-u     |
| capture mail in org-mode | C-c c e |


** Sending email

[[file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun%20message-send-and-exit%20(&optional%20arg)][file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun message-send-and-exit (&optional arg)]]

It looks like you can define these actions
message-exit-actions [[file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defvar%20message-exit-actions%20nil][file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defvar message-exit-actions nil]]

(defvar message-exit-actions nil
  "A list of actions to be performed upon exiting after sending a message.")

This looks like a list of functions that are called with no argument after the message is sent. see [[file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun%20message-do-actions%20(actions)][file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun message-do-actions (actions)]]

see [[file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/simple.el::(defun%20compose-mail%20(&optional%20to%20subject%20other-headers%20continue][file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/simple.el::(defun compose-mail (&optional to subject other-headers continue]] to see how to specify actions from compose-mail.

maybe it is possible to temporarily define a function to run. see http://www.gnu.org/software/emacs/manual/html_node/message/Message-Actions.html

[[file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun%20message-add-action%20(action%20&rest%20types)][file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun message-add-action (action &rest types)]]
[[file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun%20message-delete-action%20(action%20&rest%20types)][file:~/Dropbox/kitchingroup/jmax/emacs-24.3/lisp/gnus/message.el::(defun message-delete-action (action &rest types)]]
we need a temporary action! something like: http://www.chemie.fu-berlin.de/chemnet/use/info/elisp/elisp_13.html

  (apply 'message-add-action 'gt (list 'exit))
#+BEGIN_SRC emacs-lisp
(defmacro with-temp-message-action (action types &rest body)
  "temporarily have action for a message.
action is the same as the message-add-action definition
types is a list of 'exit 'postpone 'kill
body is the code to use in the temporary definition.
"
  (apply 'message-add-action action types)
  ,@body
  (apply 'message-delete action types))

(with-temp-message-action 'gt '(list 'exit)
			  (message "we workd"))
#+END_SRC

#+BEGIN_SRC emacs-lisp

(defun gt () (message "whoo"))
(add-to-list 'message-exit-actions 'gt)

(compose-mail "jkitchin@cmu.edu" "test")
#+END_SRC

#+RESULTS:
: t

we also have message-sent-hookand message-send-hook

let us try a variation with that:

#+BEGIN_SRC emacs-lisp
(defun org-contacts-gnus-article-to-get-marker ()
  "Return a marker for a contact based on From."
  (let* ((address (mail-extract-address-components
         (or (mail-fetch-field "To") "")))
         (name (car address))
         (email (cadr address)))
    (when email
    (cadar (or (org-contacts-filter
                nil
		nil
                (cons org-contacts-email-property (concat "\\b" (regexp-quote email) "\\b")))
               (when name
                 (org-contacts-filter
                  (concat "^" name "$"))))))))


(defun org-contacts-gnus-store-last-sent-mail ()
  "Store a link between mails and contacts.

This function should be called from `message-send-hook'."
(interactive)
  (let ((marker (org-contacts-gnus-article-to-get-marker)))
    (when marker
      (with-current-buffer (marker-buffer marker)
        (save-excursion
          (goto-char marker)
	  (org-set-property "LAST_SENT_MAIL" (current-time-string)))))))

(add-hook 'message-send-hook 'org-contacts-gnus-store-last-sent-mail)
#+END_SRC

#+RESULTS:
| org-contacts-gnus-store-last-sent-mail |

* extracting an org-contact from a gnus message
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:27
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
** getting it in the From field

try to get name from mail
#+BEGIN_SRC emacs-lisp
(defun gne ()
  (interactive)
  (if (org-contacts-gnus-article-from-get-marker)
      (message "you have that contact")
    (message "%s" (org-contacts-gnus-get-name-email))))
#+END_SRC

#+RESULTS:
: gne

try sticking entry in. you run this from a gnus article. should this happen automatically? we should
#+BEGIN_SRC emacs-lisp
(defun hare ()
  (interactive)
(let ((org-contacts-files '("test-contacts.org")))

  (let* ((r (org-contacts-gnus-get-name-email))
	 (name (nth 0 r))
	 (email (nth 1 r)))
    (find-file "test-contacts.org")
    (end-of-buffer)
    (insert (format "\n* %s" name))
    (org-entry-put (point) "EMAIL" email)
    (org-entry-put (point) "CREATED" (current-time-string))
    (save-buffer))))
#+END_SRC

#+RESULTS:
: hare

#+BEGIN_SRC emacs-lisp

#+END_SRC

* getting emails in org-contacts by tags
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:28
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
#+BEGIN_SRC emacs-lisp
(find-file "contacts-bbdb.org")
(let ((todo-only nil))
  (org-scan-tags
   (lambda ()
     (org-entry-get (point) "EMAIL")) ; action
  (cdr (org-make-tags-matcher "group-ms")) ; matcher
nil))
#+END_SRC

#+RESULTS:
| jboes@cmu.edu | mehakc@andrew.cmu.edu | mcurnan@andrew.cmu.edu | qingqif@andrew.cmu.edu | ahallenb@andrew.cmu.edu | jdmichae@andrew.cmu.edu | zhongnanxu@cmu.edu |


#+BEGIN_SRC emacs-lisp :results raw
(find-file "contacts-bbdb.org")
(let ((todo-only nil))
   (cdr (org-make-tags-matcher "group-phd")))
#+END_SRC

#+RESULTS:
(and (progn (setq org-cached-props nil) (and (not (member phd tags-list)) (member group tags-list))) t)


#+BEGIN_SRC emacs-lisp
(defun insert-emails-from-tags (tags)
  (interactive "sTags: ")
  (insert
   (save-window-excursion
     (find-file "contacts-bbdb.org")
     (mapconcat
      'identity
      (let ((todo-only nil))
	(org-scan-tags
	 (lambda ()
	   (org-entry-get (point) "EMAIL")) ; action
	 (cdr (org-make-tags-matcher tags)) ; matcher
	 nil)) ", "))))
#+END_SRC

#+RESULTS:
: add-emails-from-tags

ngovinda@andrew.cmu.edu,meihengl@andrew.cmu.edu,wenqiny@andrew.cmu.edu

#+BEGIN_SRC emacs-lisp
(insert-emails-from-tags "{^co.*}") ;no return
#+END_SRC

#+RESULTS:
#+BEGIN_SRC emacs-lisp
(insert-emails-from-tags "FIRSTNAME=\"John\"") ; no matches
#+END_SRC

#+RESULTS:

* Cleaning a bibtex entry
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:28
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(defun org-ref-clean-bibtex-entry()
  "clean and replace the key in a bibtex function"
  (interactive)
  (bibtex-beginning-of-entry)

  ;; check for empty pages, and put eid or article id in its place
  (let ((entry (bibtex-parse-entry))
	(pages (bibtex-autokey-get-field "pages"))
	(eid (bibtex-autokey-get-field "eid")))

    ;; fix pages if they are empty
    (cond
     ((string= "-" pages)
      (when eid
	(bibtex-beginning-of-entry)
	;; this seems like a clunky way to set the pages field.But I
	;; cannot find a better way.
	(goto-char (car (cdr (bibtex-search-forward-field "pages" t))))
	(bibtex-kill-field)
	(bibtex-make-field "pages")
	(backward-char)
	(insert eid))))

    ;; generate a key, and if it duplicates an existing key, edit it.
    (let ((key (bibtex-generate-autokey)))

      ;; first we delete the existing key
      (bibtex-beginning-of-entry)
      (re-search-forward bibtex-entry-maybe-empty-head)
      (if (match-beginning bibtex-key-in-head)
	  (delete-region (match-beginning bibtex-key-in-head)
			 (match-end bibtex-key-in-head)))
      ;; check if the key is in the buffer
      (when (save-excursion
	      (bibtex-search-entry key))
	  (setq key (bibtex-read-key "Duplicate Key found, edit: " key)))

      (insert key)
      (kill-new key)) ;; save key for pasting

    (bibtex-fill-entry)  ; this realigns the entry
    (bibtex-clean-entry) ; we do not replace our key

    ;; check for non-ascii characters
    (occur "[^[:ascii:]]")

    ;; one day reorder and downcase the fields
    ;; I can get all the fields like this
    ;; (bibtex-parse-entry t)
    ))
#+END_SRC

cite:daza-2014-carbon-dioxid

* Importing google contacts into bbdb
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-07-26 Sun 19:30
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

I am giving bbdb a try in emacs. I installed it from ELPA, and I am not sure if it is version 2 or 3, but it seems to work ok. The main reason I want it is so I can use email address completion in emails from Emacs.

The first thing I had to do was add this to my init files. Apparently the icicle-bbdb-complete-name function is not defined, so this takes care of that.
#+BEGIN_SRC emacs-lisp
;; This is not defined in my bbdb/icicles installation. This lets me use tab-completion.
(defalias 'icicle-bbdb-complete-name 'bbdb-complete-mail)
#+END_SRC

Next, I wanted to get my google contacts into bbdb. I am only going to do this once, to get most of what I need in. In the future, I suppose I will just add new contacts manually.  So, first, I exported my google contacts to a csv file. Google does some crazy scraping, so there were nearly 4000 contacts in that list. Not all of them were emails. I used this little python script to write out the first 5 columns of that file to a new file, as long as there was something in the first column.

#+BEGIN_SRC python
import csv

with open('contacts.csv', 'rb') as csvfile:
    spamreader = csv.reader(csvfile, delimiter=',')

    with open('new-contacts.csv', 'w') as f:
        for row in spamreader:
            if row[0]:
                f.write(','.join(row[0:5])+'\n')
                print ','.join(row[0:5])
#+END_SRC

Then, I manually went through the file deleting many obviously bad entries. It was just shy of interesting to see what was in there. I renamed the first line to have heading names with no spaces in them. So, the csv file eventually looked like this:

#+BEGIN_EXAMPLE
fname,mname,lname,email1,email2
Jennifer,,blahlan,fda@andrew.cmu.edu,
#+END_EXAMPLE


From there, I found a csv elisp file (http://ulf.epplejasper.de/EmacsGeneralPurpose.html) that can import a csv file to a lisp data structure. So, I read in the csv file, and then applied a function to each entry that created a bbdb entry with the information in the csv entry like this:

#+BEGIN_SRC emacs-lisp
#+BEGIN_SRC emacs-lisp
(let* ((b (find-file "new-contacts.csv"))
       (bbdb-allow-duplicates t)
       (contents (csv-parse-buffer t b)))
  (mapcar (lambda (x)
	    (let* ((fname (cdr (nth 0 x)))
		   (mname (cdr (nth 1 x)))
		   (lname (cdr (nth 2 x)))
		   (email1 (cdr (nth 3 x)))
		   (name (format "%s %s %s" fname mname lname)))
	      (bbdb-create-internal name nil nil nil email1))) contents))
#+END_SRC

Setting =(bbdb-allow-duplicates t)= was probably a mistake, it would have been better to leave this a false, catch the errors, and continue. But, it is easy to find duplicates in bbdb, and then manually delete them. In the end, I have 2648 "contacts" in my bbdb

* Sending email in emacs
  :PROPERTIES:
  :categories: emacs,email
  :ARCHIVE_TIME: 2015-07-26 Sun 19:31
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

I would like to be able to regularly send email from emacs (one day I would like to read it too). The reason for this is simply that I have a lot of information stored in files I often read in Emacs, and I want to be able to select that information and quickly email it to someone. I need this to work smoothly on Windows and Linux.

There are numerous blog posts on how to set this up, but many are out of date, or work on Linux only.  Here I am documenting what seems to work for me. In my emacs init files, I have this:


#+BEGIN_SRC text :tangle ~/.authinfo
machine smtp.andrew.cmu.edu login jkitchin port 587 password blahbity-blah
#+END_SRC

Note that this file has my actual password in it.

Now, I can type C-x m to start an email, or use one my functions to email a selection or org-heading, and the emails get sent.
- [X] home office
- [ ] home tablet
- [ ] office slate
- [ ] office linux
- [ ] office laptop

** take 1

Here I am following this post http://wideaperture.net/blog/?p=3343

#+BEGIN_SRC emacs-lisp
;;Configure Outbound Mail

;;Tell the program who you are

(setq user-full-name "John Kitchin")
(setq user-mail-address "johnrkitchin@gmail.com")

;;Tell Emacs to use GNUTLS instead of STARTTLS
;;to authenticate when sending mail.

(setq starttls-use-gnutls t)

;;Tell Emacs about your mail server and credentials

(setq send-mail-function 'smtpmail-send-it
      message-send-mail-function 'smtpmail-send-it
      smtpmail-starttls-credentials
      '(("smtp.gmail.com" 587 nil nil))

      smtpmail-default-smtp-server "smtp.gmail.com"
      smtpmail-smtp-server "smtp.gmail.com"
      smtpmail-smtp-service 587
      smtpmail-debug-info t)
(require 'smtpmail)
#+END_SRC

(require 'gnutls)
(open-gnutls-stream "tls" "tls-buffer" "imap.aim.com" "imaps")

ftp://ftp.gnutls.org/gcrypt/gnutls/w32/

this needs a .authinfo file. it works on home-office computer, but not on home tablet.

#+BEGIN_SRC text
machine smtp.andrew.cmu.edu login jkitchin port 587 password jfkdlajfdkl;
machine cyrus.andrew.cmu.edu login jkitchin password fjdkslafjsdkals

#+END_SRC

** Using msmtp
this worked on my home tablet

http://www.emacswiki.org/emacs/GnusMSMTP

#+BEGIN_SRC emacs-lisp
;; This is needed to allow msmtp to do its magic:
(setq message-sendmail-f-is-evil 't)

;;need to tell msmtp which account we're using
(setq message-sendmail-extra-arguments '("--read-envelope-from"))

;; with Emacs 23.1, you have to set this explicitly (in MS Windows)
;; otherwise it tries to send through OS associated mail client
(setq message-send-mail-function 'message-send-mail-with-sendmail)
;; we substitute sendmail with msmtp
(setq sendmail-program "c:/Users/jkitchin/Desktop/GetGnuWin32/bin/msmtp.exe")
;;need to tell msmtp which account we're using
(setq message-sendmail-extra-arguments '("-a" "gmail"))
;; you might want to set the following too
(setq mail-host-address "gmail.com")
(setq user-full-name "John Kitchin")
(setq user-mail-address "johnrkitchin@gmail.com")
#+END_SRC
#+RESULTS:
: johnrkitchin@gmail.com


It appears we have an msmtp installed from our git installation.


#+BEGIN_SRC sh
which msmtp
#+END_SRC

#+RESULTS:
: C:\Program Files (x86)\Git\bin\msmtp.EXE

We can check the version like this.

#+BEGIN_SRC sh
msmtp --version
#+END_SRC

#+RESULTS:
#+begin_example
msmtp version 1.4.17
TLS/SSL library: OpenSSL
Authentication library: GNU SASL
Supported authentication methods:
plain cram-md5 digest-md5 external login
IDN support: disabled
NLS: disabled
Keyring support: none
System configuration file name: C:\ProgramData\msmtprc.txt
User configuration file name: c:/Users/jkitchin/\msmtprc.txt

Copyright (C) 2008 Martin Lambers and others.
This is free software.  You may redistribute copies of it under the terms of
the GNU General Public License <http://www.gnu.org/licenses/gpl.html>.
There is NO WARRANTY, to the extent permitted by law.
#+end_example

It is not the most recent version. Next, create c:/Users/jkitchin/\msmtprc.txt with contents that look like this. I have two accounts that I could send email from, and they are listed here.

#+BEGIN_SRC text
########################
account default
host smtp.andrew.cmu.edu
tls on
tls_certcheck off
auth on
from jkitchin@andrew.cmu.edu
user jkitchin
password tjkdjfkd
port 587
logfile c:\msmtplog.txt
########################
account gmail
host smtp.gmail.com
tls on
tls_certcheck off
auth on
from johnrkitchin@gmail.com
user johnrkitchin@gmail.com
password fjdklafd
port 587

logfile c:\msmtplog.txt
########################
#+END_SRC

Now we follow the suggestions at http://www.emacswiki.org/emacs/GnusMSMTP to configure emacs

#+BEGIN_SRC emacs-lisp
;; This is needed to allow msmtp to do its magic:
(setq message-sendmail-f-is-evil 't)

;;need to tell msmtp which account we're using
(setq message-sendmail-extra-arguments '("--read-envelope-from"))

(setq message-send-mail-function 'message-send-mail-with-sendmail)

;; we substitute sendmail with msmtp
(setq sendmail-program "C:/Program Files (x86)/Git/bin/msmtp.EXE")

;;need to tell msmtp which account we're using
(setq message-sendmail-extra-arguments '("-a" "andrew"))
#+END_SRC

* problem solve coin saving
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-07 Sat 09:30
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(loop for N from 1
      if (= 0 (mod (* N 36) 100))
      return N)
#+END_SRC

#+RESULTS:
: 25

we know the ones position must be X*6 ends in 0, so X is 5.

then, we know the ones position of Y*6 plus the 10 position of X *36 must equal 10. So,

ones(Y * 6) + 8 = 10 or the ones position of Y * 6 = 2, so Y = 2.

The solution is Y = 25.

#+BEGIN_SRC python
print 5 * 36
#+END_SRC

#+RESULTS:
: 180

* Fontifying links in comments
  :PROPERTIES:
  :ID:       943D9489-43AC-4289-9741-93546274E5EA
  :ARCHIVE_TIME: 2015-11-07 Sat 11:00
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
Org-mode has a comment syntax. Anything commented out is largely ignored by org-mode during export and presumably other things too. However, it turns out that links are still active and clickable in comments, but they are hard to identify from regular text. If you mouse over them you may see some indication of clickable text due to a mouse face on the link, but the text is not colored or underlined, and is otherwise shown in a font-lock-comment-face. Here we attempt to see if we can fontify links in comments.

I thought I would be able to use a function with font-lock, but this seems to work the easiest.

#+BEGIN_EXAMPLE
(highlight-regexp org-any-link-re 'org-link)
#+END_EXAMPLE
# [[id:943D9489-43AC-4289-9741-93546274E5EA][Fontifying links in comments]]



(require 'ov)

* An experiment in navigation with a  hydra
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-07 Sat 11:53
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(defhydra nav (:color red)
  "navigation"
  ("f" forward-char "forward char")
  ("j" backward-char "backward char")
  ("d" forward-word  "forward word")
  ("k" backward-word "backward word")
  ("l" previous-line "previous line")
  ("s" forward-line "next line")
  (";" scroll-up  "scroll up")
  ("a" scroll-down "scroll down"))

#+END_SRC

#+RESULTS:
: nav/body



#+BEGIN_SRC emacs-lisp
(defhydra hydra-goto-line (goto-map ""
                           :pre (linum-mode 1)
                           :post (linum-mode -1))
  "goto-line"
  ("g" goto-line "go")
  ("m" set-mark-command "mark" :bind nil)
  ("q" nil "quit"))
#+END_SRC

#+RESULTS:
: hydra-goto-line/body

* insert code block
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-07 Sat 11:56
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
#+BEGIN_SRC emacs-lisp
(defun pec ()
  (interactive)
  (kill-region (region-beginning) (region-end))
  (insert "#+BEGIN_EXAMPLE\n")
  (yank)
  (insert "\n#+END_EXAMPLE")
  (previous-line 1)
  (org-edit-special)
  (fill-region (point-min) (point-max))
  (org-edit-src-exit))
#+END_SRC

* equations in html
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-07 Sat 11:56
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

See ref:eq-1.


label:eq-1
\begin{equation}
e^x = 4
\end{equation}

* bibdesk links
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-07 Sat 11:57
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
We guess that this base64 encoded, so we decode it (M-x base64-decode-region) This then gives us a binary plist (it starts with bplist) which we can turn into a readable form with M-: plutil -convert xml1 -o - - RET

#+BEGIN_SRC emacs-lisp
(defun convert-bindata (beg end)
  (interactive "r")
  (let ((content (buffer-substring beg end)))
    (with-temp-buffer
      (insert
       (with-temp-buffer
	 (insert content)
	 (base64-decode-region (point-min) (point-max))
	 (shell-command-on-region (point-min) (point-max) "plutil -convert xml1 -o - -")
	 (set-buffer "*Shell Command Output*")
	 (buffer-string)))
      (message "%s"(xml-parse-region (point-min) (point-max))))))
#+END_SRC

#+RESULTS:
: convert-bindata

YnBsaXN0MDDUAQIDBAUGJCVYJHZlcnNpb25YJG9iamVjdHNZJGFyY2hpdmVyVCR0b3ASAAGGoKgHCBMUFRYaIVUkbnVsbNMJCgsMDxJXTlMua2V5c1pOUy5vYmplY3RzViRjbGFzc6INDoACgAOiEBGABIAFgAdccmVsYXRpdmVQYXRoWWFsaWFzRGF0YV8QLi4uLy4uLy4uLy4uLy4uL0RvY3VtZW50cy9QYXBlcnMvQWxiaW4vMjAwNi5wZGbSFwsYGVdOUy5kYXRhTxEBigAAAAABigACAAAMTWFjaW50b3NoIEhEAAAAAAAAAAAAAAAAAAAAzJJLUEgrAAAJ9GrLCDIwMDYucGRmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAn0a4DQ8zSXAAAAAAAAAAAABQAEAAAJIAAAAAAAAAAAAAAAAAAAAAVBbGJpbgAAEAAIAADMkq3AAAAAEQAIAADQ86UXAAAAAQAUCfRqywDX3BkABcoiAAXKIQACEEoAAgA/TWFjaW50b3NoIEhEOlVzZXJzOgBzdGFudG9uOgBEb2N1bWVudHM6AFBhcGVyczoAQWxiaW46ADIwMDYucGRmAAAOABIACAAyADAAMAA2AC4AcABkAGYADwAaAAwATQBhAGMAaQBuAHQAbwBzAGgAIABIAEQAEgAtVXNlcnMvc3RhbnRvbi9Eb2N1bWVudHMvUGFwZXJzL0FsYmluLzIwMDYucGRmAAATAAEvAAAVAAIADv//AACABtIbHB0eWiRjbGFzc25hbWVYJGNsYXNzZXNdTlNNdXRhYmxlRGF0YaMdHyBWTlNEYXRhWE5TT2JqZWN00hscIiNcTlNEaWN0aW9uYXJ5oiIgXxAPTlNLZXllZEFyY2hpdmVy0SYnVHJvb3SAAQAIABEAGgAjAC0AMgA3AEAARgBNAFUAYABnAGoAbABuAHEAcwB1AHcAhACOAL8AxADMAloCXAJhAmwCdQKDAocCjgKXApwCqQKsAr4CwQLGAAAAAAAAAgEAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAsg=

../../../../../Documents/Papers/Albin/2006.pdf

bplist00$%X$versionX$objectsY$archiverT$top !U$null
WNS.keysZNS.objectsV$class\relativePathYaliasData_.../../../../../Documents/Papers/Albin/2006.pdfWNS.dataO       Macintosh HD               KPH+  	j2006.pdf                                                       	k4            	                Albin               	j  " ! J  ?Macintosh HD:Users: stanton: Documents: Papers: Albin: 2006.pdf     2 0 0 6 . p d f    M a c i n t o s h   H D  -Users/stanton/Documents/Papers/Albin/2006.pdf   /      Z$classnameX$classes]NSMutableData VNSDataXNSObject"#\NSDictionary" _NSKeyedArchiver&'Troot    # - 2 7 @ F M U ` g j l n q s u w     Z\alu             (              

* Clickable org-contacts in Emacs
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-07 Sat 12:03
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

In exploring dynamic clickable text in Emacs, it occurred to me it might be interesting if your org-contact headings were clickable links.

#+BEGIN_SRC emacs-lisp :results silent
(require 'button-lock)
(global-button-lock-mode)

(setq org-contacts-cons
      (mapcar (lambda (entry)
		(let ((contact (with-temp-buffer
				 (insert (car entry))
				 (buffer-substring-no-properties
				  (point-min) (point-max)))))
		  (cons (s-trim contact) contact)))
	      (org-contacts-db)))


(setq org-contacts-regex (mapconcat 'identity
	   (mapcar 'car org-contacts-cons)
	   "\\|"))

(button-lock-set-button
 org-contacts-regex
 (lambda ()
   (interactive)
   ;; move point back to a non-matched link, based on face property
   (while (equal
	   (car (get-text-property (point) 'face))
	   'org-link)
     (backward-char))
   ;; search forward to find the match
   (re-search-forward org-contacts-regex)
   (let* ((contact-string (cdr (assoc (match-string 0) org-contacts-cons)))
	  (contact (assoc contact-string (org-contacts-db)))
	  (marker (elt contact 1)))
     (switch-to-buffer (marker-buffer marker))
     (goto-char (marker-position marker))))
 :face (list 'org-link))
#+END_SRC

  @johnkitchin

  Billy Bardin

* test Rasmus link code
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-07 Sat 12:05
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
from [[mu4e:msgid:87bnlcdj7d.fsf@gmx.us][Re: {O} Citations, continued]]

#+BEGIN_SRC emacs-lisp

(with-eval-after-load 'org
  (require 'reftex-cite)

  (defmacro rasmus/org-bib-add-type (type)
    ;; TODO: maybe this can be made more effective?
    ;; Seems to work OK...
    `(org-add-link-type
      ,type
      'rasmus/org-bib-follow
      ,(lambda (path description backend)
	 (funcall 'rasmus/org-bib-format path description backend
                  ;; cite defaults to textcite
		  (if (equal type "cite") "textcite" type)))))

  (mapc (lambda (type) (funcall 'rasmus/org-bib-add-type type))
        '("cite" "textcite" "parentcite" "citeyear" "citeauthor"))

  (defun rasmus/org-bib-follow (path)
    "Find the pdf version of citation."
    (let* ((stream (read (format "(%s)" path))))
      (rasmus/find-lit (car head))))

  (defun rasmus/find-lit (key)
    "Open pdf file associated with KEY from `reftex-default-bibliography'."
    (let* ((bib (file-name-directory (car reftex-default-bibliography)))
           (file (concat bib path (concat "/" key ".pdf"))))
      (when (file-exists-p file) (find-file file))))

  (defun rasmus/org-bib-format (path description backend &optional type*)
    "Format a org-link citation.

 Support links of the type

 [[type*:key :pre PRE :post POST :type TYPE**]]

 Or

 [[Key*:key][POST;PRE]]

Based on John K's great post here:
    http://permalink.gmane.org/gmane.emacs.orgmode/94575"
    (let* ((key
            ;; key is a single symbol by assumption
            (and (string-match "\\` *\\([^ ]+\\) *" path)
                 (prog1 (match-string 1 path)
                   (setq path (replace-match "" nil nil path)))))
           ;; generate plist
           (data (read (format "(%s)"
                               (replace-regexp-in-string
                                "\\(:\\w+\\) \\([^:]+\\) ?" "\\1 \"\\2\" "
                                path))))
           (type (or (plist-get data :type) type* "textcite"))
           (pre  (org-trim (or (plist-get data :pre)
			       ;; support my "old" syntax
			       (and description
				    (cadr (split-string description ";"))) "")))
	   (post (org-trim
		  (or (funcall (lambda (txt)
				 (and txt
				      (let ((res (string-to-number txt)))
					(if (zerop res) txt
					  (concat (if (> (length txt) 1)  "pp." "p.") " " txt)))))
			       (plist-get data :post))
		      (and description
			   (car (split-string description ";")))
		      "")))
	   (entry (or (save-window-excursion
                        (bibtex-search-entry key t 0)
                        (bibtex-parse-entry))
                      (error (format "unknown key: %s" key))))
           (author (or (reftex-format-citation entry "%2a") ""))
           (year (or  (reftex-format-citation entry "%y") "")))
      (if (org-export-derived-backend-p backend 'latex)
          (format "\\%s[%s][%s]{%s}" type pre post key)
        ;; TODO: This should probably be wrapped in <cite>.</cite> with html...
        (cl-case (intern type)
          (parencite
           (format "(%s %s %s %s)"
                   pre author
                   (or (and (org-string-nw-p year) (concat year ", ")) "")
                   post))
          (citeyear
           (format "%s %s %s" pre year post))
          (citeauthor
           (format "%s %s %s" pre author post))
          (fullcite
           (reftex-format-citation entry reftex-cite-view-format))
          (t ;; textcite
           (format "%s (%s%s%s)"
                   author
                   (and (org-string-nw-p pre) (concat pre " "))
                   year
                   (and (org-string-nw-p post) (concat ", " post)))))))))


#+END_SRC

* Converting bbdb to org-contacts
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 21:54
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp :results output
(let ((b (find-file "../../kitchingroup/jmax/user/bbdb"))
      (count 0) (entry)(fname)(lname)(email))
  (find-file "contacts-bbdb.org")
  (erase-buffer)
  (insert "* setup")
  (while (and (< count 5) (setq entry (read b)))
    (setq fname (elt entry 0)
	  lname (elt entry 1)
	  email (car (elt entry 7)))
    (org-insert-heading-after-current)
    (insert (format "%s, %s\n" lname fname))
    (org-entry-put (point) "FIRSTNAME" fname)
    (org-entry-put (point) "LASTNAME" lname)
    (org-entry-put (point) "EMAIL" email))
  (save-buffer))
#+END_SRC

#+RESULTS:
#+begin_example
[Sarah Abdullah nil nil nil nil nil (sarah@cmu.edu) ((creation-date . 2014-03-17 01:00:18 +0000) (timestamp . 2014-03-17 01:00:18 +0000)) nil]
Sarah
Abdullah
sarah@cmu.edu
[Abdulwahab A. Abdulwahab nil nil nil nil nil (aabdulwa@andrew.cmu.edu) ((creation-date . 2014-03-17 00:54:29 +0000) (timestamp . 2014-03-17 00:54:29 +0000)) nil]
Abdulwahab A.
Abdulwahab
aabdulwa@andrew.cmu.edu
[Tanima Abedin nil nil nil nil nil (t.j.abedin@gmail.com) ((creation-date . 2014-03-17 01:00:19 +0000) (timestamp . 2014-03-17 01:00:19 +0000)) nil]
Tanima
Abedin
t.j.abedin@gmail.com
[Frank Abild-Pedersen nil nil nil nil nil (abild@slac.stanford.edu) ((creation-date . 2014-03-17 01:00:13 +0000) (timestamp . 2014-03-17 01:00:13 +0000)) nil]
Frank
Abild-Pedersen
abild@slac.stanford.edu
[Natalie Day Abrams nil nil nil nil nil (nda@andrew.cmu.edu) ((creation-date . 2014-03-17 01:00:16 +0000) (timestamp . 2014-03-17 01:00:16 +0000)) nil]
Natalie Day
Abrams
nda@andrew.cmu.edu
#+end_example

* org-mode and Perl
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 21:58
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

https://metacpan.org/pod/GD::Graph#EXAMPLES

#+BEGIN_SRC perl
load GD::Graph;
@data = (
  ["1st","2nd","3rd","4th","5th","6th","7th", "8th", "9th"],
  [    1,    2,    5,    6,    3,  1.5,    1,     3,     4],
  [ sort { $a <=> $b } (1, 2, 5, 6, 3, 1.5, 1, 3, 4) ]
);

my $graph = GD::Graph::chart->new(400, 300);

$graph->set(
    x_label           => 'X Label',
    y_label           => 'Y label',
    title             => 'Some simple graph',
    y_max_value       => 8,
    y_tick_number     => 8,
    y_label_skip      => 2
) or die $graph->error;

my $gd = $graph->plot(\@data) or die $graph->error;
#+END_SRC

#+RESULTS:

* retired wos python code
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 21:59
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

Get this here: https://gist.github.com/domoritz/2012629
#+BEGIN_SRC python :tangle wos.py
#!/usr/bin/env python
# -*- coding: utf-8 -*-

from suds.client import Client
from suds.transport.http import HttpTransport
import urllib2

class HTTPSudsPreprocessor(urllib2.BaseHandler):
    def __init__(self, SID):
        self.SID = SID

    def http_request(self, req):
        req.add_header('cookie', 'SID="'+self.SID+'"')
        return req

    https_request = http_request


class WokmwsSoapClient():
    """
    main steps you have to do:
        soap = WokmwsSoapClient()
        results = soap.search(...)
    """
    def __init__(self):
        self.url = self.client = {}
        self.SID = ''

        self.url['auth'] = 'http://search.isiknowledge.com/esti/wokmws/ws/WOKMWSAuthenticate?wsdl'
        self.url['search'] = 'http://search.isiknowledge.com/esti/wokmws/ws/WokSearchLite?wsdl'

        self.prepare()

    def __del__(self):
        self.close()

    def prepare(self):
        """does all the initialization we need for a request"""
        self.initAuthClient()
        self.authenticate()
        self.initSearchClient()

    def initAuthClient(self):
        self.client['auth'] = Client(self.url['auth'])

    def initSearchClient(self):
        http = HttpTransport()
        opener = urllib2.build_opener(HTTPSudsPreprocessor(self.SID))
        http.urlopener = opener
        self.client['search'] = Client(self.url['search'], transport = http)

    def authenticate(self):
        self.SID = self.client['auth'].service.authenticate()

    def close(self):
        self.client['auth'].service.closeSession()

    def search(self, query):
        qparams = {
            'databaseID' : 'WOS',
            'userQuery' : query,
            'queryLanguage' : 'en',
            'editions' : [{
                'collection' : 'WOS',
                'edition' : 'SCI',
            },{
                'collection' : 'WOS',
                'edition' : 'SSCI',
            }]
        }

        rparams = {
            'count' : 5, # 1-100
            'firstRecord' : 1,
            'fields' : [{
                'name' : 'Relevance',
                'sort' : 'D',
            }],
        }

        return self.client['search'].service.search(qparams, rparams)
#+END_SRC

#+BEGIN_SRC sh
pip install suds
#+END_SRC

#+BEGIN_SRC python
from wos import *
soap = WokmwsSoapClient()
results = soap.search('AU=kitchin')
print results
#+END_SRC

#+RESULTS:

suds.WebFault: Server raised fault: 'The Web Service (version 2.0) has been retired permanently. Please contact Thomson Reuters IP and Science Technical Support http://ip-science.thomsonreuters.com/techsupport/ for information on how to obtain a new version of our Web Service.'

* Revisiting tooltips on cite links
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:01
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
This is not going to work permanently. maybe i could map over the links and put some properties on though.

(insert (propertize "cite:kondratyuk-2013"
                          'help-echo "testing"))cite:kondratyuk-2013

cite:

cite:kondratyuk-2013

These links work in the code block, but not in org.

#+BEGIN_SRC emacs-lisp
(insert (concat "cite:"
(mapconcat
(lambda (key)
 (propertize key 'help-echo (org-ref-get-bibtex-entry-citation key)))
'("kondratyuk-2013" "paier-2006-errat" "marjolin-2015-therm-descr")
",")))cite:kondratyuk-2013,paier-2006-errat,marjolin-2015-therm-descr

#+END_SRC

#+RESULTS:
:


cite:kondratyuk-2013,paier-2006-errat,marjolin-2015-therm-descr

(setq tooltip-use-echo-area nil)
cite:kondratyuk-2013,paier-2006-errat,marjolin-2015-therm-descr


#+BEGIN_SRC emacs-lisp
(defun org-ref-cite-link-p () (interactive)
       (let* ((object (org-element-context))
	      (type (org-element-property :type object)))
	 ;;   We only want this to work on citation links
	 (when (-contains? org-ref-cite-types type)
	   (message (org-ref-get-citation-string-at-point)))))

(add-hook 'post-command-hook 'cite-link-p)
;(remove-hook 'post-command-hook 'cite-link-p)
#+END_SRC

#+RESULTS:
| cite-link-p | matlab-start-block-highlight-timer |

* Convert word at point to internal link
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:02
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
must have been some org-mode list question

#+BEGIN_SRC emacs-lisp
(defun word-to-link ()
  (interactive)
  (save-excursion
    (let (start end word)
      (backward-word)
      (setq start (point))
      (forward-word)
      (setq end (point))
      (setq word (buffer-substring start end))
      (setf (buffer-substring start end)
	    (format "[[%s]]" word)))))
#+END_SRC

#+RESULTS:
: word-to-link

Test [[some]] word

* Quick access to your own cheat sheets
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:05
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
There are a lot of 1-2 page cheat sheets available on the Internet. In emacs It should be easy to make your own cheat sheets (in org-mode of course), and to access them from a command with completion. Here we explore a way to get that with a helm interface.

The idea is to keep an org-file with headings in it for each cheat sheet. I put mine here: file:cheat-sheets.org.

We don't even have to work very hard here, helm already has a slick function to give you quick searching of the headlines. We just open our file, and run the helm command.

#+BEGIN_SRC emacs-lisp
(defun cheatsheet ()
  (interactive)
  (find-file "cheat-sheets.org")
  (helm-org-headlines))
#+END_SRC

#+RESULTS:
: cheatsheet

* pydoc apropos
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:06
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

see https://github.com/philippp/apropos.py

This needs to be done asynchronously
#+BEGIN_SRC emacs-lisp
(defun pydoc-apropos (name)
  (interactive)
  (switch-to-buffer-other-window "*pydoc-apropos*")
  (erase-buffer)
  (insert (shell-command-to-string (format "python -c \"import pydoc; pydoc.apropos('%s')\"" "zip")))
  (goto-char (point-min)))

(pydoc-apropos "zip")
#+END_SRC

#+RESULTS:
: 1

* Possibilities for pydoc completion
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:06
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC python
import rlcompleter as rl
import sys
C = rl.Completer(namespace=globals())
matched = True
i = 0
matches = []
while matched:
    m = C.complete("sys.", i)
    if m:
        matches += [m]
        i +=1
    else:
        matched = False

print matches
#+END_SRC

#+RESULTS:
: ['sys.__displayhook__(', 'sys.__doc__', 'sys.__egginsert', 'sys.__excepthook__(', 'sys.__name__', 'sys.__package__', 'sys.__plen', 'sys.__stderr__', 'sys.__stdin__', 'sys.__stdout__', 'sys._clear_type_cache(', 'sys._current_frames(', 'sys._executable', 'sys._getframe(', 'sys._home', 'sys._mercurial', 'sys.api_version', 'sys.argv', 'sys.base_exec_prefix', 'sys.base_prefix', 'sys.builtin_module_names', 'sys.byteorder', 'sys.call_tracing(', 'sys.callstats(', 'sys.copyright', 'sys.displayhook(', 'sys.dont_write_bytecode', 'sys.exc_clear(', 'sys.exc_info(', 'sys.exc_type', 'sys.excepthook(', 'sys.exec_prefix', 'sys.executable', 'sys.exit(', 'sys.flags', 'sys.float_info', 'sys.float_repr_style', 'sys.getcheckinterval(', 'sys.getdefaultencoding(', 'sys.getdlopenflags(', 'sys.getfilesystemencoding(', 'sys.getprofile(', 'sys.getrecursionlimit(', 'sys.getrefcount(', 'sys.getsizeof(', 'sys.gettrace(', 'sys.hexversion', 'sys.long_info', 'sys.maxint', 'sys.maxsize', 'sys.maxunicode', 'sys.meta_path', 'sys.modules', 'sys.path', 'sys.path_hooks', 'sys.path_importer_cache', 'sys.platform', 'sys.prefix', 'sys.py3kwarning', 'sys.setcheckinterval(', 'sys.setdlopenflags(', 'sys.setprofile(', 'sys.setrecursionlimit(', 'sys.settrace(', 'sys.stderr', 'sys.stdin', 'sys.stdout', 'sys.subversion', 'sys.version', 'sys.version_info', 'sys.warnoptions', 'sys.__class__(', 'sys.__class__(', 'sys.__delattr__(', 'sys.__dict__', 'sys.__doc__', 'sys.__format__(', 'sys.__getattribute__(', 'sys.__hash__(', 'sys.__init__(', 'sys.__new__(', 'sys.__reduce__(', 'sys.__reduce_ex__(', 'sys.__repr__(', 'sys.__setattr__(', 'sys.__sizeof__(', 'sys.__str__(', 'sys.__subclasshook__(', 'sys.__class__(', 'sys.__delattr__(', 'sys.__doc__', 'sys.__format__(', 'sys.__getattribute__(', 'sys.__hash__(', 'sys.__init__(', 'sys.__new__(', 'sys.__reduce__(', 'sys.__reduce_ex__(', 'sys.__repr__(', 'sys.__setattr__(', 'sys.__sizeof__(', 'sys.__str__(', 'sys.__subclasshook__(']

* completing in python
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:06
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC python

def completer(text, state):
    options = [i for i in commands if i.startswith(text)]
    if state < len(options):
        return options[state]
    else:
        return None

print completer('os.', 0)
#+END_SRC

#+RESULTS:
:
: Traceback (most recent call last):
:   File "<stdin>", line 1, in <module>
:   File "<stdin>", line 2, in completer
: NameError: global name 'commands' is not defined
:

#+BEGIN_SRC python
import rlcompleter
completer = rlcompleter.Completer()

print completer.complete("sy", 1)

#+END_SRC

#+RESULTS:
: Traceback (most recent call last):
:   File "<stdin>", line 1, in <module>
:   File "/Applications/Canopy.app/appdata/canopy-1.5.1.2730.macosx-x86_64/Canopy.app/Contents/lib/python2.7/rlcompleter.py", line 87, in complete
:     return self.matches[state]
: AttributeError: Completer instance has no attribute 'matches'
:

#+BEGIN_SRC python

import pip
installed_packages = pip.get_installed_distributions()
installed_packages_list = sorted(["%s" % (i.key)
     for i in installed_packages])
print(installed_packages_list)
#+END_SRC

#+RESULTS:
:
: ['appinst', 'apptools', 'astroid', 'atom', 'backports.ssl-match-hostname', 'basemap', 'biopython', 'bitarray', 'blist', 'blockcanvas', 'blogofile', 'blogofile-blog', 'boto', 'bsdiff4', 'casuarius', 'chaco', 'cloud', 'codetools', 'configobj', 'curl', 'cython', 'doclinks', 'elpy', 'enable', 'enaml', 'encore', 'enstaller', 'envisage', 'epc', 'epydoc', 'ets', 'etsdevtools', 'etsproxy', 'examples', 'fiona', 'flake8', 'flask', 'foolscap', 'freetype', 'fwrap', 'gdal', 'graphcanvas', 'grin', 'h5py', 'hdf5', 'html5lib', 'idle', 'ipython', 'itsdangerous', 'jedi', 'jinja2', 'kernmagic', 'kiwisolver', 'lib-netcdf4', 'libgdal', 'libjpeg', 'libpng', 'libxml2', 'libxslt', 'logilab-common', 'lxml', 'mako', 'markdown', 'markupsafe', 'matplotlib', 'mayavi', 'mccabe', 'mdp', 'netcdf4', 'networkx', 'nltk', 'nose', 'numba', 'numexpr', 'numpy', 'openpyxl', 'pandas', 'pandasql', 'paramiko', 'patsy', 'pep8', 'pil', 'pint', 'ply', 'pychecker', 'pycluster', 'pycrypto', 'pycse', 'pydot', 'pyephem', 'pyface', 'pyfits', 'pyflakes', 'pygarrayimage', 'pyglet', 'pygments', 'pyhdf', 'pylint', 'pymacs', 'pymc', 'pyodbc', 'pyopengl', 'pyopenssl', 'pyparsing', 'pyproj', 'pysal', 'pyserial', 'pyshp', 'pytables', 'python-dateutil', 'pythondoc', 'pytz', 'pyyaml', 'pyzmq', 'quantities', 'readline', 'reportlab', 'requests', 'rope', 'scikit-learn', 'scikits.image', 'scikits.timeseries', 'scimath', 'scipy', 'scons', 'sexpdata', 'shapely', 'simpy', 'six', 'sphinx', 'sqlalchemy', 'sqlparse', 'statsmodels', 'suds', 'swig', 'sympy', 'textile', 'tornado', 'traits', 'traits-enaml', 'traitsui', 'twisted', 'uncertainties', 'unidecode', 'virtualenv', 'vtk', 'werkzeug', 'wxpython', 'xlrd', 'xlwt', 'zope.interface']
:

* wok3
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:06
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
from https://github.com/mstrupler/WOS3/blob/master/wok3.py

#+BEGIN_SRC python :tangle wok3.py
# -*- coding: utf-8 -*-
"""
Created on Wed Aug 27 10:12:00 2014

@author: mathiasstrupler
"""


import sys
import re
import datetime

#try:
#    import urllib2
#except ImportError:
#    print('We need urllib2, sorry...')
#    sys.exit(1)

try:
    from suds.client import Client
except ImportError:
    print('We need suds.client, sorry...')
    sys.exit(1)

try:
    import xml.etree.ElementTree as ET
except ImportError:
    print('We need xml.etree.ElementTree, sorry...')
    sys.exit(1)

class Error(Exception):
    """Base class for any wok3 error."""

class SearchQueryError(Error):
    """You need to set a user query"""

class Edition(object):
    """
    This class is only used to let you know easily all the databases
    that can be searched in World of sciences
    example : wokSearch.setEdition(Edition.SCI)
    """
    SCI   = {'collection' : 'WOS', 'edition' : 'SCI'}    #Science Citation Index Expanded
    SSCI  = {'collection' : 'WOS', 'edition' : 'SSCI'}   #Social Sciences Citation Index
    AHCI  = {'collection' : 'WOS', 'edition' : 'AHCI'}   #Arts & Humanities Citation Index
    ISTP  = {'collection' : 'WOS', 'edition' : 'ISTP'}   #Conference Proceedings Citation Index - Science
    ISSHP = {'collection' : 'WOS', 'edition' : 'ISSHP'}  #Conference Proceedings Citation Index - Social Sciences
    IC    = {'collection' : 'WOS', 'edition' : 'IC'}     #Index Chemicus
    CCR   = {'collection' : 'WOS', 'edition' : 'CCR'}    #Current Chemical Reactions
    BSCI  = {'collection' : 'WOS', 'edition' : 'BSCI'}   #Book Citation Index - Science
    BHCI  = {'collection' : 'WOS', 'edition' : 'BHCI'}   #Book Citation Index - Social Sciences and Humanities


class SearchRespAnalyzer(object):
    """
    This class is used to parse the soap answer received
    after a search request
    """
    def __init__(self,searchResp):
        self._searchResp = searchResp

    def toDict(self):
        """
        This method parse the answer into a dictonnary
        It does not retreive all the information that gives WOS
        It looks for the following info:
            UID : WOS identifier
            title : Title of the document
            journal : Name of the journal
            year : Year of publication
            volume : Volume
            issue : Issue
            page : page [begin, end]
            authors : list of author dict {name, dais_id, affiliations list}
            language : primary language of the document
            docType : document type (article, review, book,...)
            publisher : name of the publisher
        """

        ans = {'records' : [] }
        records = re.sub(' xmlns="http://scientific.thomsonreuters.com/schema/wok5.4/public/FullRecord"', '', self._searchResp.records, count=1)
        #records = re.sub(' r_id_disclaimer="ResearcherID data provided by Thomson Reuters"', '', resp.records, count=resp.recordsFound)
        recordsTree = ET.fromstring( records)
        for rec in recordsTree.iter('REC'):
            #retreive UID
            record = {'UID' : rec.find('UID').text}
            #retreive title and journal name
            record['title'] = None
            record['journal'] = None
            for title in rec.findall('static_data/summary/titles/title'):
                if title.attrib['type'] == 'item':
                    record['title'] = title.text
                if title.attrib['type'] == 'source':
                    record['journal'] = title.text
            #retreive publication information
            pubinfo = rec.find('static_data/summary/pub_info').attrib
            record['year'] = pubinfo['pubyear']
            record['volume'] = pubinfo['vol']
            if 'issue' in  pubinfo:
                record['issue'] = pubinfo['issue']
            else:
                record['issue'] = ''
            page = rec.find('static_data/summary/pub_info/page').attrib
            if 'begin' in  page:
                record['page'] = [page['begin'],page['end']]
            else:
                record['page'] = []
            #retreive author list
            record['authors'] = []
            for name in rec.findall('static_data/summary/names/name'):
                if name.attrib['role']=='author':
                    author = {'name' : ''}
                    if name.find('wos_standard') is not None:
                        author['name'] = name.find('wos_standard').text
                    elif name.find('display_name') is not None:
                        author['name'] = name.find('display_name').text
                    elif name.find('full_name') is not None:
                        author['name'] = name.find('full_name').text
                    if 'dais_id' in name.attrib:
                        author['dais_id'] = name.attrib['dais_id']
                    author['affiliation']=[]
                    record['authors'].append(author)
            #retrieve publication language
            record['language'] = None
            for language in rec.findall('static_data/fullrecord_metadata/languages/language'):
                if language.attrib['type']=='primary':
                    record['language'] = language.text
            #retrieve adressess
            affiliations = []
            for adresses in rec.findall('static_data/fullrecord_metadata/addresses/address_name'):
                affiliations.append({'nb' : adresses.find('address_spec').attrib['addr_no'],'add' : adresses.find('address_spec/full_address').text})
            record['affiliations'] = affiliations
            if len(affiliations)==1:
                for author in record['authors']:
                    author['affiliation']=[affiliations[0]['add']]
            if len(affiliations)>=1:
                aff_names = rec.findall('static_data/fullrecord_metadata/addresses/address_name/names/name')
                aff_names_list = []
                for aff_name in aff_names:
                    tmp = {'nb' : aff_name.attrib['addr_no'], 'name' : aff_name.find('wos_standard').text}
                    aff_names_list.append(tmp)
                for author in record['authors']:
                    for name in aff_names_list:
                        if author['name'] == name['name']:
                            author['affiliation'].append(name['nb'])

            #retrieve doctype
            record['docType'] = []
            for docType in rec.findall('static_data/fullrecord_metadata/normalized_doctypes/doctype'):
                record['docType'].append(docType.text)
            #retrieve publisher
            record['publisher'] = rec.find('static_data/summary/publishers/publisher/names/name/full_name').text

            #append record to answer
            ans['records'].append(record)
        return ans

    def saveAsJSON(self,directory):
        """
        This method save as a JSON file
        the dictionnary produced by the toDict() method
        """
        try:
            import json
        except ImportError:
            print('We need JSON, sorry...')
            sys.exit(1)

        searchRespDict = self.toDict()
        with open(directory, 'wb') as fp:
            json.dump(searchRespDict , fp, sort_keys=True, indent=4, separators=(',', ': '))

    def saveRawAsXML(self,directory):
        """
        This method save as a XML file the raw records
        returned by the WOS search
        It only adds identations to make it more pretty
        """
        from xml.dom import minidom
        records = re.sub(' xmlns="http://scientific.thomsonreuters.com/schema/wok5.4/public/FullRecord"', '', self._searchResp.records, count=1)
        #records = re.sub(' r_id_disclaimer="ResearcherID data provided by Thomson Reuters"', '', resp.records, count=resp.recordsFound)
        recordsTree = ET.fromstring( records)
        rough_string = ET.tostring(recordsTree, 'utf-8')
        reparsed = minidom.parseString(rough_string)
        with open(directory, 'wb') as fp:
            reparsed.writexml(fp, indent="", addindent="\t", newl="\n")

    def saveAsBibtex(self,directory):
        """
        This method save as a bibtex files all the records
        It should be rewritten better handle different document types
        """
        searchRespDict = self.toDict()
        with open(directory, 'w') as fp:
            for rec in searchRespDict['records']:
                if rec['docType'][0]=='Article' or rec['docType'][0]=='Review' or rec['docType'][0]=='Letter':
                    bibtexentry = '@article{'
                elif rec['docType'][0]=='Proceedings Paper' or rec['docType'][0]=='Meeting':
                    bibtexentry = '@proceedings{'
                elif rec['docType'][0]=='Book':
                    bibtexentry = '@book{'
                elif rec['docType'][0]=='Book Chapter':
                    bibtexentry = '@inbook{'
                else:
                    bibtexentry = '@misc{'
                bibtexentry = bibtexentry + rec['UID'] + ',\n'
                bibtexentry = bibtexentry + '  title={' + rec['title'] + '},\n'

                authors = ''
                authorlist = rec['authors']
                firstauthor = authorlist.pop(0)
                authors = firstauthor['name']
                for author in authorlist:
                    authors = authors + ' and ' + author['name']

                bibtexentry = bibtexentry + '  author={' + authors + '},\n'
                bibtexentry = bibtexentry + '  journal={' + rec['journal'] + '},\n'
                if not(rec['volume']==''):
                    bibtexentry = bibtexentry + '  volume={' + rec['volume'] + '},\n'
                if not(rec['issue']==''):
                    bibtexentry = bibtexentry + '  number={' + rec['issue'] + '},\n'
                if rec['page']:
                    bibtexentry = bibtexentry + '  pages={'  + rec['page'][0] + '--' + rec['page'][1] + '},\n'
                if not(rec['year']==''):
                    bibtexentry = bibtexentry + '  year={' + rec['year'] + '},\n'
                if not(rec['publisher']==''):
                    bibtexentry = bibtexentry + '  publisher={' + rec['publisher'] + '},\n'
                bibtexentry = bibtexentry  + '}\n'
                fp.write(bibtexentry)





class WokSearch(object):
    """
    This class is used
        - to define the query parameters of a WOK search
        - open a session on WOK
        - send requests
        - close the session

    """
    AUTH_URL = 'http://search.webofknowledge.com/esti/wokmws/ws/WOKMWSAuthenticate?wsdl'
    SEARCH_URL = 'http://search.webofknowledge.com/esti/wokmws/ws/WokSearch?wsdl'
    def __init__(self):
        #initialization
        self._queryLanguage = 'en'
        self._databaseId = 'WOS'
        self._timeSpanStart = None
        self._timeSpanEnd = None
        self._edition = None
        self._query = None
        self._resultsRetrieved = 0
        self._resultsPerRequest = 100

    def setQuery(self, query):
        self._query = query

    def setEdition(self, edition):
        self._edition = edition

    def setTimeSpanStart(self, date):
        self._timeSpanStart = date

    def setTimeSpanEnd(self, date):
        self._timeSpanEnd = date

    def clearEdition(self):
        self._edition = None

    def clearSpanTime(self):
        self._timeSpanStart = None
        self._timeSpanEnd = None

    def queryToSOAP(self):
        if self._query is not None:
            soap =  {'databaseId' : self._databaseId, 'userQuery' : self._query, 'queryLanguage': self._queryLanguage}
            if self._edition is not None:
                soap['editions'] = self._edition
            soaptime = {}
            if self._timeSpanStart is not None:
                soaptime['begin'] = self._timeSpanStart.isoformat()
            if self._timeSpanEnd is not None:
                soaptime['end'] = self._timeSpanEnd.isoformat()
            if soaptime :
                soap['timeSpan'] = soaptime
            return soap
        else:
            raise SearchQueryError

    def retrieveParamToSOAP(self):
        soap = {'firstRecord' : self._resultsRetrieved+1, 'count' : self._resultsPerRequest}
        return soap

    def openSOAPsession(self):
        self._authClient = Client(self.AUTH_URL)
        self._sid = self._authClient.service.authenticate()
        headers = { 'Cookie': 'SID='+self._sid}
        self._authClient.set_options(soapheaders=headers)
        self._searchClient = Client(self.SEARCH_URL, headers= { 'Cookie': 'SID='+self._sid})

    def closeSOAPsession(self):
        self._authClient.service.closeSession()

    def sendSearchRequest(self):
        resp = self._searchClient.factory.create('searchResponse')
        resp = self._searchClient.service.search(self.queryToSOAP(),self.retrieveParamToSOAP())
        return resp



def main():
    wokSearch = WokSearch()

    wokSearch.setQuery('TS = Optical Coherence Tomography')

    #wokSearch.setEdition(Edition.SCI)
    wokSearch.setTimeSpanEnd(datetime.date(2014,01,01))
    wokSearch.setTimeSpanStart(datetime.date(2003,01,01))
    print wokSearch.queryToSOAP()
    print wokSearch.retrieveParamToSOAP()

    wokSearch.openSOAPsession()
    resp = wokSearch.sendSearchRequest()
    aResp = SearchRespAnalyzer(resp)
    aResp.saveRawAsXML('/Users/mathiasstrupler/WOS3/OCT2003_2010.xml')
    aResp.saveAsJSON('/Users/mathiasstrupler/WOS3/OCT2003_2010.JSON')
    aResp.saveAsBibtex('/Users/mathiasstrupler/WOS3/OCT2003_2010.bib')
    wokSearch.closeSOAPsession()

if __name__ == "__main__":
    sys.exit(main())

#+END_SRC

#+BEGIN_SRC python
from wok3 import *
wokSearch = WokSearch()

wokSearch.setQuery('TS = Optical Coherence Tomography')

wokSearch.setEdition(Edition.SCI)
wokSearch.setTimeSpanEnd(datetime.date(2014,01,01))
wokSearch.setTimeSpanStart(datetime.date(2003,01,01))
print wokSearch.queryToSOAP()
print wokSearch.retrieveParamToSOAP()

wokSearch.openSOAPsession()
resp = wokSearch.sendSearchRequest()
#aResp = SearchRespAnalyzer(resp)
#aResp.saveRawAsXML('OCT2003_2010.xml')
#aResp.saveAsJSON('/Users/mathiasstrupler/WOS3/OCT2003_2010.JSON')
#aResp.saveAsBibtex('OCT2003_2010.bib')

#wokSearch.closeSOAPsession()
#+END_SRC

#+RESULTS:
#+begin_example
{'editions': {'edition': 'SCI', 'collection': 'WOS'}, 'databaseId': 'WOS', 'timeSpan': {'begin': '2003-01-01', 'end': '2014-01-01'}, 'userQuery': 'TS = Optical Coherence Tomography', 'queryLanguage': 'en'}
{'count': 100, 'firstRecord': 1}
No handlers could be found for logger "suds.client"
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "wok3.py", line 309, in sendSearchRequest
    resp = self._searchClient.service.search(self.queryToSOAP(),self.retrieveParamToSOAP())
  File "/Users/jkitchin/Library/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/suds/client.py", line 542, in __call__
    return client.invoke(args, kwargs)
  File "/Users/jkitchin/Library/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/suds/client.py", line 602, in invoke
    result = self.send(soapenv)
  File "/Users/jkitchin/Library/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/suds/client.py", line 649, in send
    result = self.failed(binding, e)
  File "/Users/jkitchin/Library/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/suds/client.py", line 702, in failed
    r, p = binding.get_fault(reply)
  File "/Users/jkitchin/Library/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/suds/bindings/binding.py", line 265, in get_fault
    raise WebFault(p, faultroot)
suds.WebFault: Server raised fault: 'User has no entitlement for this service level - WOKSearchPremium'

#+end_example

#+BEGIN_SRC bibtex

#+END_SRC

* vtk
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:07
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC python
import vtk
from ase.cluster.icosahedron import Icosahedron
from ase.io import write
from ase.visualize import view

# With almost everything else ready, its time to initialize the renderer and window, as well as creating a method for exiting the application
renderer = vtk.vtkRenderer()
renderWin = vtk.vtkRenderWindow()
renderWin.AddRenderer(renderer)
renderInteractor = vtk.vtkRenderWindowInteractor()
renderInteractor.SetRenderWindow(renderWin)



atoms = Icosahedron('Au', noshells=3)

from ase.visualize.vtk.atoms import vtkAtoms

va = vtkAtoms(atoms)
va.add_actors_to_renderer(renderer)


renderInteractor.Initialize()
# Because nothing will be rendered without any input, we order the first render manually before control is handed over to the main-loop.
renderWin.Render()
renderInteractor.Start()
#+END_SRC

#+RESULTS:

* bullet
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:07
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

notes about this mail: [[mu4e:msgid:CANniJEwZu8UcvbB6G%2B0Q%2Be_ZYQNFUsw9DJxxVg9cfKvSnoSQOw@mail.gmail.com][{O} Getting beginning postiion of a description list]]

- foo :: bar    (goto-char (org-element-property :contents-begin (org-element-at-point)))
-     baz :: goo
- 1 egg
- 0.5 cups
- :punc

#+BEGIN_SRC emacs-lisp
(defun gg ()
 (interactive)
 (beginning-of-line)
 (forward-word)
 (backward-word)
 (while (not (looking-at " "))
   (backward-char)))
#+END_SRC


#+BEGIN_SRC emacs-lisp
; display element at point as a message.
(defun eap ()
  (interactive)
  (message "%s" (org-element-at-point)))


(defun gg ()
(interactive)
(when (eq (car (org-element-at-point)) 'item)
(message-box "on item")
(goto-char (org-element-property :end (org-element-at-point)))))

(add-hook 'post-command-hook 'eap)
(remove-hook 'post-command-hook 'eap)
#+END_SRC

#+RESULTS:
| eap |

* Replacement for insert paths using helm
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:11
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

You just type C-x C-f select the file, and then use the new actions. Note, there is already a way to insert an org link from helm: C-c @ but it will always be an absolute path.

#+BEGIN_SRC emacs-lisp
(defun helm-insert-path (candidate)
 (insert candidate))

(defun helm-insert-relative-path (candidate)
 (insert (file-relative-name candidate)))

(defun helm-attach-to-email (candidate)
 (mml-attach-file candidate))

(helm-add-action-to-source "Insert path"
			   'helm-insert-path helm-source-find-files)
(helm-add-action-to-source "Insert relative path"
			   'helm-insert-relative-path helm-source-find-files)

(helm-add-action-to-source "Attach file to email"
                           'helm-attach-to-email helm-source-find-files)
#+END_SRC

* Using format-spec
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:11
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(format-spec "A %s is good for %g" '((?s . "Tree") (?g . "wood")))
#+END_SRC

#+RESULTS:
: A Tree is good for wood

* DOI to org-bibtex entry
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:12
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
I can use this function to enter publications for our students in org-bibtex format. this will make them searchable in the future.

#+BEGIN_SRC emacs-lisp
(defun doi-to-org-bibtex (doi)
  (interactive "sDOI: ")
  (with-temp-buffer
    (insert (doi-utils-doi-to-bibtex-string doi))
    (bibtex-clean-entry)
    (kill-region (point-min) (point-max)))
   (org-bibtex-yank)
   (org-metaright)
   (org-metaright)
   (org-set-tags-to ":publication:"))
#+END_SRC
*** Alkaline Electrolyte and Fe Impurity Effects on the Performance and Active-Phase Structure of NiOOH Thin Films for OER Catalysis Applications :publication:
    :PROPERTIES:
    :TITLE:    Alkaline Electrolyte and Fe Impurity Effects on the Performance and Active-Phase Structure of NiOOH Thin Films for OER Catalysis Applications
    :BTYPE:    article
    :CUSTOM_ID: michael-2015-alkal-elect
    :AUTHOR:   John D. Michael and Ethan L. Demeter and Steven M. Illes and Qingqi Fan and Jacob R. Boes and John R. Kitchin
    :JOURNAL:  J. Phys. Chem. C
    :YEAR:     2015
    :VOLUME:   119
    :NUMBER:   21
    :PAGES:    11475-11481
    :DOI:      10.1021/acs.jpcc.5b02458
    :URL:      http://dx.doi.org/10.1021/acs.jpcc.5b02458
    :END:




#+BEGIN_HTML
tel:%28412%29%20268-7803
<a href="tel:18475555555">1-847-555-5555</a>
<a href="tel:+14123610357">1-412-361-0357</a>
#+END_HTML

* Using functions in font-lock
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:13
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
I am still looking at ways to add functionality to text dynamically in Emacs. Here I examine functions in font-lock mode. This puts an overlay on the text.
#+BEGIN_SRC emacs-lisp
(require 'ov)
(setq font-lock-extra-managed-props (delq 'help-echo font-lock-extra-managed-props))

(defun fn-match (bound)
  (when
      (re-search-forward "crazy fox" bound t)
    (ov (match-beginning 0)
	(match-end 0)
	'face '(:background "Darkolivegreen1")
        'mouse-face 'highlight
        'help-echo (lambda (a b c) (message-box "Aw yeah. That's what I'm talkin about"))
	'highlighted t)
    t))

(defun my-action (x) (message-box "%s\ndone" x))

(defun fn-match (bound)
  (when
      (re-search-forward "crazy fox" bound t)
    (make-button
     (match-beginning 0)
     (match-end 0)
     'face '(:background "Darkolivegreen1")
     'action (lambda (x) (message-box "%s" x))
     'follow-link t
     'help-echo (lambda (a b c) (format "On %s in %s at %s" a b c))
     )))

;;(font-lock-add-keywords nil '((fn-match 0 'font-lock-warning-face prepend)))
;;(font-lock-remove-keywords nil '((fn-match 0 'font-lock-warning-face prepend)))

(font-lock-add-keywords nil '(fn-match))
;; (font-lock-remove-keywords nil '(fn-match))

;; (ov-clear)
#+END_SRC

The crazy fox crazy fox  and the tree but not the graph

#+BEGIN_SRC emacs-lisp
(font-lock-add-keywords nil
  '(("\\<\\(FIXME\\):" 1 'font-lock-warning-face prepend)
    ("\\<\\(and\\|or\\|not\\)\\>" . 'font-lock-keyword-face)))
#+END_SRC

#+BEGIN_SRC emacs-lisp
(require 'button)
(re-search-forward "foo")
(make-button
 (match-beginning 0)
 (match-end 0)
 'follow-link t  ;; make mouse-1 work
 'action (lambda (x) (find-file user-init-file)))
#+END_SRC

#+RESULTS:
: #<overlay from 1461 to 1464 in blog.org>

foo

* test fortune
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:13
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp :exports results :results org
(format "#+BEGIN_QUOTE:
%s
,#+END_QUOTE
" (shell-command-to-string "fortune"))
#+END_SRC

#+BEGIN_SRC emacs-lisp :exports none
(let ((org-export-babel-evaluate t))
  (browse-url (org-html-export-to-html nil t)))
#+END_SRC
#+RESULTS:
: #<process open ./blog.html>

* functions in python
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:16
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC python

f = []

for i in range(5):
    def func(x):
        return i * x
    f.append(func)

print [g(2) for g in f]
#+END_SRC

#+RESULTS:
: [8, 8, 8, 8, 8]

yea, that does not work. And, neither does this.

#+BEGIN_SRC python
print [g(2) for g in [lambda x: i*x for i in range(5)]]
#+END_SRC

#+RESULTS:
: [8, 8, 8, 8, 8]

* file writing
  :PROPERTIES:
  :ARCHIVE_TIME: 2015-11-26 Thu 22:16
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
Write data:
#+BEGIN_SRC emacs-lisp
(let ((data (org-element-parse-buffer)))
  (with-temp-file "test-ast.txt" (insert "test 2")))
#+END_SRC
#+RESULTS:

#+BEGIN_SRC sh
head test-ast.txt
#+END_SRC
#+RESULTS:
: test 2

#+BEGIN_SRC emacs-lisp
(defun write-file (fname data &optional append)
  "Open FNAME and write DATA to it.
If APPEND is non-nil, append DATA to the end of the file.
DATA is represented as \"%s\" in `format'.
"
  (with-temp-file fname
    (when append
      (insert-file-contents fname)
      (goto-char (point-max))
      (insert "\n"))
    (insert (format "%s" data))))

(defun read-file (fname)
  "Return the contents of FNAME in a string."
  (with-temp-buffer
    (insert-file-contents fname)
    (buffer-string)))

(write-file "test-ast.txt" "test4" t)

(read-file "test-ast.txt")
#+END_SRC

#+RESULTS:
: test2
: test3
: test4
: test4
: test4
: test4

* emacs ldap
  :PROPERTIES:
  :ID:       E3B31B33-A726-4DE3-8396-91FC81BCE6F9
  :ARCHIVE_TIME: 2015-12-26 Sat 10:11
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
#+BEGIN_SRC emacs-lisp
(require 'ldap)
(let ((ldap-ldapsearch-args '("-LLL" "-x"))
      (ldap-host-parameters-alist
       '(("ldap.andrew.cmu.edu" base "ou=Person,dc=cmu,dc=edu"))))

  (ldap-search "cn=\"*kitchin*\"" "ldap.andrew.cmu.edu"))
#+END_SRC

#+RESULTS:

* TODO Copy a bibtex entry with some formatting
  :PROPERTIES:
  :ID:       573D70B8-92FA-4D6A-942C-1E0CEFF3DA00
  :ARCHIVE_TIME: 2015-12-26 Sat 10:13
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :ARCHIVE_TODO: TODO
  :END:

#+BEGIN_SRC emacs-lisp
(defun formatted ()
  "copy entry to formatted string"
  (interactive)
  (bibtex-beginning-of-entry)
  (let* ((bibtex-expand-strings t)
         (entry (bibtex-parse-entry t))
         (title (replace-regexp-in-string "\n\\|\t\\|\s+" " " (reftex-get-bib-field "title" entry)))
         (year  (reftex-get-bib-field "year" entry))
         (author (replace-regexp-in-string "\n\\|\t\\|\s+" " " (reftex-get-bib-field "author" entry)))
         (key (reftex-get-bib-field "=key=" entry))
         (journal (reftex-get-bib-field "journal" entry))
         (volume (reftex-get-bib-field "volume" entry))
         (issue (reftex-get-bib-field "issue" entry))
         (pages (reftex-get-bib-field "pages" entry))
         (doi (reftex-get-bib-field "doi" entry))
         (output))
    (setq output (concat (when author author) ", "
                         (when title title) ", "
                         (when journal journal) ", "
                         (when volume volume)
                         (if issue (format "(%s), " issue) ", ")
                         (when pages pages) ", "
                         (when year (format "(%s)." year))
                         (when doi (format " http://dx.doi.org/%s" doi))))
    (kill-new output)))

#+END_SRC

Abild-Pedersen, F. and Greeley, J. and Studt, F. and  Rossmeisl, J. and Munter, T. R. and Moses, P. G. and  Sk\'ulason, E. and Bligaard, T. and N\o{}rskov,  J. K., Scaling Properties of Adsorption Energies for  Hydrogen-Containing Molecules on Transition-Metal  Surfaces, Phys. Rev. Lett., 99(1),016105, (2007). http://dx.doi.org/10.1103/PhysRevLett.99.016105

* non-ascii characters
  :PROPERTIES:
  :ID:       7C32086C-748C-4F30-BABE-E93B521119D2
  :ARCHIVE_TIME: 2015-12-26 Sat 10:13
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
 "
 "

  \beta
 $^{\circ}$
 \v{a}
 '
 \'{e}
 \~{n}
 \'{i}
 \~{a}
 \v{s}
 \delta

* org pre-processor
  :PROPERTIES:
  :ID:       6CE4E31C-9076-4DB8-8351-CCA46B54796A
  :ARCHIVE_TIME: 2015-12-26 Sat 12:12
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
This would be code that replaces syntax like: @(some sexp) with what ever the sexp evals to.

* Using functions in font lock
  :PROPERTIES:
  :ID:       4FEC2F06-123E-49A4-A7F8-D16583ED717A
  :ARCHIVE_TIME: 2015-12-26 Sat 12:12
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

If you want to get past simple regular expressions in font-lock, you can use functions for search-based fontification.
#+BEGIN_SRC emacs-lisp
(defun foo-left (old-point new-point)
  (message "in foo-left (%s %s)" old-point new-point))

(defun foo-entered (old-point new-point)
  (message "in foo-entered (%s %s)\n" old-point new-point))

(defface new-face
  '((t (:foreground "OrangeRed1"
		    :point-left 'foo-left
		    :point-entered 'foo-entered)))
  "Font Lock mode face used to highlight format specifiers."
  :group 'font-lock-faces)


(defun match-next-foo (&optional limit)
  (when (re-search-forward "foo" limit t)
    (put-text-property (match-beginning 0) (match-end 0) 'point-left 'foo-left)
    (put-text-property (match-beginning 0) (match-end 0) 'point-entered 'foo-entered)))

(font-lock-add-keywords nil
 '((match-next-foo 0 'new-face)))

#+END_SRC


foo  foo

foo
here a foo there a foo everywhre a foo foo.
a foo is here. a foo bear.

* Using font-lock for toggling links
  :PROPERTIES:
  :ID:       C407DBEB-9653-4D56-8EC4-457C655179F2
  :ARCHIVE_TIME: 2015-12-26 Sat 12:13
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

http://stackoverflow.com/questions/14668225/context-sensitive-font-locking-in-emacs

org-any-link-re





#+BEGIN_SRC emacs-lisp
(defun org-match-next-link (&optional limit)
(org-next-link)

)

(defun org-link-entered (old-point new-point)
 (message-box "Entered a link %s %s" old-point new-point))

(defun org-link-left (old-point new-point)
 (message-box "Left a link %s %s" old-point new-point))

(defface org-link-entry-face
`((t (:inherit org-link :point-entered org-link-entered)))
"face with point-entered property")


;(font-lock-add-keywords 'org-mode '((org-match-next-link 0 org-link-entry-face)))

(org-match-next-link)
#+END_SRC

#+RESULTS:

file:blog.org

* org src blocks hydra
  :PROPERTIES:
  :ID:       001D5ED1-2332-47AF-AEA4-872917E8422E
  :ARCHIVE_TIME: 2015-12-26 Sat 12:13
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
[[https://github.com/abo-abo/hydra/wiki/Org-mode-block-templates][Org mode block templates  abo-abo/hydra Wiki]]

* not breaking index			 :ARCHIVE:
  :PROPERTIES:
  :ID:       41CA48CE-5F53-4CB9-ABF8-E293B3EF5105
  :ARCHIVE_TIME: 2015-12-26 Sat 12:16
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
this was an effort to try getting emacs not to break at spaces in the index. it did not work.
#+BEGIN_SRC emacs-lisp
(defun nobreak-p ()
  (interactive)
  (let ((result (if (and (looking-at " ")
			 (save-excursion
			   (re-search-forward "[^{]*}" (line-end-position) 'end))
			 (save-excursion
			   (re-search-backward "[^}]*\\\\index{" (line-beginning-position) 'end)))
		    t
		  nil)))
    (message "%s" result)
    result))

(add-hook 'fill-nobreak-predicate #'nobreak-p)
#+END_SRC

#+RESULTS:
| nobreak-p | org-fill-line-break-nobreak-p | org-fill-paragraph-with-timestamp-nobreak-p |


like this fjkd;lsa fiosg hgjkr ae jfk;las fdsjakl; fdjskal; fjdskla; fjkdsla;
fjdskla; fjdskla; fjdskal; fjdskal;f jdsakl;f ajkl;sd fjklas;
fjdksla;fjkdsjfkd;lsjfkdls;jfkldsa  jfkld;s fjkdlas; fjdkl; fjdkl;sa fjkdsl;
fjdskl; fjdskl;

jfdjkla; fjkdsla \index{this is an index} and then some text \index{and then
another index} what  else can we do to get wrapping to work?   something fjdklsa fjdklasjfkdsla kl; jfklda jkl; jfkdlsa jkl;a jfkldsjierwoqjr kl;as l; j lkjkl;as jkl; jklfewaj jkl;ewjk l; jfdkajkf jkfl;dsa jkl; jk ;fjkl;w jfdl jkfldas jkl j lk; jklfdsa jkfldsa jkl jkl fjdkl;sa

what djkf;a fkdls; fjdksal; fjdklsa; fjdklsa;

* highlight notes			 :ARCHIVE:
  :PROPERTIES:
  :ID:       EFA043A1-6B18-456A-8E01-15DEDD593270
  :ARCHIVE_TIME: 2015-12-26 Sat 12:17
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp
(remove-hook 'activate-mark-hook 'highlight-yellow)
(remove-hook 'deactivate-mark-hook 'highlight-yellow)
#+END_SRC

#+RESULTS:

#+BEGIN_SRC emacs-lisp
(defadvice handle-shift-selection (after my-show-point-and-mark () activate)
  "Show point and mark."
  (message "[%s %s]" (mark) (point)))

(defadvice mouse-set-region (after my-highlight () activate)
  "Highlight"
  (highlight-green))
#+END_SRC

#+RESULTS:
: mouse-set-region

(setq org-support-shift-select t)


what else can we  can we do? Let's make a new highlight /note/.

#+BEGIN_SRC emacs-lisp
(defun highlight-note (beg end note)
  (interactive (list (region-beginning) (region-end) (read-input "Note: ")))
  (unless (region-active-p)
    (error "No region selected."))
  (add-text-properties
   beg end
   `(help-echo ,note font-lock-face (:background "Thistle")
		    highlighted t)))

;; You might want to edit your note
(defun highlight-note-edit (new-note)
  (interactive (list (read-input "Note: " (get-text-property (point) 'help-echo))))
  (let* ((region (button-lock-find-extent (point) 'highlighted))
	 (beg (car region))
	 (end (cdr region)))
    (put-text-property beg end 'help-echo new-note)))
#+END_SRC

#+RESULTS:
: highlight-note-edit

f   dsaf   das    fds (ov-all)


#+BEGIN_SRC emacs-lisp
(require 'ov)

(defun highlight-note (beg end note)
  (interactive (list (region-beginning) (region-end) (read-input "Note: ")))
  (unless (region-active-p)
    (error "No region selected."))
  (ov beg end 'help-echo note 'face '(:background "Thistle")))

;; You might want to edit your note
(defun highlight-note-edit (new-note)
  (interactive (list (read-input "Note: " (get-text-property (point) 'help-echo))))
  (let* ((region (button-lock-find-extent (point) 'highlighted))
	 (beg (car region))
	 (end (cdr region)))
    (put-text-property beg end 'help-echo new-note)))
#+END_SRC

* overlay notes				 :ARCHIVE:
  :PROPERTIES:
  :ID:       A4D21A7E-7A90-4DEB-9329-E2B88BE06E4F
  :ARCHIVE_TIME: 2015-12-26 Sat 12:17
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

(overlay-start (ov-next 'highlighted t))
(overlay-end (ov-next 'highlighted t))
(overlay-properties (ov-next 'highlighted t))
(overlay-get (ov-next 'highlighted t) 'help-echo)
(overlay-get (ov-next 'highlighted t) 'face)

(ov-in 'highlighted t)

(ov-spec (ov-prev 'highlighted t))
clear all
(ov-clear 'highlighted t)

tree tree


(ov-goto-next 'highlighted t)

* Don't put headline in the email body	 :ARCHIVE:
  :PROPERTIES:
  :SENT-ON:  Tue Jul  7 13:34:58 2015
  :TO:       dixit@aya.yale.edu
#+ATTR_ORG: :width 300
#+CAPTION:
[[file:/Users/jkitchin/Desktop/scopus/nauthors-vs-ranking.png]]
:ID:       AC4360D3-D15D-4916-8C31-8B50F66EFFC1
:ARCHIVE_TIME: 2015-12-26 Sat 12:18
:ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
:ARCHIVE_CATEGORY: blog
  :END:

With the email.el in github it is not possible to not repeat the headline in the body of the message because it uses the whole subtree. Here is a modified version that fixes that issue and only puts the body of the current headline (including sub-headings).

** modified email-heading function
   :PROPERTIES:
   :SENT-ON:  Tue Jul  7 14:30:46 2015
   :TO:       dixit@aya.yale.edu
   :ID:       82E0BE64-EC14-4B2C-AEFE-2418C1C62E2A
   :END:
(require 'org-mime)

It looks like you need to put those into the body of the email-heading function. I am not too sure why. Also, I have to pass nil as an arg to org-mime-htmlize.

#+BEGIN_SRC emacs-lisp
(defun email-heading ()
  "Send the current org-mode heading as the body of an email, with headline as the subject.

use these properties
TO
CC
BCC
OTHER-HEADERS is an alist specifying additional
header fields.  Elements look like (HEADER . VALUE) where both
HEADER and VALUE are strings.

Save when it was sent as a SENT property. this is overwritten on
subsequent sends."
  (interactive)
  ; store location.
  (setq *email-heading-point* (set-marker (make-marker) (point)))
  (save-excursion
    (let ((content (progn
		     (unless (org-on-heading-p) (outline-previous-heading))
		     (let ((headline (org-element-at-point)))
		       (buffer-substring
			(org-element-property :contents-begin headline)
			(org-element-property :contents-end headline)))))
	  (TO (org-entry-get (point) "TO" t))
	  (CC (org-entry-get (point) "CC" t))
	  (BCC (org-entry-get (point) "BCC" t))
	  (SUBJECT (nth 4 (org-heading-components)))
	  (OTHER-HEADERS (eval (org-entry-get (point) "OTHER-HEADERS")))
	  (continue nil)
	  (switch-function nil)
	  (yank-action nil)
	  (send-actions '((email-send-action . nil)))
	  (return-action '(email-heading-return)))

      (compose-mail TO SUBJECT OTHER-HEADERS continue switch-function yank-action send-actions return-action)
      (message-goto-body)
      (insert content)
      (when CC
	(message-goto-cc)
	(insert CC))
      (when BCC
	(message-goto-bcc)
	(insert BCC))
      (if TO
	  (message-goto-body)
	(message-goto-to))

      (end-of-buffer)
      (insert "Warm regards,\nJay Dixit\n\n---\nJay Dixit
(646) 355-8001
[[http://jaydixit.com/][jaydixit.com]]
\n"))
(org-mime-htmlize nil)))
#+END_SRC

#+RESULTS:
: email-heading

* Indexing MS Office and PDF documents with swish-e :ARCHIVE:
  :PROPERTIES:
  :ID:       2444338F-B4A1-4F87-B98C-867F344EFDA8
  :ARCHIVE_TIME: 2015-12-26 Sat 12:18
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

We use file filters here. This is a little slow because each program is opened by another program.

there are also lots of errors from xml parsing.
#+BEGIN_SRC text :tangle ~/.swish-e/swish-office.conf
# Tell Swish-e what to directories to index
IndexDir /Users/jkitchin/Dropbox

# where to save the index
IndexFile /Users/jkitchin/.swish-e/office-index.swish-e

# What to index
IndexOnly .docx .pptx .xlsx .pdf

# Tell Swish-e that .txt files are to use the text parser.
IndexContents XML* .docx .pptx .xlsx .pdf

FileFilter  .docx  /sw/bin/unzip "-p \"%p\" word/document.xml
FileFilter  .pptx  /sw/bin/unzip "-p \"%p\" ppt/slides/slide*.xml
FileFilter  .xlsx  /sw/bin/unzip "-p \"%p\" xl/worksheets/sheet*.xml
FileFilter  .pdf /Users/jkitchin/Library/Enthought/Canopy_64bit/User/bin/pdf2txt.py "-t xml \"%p\""

MetaNames swishtitle

# Ask libxml2 to report any parsing errors and warnings or
# any UTF-8 to 8859-1 conversion errors
ParserWarnLevel 9
#+END_SRC



#+BEGIN_SRC sh
swish-e -c ~/.swish-e/swish-office.conf
#+END_SRC

#+RESULTS:
#+begin_example
Indexing Data Source: "File-System"
Indexing "/Users/jkitchin/Dropbox"

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [11]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]

Warning: filter '/sw/bin/unzip' exited with non-zero status: [9]
Removing very common words...
no words removed.
Writing main index...
Sorting words ...
Sorting 1,382,832 words alphabetically
Writing header ...
Writing index entries ...
  Writing word text: ...  Writing word text:  10%  Writing word text:  20%  Writing word text:  30%  Writing word text:  40%  Writing word text:  50%  Writing word text:  60%  Writing word text:  70%  Writing word text:  80%  Writing word text:  90%  Writing word text: 100%  Writing word text: Complete
  Writing word hash: ...  Writing word hash:  10%  Writing word hash:  20%  Writing word hash:  30%  Writing word hash:  40%  Writing word hash:  50%  Writing word hash:  60%  Writing word hash:  70%  Writing word hash:  80%  Writing word hash:  90%  Writing word hash: 100%  Writing word hash: Complete
  Writing word data: ...  Writing word data:   9%  Writing word data:  19%  Writing word data:  29%  Writing word data:  39%  Writing word data:  49%  Writing word data:  59%  Writing word data:  69%  Writing word data:  79%  Writing word data:  89%  Writing word data:  99%  Writing word data: Complete
1,382,832 unique words indexed.
Sorting property: swishdocpath                            Sorting property: swishtitle                              Sorting property: swishdocsize                            Sorting property: swishlastmodified                       4 properties sorted.
3,598 files indexed.  5,154,618,509 total bytes.  19,696,066 total words.
Elapsed time: 00:01:57 CPU time: 00:01:36
Indexing done!
#+end_example





#+BEGIN_SRC sh
swish-e -f ~/.swish-e/office-index.swish-e -x '%r\t%p\n' -w bingyun
#+END_SRC

#+RESULTS:
#+begin_example
# SWISH format: 2.4.7
# Search words: bingyun
# Removed stopwords:
# Number of hits: 47
# Search time: 0.003 seconds
# Run time: 0.015 seconds
1000	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-april-2012-kitchin.docx
1000	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-january-2012-kitchin.docx
1000	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-june-2012-kitchin.docx
1000	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-march-2012-kitchin.docx
1000	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-may-2012-kitchin.docx
922	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/August-2012-all-reports-RUA.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/May-2012-all-reports-RUA.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/January-2012-all-reports-RUA.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/amine-co2/monthly-reports/Carbon Capture Monthly Report - December 2011 - kitchin.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-september-2012-kitchin.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-july-2012-kitchin.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-february-2012-kitchin.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-august-2012-kitchin.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/Carbon Capture Monthly September 2012 Ver 3.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/April-2012-all-reports-RUA.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/amine-co2/monthly-reports/December-2011-luebke-monthly.docx
824	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/February-2012-all-reports-RUA.docx
711	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/Carbon Capture Monthly Oct 2012 Ver 2.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/FY13-URS/Carbon Capture Monthly Template FY-13 ver 1.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/amine-co2/monthly-reports/November-2011-luebke-summary.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/March-2012-all-reports-RUA.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/kitchin-sept-2013-quarterly-Carbon Capture Monthly Template FY-13 ver 10.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/Carbon Capture Monthly Template FY-13 ver 7 Solvents Hydrophobic Enick  rme.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/kitchin-Mar-Carbon Capture Monthly Template FY-13 ver 7.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/kitchin-july-2013-Carbon Capture Monthly Template FY-13 ver 9.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/kitchin-Carbon Capture Monthly Template FY-13 - Feb.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/kitchin-august-2013-Carbon Capture Monthly Template FY-13 ver 10.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/kitchin-april-Carbon Capture Monthly Template FY-13 ver 7.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/CarbonCaptureAugust.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/CarbonCaptureApril-1.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/CaptureMonthlyMay-1.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/amine-co2/monthly-reports/October-2011-luebke-monthly.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/December-2012.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-october-2012-kitchin.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-november-2012-kitchin.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/Carbon Capture Monthly Nov 2012 Final.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-january-2013-kitchin.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY12/Task-94-solvent-Raman/monthly-reports/co2-december-2012-kitchin.docx
561	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/kitchin-may-2013Carbon Capture Monthly Template FY-13 ver 8-1.docx
355	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY14/kitchin-feb-2014-Carbon Capture Monthly Template FY-14 ver 9.docx
355	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY14/2014-08-monthly-kitchin.docx
355	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY14/carbon-capture-templates/kitchin-2014-3rd-quarterly-report.docx
355	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY14/kitchin-may-2014-Carbon Capture Monthly Template FY-14 ver 9.docx
355	/Users/jkitchin/Dropbox/kitchingroup/students/ahallenb/reports/2014-01-kitchin-Carbon Capture Monthly Template FY-14 ver 6.docx
355	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY14/CC-November-2013.docx
355	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY14/kitchin-Carbon Capture Monthly Template FY-14 ver 11-2.docx
355	/Users/jkitchin/Dropbox/CMU/projects/archive/RUA/FY13/task-136/kitchin-Carbon Capture Monthly Template FY-14 ver 4.docx
.
#+end_example

* debugging outshine issue
  :PROPERTIES:
  :ID:       AE29C176-A2A1-44C1-9ECE-3674ECB44270
  :ARCHIVE_TIME: 2015-12-26 Sat 12:19
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
outline-regexp
#+END_SRC

#+RESULTS:
: \*+

#+BEGIN_SRC emacs-lisp
(require 'outshine)
#+END_SRC

#+RESULTS:
: outshine

#+BEGIN_SRC emacs-lisp
outline-regexp
#+END_SRC

#+RESULTS:
: \*+

* A simple helm menu
  :PROPERTIES:
  :ID:       533BDE60-35F7-4E1F-B9EC-E41CA0CBABCF
  :ARCHIVE_TIME: 2015-12-26 Sat 12:21
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

Helm is an interesting way to interactively select something, and perform an action on it.
here is an example where I tried to get all the words in the buffer, select one from helm, and then search the word.

The setup is not intuitive yet. You need to provide some sources that helm will use to create the matching buffer. This is usually done in a variable that is a list of cons cells. The source provides "candidates", and "actions". After that


#+BEGIN_SRC emacs-lisp
(defun helm-words-google (word)
  "Google the WORD."
  (interactive)
  (browse-url
   (format
    "http://www.google.com/search?q=%s" word)))

(defun helm-words-twitter (word)
  "Search twitter for WORD."
  (interactive)
  (browse-url
   (format
    "https://twitter.com/search?q=%s" word)))


(defvar helm-source-words
 '()
  "Source for helm-words")

(setq helm-source-words
      '((name . "Words entries")
	(candidates . (lambda nil (with-current-buffer
				    cb
				    (split-string (buffer-string)))))
	(action . (("google" . helm-words-google)
		   ("twitter" . helm-words-twitter)))))

(defun helm-words ()
  "helm a word"
  (interactive)
  ;; we have to save the buffer we are in before we go to the helm buffer
  ;; so that we can get the words there.
  (let ((cb (current-buffer)))
    (helm :sources '(helm-source-words)
	  :buffer "*helm-words*")))

#+END_SRC

#+RESULTS:
: helm-words

#+BEGIN_SRC emacs-lisp :results code
(helm-bibtex-candidates)
#+END_SRC

#+RESULTS:


The candidates must be a list of items, and the car of the list is what gets listed in the helm selection buffer. The cdr of the list gets passed to the action functions. Here we hard code some candidates to make it more clear. We see the car in the helm buffer, and get the cdr passed to our action functions.

#+BEGIN_SRC emacs-lisp
(defun helm-words-google (word)
  "Google the WORD."
  (interactive)
  (browse-url
   (format
    "http://www.google.com/search?q=%s"
    (if (listp word)
	(mapconcat 'identity word " and ")
      word))))

(defun helm-words-twitter (word)
  "Search twitter for WORD."
  (interactive)
  (browse-url
   (format
    "https://twitter.com/search?q=%s"
    (if (listp word)
	(mapconcat 'identity word " and ")
      word))))

(defvar helm-source-words
 '()
  "Source for helm-words")

(setq helm-source-words
      '((name . "Words entries")
	(candidates . (lambda nil '(("a" . ("apple" "apricot"))
				    ("b" . "bear")
				    ("c" . "cat"))))
	(action . (("google" . helm-words-google)
		   ("twitter" . helm-words-twitter)))))

(defun helm-words ()
  "helm a word"
  (interactive)

  (let ((cb (current-buffer)))
    (helm :sources '(helm-source-words)
	  :buffer "*helm-words*")))

#+END_SRC

#+RESULTS:
: helm-words

* a simple logging library for emacs
  :PROPERTIES:
  :ID:       27F6BFA9-DF70-44C5-BFB1-FA85C6155009
  :ARCHIVE_TIME: 2015-12-26 Sat 12:23
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
python has a great logging module. I would like this kind of capability.

(log-info "something %s" variable)
(log-debug "something %s" variable)

you set a =*log-level*= somewhere in your code to determine which messages get logged. Each log function has a corresponding trigger level, and if your =*log-level*= is greater than or equal to the trigger it will log to Messages.

#+BEGIN_SRC emacs-lisp
(setq *log-level* 10
      ,*log-info* 10
      ,*log-debug* 50)

(defun log-info (message &rest args)
  "print message formatted with args"
  (when (>= *log-level* *log-info*) ; *log-level* greater than this level print
    (message "log-info: %s" (apply #'format message args))))

(log-info "test %s %s" 5 "done")
#+END_SRC

#+RESULTS:
: log-info: test 5 done

this is not that sophisticated, it might be nice to have introspection, line numbers, functions, etc...

* Is my cursor on a link
  :PROPERTIES:
  :ID:       77362EB8-8EE8-4396-AD71-D15A2ABB7ADE
  :ARCHIVE_TIME: 2015-12-26 Sat 12:23
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp
(defun label-p ()
 "determine if the cursor is on a label link. return the path if so, nil otherwise"
  (interactive)
  (let ((object (org-element-context)))
    (message "%s" (when
	(and (equal (org-element-type object) 'link)
	     (equal (org-element-property :type object) "label"))
      (org-element-property :path object)))))
#+END_SRC


label:test1
   label:test

[[file:~/Dropbox/kitchingroup/jmax/org-mode/lisp/org.el::((looking-at%20org-any-link-re)][file:~/Dropbox/kitchingroup/jmax/org-mode/lisp/org.el::((looking-at org-any-link-re)]]

* miscellaneous links
  :PROPERTIES:
  :ID:       0E7AA5EA-903F-45D0-BF0A-226C1CC8873F
  :ARCHIVE_TIME: 2015-12-26 Sat 20:34
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

see http://draketo.de/light/english/emacs/convert-ris-citations-bibtex-bibutils

http://draketo.de/english/emacs/writing-papers-in-org-mode-acpd

* Using Matlab in org-mode
  :PROPERTIES:
  :categories: matlab
  :ID:       68A3AF12-CE56-4EFB-82F0-D31738545E4D
  :ARCHIVE_TIME: 2015-12-26 Sat 20:34
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
Most of my work in org-mode uses python, or emacs-lisp. One thing that would make org-mode more readily adopted is if we could use Matlab too. Unfortunately, this is not currently possible on Windows. We need a tty shell.

#+BEGIN_SRC matlab :results value
u = cmu.units;

5*u.kg % a mass
5*u.lb % another mass
6*u.m/u.s  % a velocity

ans = 1*u.m + 10*u.cm % this is ok, 1.1 m
% 1*u.m + 1*u.s  % this is not ok
#+END_SRC

#+RESULTS:

* Storing data files in a Word document
  :PROPERTIES:
  :ID:       DEBFDB6F-D996-4DEB-B524-BFD73C7ACE00
  :ARCHIVE_TIME: 2015-12-26 Sat 20:37
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


You probably know that the modern office documents are just thinly wrapped zip files full of other files. For example, this Word document file:kitchin_cv.docx opens as a Word document, but we can use Python and zipfile to examine the contents.

#+BEGIN_SRC python
from zipfile import ZipFile
with ZipFile('kitchin_cv.docx') as myzip:
    print myzip.printdir()
#+END_SRC
#+RESULTS:
#+begin_example
File Name                                             Modified             Size
[Content_Types].xml                            1980-01-01 00:00:00         2125
_rels/.rels                                    1980-01-01 00:00:00          590
word/_rels/document.xml.rels                   1980-01-01 00:00:00        14241
word/document.xml                              1980-01-01 00:00:00       524045
word/footer1.xml                               1980-01-01 00:00:00         4036
word/header1.xml                               1980-01-01 00:00:00         1706
word/endnotes.xml                              1980-01-01 00:00:00         1629
word/footnotes.xml                             1980-01-01 00:00:00         3117
word/theme/theme1.xml                          1980-01-01 00:00:00         7076
word/media/image1.tmp                          1980-01-01 00:00:00        99449
word/media/image2.tmp                          1980-01-01 00:00:00        85976
word/media/image3.tmp                          1980-01-01 00:00:00        61281
word/settings.xml                              1980-01-01 00:00:00        29812
word/fontTable.xml                             1980-01-01 00:00:00         3887
word/styles.xml                                1980-01-01 00:00:00        36430
word/stylesWithEffects.xml                     1980-01-01 00:00:00        37296
docProps/app.xml                               1980-01-01 00:00:00        21158
docProps/core.xml                              1980-01-01 00:00:00          748
word/webSettings.xml                           1980-01-01 00:00:00         2484
word/numbering.xml                             1980-01-01 00:00:00        82725
None
#+end_example

You can see many of the files are xml files. In this post, I want to explore putting an arbitrary data file in the Word document, and then extracting it later. This is similar to the way we use LaTeX and attachfile to store data files in PDFs for supporting information files.

So first, lets create a simple json file.

#+BEGIN_SRC python :results silent
import json
with open('some-data.json', 'w') as f:
    f.write(json.dumps({'a': 1,
                        'b': 2}))
#+END_SRC

Here are the contents of our new file.
#+BEGIN_SRC sh
cat some-data.json
#+END_SRC

#+RESULTS:
: {"a": 1, "b": 2}

Now, we will add the file to the docx file. We just open the ZipFile in append mode, and write a new file to it.

#+BEGIN_SRC python
from zipfile import ZipFile
with ZipFile('kitchin_cv.docx', 'a') as myzip:
    print myzip.write('some-data.json')
    print myzip.printdir()
#+END_SRC

#+RESULTS:
#+begin_example
None
File Name                                             Modified             Size
[Content_Types].xml                            1980-01-01 00:00:00         2125
_rels/.rels                                    1980-01-01 00:00:00          590
word/_rels/document.xml.rels                   1980-01-01 00:00:00        14241
word/document.xml                              1980-01-01 00:00:00       524045
word/footer1.xml                               1980-01-01 00:00:00         4036
word/header1.xml                               1980-01-01 00:00:00         1706
word/endnotes.xml                              1980-01-01 00:00:00         1629
word/footnotes.xml                             1980-01-01 00:00:00         3117
word/theme/theme1.xml                          1980-01-01 00:00:00         7076
word/media/image1.tmp                          1980-01-01 00:00:00        99449
word/media/image2.tmp                          1980-01-01 00:00:00        85976
word/media/image3.tmp                          1980-01-01 00:00:00        61281
word/settings.xml                              1980-01-01 00:00:00        29812
word/fontTable.xml                             1980-01-01 00:00:00         3887
word/styles.xml                                1980-01-01 00:00:00        36430
word/stylesWithEffects.xml                     1980-01-01 00:00:00        37296
docProps/app.xml                               1980-01-01 00:00:00        21158
docProps/core.xml                              1980-01-01 00:00:00          748
word/webSettings.xml                           1980-01-01 00:00:00         2484
word/numbering.xml                             1980-01-01 00:00:00        82725
some-data.json                                 2014-12-14 12:08:56           16
None
#+end_example

Sure enough, there is a new entry in there! Finally, we show that the contents of this file can be read in. We simply have to know what the file to read is, and we can get the contents.

#+BEGIN_SRC python
import json
from zipfile import ZipFile
with ZipFile('kitchin_cv.docx', 'r') as myzip:
    contents = myzip.read('some-data.json')
    data = json.loads(contents)
    print data
#+END_SRC
#+RESULTS:

Unfortunately, this corrupts the Word file so it does not immediately open. Word is able to recover it and get it open. And, after it is open, the some-data.json entry is gone.

#+BEGIN_SRC python
from zipfile import ZipFile
with ZipFile('kitchin_cv.docx', 'a') as myzip:
    print myzip.printdir()
#+END_SRC
#+RESULTS:
#+begin_example
File Name                                             Modified             Size
[Content_Types].xml                            1980-01-01 00:00:00         2125
_rels/.rels                                    1980-01-01 00:00:00          590
word/_rels/document.xml.rels                   1980-01-01 00:00:00        14241
word/document.xml                              1980-01-01 00:00:00       524305
word/footer1.xml                               1980-01-01 00:00:00         4037
word/header1.xml                               1980-01-01 00:00:00         1706
word/endnotes.xml                              1980-01-01 00:00:00         1629
word/footnotes.xml                             1980-01-01 00:00:00         3117
word/theme/theme1.xml                          1980-01-01 00:00:00         7076
word/media/image1.tmp                          1980-01-01 00:00:00        99449
word/media/image2.tmp                          1980-01-01 00:00:00        85976
word/media/image3.tmp                          1980-01-01 00:00:00        61281
word/settings.xml                              1980-01-01 00:00:00        29890
word/fontTable.xml                             1980-01-01 00:00:00         3887
word/styles.xml                                1980-01-01 00:00:00        36430
word/stylesWithEffects.xml                     1980-01-01 00:00:00        37296
docProps/app.xml                               1980-01-01 00:00:00        21158
docProps/core.xml                              1980-01-01 00:00:00          748
word/webSettings.xml                           1980-01-01 00:00:00         2484
word/numbering.xml                             1980-01-01 00:00:00        82725
None
#+end_example

So, it appears this is not a good way to store data inside a Word document.

* org-element-explorer
  :PROPERTIES:
  :CATEGORY: emacs
  :ID:       DA6BE2FD-B2DA-490A-9413-AF4173FA0403
  :ARCHIVE_TIME: 2015-12-26 Sat 20:38
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: emacs
  :END:

#+OPTIONS: toc:nil ^:{}

#+TITLE: org-element-explorer

#+caption: some table.
| 2 | 4 |
| e | r |
| 5 | 6 |

cite:shi-2007-first-au

#+caption: image caption
#+label: citations
[[./images/2014-citations.png]]


\( sin(x) = 5\)

#+BEGIN_EXAMPLE
example
#+END_EXAMPLE

#+BEGIN_SRC emacs-lisp
(defvar org-ref-last-mouse-pos nil
 "Stores last mouse position for use in `org-ref-mouse-message'.")

(defun can-move-p ()
  "See if a character is under the mouse. If so return the position for `goto-char'."
  (let* ((line (cddr org-ref-last-mouse-pos))
	 (col  (cadr org-ref-last-mouse-pos)))
    (save-excursion
      (goto-char (window-start))
      (forward-line line)
      (if
	  (> (- (line-end-position) (line-beginning-position)) col)
	  (progn  (forward-char col) (point))
	nil))))

(defun org-element-explorer ()
  "Display buffer with org-element context under mouse cursor."
  (interactive)

        (let ((context (org-element-context))
              (cb (current-buffer)))
	  (switch-to-buffer "*org-element*")
	  (erase-buffer)
	  (emacs-lisp-mode)
	  (insert (format "%s"  context))
	  (goto-char (point-min))
	  (while (re-search-forward ":" nil t)
	    (backward-char)
	    (insert "\n")
	    (forward-char))
	  (goto-char (point-min))
	  (special-lispy-multiline)
	  (switch-to-buffer cb)
          ))

(add-hook 'post-command-hook 'org-element-explorer nil t)
;(remove-hook 'post-command-hook 'org-element-explorer)
#+END_SRC

#+RESULTS:
| org-element-explorer | whitespace-post-command-hook | t | flyspell-post-command-hook |

** TODO a subheading
   SCHEDULED: <2015-01-28 Wed> DEADLINE: <2015-01-29 Thu>
   :PROPERTIES:
   :ID:       E3EA8196-D12A-4588-BEA7-8BE54C468307
   :END:

* Asynchronous functions to modify buffers
  :PROPERTIES:
  :ID:       D7921549-B8F7-4F8B-AFC6-46D16E0A73DF
  :ARCHIVE_TIME: 2015-12-26 Sat 21:12
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

I wrote some code to make clickable org-contacts in org-mode buffers. The code works by generating a regular expression for every name in your contact, and using button-lock to add properties to matches. I discovered that if you have a few thousand contacts though, the regular expression is "too big" for Emacs! I could try to figure out how to breakup the contacts into reasonable sized groups, say 100 names at a time, but I want to try something else today. Today I want to explore an alternative approach to font-lock. The idea is to write a function that will scan through the buffer for names, and fontify them when they are found. This will usually block Emacs while running, so I want to see if I can run it asynchronously.

It does not appear possible. I cannot figure out how to pass the buffer to the asynchronous function.

#+BEGIN_SRC emacs-lisp
(require 'ov)
(defun hl-phrases ()
  (let ((phrases '("tree" "crazy fox" "animal")))
    (loop for phrase in phrases
	  do
	  (sleep-for 2)
	  (save-excursion
	    (goto-char (point-min))
	    (while (re-search-forward phrase nil t)
	      (ov (match-beginning 0)
		  (match-end 0)
		  'face '(:background "Darkolivegreen1")
		  'highlighted t)))))
  0)

(setq *hl-buffer* (current-buffer))
(async-start
 (lambda ()
   (require 'cl)
   (let ((phrases '("tree" "crazy fox" "animal"))
	 (found '()))
     (loop for phrase in phrases
	   do
	   (sleep-for 2)
	   (save-excursion
	     (goto-char (point-min))
	     (while (re-search-forward phrase nil t)
	       (add-to-list
		'found
		(list (match-beginning 0) (match-end 0))))))
     found))
 (lambda (result)
   (message-box "Done in %s" result)))
#+END_SRC

#+RESULTS:
: #<overlay from 1648 to 1651 in blog.org>


#+BEGIN_SRC emacs-lisp
(ov-clear 'highlighted t)
#+END_SRC

#+RESULTS:


The crazy fox jumped over the tree because it is an animal.

* Formatting citation links
  :PROPERTIES:
  :ID:       F918E93C-2497-46A3-AE5C-241700F98368
  :ARCHIVE_TIME: 2016-01-03 Sun 21:17
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(setq s "pre text::post text")
(cond
  ((string-match "::" s)
   (format "[%s][%s]" (car (setq results (split-string s "::"))) (cadr results)))
  (t (format "[%s]" s)))

#+END_SRC

#+RESULTS:
: [pre text][:post text]

#+BEGIN_SRC emacs-lisp
(defun org-ref-cite-link-format (keyword desc format)
   (cond
    ((eq format 'html) (format "(<cite>%s</cite>)" path))
    ((eq format 'latex)
     (concat "\\cite" (when desc (format "[%s]" desc)) "{"
	     (mapconcat (lambda (key) key) (org-ref-split-and-strip-string keyword) ",")
	     "}"))))

(org-ref-cite-link-format "cite" "pre text::post text" 'latex)
#+END_SRC

#+RESULTS:
: \cite[pre text::post text]{cite}

* Functional definition of links
  :PROPERTIES:
  :ID:       90628675-2551-4068-A12E-9C9E21E244D6
  :ARCHIVE_TIME: 2016-01-03 Sun 21:17
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
In org-ref, I have a need to define a lot of link types that are all variations of the same kind, but with different names. I do not want to make a unique function for each link, because that involves a lot of cut and paste code.

I want to use something like mapcar on a list to define these links.

#+BEGIN_SRC emacs-lisp :results silent
(setq links '("test1" "test2"))

(defun define-link (link)
  (interactive)
  (eval-expression `(org-add-link-type ,link
 (lambda (x) (message "you clicked on %s" x))
 ;; formatting
 (lambda (keyword desc format)
   (cond
    ((eq format 'html) (format "(<",link">%s</",link">)" path))
    ((eq format 'latex)
     (concat "\\" ,link "{" keyword "}")))))))

(mapcar 'define-link links)
#+END_SRC


test1:wat

test2:yes

* put properties on strings
  :PROPERTIES:
  :ID:       111A4A84-8EDF-418D-8F12-2B6F9DE3BB59
  :ARCHIVE_TIME: 2016-01-03 Sun 21:18
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

(put-text-property


#+BEGIN_SRC emacs-lisp
   (let ((s "Alex"))
      (put-text-property 0 (length s) 'font-lock-face '(:foreground "blue" :background "white" :underline t) s)
      (message-box s))
#+END_SRC

#+RESULTS:
: Alex

   (let ((s "Alex"))
      (put-text-property 0 (length s) 'face 'diary s)
      (insert s))

finish
#+BEGIN_SRC emacs-lisp
(defun func (a b)
 (interactive (list '("a" "b") '(1 2)))
 (message "%s %s" a b))

#+END_SRC

* Getting data from a named checklist in org-mode
  :PROPERTIES:
  :ID:       E3264006-2601-433B-A580-919EF810A7D4
  :categories: orgmode
  :ARCHIVE_TIME: 2016-02-14 Sun 19:19
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

A while ago I was using


#+name: research-impact
- test
  - [ ] (4) a
  - [ ] (3) b
  - [X] (2) c
  - [X] (1) d

#+attr_org: :single-value
#+name: teaching
- [X] (4) a
- [ ] (3) b
- [ ] (2) c
- [ ] (1) d



#+BEGIN_SRC emacs-lisp
(defun element-explorer ()
  (interactive)
  (message "%s" (org-element-context)))
#+END_SRC

#+RESULTS:

#+BEGIN_SRC emacs-lisp :results none
(defun org-jump-to-plain-list (name)
  (catch 'found
    (org-element-map
	(org-element-parse-buffer)
	'plain-list
      (lambda (plain-list)
	(when
	    (string= name (org-element-property :name plain-list))
	  (goto-char (org-element-property :begin plain-list))
	  (throw 'found plain-list))))))

(org-jump-to-plain-list "research-impact")
#+END_SRC

#+BEGIN_SRC emacs-lisp
(defun happ-get-first-checked-item (plain-list-name)
  "Go to the list named PLAIN-LIST-NAME and get the value of the first checked item.
The value is stored in () in the list, and it will be 1,2,3,4 or y/n."

  (save-excursion
    (loop for el in (org-element-property
		     :structure
		     (org-jump-to-plain-list plain-list-name))
	  if (string= (nth 4 el) "[X]")
	  return (progn
		   (string-match "(\\([1234yn]\\))" (buffer-substring (car el) (car (last el))))
		   (match-string 1 (buffer-substring (car el) (car (last el))))))))

(org-get-checked-items "research-impact")
#+END_SRC
#+RESULTS:
: 2

* gist of org-ref
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-02-14 Sun 19:22
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

1. A way to search a database of references and insert a formatted citation (helm-bibtex)
2. Clickable citations that give a menu of "actions"
3. Export of citations to formats
4. Utility functions

* Scrape DOIs from a url
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-02-14 Sun 19:22
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

** url
#+BEGIN_SRC emacs-lisp
(with-current-buffer (url-retrieve-synchronously "http://www.sciencedirect.com/science/article/pii/S1388248109003750")
  (re-search-forward "doi = '\\([^']*\\)'")
  (match-string 1))
#+END_SRC

#+RESULTS:
: 10.1016/j.elecom.2009.08.004

<meta name="citation_doi" content="10.1002/ange.201002301">
#+BEGIN_SRC emacs-lisp
(with-current-buffer (url-retrieve-synchronously "http://onlinelibrary.wiley.com/doi/10.1002/ange.201002301/abstract")
(message (buffer-string))
  (re-search-forward "<meta name=\"citation_doi\" content=\"\\([^\"]*\\)\">")
  (match-string 1))
#+END_SRC

#+BEGIN_SRC emacs-lisp :results code
(let* ((html (with-current-buffer (url-retrieve-synchronously
"http://onlinelibrary.wiley.com/doi/10.1002/ange.201002301/abstract")
	       (libxml-parse-html-region url-http-end-of-headers (point-max))))
       (head (car (xml-get-children html 'head)))
       (metas (xml-get-children head 'meta)))
metas)
#+END_SRC
#+RESULTS:
#+BEGIN_SRC emacs-lisp
nil
#+END_SRC



(switch-to-buffer (url-retrieve-synchronously "http://www.ncbi.nlm.nih.gov/pubmed/26455918")) "http://www.nature.com/nature/journal/v528/n7582/full/nature15540.html"))



#+BEGIN_SRC emacs-lisp
(loop for url in '("http://www.jstor.org/stable/1694721?seq=1#page_scan_tab_contents"
		   "http://pubs.acs.org/doi/abs/10.1021/acscatal.5b00538"
		   "http://jes.ecsdl.org/content/162/11/D3030"
		   "http://www.tandfonline.com/doi/abs/10.1080/08927020902833137#.VnNqcxHodPI" "http://iopscience.iop.org/article/10.1088/0957-4484/27/5/055301;jsessionid=E46EA54B5E75077ABED2EDCA9364CA3B.c3.iopscience.cld.iop.org" "http://pubs.rsc.org/en/content/articlelanding/2016/sc/c5sc04385a#!divAbstract"
		   "http://ecst.ecsdl.org/content/25/2/2769"
		   "http://www.pnas.org/content/early/2014/05/08/1319030111"
		   "http://link.springer.com/article/10.1007%2Fs11244-013-0166-3"
		   ;"http://www.nature.com/nature/journal/v528/n7582/full/nature16323.html"
		   "http://www.sciencemag.org/content/347/6217/7"
		   "http://scitation.aip.org/content/aip/journal/jcp/137/8/10.1063/1.4746117"
		   "http://journals.aps.org/prb/abstract/10.1103/PhysRevB.77.075437"
		   "http://onlinelibrary.wiley.com/doi/10.1002/ange.201002301/abstract"
                   "http://www.ncbi.nlm.nih.gov/pubmed/26455918")
 collect (org-ref-scrape-doi url))
#+END_SRC

#+RESULTS:
| 10.2307/1694721 | 10.1021/acscatal.5b00538 | 10.1149/2.0161511jes | 10.1080/08927020902833137 | 10.1088/0957-4484/27/5/055301 | 10.1039/C5SC04385A | 10.1149/1.3205838 | 10.1073/pnas.1319030111 | 10.1007/s11244-013-0166-3 | 10.1126/science.aaa5057 | 10.1063/1.4746117 | 10.1103/PhysRevB.77.075437 | 10.1002/ange.201002301 | 10.1039/c5cp04840k |

** For PDF


#+BEGIN_SRC emacs-lisp
(defun visit-pdf (fname)
  (interactive)
  (switch-to-buffer "*pdftotext*")
  (erase-buffer)
  (insert
   (shell-command-to-string (format "pdftotext %s -" fname)))
  (goto-char (point-min))
  (occur "doi"))

#+END_SRC

#+RESULTS:
: visit-pdf

(visit-pdf "~/Dropbox/bibliography/bibtex-pdfs/giannozzi-2009-quant-espres.pdf")
(visit-pdf "~/Dropbox/bibliography/bibtex-pdfs/friebel-2015-ident-fe.pdf")



DOI regexps
"dx.doi.org/\\([^]} \"]*\\)"

"\\(?:doi\\|DOI\\):\\s-?\\([^]} \"]*\\)"

"dx.doi.org/\\(?1:[^]} \"]*\\)\\|\\(?:doi\\|DOI\\):\\s-?\\(?1:[^]} \"]*\\)"

http://www.emacswiki.org/emacs/MultilineRegexp

#+BEGIN_SRC emacs-lisp :results code
(defun org-ref-extract-doi-from-pdf (pdf)
  (with-temp-buffer
    (insert (shell-command-to-string (format "pdftotext %s -" pdf)))
    (goto-char (point-min))
    (let ((matches '()))
      (while (re-search-forward "dx.doi.org/\\(?1:[^]\n} \"]*\\)\\|\\(?:doi\\|DOI\\):\\s-?\\(?1:[^]}\n \"]*\\)" nil t)
	;; I don't know how to avoid a trailing . on some dois with the expression above
	(let ((doi (match-string 1)))
	  (when (s-ends-with? "." doi)
	    (setq doi (substring doi 0 (- (length doi) 1))))
	  (add-to-list 'matches doi)))
      matches)))

(loop for pdf in (-slice  (f-entries
			   "~/Dropbox/bibliography/bibtex-pdfs"
			   (lambda (f) (f-ext? f "pdf")))
			 50 75)
      collect (org-ref-extract-doi-from-pdf pdf))
#+END_SRC
#+RESULTS:
| 10.1021/cm901723j            |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1103/PhysRevB.83.153101   |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1103/PhysRevB.85.045439   |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1021/nl5005674            |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1016/0263-7855(96)00018-5 | 10.1063/1.2408420 | 10.1002/jcc.540080710 | 10.1021/jp037780t | 10.1021/jp970984n | 10.1063/1.1699114 | 10.1063/ | 10.1137/0916069 | 10.1103/PhysRevLett.78.1396 | 10.1103/PhysRevLett.77.3865 | 10.1103/PhysRevLett.102.073005 | 10.1063/1.467943 | 10.1002/pssb.201248370 | 10.1103/PhysRevB.83.153101 | 10.1103/ | 10.1021/nl102588p | 10.1039/B821328C | 10.1039/B912501A | 10.1002/jcc.21197 | 10.1021/nl302405k | 10.1103/PhysRevB.57.6427 | 10.1016/ | 10.1142/s0217979205030943 | 10.1039/b707813g | 10.1016/s0169-4332(03)00632-9 | 10.1063/1.1429658 | 10.1021/ | 10.1039/C3CP53758G | 10.1021/nn403788a | 10.1021/jp305367z | 10.1021/cs300227s | 10.1038/nchem.121 | 10.1039/c4ra08949a | 10.1021/ja500590n | 10.1039/c4cp02930e | 10.1039/c2cp42716h | 10.1039/B817729P | 10.1021/cr040090g | 10.1039/c3ee41272e | 10.1021/jo801260f | 10.1039/C2CC31576A | 10.1126/science.1170377 |   | 10.1016/j.commatsci.2015.07.046 |
| 10.1002/anie.201404109       | 10.1021/jp505847g |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1021/jp4110536            |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1103/PhysRevB.90.115105   |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1103/PhysRevB.90.115105   |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1126/science.1251959      |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1021/ja405997s            |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |
| 10.1016/j.jssc.2008.01.007   |                   |                       |                   |                   |                   |          |                 |                             |                             |                                |                  |                        |                            |          |                   |                  |                  |                   |                   |                          |          |                           |                  |                               |                   |          |                    |                   |                   |                   |                   |                    |                   |                    |                    |                  |                   |                    |                   |                    |                         |   |                                 |

DOI regexps
"dx.doi.org/\\([^]} \"]*\\)"

"\\(?:doi\\|DOI\\):\\s-?\\([^]} \"]*\\)"










#+BEGIN_SRC emacs-lisp
(defun extract-doi-from-pdf (event)
  (interactive "e")
  (goto-char (nth 1 (event-start event)))
  (x-focus-frame nil)
  (let* ((payload (car (last event)))
	 (pdf-file (abbreviate-file-name
		    (replace-regexp-in-string "\\\\" "/" (cdr payload))))
	 doi)
    (save-excursion
      (with-temp-buffer
	(insert (shell-command-to-string (format "pdftotext %s -" pdf-file)))
	(goto-char (point-min))
	(if (re-search-forward "http://dx.doi.org/\\(10.+$\\)" nil nil)
	    (setq doi (match-string 1))
	  (user-error "No doi can be found in the pdf file.")))
      ;; (doi-utils-add-bibtex-entry-from-doi doi (car org-ref-default-bibliography))
      )))

(bind-key "<drag-n-drop>" 'extract-doi-from-pdf)

#+END_SRC
#+RESULTS:
: extract-doi-from-pdf

* pdf crossref
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-02-14 Sun 19:22
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
efforts to find a bibtex entry from a pdf.

#+BEGIN_SRC emacs-lisp
(require 'org-ref-pdf)
(loop for pdf in (-slice  (f-entries
			   "~/Dropbox/bibliography/bibtex-pdfs"
			   (lambda (f) (f-ext? f "pdf")))
			 0 10)
      collect (list (file-name-nondirectory pdf) (org-ref-extract-doi-from-pdf pdf)))
#+END_SRC

#+RESULTS:
| 2010-reprod-resear.pdf                | nil                                                     |
| PhysRev.140.A1133.pdf                 | nil                                                     |
| aarik-1996-atomic-tio2.pdf            | (10.1080/095008396180911)                               |
| aarik-1997-effec-tio2.pdf             | nil                                                     |
| abild-pedersen-2007-scalin-proper.pdf | (10.1103/PhysRevLett.99.016105)                         |
| abild-pedersen-2013-commen-uesin.pdf  | (10.1021/jp312595p 10.1021/jp401620e 10.1021/jp303276z) |
| abolhasani-2011-model.pdf             | nil                                                     |
| abolhasani-2012-autom.pdf             | (10.1039/c2lc21043f)                                    |
| abolhasani-2012-cruis.pdf             | (10.1039/c2lc40513j)                                    |
| abolhasani-2015-peclet-number.pdf     | (10.1021/acs.iecr.5b01991)                              |


#+BEGIN_SRC emacs-lisp
(progn
  (switch-to-buffer "*pdftotext*")
  (erase-buffer)
  (insert
   (shell-command-to-string (format "pdftotext %s -" "~/Dropbox/bibliography/bibtex-pdfs/PhysRev.140.A1133.pdf")))
;;   (shell-command-to-string (format "pdftotext %s -" "~/Dropbox/bibliography/bibtex-pdfs/abolhasani-2011-model.pdf")))
;;   (shell-command-to-string (format "pdftotext %s -" "~/Dropbox/bibliography/bibtex-pdfs/aarik-1997-effec-tio2.pdf")))
  (goto-char (point-min))
  )
#+END_SRC

#+RESULTS:
: 1

Let's try to find an abstract
#+BEGIN_SRC emacs-lisp
(defun org-ref-pdf-abstract (pdf)
  (with-temp-buffer
    (insert (shell-command-to-string (format "pdftotext %s -" pdf)))
    (goto-char (point-min))
    (when (re-search-forward "abstract" nil t)
      (setq start (point))
      (forward-paragraph)
      (buffer-substring start (point)))))

(org-ref-pdf-abstract "~/Dropbox/bibliography/bibtex-pdfs/abolhasani-2011-model.pdf")
#+END_SRC

#+RESULTS:
#+begin_example

We report a microfluidic platform for the systematic investigation of gas solubility and gas-liquid mass transfer in a segmented flow format. Our approach is enabled by an image-based feedback control strategy that allows for screening of a wide
range of flow conditions while keeping the initial bubble size and slug length, that would otherwise dynamically adjust, constant and thereby allowing for a systematic reduction of mass transfer limitations by increasing the bubble velocity. The proposed approach is applied to explore the dissolution and mass transfer for carbon dioxide bubbles flowing in ethanol and the
fluorocarbon FC40.
KEYWORDS: Microfluidic, Mass Transfer, Carbon Dioxide, Feedback
INTRODUCTION
The mass transfer of carbon dioxide across gas-liquid interfaces plays a key role in applications with associated length
scales between hundreds of kilometers (e.g., gas exchange at the surface of the oceans) and the diffusive length scale. In a
technical context, chemical reaction engineering approaches have been developed over the past decades with the goal to reduce mass transfer limitations of (macroscale) chemical processing equipments, thereby increasing the yield and selectivity
of the associated processes. With the advent of microreaction technology, miniature formats of conducting chemical reactions
became available. Segmented flows have become a popular format to significantly reduce gas-liquid mass transfer limitations
at the microscale , due to the associated reduction in axial dispersion and the improved heat and mass transfer rates [1].
Deterministic and stochastic characteristics of bubble formation and flow in a microfluidic system have previously been
investigated. The associated features of microscale gas-liquid flows allow on one hand chemical reactions to be carried out
under well-defined conditions or, on the other hand, constitute a model non-linear system [2]. In the laboratory setting, microscale multiphase flows dynamically assume for a set of externally selected parameters (e.g., the imposed liquid flow rate,
QL and the gas inlet pressure, P) a set of dependent parameters (e.g., the liquid slug length, LS, and the bubble velocity, UB). It
is however these dependent parameters that play a key role in the context of gas-liquid mass transfer and related chemical
reactions.
THEORY
As shown in Fig.1, the shrinkage or expansion of a bubble inside a microchannel is due to the net effect of the dissolution
of gas molecules in the liquid and an expansion due to an decreasing pressure along the flow direction. From the pressure
evolution along the channel [3] and the ideal gas law, the bubble volume expansion can be separated from the bubble shrinkage due to the gas dissolution. The main parameters affecting the volumetric gas liquid mass transfer are LS, UB and the diffusivity of the gas in the liquid, D [4]. Depending on the solubility of the considered gas in the liquid, i.e. whether the liquid
has a high or low gas solubility, the location varies along the microchannel for a fixed set of flow conditions.
#+end_example

Some PDFs have no labeled abstract. Let's try getting the first paragraph with at least N sentences.

#+BEGIN_SRC emacs-lisp
(defun count-sentences-in-paragraph ()
  (interactive)
  (save-restriction
    (let (start
	  end
	  (count 0))
      (setq start (point))
      (forward-paragraph)
      (setq end (point))
      (narrow-to-region start (point))
      (goto-char (point-min))
      (while (< (point) end)
	(forward-sentence)
	(setq count (+ 1 count)))
      (setq count (- count 1))
      count)))

(defun org-ref-pdf-get-paragraph (pdf &optional N)
  (unless N (setq N 5))
  (with-temp-buffer
    (insert (shell-command-to-string (format "pdftotext %s -" pdf)))
    (goto-char (point-min))
    (while (<= (count-sentences-in-paragraph) N)
      (forward-paragraph))
    (let ((start (point)))
      (backward-paragraph)
      (buffer-substring start (point)))))

(org-ref-pdf-get-paragraph
 "~/Dropbox/bibliography/bibtex-pdfs/PhysRev.140.A1133.pdf "
 5)
#+END_SRC

#+RESULTS:
:
: From a theory of Hohenberg and Kohn, approximation methods for treating an inhomogeneous system
: of interacting electrons are developed. These methods are exact for systems of slowly varying or high density.
: For the ground state, they lead to self-consistent equations analogous to the Hartree and Hartree-Fock
: equations, respectively. In these equations the exchange and correlation portions of the chemical potential
: of a uniform electron gas appear as additional effective potentials. (The exchange portion of our effective
: potential differs from that due to Slater by a factor of -';.) Electronic systems at finite temperatures and in
: magnetic lelds are also treated by similar methods. An appendix deals with a further correction for
: systems with short-wavelength density oscillations.

* Colorize comments
  :PROPERTIES:
  :ID:       8206E03F-01D0-4467-8C3C-C6292D7455E5
  :ARCHIVE_TIME: 2016-03-17 Thu 09:26
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp
(defvar org-comment-color "red")

(defvar org-comment-re
  "\\(\\[\\[\\)?comment:\\([^]]\\)+\\]?\\[?\\([^]]\\)*\\(\\]\\]\\)")

(defface org-comment-face2
  `((t (:inherit org-link :slant italic :foreground ,org-comment-color)))
  "Face for ref links in org-ref.")


(defun org-comment-colorize-links ()
  "Colorize org-ref links."
  (hi-lock-mode 1)
  (highlight-regexp org-comment-re 'org-comment-face2))
#+END_SRC

[[comment:test]]

[[comment:second test][Test]]


[[comment:check baby]]

* Generating tables with attributes using code
  :PROPERTIES:
  :ID:       6C49131A-749F-4A2F-A022-2B06F84D6BE4
  :ARCHIVE_TIME: 2016-03-17 Thu 13:42
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

** attempt with :wrap
   :PROPERTIES:
   :ID:       82D78D23-A8DE-487E-B84F-677BF1053F4B
   :END:
this doesn't make a table that is usable.

** :post
   :PROPERTIES:
   :ID:       A5616305-58DD-4432-B0EA-12FE99FFC740
   :END:
pretty close...

#+name: el_attr
#+BEGIN_SRC emacs-lisp
(org-babel-format-result
 (concat
  "#+tblname: test\n"
  "#+ATTR_LATEX: :environment longtable\n"
  (orgtbl-to-generic  (list data) (list :lstart "|" :lend "|"  :sep "|" :fmt "%s"))))
#+END_SRC

#+RESULTS: el_attr
: #+tblname: test
: #+ATTR_LATEX: :environment longtable
: |1|2|3|


#+BEGIN_SRC emacs-lisp
(defun table (data &optional attrs)
  (concat
   (mapconcat
    'identity
    attrs
    "\n")
   "\n"
   (orgtbl-to-generic
    (list data)
    (list :lstart "|" :lend "|"  :sep "|" :fmt "%s"))))

(table (list (+ 2 4) 4 5) '("#+tblname: test" "#+attr_latex: :environment longtable"))
#+END_SRC


** Attempt 2 with :wrap
   :PROPERTIES:
   :ID:       4B51FFB6-5BE9-4CBD-B74E-A01754A95015
   :END:
this works if you run the block on the backend.

(setq org-export-babel-evaluate nil)

#+BEGIN_SRC emacs-lisp
(defun ex-aware-wrap ()
  (if org-export-current-backend
      (concat "src org :exports results "
	      ":results  replace drawer"
"\n#+caption: test"
	      "\n#+ATTR_LATEX: "
	      ":environment longtable")))
#+END_SRC

#+RESULTS:
: ex-aware-wrap

#+BEGIN_SRC emacs-lisp  :exports results :wrap (ex-aware-wrap)
`((,(+ 1 2) 3 4) (3 4 5))
#+END_SRC

#+RESULTS:
#+BEGIN_RESULTS
| 3 | 3 | 4 |
| 3 | 4 | 5 |
#+END_RESULTS

no solution yet.

* gdrive command-line
  :PROPERTIES:
  :ID:       D4E9EF99-ACF0-442C-949F-6FA504899548
  :ARCHIVE_TIME: 2016-03-17 Thu 13:42
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
Adapted from http://stackoverflow.com/questions/18390467/edit-google-docs-using-emacs

brew install gdrive

the executable seems to be called drive

I am leaving this here for now. I am not sure why I need to do this, it seems like I can edit files in Google drive already.


: Id                             Title   Size    Created


#+BEGIN_SRC emacs-lisp
(cl-mapcar (lambda (a b) `(,a ,b))
      '(:id :title :size :unit :created)
       (split-string
	(s-trim
	 (shell-command-to-string
	  "drive list -n -q \"title = 'org'\""))
	" " t))
#+END_SRC

#+RESULTS:
| :id      | 0B67FYRNpJuqVSVRvTVJSckluUDA |
| :title   | org                          |
| :size    | 0.0                          |
| :unit    | B                            |
| :created | 2015-11-22                   |


#+BEGIN_SRC emacs-lisp
(defvar gdocs-folder-id "0B67FYRNpJuqVSVRvTVJSckluUDA"
 "location for storing org to gdocs exported files, use 'drive list  -t <foldername>' to find the id")

(defun gdoc-export-buffer ()
  "Export current buffer as google doc to folder identified by `gdocs-folder-id'"
  (interactive)
  (shell-command
  (format "drive upload --convert --mimetype text/plain --parent %s --file %s"
      gdocs-folder-id buffer-file-name)))

(defun gdoc-import-buffer (doc)
   "Import a file in `gdocs-folder-id' into current buffer"
   (interactive
   (list
    (completing-read
     "Choose one: "
     (split-string
      (shell-command-to-string
       (format "drive list -q \"'%s' in parents\"" gdocs-folder-id))
      "\n"))))
   (insert (replace-regexp-in-string
	    (string ?\C-m)
	    (string ?\C-j)
	    (shell-command-to-string
	     (format "drive download -s --id %s" (car (split-string doc " ")))))))
#+END_SRC

#+RESULTS:
: gdoc-import-buffer

* archive
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-03-17 Thu 16:31
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_OLPATH: Fontifying LaTeX fragments in org-mode
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp
(add-hook 'org-mode-hook
	  (lambda ()
	    (font-lock-add-keywords
	     nil
	     `((,(mapconcat (lambda (x)
			      (nth 1 x))
			    org-latex-regexps
			    "\\|") 0 '(:foreground "blue"))
	       ("@@latex:[^@]*@@" 0 '(:foreground "blue"))))))
#+END_SRC

1. $\exp{x}$
2. $$\exp{x}$$
3. \(\exp{x}\)
4. \[\exp{x}\]
5. @@latex:\ce{H2}@@

\citep[p. 1445]{Fong:2006}
  [[citep:Fong:2006][p. 1445]]



#+BEGIN_SRC emacs-lisp
(defvar org-latex-fragment-last nil
  "Holds last fragment/environment you were on.")

(setq org-latex-fragment-last nil)

(defun overlay-at-point ()
  "Return LaTeX fragment overlay at point."
  (loop for ov in org-latex-fragment-image-overlays
	if
	(and (overlay-start ov) (point) (overlay-end ov) (point)
	     (<= (overlay-start ov) (point))
	     (>= (overlay-end ov) (point)))
	return ov))


(defun org-latex-fragment-toggle ()
  "Toggle a latex fragment image at point."
  (interactive)
  (when org-latex-fragment-last
    (save-excursion
      (goto-char (org-element-property :begin org-latex-fragment-last))
      (forward-char (if (looking-at "\\$") 1 2))
      (org-toggle-latex-overlays nil)))

  (setq org-latex-fragment-last (org-element-context))

  (let ((ov (overlay-at-point)))
    (if ov
	;; we have an overlay, remove it
	(progn
	  (setq org-latex-fragment-last (org-element-context))
	  (delete-overlay ov)
	  (-remove-item ov org-latex-fragment-image-overlays))
      ;; no overlay. just add one
      (org-preview-latex-fragment))))


(defun match-next-latex-fragment (&optional limit)
  (when (re-search-forward (mapconcat (lambda (x)
					(nth 1 x))
				      org-latex-regexps
				      "\\|")
			   limit t)
    (add-text-properties
     (match-beginning 0)
     (match-end 0)
     `(mouse-face
       highlight
       local-map ,(let ((map (copy-keymap org-mode-map)))
		    (define-key map [mouse-1]
		      'org-latex-fragment-toggle)
				  map)
       help-echo "Click to toggle LaTeX overlay."))))

(defun match-next-inline-latex (&optional limit)
  (when (re-search-forward "@@latex:[^@]*@@"
			   limit t)
    (add-text-properties
     (match-beginning 0)
     (match-end 0)
     '(help-echo "Inline LaTeX is not previewable."))))

(add-hook 'org-mode-hook
	  (lambda ()
	    (font-lock-add-keywords
	     nil
	     '((match-next-latex-fragment . font-lock-keyword-face)))
	    (font-lock-add-keywords
	     nil
	     '((match-next-inline-latex . font-lock-keyword-face)))))
#+END_SRC

   w$e^x=4$  is an equation. Here is another one: \(\ln x = \alpha\).

   Here is an inline fragment @@latex:\ce{H2O}@@

\[test\]

I don't know why we cannot toggle a single equation with this without turning off all the other images. It isn't a big deal I guess, but a little annoying. It might be cool to have an image of the equation show in the tooltip instead of toggling it.

While we are here, let us make it a bit easier to add equations.

#+BEGIN_SRC emacs-lisp
(defun latex-math-region-or-point (&optional arg)
  "Put selected region in $$, or with ARG in \( \)."
  (interactive "P")
  (let ((chars (if arg
		   '("\\(" . "\\)")
		 '("$" . "$"))))

    (if (region-active-p)
	(progn
	  (let ((beg (region-beginning))
		(end (region-end)))
	    (goto-char end)
	    (insert (cdr chars))
	    (goto-char beg)
	    (insert (car chars))
	    (goto-char end)
	    (forward-char (+ 1 (length (cdr chars))))))
      (insert (concat  (car chars) (cdr chars)))
      (backward-char (length (cdr chars))))))


(define-key global-map (kbd "s-4") 'latex-math-region-or-point)
#+END_SRC

#+RESULTS:
: latex-math-region-or-point

Anyway, this will make it into jmax before too long.

* My emacsclient setup			    :sent:
  :PROPERTIES:
  :SENT-ON:  Mon Feb 15 15:47:39 2016
  :TO:       jboes@andrew.cmu.edu
  :Message-ID: [[mu4e:msgid:m21t8dn1jq.fsf@Johns-MacBook-Air.local][My emacsclient setup (Mon Feb 15 15:47:39 2016)]]
  :ARCHIVE_TIME: 2016-03-17 Thu 20:16
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC sh :tangle ~/bin/ec :shebang "#!/bin/bash"
#!/bin/bash

# This script starts emacs daemon if it is not running, opens whatever file
# you pass in and changes the focus to emacs.  Without any arguments, it just
# opens the current buffer or *scratch* if nothing else is open.  The following
# example will open ~/.bashrc

# ec ~/.bashrc

# You can also pass it multiple files, it will open them all.  Unbury-buffer
# will cycle through those files in order

# If you want to execute elisp, pass in -e whatever.
# You may also want to stop the output from returning to the terminal, like
# ec -e "(message \"Hello\")" > /dev/null

# emacsclient options for reference
# -a "" starts emacs daemon and reattaches
# -c creates a new frame
# -n returns control back to the terminal
# -e eval the script

# Number of current visible frames,
# Emacs daemon always has a visible frame called F1
visible_frames() {
  emacsclient -a "" -e '(length (visible-frame-list))'
}

change_focus() {
  emacsclient -n -e "(select-frame-set-input-focus (selected-frame))" > /dev/null
}

# try switching to the frame incase it is just minimized
# will start a server if not running
test "$(visible_frames)" -eq "1" && change_focus

if [ "$(visible_frames)" -lt  "2" ]; then # need to create a frame
  # -c $@ with no args just opens the scratch buffer
  emacsclient -n -c "$@" && change_focus
else # there is already a visible frame besides the daemon, so
  change_focus
  # -n $@ errors if there are no args
  test  "$#" -ne "0" && emacsclient -n "$@"
fi
#+END_SRC

#+BEGIN_SRC sh :tangle ~/bin/es :tangle-mode (identity #o755)
#!/bin/bash

# simple script to shutdown the running Emacs daemon

# emacsclient options for reference
# -a Alternate editor, runs bin/false in this case
# -e eval the script

# If the server-process is bound and the server is in a good state, then kill
# the server

server_ok() {
  emacsclient -a "false" -e "(boundp 'server-process)"
}

if [ "t" == "$(server_ok)" ]; then
  echo "Shutting down Emacs server"
  # wasn't removing emacs from ALT-TAB on mac
  # emacsclient -e "(server-force-delete)"
  emacsclient -e '(kill-emacs)'
else
  echo "Emacs server not running"
fi
#+END_SRC

* bokeh
  :PROPERTIES:
  :ID:       65FA61C0-5DBF-4716-B59D-B47BEE5DBE71
  :ARCHIVE_TIME: 2016-03-17 Thu 20:16
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
** embedded example			:noexport:
#+BEGIN_SRC python :results raw
from bokeh.plotting import figure
from bokeh.resources import CDN
from bokeh.embed import components

plot = figure()
plot.circle([1,2], [3,4])

script, div = components(plot)

script = '\n'.join(['#+HTML_HEAD_EXTRA: ' + line for line in script.split('\n')])

print '''{script}

#+BEGIN_HTML
{div}
#+END_HTML
'''.format(script=script, div=div)
#+END_SRC

#+RESULTS:
#+HTML_HEAD_EXTRA:
#+HTML_HEAD_EXTRA: <script type="text/javascript">
#+HTML_HEAD_EXTRA:     Bokeh.$(function() {
#+HTML_HEAD_EXTRA:     var docs_json = {"9815b209-96e8-491e-b231-e960671b7a45":{"roots":{"references":[{"attributes":{"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"}},"id":"c7df6803-e0cb-4fb8-9bfa-29c9395110ac","type":"WheelZoomTool"},{"attributes":{"overlay":{"id":"8cbaa345-b78c-4670-91ba-3a4650db75f6","type":"BoxAnnotation"},"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"}},"id":"5a3c3588-4c95-4457-af96-8bbb58c34823","type":"BoxZoomTool"},{"attributes":{"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"},"ticker":{"id":"4e176802-acea-43a6-9cbb-1aa92a4d5c0d","type":"BasicTicker"}},"id":"ae6e9b6e-3923-4fa4-936e-7389549cfe89","type":"Grid"},{"attributes":{"callback":null},"id":"e8162314-511a-4bff-825d-80a0d05a9ecf","type":"DataRange1d"},{"attributes":{"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"}},"id":"e721303e-1c7c-41be-afd7-86a267af6f2e","type":"ResetTool"},{"attributes":{},"id":"4e176802-acea-43a6-9cbb-1aa92a4d5c0d","type":"BasicTicker"},{"attributes":{"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"}},"id":"f7f29347-a314-45d7-8c99-b9b67d118a62","type":"ResizeTool"},{"attributes":{"callback":null,"column_names":["y","x"],"data":{"x":[1,2],"y":[3,4]}},"id":"54dbd215-95a4-4161-976e-f9119adfc76c","type":"ColumnDataSource"},{"attributes":{"fill_color":{"value":"#1f77b4"},"line_color":{"value":"#1f77b4"},"x":{"field":"x"},"y":{"field":"y"}},"id":"c4e8ee0d-79ee-4f4c-ab5f-3a81362b988f","type":"Circle"},{"attributes":{"dimension":1,"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"},"ticker":{"id":"9f880a6e-b77d-43a8-adb2-bfccd7810a9b","type":"BasicTicker"}},"id":"4f07c746-209a-4c70-bca3-049a24abb5f4","type":"Grid"},{"attributes":{"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"}},"id":"cac7f0f5-0223-45c8-8e50-e45bc00e0f8c","type":"PreviewSaveTool"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"plot":null,"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"8cbaa345-b78c-4670-91ba-3a4650db75f6","type":"BoxAnnotation"},{"attributes":{},"id":"9b73ebc2-739b-4b88-a899-639d2414c352","type":"BasicTickFormatter"},{"attributes":{"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"}},"id":"21d6d4dd-2177-438e-972f-d7ee7e2adf5d","type":"PanTool"},{"attributes":{"formatter":{"id":"0191a1af-222f-4572-8541-1d95f2be89e8","type":"BasicTickFormatter"},"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"},"ticker":{"id":"4e176802-acea-43a6-9cbb-1aa92a4d5c0d","type":"BasicTicker"}},"id":"c6d0e728-1d8b-49d3-bcde-815e5ee37f01","type":"LinearAxis"},{"attributes":{},"id":"0191a1af-222f-4572-8541-1d95f2be89e8","type":"BasicTickFormatter"},{"attributes":{"callback":null},"id":"13c5f80c-9491-46c4-8428-773cdcfa192c","type":"DataRange1d"},{"attributes":{},"id":"7ba1b1a9-3ba4-49aa-99a8-af8e43854fe8","type":"ToolEvents"},{"attributes":{"formatter":{"id":"9b73ebc2-739b-4b88-a899-639d2414c352","type":"BasicTickFormatter"},"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"},"ticker":{"id":"9f880a6e-b77d-43a8-adb2-bfccd7810a9b","type":"BasicTicker"}},"id":"c330a500-cf3d-46ad-8bba-d4eedf37f667","type":"LinearAxis"},{"attributes":{},"id":"9f880a6e-b77d-43a8-adb2-bfccd7810a9b","type":"BasicTicker"},{"attributes":{"plot":{"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"}},"id":"0dbefce0-5027-479b-a98d-326330e61458","type":"HelpTool"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"x":{"field":"x"},"y":{"field":"y"}},"id":"fcd4feb1-c930-4219-af07-958f05cf180b","type":"Circle"},{"attributes":{"below":[{"id":"c6d0e728-1d8b-49d3-bcde-815e5ee37f01","type":"LinearAxis"}],"left":[{"id":"c330a500-cf3d-46ad-8bba-d4eedf37f667","type":"LinearAxis"}],"renderers":[{"id":"c6d0e728-1d8b-49d3-bcde-815e5ee37f01","type":"LinearAxis"},{"id":"ae6e9b6e-3923-4fa4-936e-7389549cfe89","type":"Grid"},{"id":"c330a500-cf3d-46ad-8bba-d4eedf37f667","type":"LinearAxis"},{"id":"4f07c746-209a-4c70-bca3-049a24abb5f4","type":"Grid"},{"id":"8cbaa345-b78c-4670-91ba-3a4650db75f6","type":"BoxAnnotation"},{"id":"695af52b-dcd9-4382-b434-ebdb9cd916bb","type":"GlyphRenderer"}],"tool_events":{"id":"7ba1b1a9-3ba4-49aa-99a8-af8e43854fe8","type":"ToolEvents"},"tools":[{"id":"21d6d4dd-2177-438e-972f-d7ee7e2adf5d","type":"PanTool"},{"id":"c7df6803-e0cb-4fb8-9bfa-29c9395110ac","type":"WheelZoomTool"},{"id":"5a3c3588-4c95-4457-af96-8bbb58c34823","type":"BoxZoomTool"},{"id":"cac7f0f5-0223-45c8-8e50-e45bc00e0f8c","type":"PreviewSaveTool"},{"id":"f7f29347-a314-45d7-8c99-b9b67d118a62","type":"ResizeTool"},{"id":"e721303e-1c7c-41be-afd7-86a267af6f2e","type":"ResetTool"},{"id":"0dbefce0-5027-479b-a98d-326330e61458","type":"HelpTool"}],"x_range":{"id":"e8162314-511a-4bff-825d-80a0d05a9ecf","type":"DataRange1d"},"y_range":{"id":"13c5f80c-9491-46c4-8428-773cdcfa192c","type":"DataRange1d"}},"id":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d","subtype":"Figure","type":"Plot"},{"attributes":{"data_source":{"id":"54dbd215-95a4-4161-976e-f9119adfc76c","type":"ColumnDataSource"},"glyph":{"id":"c4e8ee0d-79ee-4f4c-ab5f-3a81362b988f","type":"Circle"},"hover_glyph":null,"nonselection_glyph":{"id":"fcd4feb1-c930-4219-af07-958f05cf180b","type":"Circle"},"selection_glyph":null},"id":"695af52b-dcd9-4382-b434-ebdb9cd916bb","type":"GlyphRenderer"}],"root_ids":["9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d"]},"title":"Bokeh Application","version":"0.11.1"}};
#+HTML_HEAD_EXTRA:     var render_items = [{"docid":"9815b209-96e8-491e-b231-e960671b7a45","elementid":"6da8735c-adf2-450e-96fb-d31b5ef74662","modelid":"9856c5ac-5a5a-4a91-92b9-0f94dab0ad4d"}];
#+HTML_HEAD_EXTRA:
#+HTML_HEAD_EXTRA:     Bokeh.embed.embed_items(docs_json, render_items);
#+HTML_HEAD_EXTRA: });
#+HTML_HEAD_EXTRA: </script>

#+BEGIN_HTML

<div class="plotdiv" id="6da8735c-adf2-450e-96fb-d31b5ef74662"></div>
#+END_HTML



** some examples			:noexport:
#+BEGIN_SRC python
import bokeh
bokeh.sampledata.download()

#+END_SRC

#+RESULTS:
#+begin_example
Creating ~/.bokeh directory
Creating /Users/jkitchin/.bokeh/data directory
Using data directory: /Users/jkitchin/.bokeh/data
Downloading: CGM.csv (1589982 bytes)
     16384 [  1.03%]     32768 [  2.06%]     49152 [  3.09%]     65536 [  4.12%]     81920 [  5.15%]     98304 [  6.18%]    114688 [  7.21%]    131072 [  8.24%]    147456 [  9.27%]    163840 [ 10.30%]    180224 [ 11.33%]    196608 [ 12.37%]    212992 [ 13.40%]    229376 [ 14.43%]    245760 [ 15.46%]    262144 [ 16.49%]    278528 [ 17.52%]    294912 [ 18.55%]    311296 [ 19.58%]    327680 [ 20.61%]    344064 [ 21.64%]    360448 [ 22.67%]    376832 [ 23.70%]    393216 [ 24.73%]    409600 [ 25.76%]    425984 [ 26.79%]    442368 [ 27.82%]    458752 [ 28.85%]    475136 [ 29.88%]    491520 [ 30.91%]    507904 [ 31.94%]    524288 [ 32.97%]    540672 [ 34.00%]    557056 [ 35.04%]    573440 [ 36.07%]    589824 [ 37.10%]    606208 [ 38.13%]    622592 [ 39.16%]    638976 [ 40.19%]    655360 [ 41.22%]    671744 [ 42.25%]    688128 [ 43.28%]    704512 [ 44.31%]    720896 [ 45.34%]    737280 [ 46.37%]    753664 [ 47.40%]    770048 [ 48.43%]    786432 [ 49.46%]    802816 [ 50.49%]    819200 [ 51.52%]    835584 [ 52.55%]    851968 [ 53.58%]    868352 [ 54.61%]    884736 [ 55.64%]    901120 [ 56.67%]    917504 [ 57.71%]    933888 [ 58.74%]    950272 [ 59.77%]    966656 [ 60.80%]    983040 [ 61.83%]    999424 [ 62.86%]   1015808 [ 63.89%]   1032192 [ 64.92%]   1048576 [ 65.95%]   1064960 [ 66.98%]   1081344 [ 68.01%]   1097728 [ 69.04%]   1114112 [ 70.07%]   1130496 [ 71.10%]   1146880 [ 72.13%]   1163264 [ 73.16%]   1179648 [ 74.19%]   1196032 [ 75.22%]   1212416 [ 76.25%]   1228800 [ 77.28%]   1245184 [ 78.31%]   1261568 [ 79.34%]   1277952 [ 80.38%]   1294336 [ 81.41%]   1310720 [ 82.44%]   1327104 [ 83.47%]   1343488 [ 84.50%]   1359872 [ 85.53%]   1376256 [ 86.56%]   1392640 [ 87.59%]   1409024 [ 88.62%]   1425408 [ 89.65%]   1441792 [ 90.68%]   1458176 [ 91.71%]   1474560 [ 92.74%]   1490944 [ 93.77%]   1507328 [ 94.80%]   1523712 [ 95.83%]   1540096 [ 96.86%]   1556480 [ 97.89%]   1572864 [ 98.92%]   1589248 [ 99.95%]   1589982 [100.00%]
Downloading: US_Counties.zip (3182088 bytes)
     16384 [  0.51%]     32768 [  1.03%]     49152 [  1.54%]     65536 [  2.06%]     81920 [  2.57%]     98304 [  3.09%]    114688 [  3.60%]    131072 [  4.12%]    147456 [  4.63%]    163840 [  5.15%]    180224 [  5.66%]    196608 [  6.18%]    212992 [  6.69%]    229376 [  7.21%]    245760 [  7.72%]    262144 [  8.24%]    278528 [  8.75%]    294912 [  9.27%]    311296 [  9.78%]    327680 [ 10.30%]    344064 [ 10.81%]    360448 [ 11.33%]    376832 [ 11.84%]    393216 [ 12.36%]    409600 [ 12.87%]    425984 [ 13.39%]    442368 [ 13.90%]    458752 [ 14.42%]    475136 [ 14.93%]    491520 [ 15.45%]    507904 [ 15.96%]    524288 [ 16.48%]    540672 [ 16.99%]    557056 [ 17.51%]    573440 [ 18.02%]    589824 [ 18.54%]    606208 [ 19.05%]    622592 [ 19.57%]    638976 [ 20.08%]    655360 [ 20.60%]    671744 [ 21.11%]    688128 [ 21.63%]    704512 [ 22.14%]    720896 [ 22.65%]    737280 [ 23.17%]    753664 [ 23.68%]    770048 [ 24.20%]    786432 [ 24.71%]    802816 [ 25.23%]    819200 [ 25.74%]    835584 [ 26.26%]    851968 [ 26.77%]    868352 [ 27.29%]    884736 [ 27.80%]    901120 [ 28.32%]    917504 [ 28.83%]    933888 [ 29.35%]    950272 [ 29.86%]    966656 [ 30.38%]    983040 [ 30.89%]    999424 [ 31.41%]   1015808 [ 31.92%]   1032192 [ 32.44%]   1048576 [ 32.95%]   1064960 [ 33.47%]   1081344 [ 33.98%]   1097728 [ 34.50%]   1114112 [ 35.01%]   1130496 [ 35.53%]   1146880 [ 36.04%]   1163264 [ 36.56%]   1179648 [ 37.07%]   1196032 [ 37.59%]   1212416 [ 38.10%]   1228800 [ 38.62%]   1245184 [ 39.13%]   1261568 [ 39.65%]   1277952 [ 40.16%]   1294336 [ 40.68%]   1310720 [ 41.19%]   1327104 [ 41.71%]   1343488 [ 42.22%]   1359872 [ 42.74%]   1376256 [ 43.25%]   1392640 [ 43.76%]   1409024 [ 44.28%]   1425408 [ 44.79%]   1441792 [ 45.31%]   1458176 [ 45.82%]   1474560 [ 46.34%]   1490944 [ 46.85%]   1507328 [ 47.37%]   1523712 [ 47.88%]   1540096 [ 48.40%]   1556480 [ 48.91%]   1572864 [ 49.43%]   1589248 [ 49.94%]   1605632 [ 50.46%]   1622016 [ 50.97%]   1638400 [ 51.49%]   1654784 [ 52.00%]   1671168 [ 52.52%]   1687552 [ 53.03%]   1703936 [ 53.55%]   1720320 [ 54.06%]   1736704 [ 54.58%]   1753088 [ 55.09%]   1769472 [ 55.61%]   1785856 [ 56.12%]   1802240 [ 56.64%]   1818624 [ 57.15%]   1835008 [ 57.67%]   1851392 [ 58.18%]   1867776 [ 58.70%]   1884160 [ 59.21%]   1900544 [ 59.73%]   1916928 [ 60.24%]   1933312 [ 60.76%]   1949696 [ 61.27%]   1966080 [ 61.79%]   1982464 [ 62.30%]   1998848 [ 62.82%]   2015232 [ 63.33%]   2031616 [ 63.85%]   2048000 [ 64.36%]   2064384 [ 64.88%]   2080768 [ 65.39%]   2097152 [ 65.90%]   2113536 [ 66.42%]   2129920 [ 66.93%]   2146304 [ 67.45%]   2162688 [ 67.96%]   2179072 [ 68.48%]   2195456 [ 68.99%]   2211840 [ 69.51%]   2228224 [ 70.02%]   2244608 [ 70.54%]   2260992 [ 71.05%]   2277376 [ 71.57%]   2293760 [ 72.08%]   2310144 [ 72.60%]   2326528 [ 73.11%]   2342912 [ 73.63%]   2359296 [ 74.14%]   2375680 [ 74.66%]   2392064 [ 75.17%]   2408448 [ 75.69%]   2424832 [ 76.20%]   2441216 [ 76.72%]   2457600 [ 77.23%]   2473984 [ 77.75%]   2490368 [ 78.26%]   2506752 [ 78.78%]   2523136 [ 79.29%]   2539520 [ 79.81%]   2555904 [ 80.32%]   2572288 [ 80.84%]   2588672 [ 81.35%]   2605056 [ 81.87%]   2621440 [ 82.38%]   2637824 [ 82.90%]   2654208 [ 83.41%]   2670592 [ 83.93%]   2686976 [ 84.44%]   2703360 [ 84.96%]   2719744 [ 85.47%]   2736128 [ 85.99%]   2752512 [ 86.50%]   2768896 [ 87.02%]   2785280 [ 87.53%]   2801664 [ 88.04%]   2818048 [ 88.56%]   2834432 [ 89.07%]   2850816 [ 89.59%]   2867200 [ 90.10%]   2883584 [ 90.62%]   2899968 [ 91.13%]   2916352 [ 91.65%]   2932736 [ 92.16%]   2949120 [ 92.68%]   2965504 [ 93.19%]   2981888 [ 93.71%]   2998272 [ 94.22%]   3014656 [ 94.74%]   3031040 [ 95.25%]   3047424 [ 95.77%]   3063808 [ 96.28%]   3080192 [ 96.80%]   3096576 [ 97.31%]   3112960 [ 97.83%]   3129344 [ 98.34%]   3145728 [ 98.86%]   3162112 [ 99.37%]   3178496 [ 99.89%]   3182088 [100.00%]
Unpacking: US_Counties.csv
Downloading: us_cities.json (713565 bytes)
     16384 [  2.30%]     32768 [  4.59%]     49152 [  6.89%]     65536 [  9.18%]     81920 [ 11.48%]     98304 [ 13.78%]    114688 [ 16.07%]    131072 [ 18.37%]    147456 [ 20.66%]    163840 [ 22.96%]    180224 [ 25.26%]    196608 [ 27.55%]    212992 [ 29.85%]    229376 [ 32.15%]    245760 [ 34.44%]    262144 [ 36.74%]    278528 [ 39.03%]    294912 [ 41.33%]    311296 [ 43.63%]    327680 [ 45.92%]    344064 [ 48.22%]    360448 [ 50.51%]    376832 [ 52.81%]    393216 [ 55.11%]    409600 [ 57.40%]    425984 [ 59.70%]    442368 [ 61.99%]    458752 [ 64.29%]    475136 [ 66.59%]    491520 [ 68.88%]    507904 [ 71.18%]    524288 [ 73.47%]    540672 [ 75.77%]    557056 [ 78.07%]    573440 [ 80.36%]    589824 [ 82.66%]    606208 [ 84.95%]    622592 [ 87.25%]    638976 [ 89.55%]    655360 [ 91.84%]    671744 [ 94.14%]    688128 [ 96.44%]    704512 [ 98.73%]    713565 [100.00%]
Downloading: unemployment09.csv (253301 bytes)
     16384 [  6.47%]     32768 [ 12.94%]     49152 [ 19.40%]     65536 [ 25.87%]     81920 [ 32.34%]     98304 [ 38.81%]    114688 [ 45.28%]    131072 [ 51.75%]    147456 [ 58.21%]    163840 [ 64.68%]    180224 [ 71.15%]    196608 [ 77.62%]    212992 [ 84.09%]    229376 [ 90.55%]    245760 [ 97.02%]    253301 [100.00%]
Downloading: AAPL.csv (166698 bytes)
     16384 [  9.83%]     32768 [ 19.66%]     49152 [ 29.49%]     65536 [ 39.31%]     81920 [ 49.14%]     98304 [ 58.97%]    114688 [ 68.80%]    131072 [ 78.63%]    147456 [ 88.46%]    163840 [ 98.29%]    166698 [100.00%]
Downloading: FB.csv (9706 bytes)
      9706 [100.00%]
Downloading: GOOG.csv (113894 bytes)
     16384 [ 14.39%]     32768 [ 28.77%]     49152 [ 43.16%]     65536 [ 57.54%]     81920 [ 71.93%]     98304 [ 86.31%]    113894 [100.00%]
Downloading: IBM.csv (165625 bytes)
     16384 [  9.89%]     32768 [ 19.78%]     49152 [ 29.68%]     65536 [ 39.57%]     81920 [ 49.46%]     98304 [ 59.35%]    114688 [ 69.25%]    131072 [ 79.14%]    147456 [ 89.03%]    163840 [ 98.92%]    165625 [100.00%]
Downloading: MSFT.csv (161614 bytes)
     16384 [ 10.14%]     32768 [ 20.28%]     49152 [ 30.41%]     65536 [ 40.55%]     81920 [ 50.69%]     98304 [ 60.83%]    114688 [ 70.96%]    131072 [ 81.10%]    147456 [ 91.24%]    161614 [100.00%]
Downloading: WPP2012_SA_DB03_POPULATION_QUINQUENNIAL.zip (5148539 bytes)
     16384 [  0.32%]     32768 [  0.64%]     49152 [  0.95%]     65536 [  1.27%]     81920 [  1.59%]     98304 [  1.91%]    114688 [  2.23%]    131072 [  2.55%]    147456 [  2.86%]    163840 [  3.18%]    180224 [  3.50%]    196608 [  3.82%]    212992 [  4.14%]    229376 [  4.46%]    245760 [  4.77%]    262144 [  5.09%]    278528 [  5.41%]    294912 [  5.73%]    311296 [  6.05%]    327680 [  6.36%]    344064 [  6.68%]    360448 [  7.00%]    376832 [  7.32%]    393216 [  7.64%]    409600 [  7.96%]    425984 [  8.27%]    442368 [  8.59%]    458752 [  8.91%]    475136 [  9.23%]    491520 [  9.55%]    507904 [  9.87%]    524288 [ 10.18%]    540672 [ 10.50%]    557056 [ 10.82%]    573440 [ 11.14%]    589824 [ 11.46%]    606208 [ 11.77%]    622592 [ 12.09%]    638976 [ 12.41%]    655360 [ 12.73%]    671744 [ 13.05%]    688128 [ 13.37%]    704512 [ 13.68%]    720896 [ 14.00%]    737280 [ 14.32%]    753664 [ 14.64%]    770048 [ 14.96%]    786432 [ 15.27%]    802816 [ 15.59%]    819200 [ 15.91%]    835584 [ 16.23%]    851968 [ 16.55%]    868352 [ 16.87%]    884736 [ 17.18%]    901120 [ 17.50%]    917504 [ 17.82%]    933888 [ 18.14%]    950272 [ 18.46%]    966656 [ 18.78%]    983040 [ 19.09%]    999424 [ 19.41%]   1015808 [ 19.73%]   1032192 [ 20.05%]   1048576 [ 20.37%]   1064960 [ 20.68%]   1081344 [ 21.00%]   1097728 [ 21.32%]   1114112 [ 21.64%]   1130496 [ 21.96%]   1146880 [ 22.28%]   1163264 [ 22.59%]   1179648 [ 22.91%]   1196032 [ 23.23%]   1212416 [ 23.55%]   1228800 [ 23.87%]   1245184 [ 24.19%]   1261568 [ 24.50%]   1277952 [ 24.82%]   1294336 [ 25.14%]   1310720 [ 25.46%]   1327104 [ 25.78%]   1343488 [ 26.09%]   1359872 [ 26.41%]   1376256 [ 26.73%]   1392640 [ 27.05%]   1409024 [ 27.37%]   1425408 [ 27.69%]   1441792 [ 28.00%]   1458176 [ 28.32%]   1474560 [ 28.64%]   1490944 [ 28.96%]   1507328 [ 29.28%]   1523712 [ 29.60%]   1540096 [ 29.91%]   1556480 [ 30.23%]   1572864 [ 30.55%]   1589248 [ 30.87%]   1605632 [ 31.19%]   1622016 [ 31.50%]   1638400 [ 31.82%]   1654784 [ 32.14%]   1671168 [ 32.46%]   1687552 [ 32.78%]   1703936 [ 33.10%]   1720320 [ 33.41%]   1736704 [ 33.73%]   1753088 [ 34.05%]   1769472 [ 34.37%]   1785856 [ 34.69%]   1802240 [ 35.00%]   1818624 [ 35.32%]   1835008 [ 35.64%]   1851392 [ 35.96%]   1867776 [ 36.28%]   1884160 [ 36.60%]   1900544 [ 36.91%]   1916928 [ 37.23%]   1933312 [ 37.55%]   1949696 [ 37.87%]   1966080 [ 38.19%]   1982464 [ 38.51%]   1998848 [ 38.82%]   2015232 [ 39.14%]   2031616 [ 39.46%]   2048000 [ 39.78%]   2064384 [ 40.10%]   2080768 [ 40.41%]   2097152 [ 40.73%]   2113536 [ 41.05%]   2129920 [ 41.37%]   2146304 [ 41.69%]   2162688 [ 42.01%]   2179072 [ 42.32%]   2195456 [ 42.64%]   2211840 [ 42.96%]   2228224 [ 43.28%]   2244608 [ 43.60%]   2260992 [ 43.92%]   2277376 [ 44.23%]   2293760 [ 44.55%]   2310144 [ 44.87%]   2326528 [ 45.19%]   2342912 [ 45.51%]   2359296 [ 45.82%]   2375680 [ 46.14%]   2392064 [ 46.46%]   2408448 [ 46.78%]   2424832 [ 47.10%]   2441216 [ 47.42%]   2457600 [ 47.73%]   2473984 [ 48.05%]   2490368 [ 48.37%]   2506752 [ 48.69%]   2523136 [ 49.01%]   2539520 [ 49.33%]   2555904 [ 49.64%]   2572288 [ 49.96%]   2588672 [ 50.28%]   2605056 [ 50.60%]   2621440 [ 50.92%]   2637824 [ 51.23%]   2654208 [ 51.55%]   2670592 [ 51.87%]   2686976 [ 52.19%]   2703360 [ 52.51%]   2719744 [ 52.83%]   2736128 [ 53.14%]   2752512 [ 53.46%]   2768896 [ 53.78%]   2785280 [ 54.10%]   2801664 [ 54.42%]   2818048 [ 54.73%]   2834432 [ 55.05%]   2850816 [ 55.37%]   2867200 [ 55.69%]   2883584 [ 56.01%]   2899968 [ 56.33%]   2916352 [ 56.64%]   2932736 [ 56.96%]   2949120 [ 57.28%]   2965504 [ 57.60%]   2981888 [ 57.92%]   2998272 [ 58.24%]   3014656 [ 58.55%]   3031040 [ 58.87%]   3047424 [ 59.19%]   3063808 [ 59.51%]   3080192 [ 59.83%]   3096576 [ 60.14%]   3112960 [ 60.46%]   3129344 [ 60.78%]   3145728 [ 61.10%]   3162112 [ 61.42%]   3178496 [ 61.74%]   3194880 [ 62.05%]   3211264 [ 62.37%]   3227648 [ 62.69%]   3244032 [ 63.01%]   3260416 [ 63.33%]   3276800 [ 63.65%]   3293184 [ 63.96%]   3309568 [ 64.28%]   3325952 [ 64.60%]   3342336 [ 64.92%]   3358720 [ 65.24%]   3375104 [ 65.55%]   3391488 [ 65.87%]   3407872 [ 66.19%]   3424256 [ 66.51%]   3440640 [ 66.83%]   3457024 [ 67.15%]   3473408 [ 67.46%]   3489792 [ 67.78%]   3506176 [ 68.10%]   3522560 [ 68.42%]   3538944 [ 68.74%]   3555328 [ 69.06%]   3571712 [ 69.37%]   3588096 [ 69.69%]   3604480 [ 70.01%]   3620864 [ 70.33%]   3637248 [ 70.65%]   3653632 [ 70.96%]   3670016 [ 71.28%]   3686400 [ 71.60%]   3702784 [ 71.92%]   3719168 [ 72.24%]   3735552 [ 72.56%]   3751936 [ 72.87%]   3768320 [ 73.19%]   3784704 [ 73.51%]   3801088 [ 73.83%]   3817472 [ 74.15%]   3833856 [ 74.46%]   3850240 [ 74.78%]   3866624 [ 75.10%]   3883008 [ 75.42%]   3899392 [ 75.74%]   3915776 [ 76.06%]   3932160 [ 76.37%]   3948544 [ 76.69%]   3964928 [ 77.01%]   3981312 [ 77.33%]   3997696 [ 77.65%]   4014080 [ 77.97%]   4030464 [ 78.28%]   4046848 [ 78.60%]   4063232 [ 78.92%]   4079616 [ 79.24%]   4096000 [ 79.56%]   4112384 [ 79.87%]   4128768 [ 80.19%]   4145152 [ 80.51%]   4161536 [ 80.83%]   4177920 [ 81.15%]   4194304 [ 81.47%]   4210688 [ 81.78%]   4227072 [ 82.10%]   4243456 [ 82.42%]   4259840 [ 82.74%]   4276224 [ 83.06%]   4292608 [ 83.38%]   4308992 [ 83.69%]   4325376 [ 84.01%]   4341760 [ 84.33%]   4358144 [ 84.65%]   4374528 [ 84.97%]   4390912 [ 85.28%]   4407296 [ 85.60%]   4423680 [ 85.92%]   4440064 [ 86.24%]   4456448 [ 86.56%]   4472832 [ 86.88%]   4489216 [ 87.19%]   4505600 [ 87.51%]   4521984 [ 87.83%]   4538368 [ 88.15%]   4554752 [ 88.47%]   4571136 [ 88.79%]   4587520 [ 89.10%]   4603904 [ 89.42%]   4620288 [ 89.74%]   4636672 [ 90.06%]   4653056 [ 90.38%]   4669440 [ 90.69%]   4685824 [ 91.01%]   4702208 [ 91.33%]   4718592 [ 91.65%]   4734976 [ 91.97%]   4751360 [ 92.29%]   4767744 [ 92.60%]   4784128 [ 92.92%]   4800512 [ 93.24%]   4816896 [ 93.56%]   4833280 [ 93.88%]   4849664 [ 94.19%]   4866048 [ 94.51%]   4882432 [ 94.83%]   4898816 [ 95.15%]   4915200 [ 95.47%]   4931584 [ 95.79%]   4947968 [ 96.10%]   4964352 [ 96.42%]   4980736 [ 96.74%]   4997120 [ 97.06%]   5013504 [ 97.38%]   5029888 [ 97.70%]   5046272 [ 98.01%]   5062656 [ 98.33%]   5079040 [ 98.65%]   5095424 [ 98.97%]   5111808 [ 99.29%]   5128192 [ 99.60%]   5144576 [ 99.92%]   5148539 [100.00%]
Unpacking: WPP2012_SA_DB03_POPULATION_QUINQUENNIAL.csv
Downloading: gapminder_fertility.csv (64346 bytes)
     16384 [ 25.46%]     32768 [ 50.92%]     49152 [ 76.39%]     64346 [100.00%]
Downloading: gapminder_population.csv (94509 bytes)
     16384 [ 17.34%]     32768 [ 34.67%]     49152 [ 52.01%]     65536 [ 69.34%]     81920 [ 86.68%]     94509 [100.00%]
Downloading: gapminder_life_expectancy.csv (73243 bytes)
     16384 [ 22.37%]     32768 [ 44.74%]     49152 [ 67.11%]     65536 [ 89.48%]     73243 [100.00%]
Downloading: gapminder_regions.csv (7781 bytes)
      7781 [100.00%]
Downloading: world_cities.zip (646858 bytes)
     16384 [  2.53%]     32768 [  5.07%]     49152 [  7.60%]     65536 [ 10.13%]     81920 [ 12.66%]     98304 [ 15.20%]    114688 [ 17.73%]    131072 [ 20.26%]    147456 [ 22.80%]    163840 [ 25.33%]    180224 [ 27.86%]    196608 [ 30.39%]    212992 [ 32.93%]    229376 [ 35.46%]    245760 [ 37.99%]    262144 [ 40.53%]    278528 [ 43.06%]    294912 [ 45.59%]    311296 [ 48.12%]    327680 [ 50.66%]    344064 [ 53.19%]    360448 [ 55.72%]    376832 [ 58.26%]    393216 [ 60.79%]    409600 [ 63.32%]    425984 [ 65.85%]    442368 [ 68.39%]    458752 [ 70.92%]    475136 [ 73.45%]    491520 [ 75.99%]    507904 [ 78.52%]    524288 [ 81.05%]    540672 [ 83.58%]    557056 [ 86.12%]    573440 [ 88.65%]    589824 [ 91.18%]    606208 [ 93.72%]    622592 [ 96.25%]    638976 [ 98.78%]    646858 [100.00%]
Unpacking: world_cities.csv
Downloading: airports.json (6373 bytes)
      6373 [100.00%]
Downloading: movies.db.zip (5067833 bytes)
     16384 [  0.32%]     32768 [  0.65%]     49152 [  0.97%]     65536 [  1.29%]     81920 [  1.62%]     98304 [  1.94%]    114688 [  2.26%]    131072 [  2.59%]    147456 [  2.91%]    163840 [  3.23%]    180224 [  3.56%]    196608 [  3.88%]    212992 [  4.20%]    229376 [  4.53%]    245760 [  4.85%]    262144 [  5.17%]    278528 [  5.50%]    294912 [  5.82%]    311296 [  6.14%]    327680 [  6.47%]    344064 [  6.79%]    360448 [  7.11%]    376832 [  7.44%]    393216 [  7.76%]    409600 [  8.08%]    425984 [  8.41%]    442368 [  8.73%]    458752 [  9.05%]    475136 [  9.38%]    491520 [  9.70%]    507904 [ 10.02%]    524288 [ 10.35%]    540672 [ 10.67%]    557056 [ 10.99%]    573440 [ 11.32%]    589824 [ 11.64%]    606208 [ 11.96%]    622592 [ 12.29%]    638976 [ 12.61%]    655360 [ 12.93%]    671744 [ 13.26%]    688128 [ 13.58%]    704512 [ 13.90%]    720896 [ 14.22%]    737280 [ 14.55%]    753664 [ 14.87%]    770048 [ 15.19%]    786432 [ 15.52%]    802816 [ 15.84%]    819200 [ 16.16%]    835584 [ 16.49%]    851968 [ 16.81%]    868352 [ 17.13%]    884736 [ 17.46%]    901120 [ 17.78%]    917504 [ 18.10%]    933888 [ 18.43%]    950272 [ 18.75%]    966656 [ 19.07%]    983040 [ 19.40%]    999424 [ 19.72%]   1015808 [ 20.04%]   1032192 [ 20.37%]   1048576 [ 20.69%]   1064960 [ 21.01%]   1081344 [ 21.34%]   1097728 [ 21.66%]   1114112 [ 21.98%]   1130496 [ 22.31%]   1146880 [ 22.63%]   1163264 [ 22.95%]   1179648 [ 23.28%]   1196032 [ 23.60%]   1212416 [ 23.92%]   1228800 [ 24.25%]   1245184 [ 24.57%]   1261568 [ 24.89%]   1277952 [ 25.22%]   1294336 [ 25.54%]   1310720 [ 25.86%]   1327104 [ 26.19%]   1343488 [ 26.51%]   1359872 [ 26.83%]   1376256 [ 27.16%]   1392640 [ 27.48%]   1409024 [ 27.80%]   1425408 [ 28.13%]   1441792 [ 28.45%]   1458176 [ 28.77%]   1474560 [ 29.10%]   1490944 [ 29.42%]   1507328 [ 29.74%]   1523712 [ 30.07%]   1540096 [ 30.39%]   1556480 [ 30.71%]   1572864 [ 31.04%]   1589248 [ 31.36%]   1605632 [ 31.68%]   1622016 [ 32.01%]   1638400 [ 32.33%]   1654784 [ 32.65%]   1671168 [ 32.98%]   1687552 [ 33.30%]   1703936 [ 33.62%]   1720320 [ 33.95%]   1736704 [ 34.27%]   1753088 [ 34.59%]   1769472 [ 34.92%]   1785856 [ 35.24%]   1802240 [ 35.56%]   1818624 [ 35.89%]   1835008 [ 36.21%]   1851392 [ 36.53%]   1867776 [ 36.86%]   1884160 [ 37.18%]   1900544 [ 37.50%]   1916928 [ 37.83%]   1933312 [ 38.15%]   1949696 [ 38.47%]   1966080 [ 38.80%]   1982464 [ 39.12%]   1998848 [ 39.44%]   2015232 [ 39.77%]   2031616 [ 40.09%]   2048000 [ 40.41%]   2064384 [ 40.74%]   2080768 [ 41.06%]   2097152 [ 41.38%]   2113536 [ 41.70%]   2129920 [ 42.03%]   2146304 [ 42.35%]   2162688 [ 42.67%]   2179072 [ 43.00%]   2195456 [ 43.32%]   2211840 [ 43.64%]   2228224 [ 43.97%]   2244608 [ 44.29%]   2260992 [ 44.61%]   2277376 [ 44.94%]   2293760 [ 45.26%]   2310144 [ 45.58%]   2326528 [ 45.91%]   2342912 [ 46.23%]   2359296 [ 46.55%]   2375680 [ 46.88%]   2392064 [ 47.20%]   2408448 [ 47.52%]   2424832 [ 47.85%]   2441216 [ 48.17%]   2457600 [ 48.49%]   2473984 [ 48.82%]   2490368 [ 49.14%]   2506752 [ 49.46%]   2523136 [ 49.79%]   2539520 [ 50.11%]   2555904 [ 50.43%]   2572288 [ 50.76%]   2588672 [ 51.08%]   2605056 [ 51.40%]   2621440 [ 51.73%]   2637824 [ 52.05%]   2654208 [ 52.37%]   2670592 [ 52.70%]   2686976 [ 53.02%]   2703360 [ 53.34%]   2719744 [ 53.67%]   2736128 [ 53.99%]   2752512 [ 54.31%]   2768896 [ 54.64%]   2785280 [ 54.96%]   2801664 [ 55.28%]   2818048 [ 55.61%]   2834432 [ 55.93%]   2850816 [ 56.25%]   2867200 [ 56.58%]   2883584 [ 56.90%]   2899968 [ 57.22%]   2916352 [ 57.55%]   2932736 [ 57.87%]   2949120 [ 58.19%]   2965504 [ 58.52%]   2981888 [ 58.84%]   2998272 [ 59.16%]   3014656 [ 59.49%]   3031040 [ 59.81%]   3047424 [ 60.13%]   3063808 [ 60.46%]   3080192 [ 60.78%]   3096576 [ 61.10%]   3112960 [ 61.43%]   3129344 [ 61.75%]   3145728 [ 62.07%]   3162112 [ 62.40%]   3178496 [ 62.72%]   3194880 [ 63.04%]   3211264 [ 63.37%]   3227648 [ 63.69%]   3244032 [ 64.01%]   3260416 [ 64.34%]   3276800 [ 64.66%]   3293184 [ 64.98%]   3309568 [ 65.31%]   3325952 [ 65.63%]   3342336 [ 65.95%]   3358720 [ 66.28%]   3375104 [ 66.60%]   3391488 [ 66.92%]   3407872 [ 67.25%]   3424256 [ 67.57%]   3440640 [ 67.89%]   3457024 [ 68.22%]   3473408 [ 68.54%]   3489792 [ 68.86%]   3506176 [ 69.18%]   3522560 [ 69.51%]   3538944 [ 69.83%]   3555328 [ 70.15%]   3571712 [ 70.48%]   3588096 [ 70.80%]   3604480 [ 71.12%]   3620864 [ 71.45%]   3637248 [ 71.77%]   3653632 [ 72.09%]   3670016 [ 72.42%]   3686400 [ 72.74%]   3702784 [ 73.06%]   3719168 [ 73.39%]   3735552 [ 73.71%]   3751936 [ 74.03%]   3768320 [ 74.36%]   3784704 [ 74.68%]   3801088 [ 75.00%]   3817472 [ 75.33%]   3833856 [ 75.65%]   3850240 [ 75.97%]   3866624 [ 76.30%]   3883008 [ 76.62%]   3899392 [ 76.94%]   3915776 [ 77.27%]   3932160 [ 77.59%]   3948544 [ 77.91%]   3964928 [ 78.24%]   3981312 [ 78.56%]   3997696 [ 78.88%]   4014080 [ 79.21%]   4030464 [ 79.53%]   4046848 [ 79.85%]   4063232 [ 80.18%]   4079616 [ 80.50%]   4096000 [ 80.82%]   4112384 [ 81.15%]   4128768 [ 81.47%]   4145152 [ 81.79%]   4161536 [ 82.12%]   4177920 [ 82.44%]   4194304 [ 82.76%]   4210688 [ 83.09%]   4227072 [ 83.41%]   4243456 [ 83.73%]   4259840 [ 84.06%]   4276224 [ 84.38%]   4292608 [ 84.70%]   4308992 [ 85.03%]   4325376 [ 85.35%]   4341760 [ 85.67%]   4358144 [ 86.00%]   4374528 [ 86.32%]   4390912 [ 86.64%]   4407296 [ 86.97%]   4423680 [ 87.29%]   4440064 [ 87.61%]   4456448 [ 87.94%]   4472832 [ 88.26%]   4489216 [ 88.58%]   4505600 [ 88.91%]   4521984 [ 89.23%]   4538368 [ 89.55%]   4554752 [ 89.88%]   4571136 [ 90.20%]   4587520 [ 90.52%]   4603904 [ 90.85%]   4620288 [ 91.17%]   4636672 [ 91.49%]   4653056 [ 91.82%]   4669440 [ 92.14%]   4685824 [ 92.46%]   4702208 [ 92.79%]   4718592 [ 93.11%]   4734976 [ 93.43%]   4751360 [ 93.76%]   4767744 [ 94.08%]   4784128 [ 94.40%]   4800512 [ 94.73%]   4816896 [ 95.05%]   4833280 [ 95.37%]   4849664 [ 95.70%]   4866048 [ 96.02%]   4882432 [ 96.34%]   4898816 [ 96.66%]   4915200 [ 96.99%]   4931584 [ 97.31%]   4947968 [ 97.63%]   4964352 [ 97.96%]   4980736 [ 98.28%]   4997120 [ 98.60%]   5013504 [ 98.93%]   5029888 [ 99.25%]   5046272 [ 99.57%]   5062656 [ 99.90%]   5067833 [100.00%]
Unpacking: movies.db
#+end_example


#+BEGIN_SRC python
from bokeh.io import output_notebook, show
output_notebook()

from bokeh.sampledata.world_cities import data
from bokeh.models import (
    GMapOptions, GMapPlot, ColumnDataSource, PanTool, WheelZoomTool, Circle, Range1d
)

p = GMapPlot(
    x_range=Range1d(-160, 160), y_range=Range1d(-80, 80),
    plot_width=1000,plot_height=500,
    map_options=GMapOptions(lat=48.77, lng=9.18, zoom=4),
    title="Cities with more than 5,000 people",
    webgl=True, responsive=True)

circle = Circle(x="lng", y="lat", size=5, line_color=None, fill_color='firebrick', fill_alpha=0.3)
p.add_glyph(ColumnDataSource(data), circle)
p.add_tools(PanTool(), WheelZoomTool())
show(p)
#+END_SRC

#+RESULTS:

#+BEGIN_SRC python
import bokeh

from bokeh.models import HoverTool
from bokeh.plotting import figure, show, output_file, ColumnDataSource
from bokeh.sampledata.us_counties import data as counties
from bokeh.sampledata.unemployment import data as unemployment


counties = {
    code: county for code, county in counties.items() if county["state"] == "tx"
}

county_xs = [county["lons"] for county in counties.values()]
county_ys = [county["lats"] for county in counties.values()]

colors = ["#F1EEF6", "#D4B9DA", "#C994C7", "#DF65B0", "#DD1C77", "#980043"]

county_names = [county['name'] for county in counties.values()]
county_rates = [unemployment[county_id] for county_id in counties]
county_colors = [colors[int(rate/3)] for rate in county_rates]

source = ColumnDataSource(data=dict(
    x=county_xs,
    y=county_ys,
    color=county_colors,
    name=county_names,
    rate=county_rates,
))

output_notebook()

p.patches('x', 'y', source=source,
          fill_color='color', fill_alpha=0.7,
          line_color="white", line_width=0.5)

hover = p.select_one(HoverTool)
hover.point_policy = "follow_mouse"
hover.tooltips = [
    ("Name", "@name"),
    ("Unemployment rate)", "@rate%"),
    ("(Long, Lat)", "($x, $y)"),
]
show(p)
#+END_SRC

#+RESULTS:

#+BEGIN_SRC python
import numpy as np

from bokeh.plotting import figure, show, output_file

N = 1000
x = np.linspace(0, 10, N)
y = np.linspace(0, 10, N)
xx, yy = np.meshgrid(x, y)
d = np.sin(xx)*np.cos(yy)

p = figure(x_range=(0, 10), y_range=(0, 10))

# must give a vector of image data for image parameter
p.image(image=[d], x=0, y=0, dw=10, dh=10, palette="Spectral11")

output_file("image.html", title="image.py example")

show(p)  # open a browser
#+END_SRC

#+RESULTS:

#+BEGIN_SRC python
from collections import OrderedDict
import numpy as np

from bokeh.plotting import *
from bokeh.models import HoverTool

x = np.linspace(0, 4*np.pi, 200)
y = np.sin(x)

output_file("line_dots.html", title="line.py example")

source = ColumnDataSource(
    data=dict(
        x=x,
        y=y,
        label=["%s X %s" % (x_, y_) for x_, y_ in zip(x, y)]
    )
)
TOOLS="crosshair,pan,wheel_zoom,box_zoom,reset,hover,previewsave"
p = figure(title="simple line example", tools=TOOLS)
p.line('x', 'y', color="#2222aa", line_width=2, source=source)
p.circle('x', 'y', color="#2222aa", line_width=2, source=source)

hover =p.select(dict(type=HoverTool))
hover.tooltips = OrderedDict([
    ("index", "$index"),
    ("(xx,yy)", "(@x, @y)"),
    ("label", "@label"),
])

show(p)
#+END_SRC


#+RESULTS:

* A new helm-bibtex selector
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-03-17 Thu 20:16
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC emacs-lisp
(mapcar 'car or-bibtex-cache-data)
#+END_SRC

#+RESULTS:
| hashes | candidates |

#+BEGIN_SRC emacs-lisp
(assoc 'hashes or-bibtex-cache-data)
#+END_SRC

#+RESULTS:
| hashes | (~/Dropbox/bibliography/references.bib . a66900b30e17fcf69fbdfabe8269ac1ae573ececfb1b099ba1fd6511508b9d53) | quote | nil |


#+BEGIN_SRC emacs-lisp :results output
(progn (find-file "~/Dropbox/bibliography/references.bib")
(goto-char (point-min))
(parsebib-find-next-item)
(print (parsebib-read-entry (parsebib-find-next-item))))
#+END_SRC

#+RESULTS:
:
: (("type" . "{Journal Article}") ("year" . "{2007}") ("volume" . "{http://science.energy.gov/~/media/bes/pdf/reports/files/cat_rpt.pdf}") ("journal" . "{DOE Report}") ("title" . "{Basic Research Needs: Catalysis for Energy}") ("=type=" . #("article" 0 7 (fontified t face font-lock-function-name-face))) ("=key=" . "2007-basic-resear-needs"))





#+BEGIN_SRC emacs-lisp :results code
(let ((entry (cdr (assoc (car (org-ref-find-bibliography))
			 (cdr (assoc 'candidates or-bibtex-cache-data))))))
entry
  )
#+END_SRC

#+RESULTS:
#+BEGIN_SRC emacs-lisp
(", The ACS Style Guide (2006)." "2006-acs-style-guide" "/Users/jkitchin/Dropbox/bibliography/references.bib" 1811
 (("url" . "{http://dx.doi.org/10.1021/bk-2006-STYG}")
  ("doi" . "{10.1021/bk-2006-styg}")
  ("pages" . "{nil}")
  ("year" . "{2006}")
  ("publisher" . "{American Chemical Society (ACS)}")
  ("series" . "{nil}")
  ("date_added" . "{Wed Apr  1 10:17:54 2015}")
  ("title" . "{The ACS Style Guide}")
  ("author" . "{}")
  ("=type=" .
   #("book" 0 4
     (fontified t face font-lock-function-name-face)))
  ("=key=" . "2006-acs-style-guide")))
#+END_SRC

** 1
#+BEGIN_SRC emacs-lisp :results raw
(progn (find-file "bib.bib")
(car (helm-bibtex-parse-bibliography)))
#+END_SRC

#+RESULTS:
((year . 1997) (pages . {259-264}) (number . 3) (volume . 181) (journal . "Journal of Crystal Growth") (title . {Effect of growth conditions on formation of
                  \ce{TiO_2}-{II} thin films in atomic layer
                  deposition process}) (author . {Aarik, J. and Aidla, A. and Sammelselg, V. and
                  Uustare, T.}) (=type= . article) (=key= . aarik-1997-effec-ii))

#+BEGIN_SRC emacs-lisp
(defvar my-bibtex-candidates
  '()
  "Variable to speed up things.")

(defvar my-bibtex-hash nil
  "hash of bibtex file.")

(setq my-bibtex-hash "")

(defun helm-bibtex-parse-bibliography ()
  "Parse the BibTeX entries listed in the current buffer and
return a list of entry keys in the order in which the entries
appeared in the BibTeX files."
  (goto-char (point-min))
  (cl-loop
   for entry-type = (parsebib-find-next-item)
   while entry-type
   unless (member-ignore-case entry-type '("preamble" "string" "comment"))
   collect (-map (lambda (it)
                   (cons (downcase (car it)) (cdr it)))
                 (parsebib-read-entry entry-type))))


(defun my-bibtex-candidates ()
  (with-current-buffer (find-file-noselect (car org-ref-default-bibliography))
    (let ((entries '())
	  (bibtex-entries '())
	  (formats '(("article" . "${author}, ${title}, ${journal} (${year}). keywords: ${keywords}")
		     ("book" . "${author}, ${title} (${year}).")
		     ("inproceedings" . "${author}, ${title} in ${booktitle} (${year}.")
		     ("misc" . "${author}, ${title}")))
	  (hash (secure-hash 'sha256 (current-buffer))))

      (if (string= hash my-bibtex-hash)
	  my-bibtex-candidates
	(goto-char (point-min))

	(setq my-bibtex-candidates (cl-loop
				    for entry-type = (parsebib-find-next-item)
				    while entry-type
				    unless (member-ignore-case entry-type '("preamble" "string" "comment"))
				    collect
				    (let* ((entry (parsebib-read-entry entry-type))
					   (key (cdr (assoc "=key=" entry))))
				      (cons (s-format
					     (or (cdr (assoc entry-type formats))
						 (format "%s" entry))
					     (lambda (field data)
					       (replace-regexp-in-string
						"^{\\|}$" ""
						(replace-regexp-in-string
						 "\n\\|\t\\|\s+" " "
						 (or (cdr (assoc field data)) ""))))
					     entry)
					    (list key (point-marker) entry))))
	      my-bibtex-hash hash)
	my-bibtex-candidates))))

(helm
 :sources
 `((name . "Bibtex")
   (multiline)
   (candidates . ,(my-bibtex-candidates))
   (action . (("Identity" . (lambda (candidate)
			      (helm-marked-candidates)))
	      ("Open entry" . (lambda (candidate)
				(let ((marker (nth 1 candidate)))
				  (switch-to-buffer (marker-buffer marker))
				  (goto-char (marker-position marker))
				  (bibtex-beginning-of-entry))))))))
#+END_SRC

#+RESULTS:
: 893130


** org-ref-helm-bibtex

#+BEGIN_SRC emacs-lisp
(or-bibtex-candidates)
#+END_SRC

* automatic inlining a plot in org-mode with python
  :PROPERTIES:
  :ID:       6ED7BC53-6979-41A0-8A98-BFA8C0FE5432
  :ARCHIVE_TIME: 2016-03-17 Thu 20:17
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

It has always bothered me that I have to manually put links to figures in after my code blocks, or I have to custom print org syntax. here is a way to get org to do it.
#+BEGIN_SRC python :file test.png
import matplotlib.pyplot as plt
plt.plot([1,2,3,4])
plt.savefig('silly-plot.png')

import os
os.system('cat silly-plot.png')
#+END_SRC

#+RESULTS:
[[file:test.png]]

It is not better if you have add the code at the end to output the image. It is also not possible to add captions with code.

Here is another approach, where we specify what gets returned, in this case a filename.
#+BEGIN_SRC python :results value :return s
import matplotlib.pyplot as plt
plt.plot([1,2,3,4])

s = './silly-plot.png'
plt.savefig(s)
#+END_SRC

#+RESULTS:
: ./silly-plot.png

* font-locking to make clickable links for pandoc citations
  :PROPERTIES:
  :ID:       3104DD13-0B3D-4F3D-9804-4D2CA49C4DF0
  :ARCHIVE_TIME: 2016-03-17 Thu 20:18
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

Org-mode has clickable links, and they are awesome. There is a new citation syntax being discussed, and these too will be clickable. Here we just explore a little approach to make clickable text using the button-lock package. We will use it to make pandoc citations clickable in Emacs. A pandoc citation looks like [@dominik-2010-org-mode].

This code makes pandoc citation links clickable, as you type them in.

#+BEGIN_SRC emacs-lisp :results silent
(require 'button-lock)
(global-button-lock-mode)

(button-lock-set-button
 "@\\([-a-zA-Z0-9_:]*\\)"
 (lambda ()
   (interactive)
   (re-search-backward "@")
   (re-search-forward  "@\\([-a-zA-Z0-9_:]*\\)")
   (let* ((key (match-string-no-properties 1))
	  (bibfile (cdr (org-ref-get-bibtex-key-and-file key))))
     (if bibfile
	(save-excursion
	  (with-temp-buffer
	    (insert-file-contents bibfile)
	    (bibtex-search-entry key)
	    (message (org-ref-bib-citation))))
       (message "No entry found"))))
 :face (list 'org-link))
#+END_SRC

* What is next for jmax?
  :PROPERTIES:
  :ID:       7D8BE6ED-4650-4A43-BCA4-03A6A44C6E54
  :ARCHIVE_TIME: 2016-03-17 Thu 20:20
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


- [ ] Version control/track changes

- [ ] Annotation

- [ ] orgx format

- [ ] Search integration

- [ ] Export to word

- [ ] Non-latex citations

- [ ] collaboration tools

* Exploring elpy
  :PROPERTIES:
  :ID:       4B41EF4D-44E5-4861-95BA-BAE5F3A616A8
  :ARCHIVE_TIME: 2016-03-17 Thu 20:21
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

`M-: (setq elpy-rpc-backend "jedi")` and `M-x (elpy-rpc-restart)` t

#+BEGIN_SRC python
from numpy import array

from pycse import nlinfit

nlinfit(
#+END_SRC

* NOTGOOD Decorating ase.calculators.vasp :archive:
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-05-02 Mon 11:31
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
rats, this is not likely to work.
#+BEGIN_SRC python
from jasp import *
import os

def cd(func):
    def inner(self, *args, **kwargs):
        print('starting in {}'.format(os.getcwd()))
        print('running {}'.format(func.__name__))
        os.chdir(self.vaspdir)
        print('entering in {}'.format(os.getcwd()))
        try:
            res = func(self, *args, **kwargs)
            return res
        finally:
            os.chdir(self.cwd)
            print('exited to {}'.format(os.getcwd()))
    return inner

for attr in Vasp.__dict__:
    if attr != '__init__' and callable(getattr(Vasp, attr)):
        #print attr
        setattr(Vasp, attr, cd(getattr(Vasp, attr)))


def JASP(wd, **kwargs):
    calc = Jasp(**kwargs)
    calc.vaspdir = wd
    calc.cwd = os.getcwd()
    return calc
try:
    v = JASP('/tmp/JASP')
except:
    pass

#print dir(v)
#print v.clean()

#+END_SRC

#+RESULTS:
: starting in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
: running set

* MAYBE Adding a metaclass to Vasp?
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-05-02 Mon 11:31
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC python
import os
import types

class WithCurrentDirectory(type):
   """Metaclass that decorates all of its methods except __init__."""
   def __new__(cls, name, bases, attrs):
      return super(WithCurrentDirectory, cls).__new__(cls, name, bases, attrs)

   def __init__(cls, name, bases, attrs):
      """Decorate all the methods of the class instance with the classmethod cd.

      We skip __init__ because that is where the attributes are actually set.
      It is an error to access them before they are set.
      """
      for attr_name, attr_value in attrs.iteritems():
         if attr_name != '__init__' and isinstance(attr_value, types.FunctionType):
            setattr(cls, attr_name, cls.cd(attr_value) )


   @classmethod
   def cd(cls, func):
      """Decorator to temporarily run cls.func in the directory stored in cls.wd.

      The working directory is restored to the original directory afterwards.
      """
      def wrapper(self, *args, **kwargs):
         if self.verbose:
            print('\nRunning {}'.format(func.__name__))
            print("Started in {}".format(os.getcwd()))
         os.chdir(self.wd)
         if self.verbose:
            print("  Entered {}".format(os.getcwd()))
         try:
            result = func(self, *args, **kwargs)
            if self.verbose:
               print('  {}'.format(result))
            return result
         except Exception, e:
            # this is where you would use an exception handling function
            print('  Caught {}'.format(e))
            pass
         finally:
            os.chdir(self.owd)
            if self.verbose:
               print("  Exited to {}\n".format(os.getcwd()))

      wrapper.__name__ = func.__name__
      wrapper.__doc__ = func.__doc__
      return wrapper

from jasp import *

os.environ['VASP_PP_PATH'] = '/users/jkitchin/src/Vasp'

class JASP(Vasp, object):
   __metaclass__ = WithCurrentDirectory
   def __init__(self,
                wd, verbose=True,
                atoms=None,
                ,**kwargs):
      Vasp.__init__(self, **kwargs)
      self.verbose = verbose
      self.vaspdir = wd
      self.cwd = os.getcwd()

      if not os.path.isdir(wd):
         os.makedirs(wd)

      if atoms is not None:
         atoms.calc = self

from ase import Atoms, Atom

co = Atoms([Atom('C',[0,   0, 0]),
            Atom('O',[1.2, 0, 0])],
            cell=(6., 6., 6.))

calc = JASP('/tmp/simple-co', #output dir
            xc='PBE',  # the exchange-correlation functional
            nbands=6,  # number of bands
            encut=350, # planewave cutoff
            ismear=1,  # Methfessel-Paxton smearing
            sigma=0.01,# very small smearing factor for a molecule
            atoms=co)

print calc.prepare_input_files()
print calc.get_atoms()
#+END_SRC

#+RESULTS:
: None
: Atoms(symbols='CO', positions=..., cell=[6.0, 6.0, 6.0], pbc=[False,
:       False, False], calculator=JASP(...))

#+BEGIN_SRC sh
ls /tmp/simple-co
#+END_SRC

#+RESULTS:

* MAYBE/GOOD Decorating vasp
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-05-02 Mon 11:31
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:
This uses my version of vasp.py. I think I would like to avoid this.

#+BEGIN_SRC python
from jasp import *
from jasp.vasp import *
from ase import Atoms, Atom

co = Atoms([Atom('C',[0,   0, 0]),
            Atom('O',[1.2, 0, 0])],
            cell=(6., 6., 6.))

calc = Vasp('/tmp/simple-co', #output dir
            xc='PBE',  # the exchange-correlation functional
            nbands=6,  # number of bands
            encut=350, # planewave cutoff
            ismear=1,  # Methfessel-Paxton smearing
            sigma=0.01,# very small smearing factor for a molecule
            verbose=True, debug=logging.DEBUG,
            atoms=co)

print calc.write_kpoints()
#+END_SRC

#+RESULTS:


#+BEGIN_SRC sh
ls /tmp/simple-co
#+END_SRC

#+RESULTS:
: KPOINTS

* A new idea for context managing in a class
  :PROPERTIES:
  :categories: python
  :ARCHIVE_TIME: 2016-05-02 Mon 11:32
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

One of the key innovations in our [[https://github.com/jkitchin/jasp][Python interface to Vasp]] was the use of a context manager to automatically change directories temporarily for calculations, and change back when done, even if exceptions were raised. We use a context manager for that. It has served us well, and we even recently improved exception handling in it to avoid the need for most try/except blocks inside the context manager.

There are still some nagging issues though: 1) you can only use the calculator in the context. Outside of it, none of the files it needs are in the current working directory. 2) the context manager forces a layer of indentation that is unavoidable. I would like it if the calculator could take the necessary context with it, and do the right thing from anywhere. I made a design decision when I chose the context manager solution not to decorate every single function because there are a lot of them, and it seemed like a maintenance issue.

** Decorator on the class
http://stackoverflow.com/questions/6307761/how-can-i-decorate-all-functions-of-a-class-without-typing-it-over-and-over-for

* Managing class method contexts via __getattribute__
  :PROPERTIES:
  :ARCHIVE_TIME: 2016-05-02 Mon 11:32
  :ARCHIVE_FILE: ~/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

This is only going to partially work. Some things like __str__ can only be modified by a metaclass I think.

While I have been digging into contexts, decorators, and functional programming, I came up with an idea to embed the code for this in the class where attributes are accessed. The idea is to decorate the function that gets called when it is accessed.

http://stackoverflow.com/questions/371753/python-using-getattribute-method

#+BEGIN_SRC python
import os
from ase.calculators.vasp import Vasp
import collections
import jasp.jasp_extensions
os.environ['VASP_PP_PATH'] = '/Users/jkitchin/src/VASP/'

class JASP(Vasp, object):

    def __init__(self, wd,
                 debug=None,
                 atoms=None,
                 verbose=False,
                 ,**kwargs):

        self.debug = debug
        self.verbose = verbose
        self.atoms = atoms

        # store directory this instance was created in
        self.owd = os.getcwd()

        # store the directory where the results are
        self.wd = wd

        self.cwd = self.owd     # compatibility
        self.vaspdir = self.wd  # compatibility

        # make the directory where the results are if it doesn't exist.
        if not os.path.isdir(self.wd):
            os.makedirs(self.wd)

        try:
            os.chdir(wd)
            super(JASP, self).__init__(**kwargs)
            if atoms is not None:
                atoms.calc = self
        finally:
            os.chdir(self.owd)


    def __getattribute__(self, attr):

        if attr == '__init__':
            return self.__init__

        f = super(JASP, self).__getattribute__(attr)
        #f = object.__getattribute__(self, attr)

        if isinstance(f, collections.Callable):
            def inner(*args, **kwargs):
                if self.verbose:
                    print('\nstarted in {}'.format(os.getcwd()))
                    print('inner: args {}, kwargs {}'.format(args, kwargs))
                os.chdir(self.wd)
                if self.verbose: print('  Entered {}'.format(os.getcwd()))
                try:
                    res = f(*args, **kwargs)
                    return res
                finally:
                    os.chdir(self.owd)
                    if self.verbose:
                        print('  Exited to {}\n\n'.format(os.getcwd()))
            return inner
        else:
            return f

    def add(self, a, b):
        return a + b


##################################################################

from ase import Atoms, Atom

co = Atoms([Atom('C', [0,   0, 0]),
            Atom('O', [1.2, 0, 0])],
            cell=(6., 6., 6.))


calc = JASP('/tmp/co-atoms',
            xc='PBE',    # the exchange-correlation functional
            nbands=6,    # number of bands
            encut=350,   # planewave cutoff
            ismear=1,    # Methfessel-Paxton smearing
            sigma=0.01,  # very small smearing factor for a molecule
            atoms=co)


# print calc.get_atoms()
# print calc.add(4, 5)

print calc


#+END_SRC

#+RESULTS:
#+begin_example
False
: -----------------------------
  VASP calculation from /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  converged: None
  Energy = nan eV

  Unit cell vectors (angstroms)
        x       y     z      length
  a0 [ 6.000  0.000  0.000] 6.000
  a1 [ 0.000  6.000  0.000] 6.000
  a2 [ 0.000  0.000  6.000] 6.000
  a,b,c,alpha,beta,gamma (deg):6.000 6.000 6.000 90.0 90.0 90.0
  Unit cell volume = 216.000 Ang^3
  Stress was not computed
 Atom#  sym       position [x,y,z]tag  rmsForce constraints
   0    C   [0.000      0.000      0.000]  0   nan      T T T
   1    O   [1.200      0.000      0.000]  0   nan      T T T
--------------------------------------------------

INCAR Parameters:
-----------------
        nbands: 6
        ismear: 1
         encut: 350
         sigma: 0.01
        magmom: None
          kpts: (1, 1, 1)
    reciprocal: False
            xc: PBE
           txt: -
         gamma: False

Pseudopotentials used:
----------------------
C: potpaw_PBE/C/POTCAR (git-hash: 2272d6745da89a3d872983542cef1d18750fc952)
O: potpaw_PBE/O/POTCAR (git-hash: 9a0489b46120b0cad515d935f44b5fbe3a3b1dfa)
#+end_example


#+BEGIN_SRC python
class D(object):
    def __init__(self):
        self.test = 20
        self.test2 = 21

    def __getattribute__(self,name):

        print 'looked up ', name
        return object.__getattribute__(self, name)

    def add(self, a, b):
        return a + b

    def __str__(self):
        return "DD"


d = D()

print d
print d.add(1, 2)
print d.test2
#+END_SRC
#+RESULTS:
: DD
: looked up  add
: 3
: looked up  test2
: 21

* Using macro expansions in org-mode
  :PROPERTIES:
  :ID:       9427C732-140A-4F2F-B60D-25DFCB2588AE
  :ARCHIVE_TIME: 2016-08-13 Sat 10:16
  :ARCHIVE_FILE: ~/vc/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+EMAIL: jkitchin@andrew.cmu.edu

#+RANDOM-KEYWORD: interesting

#+MACRO: my-animal-macro  a $1 has $2

Send me mail at {{{email}}}. My response will be {{{random-keyword}}}. Finally, you may be interested to know that a zebra has stripes.



* failed attempt
  :PROPERTIES:
  :ARCHIVE_TIME: 2017-01-29 Sun 15:29
  :ARCHIVE_FILE: ~/vc/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_OLPATH: ob-ipython and inline figures
  :ARCHIVE_CATEGORY: blog
  :END:


#+BEGIN_SRC emacs-lisp
(defun scimax-add-results (&optional arg info params)
  (when (and (org-in-src-block-p) 
	     (string= "ipython" (nth 0 (org-babel-get-src-block-info))))
    (let ((output (when (get-buffer "*ob-ipython-stdout*")
		    (with-current-buffer "*ob-ipython-stdout*"
		      (prog1
			  (s-trim (buffer-string))
			(kill-buffer "*ob-ipython-stdout*"))))))
      (when output
	(goto-char (org-babel-where-is-src-block-result))
	(end-of-line)
	(insert "\n"
		output)))))


(advice-add 'org-babel-execute-src-block :after 'scimax-add-results)
(advice-remove 'org-babel-execute-src-block  'scimax-add-results)
#+END_SRC

#+RESULTS:


#+BEGIN_SRC ipython :session :results value  :file inline.png
print(1)
%matplotlib inline

import matplotlib.pyplot as plt
plt.plot([1,2,4,8])
print(4,'anb')
print(5)
#+END_SRC

#+RESULTS:
1
4 anb
5
[[file:inline.png]]
5
[[file:inline.png]]

* Track changes with overlays
  :PROPERTIES:
  :ID:       E2A816F1-8293-457C-8945-18ABF636839D
  :ARCHIVE_TIME: 2017-03-14 Tue 20:54
  :ARCHIVE_FILE: ~/vc/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

the idea here is to use overlays to mark text that is deleted or inserted.

[[file:~/vc/jkitchin-github/scimax/elpa/cm-mode-20160310.829/cm-mode.el::;;%20Keywords:%20text,%20markdown]]

These are snippets{-- that--} make track changes work in cm-mode with some document markup

test{++ ok++}
#+BEGIN_SRC emacs-lisp
;; activate
(progn
  (add-to-list 'before-change-functions 'cm-before-change t)
  (add-to-list 'after-change-functions 'cm-after-change)
  (setq cm-follow-changes t)
  (message "Follow changes mode activated."))

;; deactivate
(progn
  (setq before-change-functions (delq 'cm-before-change before-change-functions))
  (setq after-change-functions (delq 'cm-after-change after-change-functions))
  (setq cm-follow-changes nil)
  (message "Follow changes mode deactivated."))

(defun cm-before-change (beg end)
  "Function to execute before a buffer change."
  (unless (or undo-in-progress
              (and (= beg (point-min)) (= end (point-max)))) ; this happens on buffer switches
    (if (= beg end)                   ; addition
        (cm-make-addition (cm-markup-at-point))
      ;; when the deletion was done with backspace, point is at end.
      (setq cm-current-deletion (list (buffer-substring beg end) (= (point) end))))))

(defun cm-after-change (beg end length)
  "Function to execute after a buffer change.
This function marks deletions. See cm-before-change for
details."
  (unless (or undo-in-progress
              (not cm-current-deletion))
    (apply 'cm-make-deletion cm-current-deletion)
    (setq cm-current-deletion nil)))
#+END_SRC


help:before-change-functions
Documentation:
List of functions to call before each text change.
Two arguments are passed to each function: the positions of
the beginning and end of the range of old text to be changed.
(For an insertion, the beginning and end are at the same place.)
No information is given about the length of the text after the change.

help:after-change-functions
Documentation:
List of functions to call after each text change.
Three arguments are passed to each function: the positions of
the beginning and end of the range of changed text,
and the length in chars of the pre-change text replaced by that range.
(For an insertion, the pre-change length is zero;
for a deletion, that length is the number of chars deleted,
and the post-change beginning and end are a#  ov-highlight-data: KCgxMjAwMCAxMjAwMCAoZmFjZSAoOmZvcmVncm91bmQgInJlZCIgOnN0cmlrZS10aHJvdWdoIHQpIG92LWhpZ2hsaWdodCB0IG92LXR5cGUgImRlbGV0ZSIpKSAoMTIwMDAgMTIwMDAgKG92LWhpZ2hsaWdodCB0IGZhY2UgKDpmb3JlZ3JvdW5kICJyZWQiIDpzdHJpa2UtdGhyb3VnaCB0KSkpKQ==

(setq inhibit-modification-hooks nil
(ovh-track-changes)
#+BEGIN_SRC emacs-lisp
(add-to-list 'before-change-functions 'ovh-before-change t)
(add-to-list 'after-change-functions 'ovh-after-change)
#+END_SRC

#+RESULTS
| ovh-after-change |




# Local Variables:
# eval: (ov-highlight-load)
# End:

#+RESULTS:
| ovh-after-change |

* An even better hy macro for functions
  :PROPERTIES:
  :ARCHIVE_TIME: 2017-03-21 Tue 15:56
  :ARCHIVE_FILE: ~/vc/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:

#+BEGIN_SRC jupyter-hy
(defmacro defun [func args &optional docstring &rest body]
  "A macro to document arguments.
Each arg is a list of the form:
(argname docstring options).
options will be interpreted as a dictionary

:default value   Makes the argument optional
:validate function
"
  `(defn ~func [~@(map (lambda [x]
(cond
 ;; take the argument name
 (True
  (nth x 0)))) args)]
~(+ (if docstring (+ docstring "\n\n") "")
"Parameters\n----------\n"
(.join "\n" (map (lambda [x]
                   (.format "{} : {}"
                            (nth x 0)
                            (nth x 1))) args)))
~@body))
(print 2)
#+END_SRC

#+RESULTS:

#+BEGIN_SRC jupyter-hy
(defmacro defun [func args &optional docstring &rest body]
  "A macro to document arguments.
Each arg is a list of the form:
(argname docstring options).
options will be interpreted as a dictionary

:default value   Makes the argument optional
:validate function
"
  `(defn ~func [~@(map (fn [x]
                         (setv argname (nth x 0) docstring (nth x 1))
(setv options {} argoptions (cut args 2))







(cond

                          (True
                           ))) args)]
~(+ (if docstring (+ docstring "\n\n") "")
"Parameters\n----------\n"
(.join "\n" (map (lambda [x]
                   (.format "{} : {}"
                            (nth x 0)
                            (nth x 1))) args)))
#+END_SRC

#+RESULTS:

(defun

#+BEGIN_SRC jupyter-hy
(print (macroexpand '(defun f [(a "an int")
                               (b "an int" :default 4)
                               (c "more ints" :rest)
                               (d "kwargs" :kwargs)]
                       "some doc"
                       (* a b))))
#+END_SRC

#+RESULTS:
: ('defun' 'f' [('a' 'an int') ('b' 'an int' '\ufdd0:default' 4) ('c' 'more ints' '\ufdd0:rest') ('d' 'kwargs' '\ufdd0:kwargs')] 'some doc' ('*' 'a' 'b'))


#+BEGIN_SRC jupyter-hy :results value
(cut '(arg1 "doc" {:default 4 :validate (fn (val) (assert (isinstance val int))) :rest}) 2)
#+END_SRC

#+RESULTS:
: ({'\ufdd0:default' 4 '\ufdd0:validate' ('fn' ('val') ('assert' ('isinstance' 'val' 'int'))) '\ufdd0:rest'})

#+BEGIN_SRC jupyter-hy :results value
(.index '(5 6 7) 6)
#+END_SRC

#+RESULTS:
: 1

#+BEGIN_SRC jupyter-hy :results value
(get (cut '(arg1 "doc" :default 4 :validate (fn (val) (assert (isinstance val int)))) 2) :validate)
#+END_SRC

#+RESULTS:
:


#+BEGIN_SRC jupyter-hy :results value
(defn f [&optional a] a)
(f 5)
#+END_SRC

#+RESULTS:
: 5

#+BEGIN_SRC jupyter-hy
(print (get {:default 40} :default))
#+END_SRC

#+RESULTS:
: 40


#+BEGIN_SRC jupyter-hy :results output
(setv arg (cut '(arg1 "doc" :rest :default 4 :validate (fn (val) (assert (isinstance val int)))) 2))
(.reverse arg)
(setv options {})
(while arg
  (setv a (.pop arg))
  (cond
   [(in a '(:rest :kwargs)) (assoc options a True)]
   [True (assoc options a (.pop arg))]))
(print options)
(print (get options :validate))
#+END_SRC

#+RESULTS:
: {'\ufdd0:default': 4, '\ufdd0:rest': True, '\ufdd0:validate': ('fn' ('val') ('assert' ('isinstance' 'val' 'int')))}
: ('fn' ('val') ('assert' ('isinstance' 'val' 'int')))

#+BEGIN_SRC jupyter-hy :results value
(in :rest '(:a :b :rest))
#+END_SRC

#+RESULTS:
: True

* Indirect buffers for editing in another mode
  :PROPERTIES:
  :ARCHIVE_TIME: 2017-03-22 Wed 20:39
  :ARCHIVE_FILE: ~/vc/blogofile-jkitchin.github.com/_blog/blog.org
  :ARCHIVE_CATEGORY: blog
  :END:


<b>Some bold text</b>



#+BEGIN_SRC emacs-lisp
(defun edit (start end)
  (interactive  "r")
  (let ((cb (current-buffer)))
    (clone-indirect-buffer-other-window "*html*" t)
    (narrow-to-region start end)
    (goto-char (point-min))
    (delay-mode-hooks (html-mode))
    (font-lock-default-function 'html-mode)
    (font-lock-default-fontify-region (point-min)
                                      (point-max)
                                      nil)

    (with-current-buffer cb
      (font-lock-fontify-buffer t))))
#+END_SRC

#+RESULTS:
: edit
