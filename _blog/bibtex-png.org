#+BEGIN_SRC python :results output org drawer
f = "../../../Desktop/Screen Shot 2016-08-26 at 8.03.49 AM.png"
METADATA = {"bibtex": '''@article{su-2016-sched-crack,
  author =	 {Lijie Su and Lixin Tang and Ignacio E. Grossmann},
  title =	 {Scheduling of Cracking Production Process With Feedstocks and
                  Energy Constraints},
  journal =	 {Computers \& Chemical Engineering},
  volume =	 94,
  number =	 {nil},
  pages =	 {92-103},
  year =	 2016,
  doi =		 {10.1016/j.compchemeng.2016.07.023},
  url =		 {http://dx.doi.org/10.1016/j.compchemeng.2016.07.023},
  DATE_ADDED =	 {Fri Aug 26 08:03:06 2016},
}
'''}


# Use PIL to save some image metadata
from PIL import Image
from PIL import PngImagePlugin

im = Image.open(f)
meta = PngImagePlugin.PngInfo()

for x in METADATA:
    meta.add_text(x, METADATA[x])
im.save(f, "png", pnginfo=meta)

im2 = Image.open(f)
print(im2.info['bibtex'])
#+END_SRC

#+RESULTS:
:RESULTS:
@article{su-2016-sched-crack,
  author =	 {Lijie Su and Lixin Tang and Ignacio E. Grossmann},
  title =	 {Scheduling of Cracking Production Process With Feedstocks and
                  Energy Constraints},
  journal =	 {Computers \& Chemical Engineering},
  volume =	 94,
  number =	 {nil},
  pages =	 {92-103},
  year =	 2016,
  doi =		 {10.1016/j.compchemeng.2016.07.023},
  url =		 {http://dx.doi.org/10.1016/j.compchemeng.2016.07.023},
  DATE_ADDED =	 {Fri Aug 26 08:03:06 2016},
}

:END:

https://pbs.twimg.com/media/CqyL9UfXgAAxiwG.jpg


#+BEGIN_SRC python :results output org drawer
f = "../../../Desktop/Screen Shot 2016-08-26 at 8.03.49 AM.png"
# Use PIL to save some image metadata
from PIL import Image
from PIL import PngImagePlugin

im2 = Image.open(f)
print(im2.info['bibtex'])
#+END_SRC

#+RESULTS:
:RESULTS:
@article{su-2016-sched-crack,
  author =	 {Lijie Su and Lixin Tang and Ignacio E. Grossmann},
  title =	 {Scheduling of Cracking Production Process With Feedstocks and
                  Energy Constraints},
  journal =	 {Computers \& Chemical Engineering},
  volume =	 94,
  number =	 {nil},
  pages =	 {92-103},
  year =	 2016,
  doi =		 {10.1016/j.compchemeng.2016.07.023},
  url =		 {http://dx.doi.org/10.1016/j.compchemeng.2016.07.023},
  DATE_ADDED =	 {Fri Aug 26 08:03:06 2016},
}

:END:




#+BEGIN_SRC python :results output org drawer
import urllib.request

urllib.request.urlretrieve('https://pbs.twimg.com/media/CqyRMXMXEAAkEmB.jpg', '/Users/jkitchin/Desktop/downloaded_tweet_image.jpg')

from PIL import Image

im2 = Image.open('/Users/jkitchin/Desktop/downloaded_tweet_image.jpg')
print(im2.info.get('bibtex', None))
#+END_SRC

#+RESULTS:
:RESULTS:
None
:END:

** Try with a jpg

#+BEGIN_SRC python :results output org drawer
f = "../../../Desktop/test.jpg"
METADATA = {"bibtex": '''@article{su-2016-sched-crack,
  author =	 {Lijie Su and Lixin Tang and Ignacio E. Grossmann},
  title =	 {Scheduling of Cracking Production Process With Feedstocks and
                  Energy Constraints},
  journal =	 {Computers \& Chemical Engineering},
  volume =	 94,
  number =	 {nil},
  pages =	 {92-103},
  year =	 2016,
  doi =		 {10.1016/j.compchemeng.2016.07.023},
  url =		 {http://dx.doi.org/10.1016/j.compchemeng.2016.07.023},
  DATE_ADDED =	 {Fri Aug 26 08:03:06 2016},
}
'''}

from PIL import Image
import piexif

im = Image.open(f)
exif_dict = piexif.load(im.info.get("exif", {}))
# process im and exif_dict...
w, h = im.size
exif_dict.update(METADATA)

exif_bytes = piexif.dump(exif_dict)

f2 = "../../../Desktop/test2.jpg"
im.save(f2, "jpeg", exif=exif_bytes)


im2 = Image.open(f2)
print(im2.info['bibtex'])
#+END_SRC

#+RESULTS:
:RESULTS:
:END:

* Try with steganography

#+BEGIN_SRC python :results output org drawer
# -*- coding: utf-8 -*-
from __future__ import absolute_import, unicode_literals
from steganography.steganography import Steganography

# hide text to image
path = "../../../Desktop/test.jpg"
output_path = "../../../Desktop/test2.jpg"
text = '''@article{su-2016-sched-crack,
  author =	 {Lijie Su and Lixin Tang and Ignacio E. Grossmann},
  title =	 {Scheduling of Cracking Production Process With Feedstocks and
                  Energy Constraints},
  journal =	 {Computers \& Chemical Engineering},
  volume =	 94,
  number =	 {nil},
  pages =	 {92-103},
  year =	 2016,
  doi =		 {10.1016/j.compchemeng.2016.07.023},
  url =		 {http://dx.doi.org/10.1016/j.compchemeng.2016.07.023},
  DATE_ADDED =	 {Fri Aug 26 08:03:06 2016},
}
'''

Steganography.encode(path, output_path, text)

# read secret text from image
secret_text = Steganography.decode(output_path)
#+END_SRC

#+RESULTS:
:RESULTS:
:END:

#+BEGIN_SRC python :results output org drawer
from stegano import lsb

text = '''@article{su-2016-sched-crack,
  author =	 {Lijie Su and Lixin Tang and Ignacio E. Grossmann},
  title =	 {Scheduling of Cracking Production Process With Feedstocks and
                  Energy Constraints},
  journal =	 {Computers \& Chemical Engineering},
  volume =	 94,
  number =	 {nil},
  pages =	 {92-103},
  year =	 2016,
  doi =		 {10.1016/j.compchemeng.2016.07.023},
  url =		 {http://dx.doi.org/10.1016/j.compchemeng.2016.07.023},
  DATE_ADDED =	 {Fri Aug 26 08:03:06 2016},
}
'''


secret = lsb.hide("../../../Desktop/test.jpg", text)
secret.save("../../../Desktop/test2.jpg")
#+END_SRC

#+RESULTS:
:RESULTS:
:END:

#+BEGIN_SRC python :results output org drawer
from stegano import lsb
print(lsb.reveal("../../../Desktop/test2.jpg"))
#+END_SRC

#+RESULTS:
:RESULTS:

:END:

