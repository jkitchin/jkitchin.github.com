<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-15 Wed 19:28 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="John Kitchin" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline3">1. Copy formatted org-mode text from Emacs to other applications</a>
<ul>
<li><a href="#orgheadline1">1.1. An example</a></li>
<li><a href="#orgheadline2">1.2. The code</a></li>
</ul>
</li>
<li><a href="#orgheadline4">2. <span class="todo TODO">TODO</span> test&#xa0;&#xa0;&#xa0;<span class="tag"><span class="test">test</span></span></a></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3"><span class="section-number-2">1</span> Copy formatted org-mode text from Emacs to other applications</h2>
<div class="outline-text-2" id="text-1">
<p>
It occurred to me that some applications can copy formatted text which I can paste into MS Word. I thought it would be great if I could do this from org-mode. For example, if I had some references formatted in org-mode, I could copy and paste them to Word, keeping the formatting. Curiosity got the better of me and I wondered how this is done. It works by creating a <a href="https://www.safaribooksonline.com/library/view/rtf-pocket-guide/9781449302047/ch01.html">Rich Text Format</a> version of what you want to copy and then get it to the clipboard. It isn't quite enough to just copy it, it needs to go in the clipboard as an RTF datatype. On Mac OSX I used <a href="http://osxdaily.com/2007/03/05/manipulating-the-clipboard-from-the-command-line/">pbcopy</a> to make that happen.
</p>

<p>
The strategy I came up with is to create a derived backend that exports a highlighted region as RTF to a temporary buffer, and then runs pbcopy on that buffer to get it on the clipboard. Then, I can switch to Word, and paste it in with Word formatting!
</p>
</div>

<div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">1.1</span> An example</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Here is some example text:
</p>

<p>
Some <b>bold</b>, <i>italic</i>, <span class="underline">underline</span>, <del>struck</del> and <code>verbatim</code> text to copy. I need some H<sub>2</sub>O with no H<sup>+</sup> in it it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">x</span> = np.linspace(0, 60, 500)
plt.plot(np.exp(-0.1 * x) * np.cos(x), np.exp(-0.1 * x) * np.sin(x))
org.figure(plt.savefig(<span style="color: #008000;">'spiral.png'</span>), caption=<span style="color: #008000;">'A spiral.'</span>, attributes=[[<span style="color: #008000;">'org'</span>, <span style="color: #008000;">':width 100'</span>]])
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)
org.table([[<span style="color: #008000;">'H1'</span>, <span style="color: #008000;">'H2'</span>], <span style="color: #D0372D;">None</span>, [1, 2], [2, 4]])
</pre>
</div>


<div class="figure">
<p><img src="spiral.png" alt="spiral.png" />
</p>
<p><span class="figure-number">Figure 1:</span> A spiral.</p>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">H1</th>
<th scope="col" class="org-right">H2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>

<ol class="org-ol">
<li>John R. Kitchin, <i>Examples of Effective Data Sharing in Scientific Publishing</i>, <b>ACS Catalysis</b>, 5(6), pp. 3894-3899 (2015). <a href="https://doi.org/10.1021/acscatal.5b00538">doi:10.1021/acscatal.5b00538</a>.</li>

<li>John R. Kitchin;  Ana E. Van Gulick and  Lisa D. Zilinski, <i>Automating Data Sharing Through Authoring Tools</i>, <b>International Journal on Digital Libraries</b>, pp. 1&#x2013;6 (2016). <a href="https://doi.org/10.1007/s00799-016-0173-7">doi:10.1007/s00799-016-0173-7</a>.</li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">1.2</span> The code</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-bold</span> (bold contents info)
  (format <span style="color: #008000;">"{\\b %s}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-italic</span> (el contents info)
  (format <span style="color: #008000;">"{\\i %s}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-underline</span> (el contents info)
  (format <span style="color: #008000;">"{\\ul %s}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-sub</span> (el contents info)
  (format <span style="color: #008000;">"{\\sub %s}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-super</span> (el contents info)
  (format <span style="color: #008000;">"{\\super %s}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-verbatim</span> (el contents info)
  (format <span style="color: #008000;">"{\\f1 %s}"</span> (org-element-property <span style="color: #006FE0;">:value</span> el)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-fixed-width</span> (el contents info) (message-box contents)
  (format <span style="color: #008000;">"{\\f1 %s}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-strike</span> (el contents info)
  (format <span style="color: #008000;">"{\\strike %s}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-paragraph</span> (el contents info)
  (format <span style="color: #008000;">"{\\pard</span>
<span style="color: #008000;">\\fi720 %s</span>
<span style="color: #008000;">\\par\\sa1}"</span> contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-headline</span> (hl contents info)
  (format <span style="color: #008000;">"{\\b %s} %s"</span> (org-element-property <span style="color: #006FE0;">:raw-value</span> hl) contents))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-src</span> (src contents info)
  (<span style="color: #0000FF;">let</span> ((lang (org-element-property <span style="color: #006FE0;">:language</span> src))
        (code (org-element-property <span style="color: #006FE0;">:value</span> src)))
    (<span style="color: #0000FF;">with-temp-file</span> <span style="color: #008000;">"rtf-exporter"</span> (insert code))
    (<span style="color: #0000FF;">prog1</span>
        (format <span style="color: #008000;">"%s\\f0"</span> (shell-command-to-string
                            (format <span style="color: #008000;">"highlight -O rtf --src-lang=python rtf-exporter"</span> lang)))
      (delete-file <span style="color: #008000;">"rtf-exporter"</span>))))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-link</span> (link contents info)
  (<span style="color: #0000FF;">cond</span>
   ((-contains? '(<span style="color: #008000;">"http"</span> <span style="color: #008000;">"https"</span>) (org-element-property <span style="color: #006FE0;">:type</span> link))
    (format <span style="color: #008000;">"</span>
<span style="color: #008000;">{\\cf2\\field{\\*\\fldinst{HYPERLINK</span>
<span style="color: #008000;"> \"%s\"</span>
<span style="color: #008000;">}}{\\fldrslt{\\ul</span>
<span style="color: #008000;">%s</span>
<span style="color: #008000;">}}}"</span> (org-element-property <span style="color: #006FE0;">:raw-link</span> link)
(<span style="color: #0000FF;">if</span> (org-element-property <span style="color: #006FE0;">:contents-begin</span> link)
    (buffer-substring (org-element-property <span style="color: #006FE0;">:contents-begin</span> link)
                      (org-element-property <span style="color: #006FE0;">:contents-end</span> link))
  (org-element-property <span style="color: #006FE0;">:raw-link</span> link))))
((string= <span style="color: #008000;">"file"</span> (org-element-property <span style="color: #006FE0;">:type</span> link))
 (format <span style="color: #008000;">"{\\field\\fldedit{\\*\\fldinst { INCLUDEPICTURE  \\\\d</span>
<span style="color: #008000;"> \"%s\"</span>
<span style="color: #008000;"> \\\\* MERGEFORMATINET }}{\\fldrslt {  }}}"</span>
         (expand-file-name (org-element-property <span style="color: #006FE0;">:path</span> link))))
(t (org-element-property <span style="color: #006FE0;">:raw-link</span> link))))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">rtf-table</span> (tbl contents info)
  <span style="color: #036A07;">"Hacky interim solution. Making tables looks hard."</span>
  (mapconcat (<span style="color: #0000FF;">lambda</span> (row) (format <span style="color: #008000;">"{\\f1 %s}\\line"</span> row))
             (split-string
              (buffer-substring
               (org-element-property <span style="color: #006FE0;">:contents-begin</span> tbl)
               (org-element-property <span style="color: #006FE0;">:contents-end</span> tbl))
              <span style="color: #008000;">"\n"</span>)
             <span style="color: #008000;">"\n"</span>))

(org-export-define-derived-backend 'RTF 'html
  <span style="color: #006FE0;">:translate-alist</span> '((bold . rtf-bold)
                     (italic . rtf-italic)
                     (underline . rtf-underline)
                     (superscript . rtf-super)
                     (subscript . rtf-sub)
                     (verbatim . rtf-verbatim)
                     (strike-through . rtf-strike)
                     (paragraph . rtf-paragraph)
                     (headline . rtf-headline)
                     (src-block . rtf-src)
                     (table . rtf-table)
                                        <span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(fixed-width . rtf-fixed-width)</span>
                     (link . rtf-link)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">formatted-copy</span> (r1 r2)
  <span style="color: #036A07;">"Convert the selected region to RTF and put it on the clipboard."</span>
  (<span style="color: #0000FF;">interactive</span> <span style="color: #008000;">"r"</span>)
  (<span style="color: #0000FF;">save-window-excursion</span>
    (<span style="color: #0000FF;">let*</span> ((buf (org-export-to-buffer 'RTF <span style="color: #008000;">"*Org RTF Export*"</span> nil nil t t))
           (rtf (<span style="color: #0000FF;">with-current-buffer</span> buf (buffer-string))))
      (<span style="color: #0000FF;">with-temp-buffer</span>
        (insert (format <span style="color: #008000;">"{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f1 Courier;}}</span>
<span style="color: #008000;">%s}"</span> rtf))
        (kill-new (buffer-string))
        (shell-command-on-region (point-min) (point-max) <span style="color: #008000;">"pbcopy"</span>))
      (kill-buffer buf))))
</pre>
</div>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">H1</th>
<th scope="col" class="org-right">H2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>





<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4"><span class="section-number-2">2</span> <span class="todo TODO">TODO</span> test&#xa0;&#xa0;&#xa0;<span class="tag"><span class="test">test</span></span></h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="https://github.com/jwiegley/dot-emacs/blob/master/lisp/copy-code.el">link</a>
</p>

<p>
<a href="https://github.com/jwiegley/dot-emacs/blob/master/lisp/copy-code.el">https://github.com/jwiegley/dot-emacs/blob/master/lisp/copy-code.el</a>
</p>



<div class="figure">
<p><img src="../../Desktop/female-emojis-google-scientist-feminism.jpg" alt="female-emojis-google-scientist-feminism.jpg" />
</p>
</div>




<p>
<a href="http://www.pindari.com/rtf1.html">http://www.pindari.com/rtf1.html</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: John Kitchin</p>
<p class="date">Created: 2016-06-15 Wed 19:28</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
