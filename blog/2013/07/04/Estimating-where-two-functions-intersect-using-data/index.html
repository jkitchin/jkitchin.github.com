

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="http://www.researcherid.com/rid/A-2363-2010" target="_new">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/group.html"
             class="">Group</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>
    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            






<article>
  <div class="blog_post">
    <header>
      <div id="Estimating-where-two-functions-intersect-using-data"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/07/04/Estimating-where-two-functions-intersect-using-data/" rel="bookmark" title="Permanent Link to Estimating where two functions intersect using data">Estimating where two functions intersect using data</a></h2>
      <p><small><span class="blog_post_date">Posted July 04, 2013 at 02:38 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/data-analysis/'>data analysis</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/07/04/Estimating-where-two-functions-intersect-using-data#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated July 07, 2013 at 09:01 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Suppose we have two functions described by this data:
</p>

<table id="data" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="right"/>

<col class="right"/>

<col class="right"/>
</colgroup>
<thead>
<tr>
<th scope="col" class="right">T(K)</th>
<th scope="col" class="right">E1</th>
<th scope="col" class="right">E2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">300</td>
<td class="right">-208</td>
<td class="right">-218</td>
</tr>

<tr>
<td class="right">400</td>
<td class="right">-212</td>
<td class="right">-221</td>
</tr>

<tr>
<td class="right">500</td>
<td class="right">-215</td>
<td class="right">-220</td>
</tr>

<tr>
<td class="right">600</td>
<td class="right">-218</td>
<td class="right">-222</td>
</tr>

<tr>
<td class="right">700</td>
<td class="right">-220</td>
<td class="right">-222</td>
</tr>

<tr>
<td class="right">800</td>
<td class="right">-223</td>
<td class="right">-224</td>
</tr>

<tr>
<td class="right">900</td>
<td class="right">-227</td>
<td class="right">-225</td>
</tr>

<tr>
<td class="right">1000</td>
<td class="right">-229</td>
<td class="right">-227</td>
</tr>

<tr>
<td class="right">1100</td>
<td class="right">-233</td>
<td class="right">-228</td>
</tr>

<tr>
<td class="right">1200</td>
<td class="right">-235</td>
<td class="right">-227</td>
</tr>

<tr>
<td class="right">1300</td>
<td class="right">-240</td>
<td class="right">-229</td>
</tr>
</tbody>
</table>

<p>
We want to determine the temperature at which they intersect, and more importantly what the uncertainty on the intersection is. There is noise in the data, which means there is uncertainty in any function that could be fit to it, and that uncertainty would propagate to the intersection. Let us examine the data.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

T = [x[0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data]
E1 = [x[1] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data]
E2 = [x[2] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data]

plt.plot(T, E1, T, E2)
plt.legend([<span style="color: #228b22;">'E1'</span>, <span style="color: #228b22;">'E2'</span>])
plt.savefig(<span style="color: #228b22;">'images/intersection-0.png'</span>)
</pre>
</div>

<p><img src="/img/./images/intersection-0.png"><p>

<p>
Our strategy is going to be to fit functions to each data set, and get the confidence intervals on the parameters of the fit. Then, we will solve the equations to find where they are equal to each other and propagate the uncertainties in the parameters to the answer.
</p>

<p>
These functions look approximately linear, so we will fit lines to each function. We use the regress function in pycse to get the uncertainties on the fits. Then, we use the uncertainties package to propagate the uncertainties in the analytical solution to the intersection of two lines.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> pycse <span style="color: #8b0000;">import</span> regress
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
<span style="color: #8b0000;">import</span> uncertainties <span style="color: #8b0000;">as</span> u

T = np.array([x[0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data])
E1 = np.array([x[1] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data])
E2 = np.array([x[2] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">columns of the x-values for a line: constant, T</span>
A = np.column_stack([T**0, T])

p1, pint1, se1 = regress(A, E1, alpha=0.05)

p2, pint2, se2 = regress(A, E2, alpha=0.05)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now we have two lines: y1 = m1*T + b1 and y2 = m2*T + b2</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">they intersect at m1*T + b1 = m2*T + b2</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">or at T = (b2 - b1) / (m1 - m2)</span>
b1 = u.ufloat((p1[0], se1[0]))
m1 = u.ufloat((p1[1], se1[1]))

b2 = u.ufloat((p2[0], se2[0]))
m2 = u.ufloat((p2[1], se2[1]))

T_intersection = (b2 - b1) / (m1 - m2)
<span style="color: #8b0000;">print</span> T_intersection

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">plot the data, the fits and the intersection and \pm 2 \sigma.</span>
plt.plot(T, E1, <span style="color: #228b22;">'bo '</span>, label=<span style="color: #228b22;">'E1'</span>)
plt.plot(T, np.dot(A,p1), <span style="color: #228b22;">'b-'</span>)
plt.plot(T, E2, <span style="color: #228b22;">'ro '</span>, label=<span style="color: #228b22;">'E2'</span>)
plt.plot(T, np.dot(A,p2), <span style="color: #228b22;">'r-'</span>)

plt.plot(T_intersection.nominal_value,
        (b1 + m1*T_intersection).nominal_value, <span style="color: #228b22;">'go'</span>,
        ms=13, alpha=0.2, label=<span style="color: #228b22;">'Intersection'</span>)
plt.plot([T_intersection.nominal_value - 2*T_intersection.std_dev(),
          T_intersection.nominal_value + 2*T_intersection.std_dev()],
         [(b1 + m1*T_intersection).nominal_value, 
          (b1 + m1*T_intersection).nominal_value],
         <span style="color: #228b22;">'g-'</span>, lw=3, label=<span style="color: #228b22;">'$\pm 2 \sigma$'</span>)
       
plt.legend(loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/intersection-1.png'</span>)
</pre>
</div>

<pre class="example">
813.698630137+/-62.407180552
</pre>

<p><img src="/img/./images/intersection-1.png"><p>

<p>
You can see there is a substantial uncertainty in the temperature at approximately the 90% confidence level (&plusmn; 2 &sigma;).
</p>


<p>
<span class="underline">Update 7-7-2013</span>
</p>

<p>
After a suggestion from Prateek, here we subtract the two data sets, fit a line to that data, and then use fsolve to find the zero. We <a href="http://pythonhosted.org/uncertainties/user_guide.html#making-custom-functions-accept-numbers-with-uncertainties">wrap</a> fsolve in the uncertainties package to directly get the uncertainty on the root. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> pycse <span style="color: #8b0000;">import</span> regress
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
<span style="color: #8b0000;">import</span> uncertainties <span style="color: #8b0000;">as</span> u
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve


T = np.array([x[0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data])
E1 = np.array([x[1] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data])
E2 = np.array([x[2] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> data])

E = E1 - E2

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">columns of the x-values for a line: constant, T</span>
A = np.column_stack([T**0, T])

p, pint, se = regress(A, E, alpha=0.05)

b = u.ufloat((p[0], se[0]))
m = u.ufloat((p[1], se[1]))

@u.wrap
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f</span>(b, m):
    X, = fsolve(<span style="color: #8b0000;">lambda</span> x: b + m * x, 800)
    <span style="color: #8b0000;">return</span> X

<span style="color: #8b0000;">print</span> f(b, m)
</pre>
</div>

<pre class="example">
813.698630137+/-54.0386903923
</pre>

<p>
Interesting that this uncertainty is a little smaller than the previously computed uncertainty. Here you can see we have to wrap the function in a peculiar way. The function must return a single float number, and take arguments with uncertainty. We define the polynomial fit (a line in this case) in a lambda function inside the function. It works ok.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/07/04/Estimating-where-two-functions-intersect-using-data.org">org-mode source</a><p>

    </div>
  </div>
</article>



<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://jkitchin.github.io/blog/2013/07/04/Estimating-where-two-functions-intersect-using-data";
</script>
<script type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/embed.js"></script>
<noscript><a href="http://kitchinresearchgroup.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
Search
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kitchingroup.cheme.cmu.edu" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
    <li><a href="http://enthought.com">Enthought Python</a></li>
    <li><a href="/pycse">Pycse</a></li>
    <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2014/03/20/Finding-VASP-calculations-in-a-directory-tree/">Finding VASP calculations in a directory tree</a></li>
      <li><a href="/blog/2014/03/08/Using-yasnippet-to-get-completion-in-ref-links/">Using yasnippet to get completion in ref links</a></li>
      <li><a href="/blog/2014/03/07/Storing-label-links-in-org-mode/">Storing label links in org-mode</a></li>
      <li><a href="/blog/2014/03/06/Using-completion-in-ref-links/">Using completion in ref links</a></li>
      <li><a href="/blog/2014/03/05/Creating-a-transportable-zip-archive-of-an-org-file/">Creating a transportable zip-archive of an org-file</a></li>
    </ul>
  </section>

  <section>
 <h1 class="post_header_gradient theme_font"><a href="http://www.citeulike.org/user/jkitchin" class="external text" title="http://www.citeulike.org/user/jkitchin" rel="nofollow">CiteULike</a> Reading List</h1>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {

var d = new Date();
curr_year = d.getFullYear();

$.getJSON('http://www.citeulike.org/json/user/jkitchin/,,?callback=?&per_page=5',
function(data) {
  var items = [];
  year=curr_year
  $.each(data, function(i) {
    year=data[i].published[0];
    var cit='<li id="' + i + '">' + '<a class="pap" href="http://dx.doi.org/'+data[i].doi+'">'+ data[i].title + '</a><br>';
    cit+='</li>';
    items.push( cit )      
  });

  $('<ul/>', {
    'class': 'my-new-list',
    html: items.join('')
  }).appendTo('#papers2');
});
});
</script>

<div id="papers2"></div>

  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
<ul id="my-github-projects">
    <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2014
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



