

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="selected">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="MS-Word-comments-from-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2023/02/25/MS-Word-comments-from-org-mode/" rel="bookmark" title="Permanent Link to MS Word comments from org-mode">MS Word comments from org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted February 25, 2023 at 11:49 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/docx/'>docx</a>, <a href='/blog/category/orgmode/'>orgmode</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Today I <a href="https://www.reddit.com/r/orgmode/comments/11bkt2h/is_it_possible_to_pass_html_in_org_to_pandoc_word/">learned</a> you can make a Word document from org-mode with Word comments in them. This could be useful when working with collaborators maybe. A subtlety is it works by using pandoc to convert markdown into docx. Within markdown you designate the comments using HTML like this:
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;span <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-start"</span> <span style="color: #BA36A5;">author</span>=<span style="color: #008000;">"jkitchin"</span>&gt;Comment text&lt;/span&gt;The text being commented on &lt;span <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-end"</span>&gt;&lt;/span&gt; 
</pre>
</div>

<p>
Let's wrap that in a link for convenience. I use a full display so it is easy to see the comment. I only export the comment for markdown export, for everything else we just use the path. We somewhat abuse the link syntax here by using the path for the text to comment on, and the description for the comment.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-link-set-parameters <span style="color: #008000;">"comment"</span>
                         <span style="color: #006FE0;">:export</span> (<span style="color: #0000FF;">lambda</span> (path desc backend)
                                   (<span style="color: #0000FF;">if</span> (eql backend 'md)
                                       (format <span style="color: #008000;">"&lt;span class=\"comment-start\" author=\"%s\"&gt;%s&lt;/span&gt;%s&lt;span class=\"comment-end\"&gt;&lt;/span&gt;"</span>
                                               (user-full-name)
                                               desc
                                               path)
                                     <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">ignore for other backends and just use path</span>
                                     path))
                         <span style="color: #006FE0;">:display</span> 'full
                         <span style="color: #006FE0;">:face</span> '(<span style="color: #006FE0;">:foreground</span> <span style="color: #008000;">"orange"</span>))                  
</pre>
</div>

<p>
Now, we use it like this This is the text commented on.
</p>

<p>
In org-mode it looks like:
</p>



<p>
<figure><img src="/media/date-25-02-2023-time-11-44-11.png"></figure> 
</p>

<p>
To get the Word doc, we need some code that first exports to Markdown, and then calls pandoc to convert that to docx. Here is my solution to that. Usually you would put this in a subsection tagged with :noexport: but I show it here to see it. Running this block generates the docx file and opens it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">let*</span> ((md (org-md-export-to-markdown))
       (docx (concat (file-name-sans-extension md) <span style="color: #008000;">".docx"</span>)))
  (shell-command (format <span style="color: #008000;">"pandoc -s %s -o %s"</span> md docx))
  (org-open-file docx '(16)))
</pre>
</div>

<p>
The result looks like this in MS Word:
</p>


<p>
<figure><img src="/media/date-25-02-2023-time-11-41-37.png"></figure> 
</p>

<p>
That is pretty remarkable. I guess this has some limitations in going through markdown, e.g. usually I have found something doesn't work like an equation or table, or caption, cross-reference, etc. Still, this might be inspiration to test it out further!
</p>
<p>Copyright (C) 2023 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2023/02/25/MS-Word-comments-from-org-mode.org">org-mode source</a></p>
<p>Org-mode version = 9.5.5</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2023/02/25/MS-Word-comments-from-org-mode">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Update-on-finding-the-minimum-distance-from-a-point-to-a-curve"></div>
      <h2 class="blog_post_title"><a href="/blog/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve/" rel="bookmark" title="Permanent Link to Update on finding the minimum distance from a point to a curve">Update on finding the minimum distance from a point to a curve</a></h2>
      <p><small><span class="blog_post_date">Posted February 17, 2023 at 06:41 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Almost 10 years ago I <a href="https://kitchingroup.cheme.cmu.edu/blog/2013/02/14/Find-the-minimum-distance-from-a-point-to-a-curve/">wrote</a> about finding the minimum distance from a point to a curve using a constrained optimization. At that time, the way to do this used <code>scipy.optimize.fmin_coblya</code>. I learned today from a student, that sometimes this method fails! I reproduce the code here, updated for Python 3, some style updates, and to show it does indeed fail sometimes, notably when the point is "outside" the parabola.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fmin_cobyla

<span style="color: #0000FF;">def</span> <span style="color: #006699;">f</span>(x):
    <span style="color: #0000FF;">return</span> x**2

<span style="color: #0000FF;">for</span> P <span style="color: #0000FF;">in</span> np.array([[0.5, 2],
                   [2, 2],
                   [-1, 2],
                   [-2, 2],
                   [0, 0.5],
                   [0, -0.5]]):
    
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(X):
        <span style="color: #BA36A5;">X</span> = np.array(X)
        <span style="color: #0000FF;">return</span> np.linalg.norm(X - P)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">c1</span>(X):
        <span style="color: #BA36A5;">x</span>,<span style="color: #BA36A5;">y</span> = X
        <span style="color: #0000FF;">return</span> f(x) - y

    <span style="color: #BA36A5;">X</span> = fmin_cobyla(objective, x0=[P[0], f(P[0])], cons=[c1])

    <span style="color: #006FE0;">print</span>(f<span style="color: #008000;">'The minimum distance is </span>{objective(X):1.2f}<span style="color: #008000;">. Constraint satisfied = </span>{c1(X) &lt; 1e-6}<span style="color: #008000;">'</span>)

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Verify the vector to this point is normal to the tangent of the curve</span>
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector from curve to point</span>
    v1 = np.array(P) - np.array(X)
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector</span>
    v2 = np.array([1, 2.0 * X[0]])
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'dot(v1, v2) = '</span>, np.dot(v1, v2))

    x = np.linspace(-2, 2, 100)

    plt.plot(x, f(x), <span style="color: #008000;">'r-'</span>, label=<span style="color: #008000;">'f(x)'</span>)
    plt.plot(P[0], P[1], <span style="color: #008000;">'bo'</span>, label=<span style="color: #008000;">'point'</span>)
    plt.plot([P[0], X[0]], [P[1], X[1]], <span style="color: #008000;">'b-'</span>, label=<span style="color: #008000;">'shortest distance'</span>)
    plt.plot([X[0], X[0] + 1], [X[1], X[1] + 2.0 * X[0]], <span style="color: #008000;">'g-'</span>, label=<span style="color: #008000;">'tangent'</span>)
    plt.axis(<span style="color: #008000;">'equal'</span>)
    plt.xlabel(<span style="color: #008000;">'x'</span>)
    plt.ylabel(<span style="color: #008000;">'y'</span>)    
</pre>
</div>

<p>
The minimum distance is 0.86. Constraint satisfied = True
dot(v1, v2) =  0.0002913487659186309
The minimum distance is 0.00. Constraint satisfied = False
dot(v1, v2) =  0.00021460906432962284
The minimum distance is 0.39. Constraint satisfied = True
dot(v1, v2) =  0.00014271520451364372
The minimum distance is 0.00. Constraint satisfied = False
dot(v1, v2) =  -0.0004089466778209598
The minimum distance is 0.50. Constraint satisfied = True
dot(v1, v2) =  1.9999998429305957e-12
The minimum distance is 0.00. Constraint satisfied = False
dot(v1, v2) =  8.588744170160093e-06
<figure><img src="/media/f66cff16ba65526d5877bd894142fa021c51f434.png"></figure> 
</p>

<p>
So, sure enough, the optimizer is failing to find a solution that meets the constraint. It is strange it does not work on the outside. That is almost certainly an algorithm problem. Here we solve it nearly identically with the more modern <code>scipy.optimize.minimize</code> function, and it converges every time. 
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> minimize

<span style="color: #0000FF;">for</span> P <span style="color: #0000FF;">in</span> np.array([[0.5, 2],
                   [2, 2],
                   [-1, 2],
                   [-2, 2],
                   [0, 0.5],
                   [0, -0.5]]):
    
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(X):
        <span style="color: #BA36A5;">X</span> = np.array(X)
        <span style="color: #0000FF;">return</span> np.linalg.norm(X - P)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">c1</span>(X):
        <span style="color: #BA36A5;">x</span>,<span style="color: #BA36A5;">y</span> = X
        <span style="color: #0000FF;">return</span> f(x) - y

    <span style="color: #BA36A5;">sol</span> = minimize(objective, x0=[P[0], f(P[0])], constraints={<span style="color: #008000;">'type'</span>: <span style="color: #008000;">'eq'</span>, <span style="color: #008000;">'fun'</span>: c1})
    X = sol.x

    <span style="color: #006FE0;">print</span>(f<span style="color: #008000;">'The minimum distance is </span>{objective(X):1.2f}<span style="color: #008000;">. Constraint satisfied = </span>{sol.status &lt; 1e-6}<span style="color: #008000;">'</span>)

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Verify the vector to this point is normal to the tangent of the curve</span>
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector from curve to point</span>
    v1 = np.array(P) - np.array(X)
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector</span>
    v2 = np.array([1, 2.0 * X[0]])
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'dot(v1, v2) = '</span>, np.dot(v1, v2))

    x = np.linspace(-2, 2, 100)

    plt.plot(x, f(x), <span style="color: #008000;">'r-'</span>, label=<span style="color: #008000;">'f(x)'</span>)
    plt.plot(P[0], P[1], <span style="color: #008000;">'bo'</span>, label=<span style="color: #008000;">'point'</span>)
    plt.plot([P[0], X[0]], [P[1], X[1]], <span style="color: #008000;">'b-'</span>, label=<span style="color: #008000;">'shortest distance'</span>)
    plt.plot([X[0], X[0] + 1], [X[1], X[1] + 2.0 * X[0]], <span style="color: #008000;">'g-'</span>, label=<span style="color: #008000;">'tangent'</span>)
    plt.axis(<span style="color: #008000;">'equal'</span>)
    plt.xlabel(<span style="color: #008000;">'x'</span>)
    plt.ylabel(<span style="color: #008000;">'y'</span>)
</pre>
</div>

<p>
The minimum distance is 0.86. Constraint satisfied = True
dot(v1, v2) =  1.0701251773603815e-08
The minimum distance is 0.55. Constraint satisfied = True
dot(v1, v2) =  -0.0005793028003104883
The minimum distance is 0.39. Constraint satisfied = True
dot(v1, v2) =  -1.869272921939391e-05
The minimum distance is 0.55. Constraint satisfied = True
dot(v1, v2) =  0.0005792953298950909
The minimum distance is 0.50. Constraint satisfied = True
dot(v1, v2) =  0.0
The minimum distance is 0.50. Constraint satisfied = True
dot(v1, v2) =  0.0
<figure><img src="/media/4776aa1f11411aa8cf0c3ea47f96e2a8973e314e.png"></figure> 
</p>

<p>
There is no wisdom in fixing the first problem, here I just tried a newer optimization method. Out of the box with default settings it just worked. I did learn the answer is sensitive to the initial guess, so it could make sense to sample the function and find the point that is closest as the initial guess, but here the simple heuristic guess I used worked fine.
</p>
<p>Copyright (C) 2023 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve.org">org-mode source</a></p>
<p>Org-mode version = 9.5.5</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Caching-expensive-function-calls-so-you-don-t-have-to-rerun-them"></div>
      <h2 class="blog_post_title"><a href="/blog/2023/02/01/Caching-expensive-function-calls-so-you-don-t-have-to-rerun-them/" rel="bookmark" title="Permanent Link to Caching expensive function calls so you don't have to rerun them">Caching expensive function calls so you don't have to rerun them</a></h2>
      <p><small><span class="blog_post_date">Posted February 01, 2023 at 08:09 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 01, 2023 at 08:11 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org07769a2">1. where things start to go wrong</a>
<ul>
<li><a href="#org45a5a5a">1.1. Global variables</a></li>
<li><a href="#org81a44de">1.2. running functions with mutable arguments</a></li>
<li><a href="#orgeecc951">1.3. If you run the same function different ways, the cache is not reused</a></li>
<li><a href="#orgb8d7f30">1.4. Fragile cache invalidation</a></li>
</ul>
</li>
<li><a href="#orgd5fbbc2">2. Some partial solutions with pycse.hashcache</a>
<ul>
<li><a href="#orge7c0587">2.1. No known problem with global variables</a></li>
<li><a href="#org857113f">2.2. hashcache and mutable arguments</a></li>
<li><a href="#org4925e4a">2.3. Reuse the cache when you run different ways</a></li>
<li><a href="#org8461f88">2.4. Insensitivity to unimportant changes</a></li>
</ul>
</li>
<li><a href="#orgfb0f2ed">3. Is it the answer?</a></li>
</ul>
</div>
</div>
<p>
Check out the video at:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Sp0qebuYsZU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>
Nobody likes to run expensive jobs more than necessary, so cache solutions are often used where you save the results, and look them up later. There is functools.cache in Python, but it is memory only, and not persistent, so you start over in a new session.
</p>

<p>
For persistent cache, joblib (<a href="https://joblib.readthedocs.io/en/latest/">https://joblib.readthedocs.io/en/latest/</a>) is a standard tool for this. Here is a simple example: 
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> joblib <span style="color: #0000FF;">import</span> Memory
<span style="color: #BA36A5;">location</span> = <span style="color: #008000;">'/Users/jkitchin/Dropbox/emacs/journal/2023/02/01/joblib_cache/joblib_cache'</span>
<span style="color: #BA36A5;">memory</span> = Memory(location, verbose=0)

<span style="color: #6434A3;">@memory.cache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">fun</span>(x=1.0):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee while it runs &#128012;.'</span>)
    <span style="color: #0000FF;">return</span> x**2

<span style="color: #006FE0;">print</span>(fun(2)) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Runs the function</span>
<span style="color: #006FE0;">print</span>(fun(2)) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Looks up the cached value</span>
</pre>
</div>

<p>
If you see this, go get a coffee while it runs üêå.
4
4
</p>

<p>
That works because joblib saves the results in a file in the location you specify.
</p>

<p>
Here is another example with another arg.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #6434A3;">@memory.cache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">f2</span>(x=1.0, a=3):
    <span style="color: #006FE0;">print</span>(f<span style="color: #008000;">'If you see this, go get a coffee while it runs. a=</span>{"&#128012;"*a}<span style="color: #008000;">'</span>)
    <span style="color: #0000FF;">return</span> a*x**2

(f2(2),       <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Runs function</span>
 f2(2, a=3),  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">calls cache</span>
 f2(2, 4))    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Runs another function because a changed</span>
</pre>
</div>

<p>
If you see this, go get a coffee while it runs. a=üêåüêåüêå
If you see this, go get a coffee while it runs. a=üêåüêåüêåüêå
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">12</td>
<td class="org-right">12</td>
<td class="org-right">16</td>
</tr>
</tbody>
</table>

<p>
Here, we look up from the cache each time.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python">(f2(2), f2(2, a=3), f2(2, 4))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">12</td>
<td class="org-right">12</td>
<td class="org-right">16</td>
</tr>
</tbody>
</table>


<div id="outline-container-org07769a2" class="outline-2">
<h2 id="org07769a2"><span class="section-number-2">1.</span> where things start to go wrong</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org45a5a5a" class="outline-3">
<h3 id="org45a5a5a"><span class="section-number-3">1.1.</span> Global variables</h3>
<div class="outline-text-3" id="text-1-1">
<p>
First, we look at an uncached version of a function that uses a global variable.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">a</span> = 3

<span style="color: #0000FF;">def</span> <span style="color: #006699;">f3</span>(x=1.0):
    <span style="color: #0000FF;">return</span> a*x**2

f3(2)
</pre>
</div>

<p>
12
</p>

<p>
We can change <code>a</code> and see the change.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">a</span>=0
f3(2)
</pre>
</div>

<p>
0
</p>

<p>
Now we look at a cached version.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">a</span> = 3
<span style="color: #6434A3;">@memory.cache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">f4</span>(x=1.0):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee while it runs &#128012;.'</span>)
    <span style="color: #0000FF;">return</span> a*x**2

(f4(2), f4(2), f4(2))
</pre>
</div>

<p>
If you see this, go get a coffee while it runs üêå.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">12</td>
<td class="org-right">12</td>
<td class="org-right">12</td>
</tr>
</tbody>
</table>

<p>
Changing the global variable does not change the cache though. uh oh. This is just wrong. The answers should clearly be 0. Incorrect cache invalidation strikes.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">a</span> = 0
(f4(2), f4(2), f4(2))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">12</td>
<td class="org-right">12</td>
<td class="org-right">12</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org81a44de" class="outline-3">
<h3 id="org81a44de"><span class="section-number-3">1.2.</span> running functions with mutable arguments</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Using mutable arguments is a recipe for trouble and unanticipated problems, but it is easy to unintentionally do, and not always obvious, as I show here.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> ase.build <span style="color: #0000FF;">import</span> bulk
<span style="color: #0000FF;">from</span> ase.calculators.emt <span style="color: #0000FF;">import</span> EMT

<span style="color: #BA36A5;">atoms</span> = bulk(<span style="color: #008000;">'Pd'</span>)
atoms.set_calculator(EMT())

<span style="color: #6434A3;">@memory.cache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">f</span>(atoms):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee.'</span>)
    <span style="color: #0000FF;">return</span> atoms.get_potential_energy()

(f(atoms), f(atoms))

</pre>
</div>

<p>
If you see this, go get a coffee.
If you see this, go get a coffee.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.0003422625372841992</td>
<td class="org-right">0.0003422625372841992</td>
</tr>
</tbody>
</table>

<p>
You can see this ran twice. The reason is that the atoms object was mutated by adding data onto it. Here is how I know:
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> joblib
<span style="color: #BA36A5;">atoms</span> = bulk(<span style="color: #008000;">'Pd'</span>)
atoms.set_calculator(EMT())
joblib.<span style="color: #006FE0;">hash</span>(atoms), atoms._calc.results
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">ee2ed2eb9fdb4b3d6416803a33f43a22</td>
<td class="org-left">nil</td>
</tr>
</tbody>
</table>

<p>
Here you can see that simply running the get energy function the hash changes because the results dictionary on the calculator changes. That means subsequent uses of the atoms object will have a different hash, and you cannot rely on that to look up the results. In this case the results should not change the output of the function, but since they are included in the hash, it incorrectly invalidates the hash.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python">atoms.get_potential_energy()
joblib.<span style="color: #006FE0;">hash</span>(atoms), atoms._calc.results
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">d37ef0a5761f499060b4f55bdf644814</td>
<td class="org-left">(energy : 0.0003422625372841992 energies : array ((0.00034226)) free_energy : 0.0003422625372841992 forces : array (((0 0 0))))</td>
</tr>
</tbody>
</table>

<p>
Suffice to say, this is non-obvious, but having seen it, not a surprise; mutable arguments are frequently a source of problems.
</p>
</div>
</div>

<div id="outline-container-orgeecc951" class="outline-3">
<h3 id="orgeecc951"><span class="section-number-3">1.3.</span> If you run the same function different ways, the cache is not reused</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Some aspects of this are specific to org-mode and how scripts are run in it. Here we have to use an absolute path to make sure we use the right cache. That still doesn't solve the problem though as we will see.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> joblib <span style="color: #0000FF;">import</span> Memory
<span style="color: #BA36A5;">location</span> = <span style="color: #008000;">'/Users/jkitchin/Dropbox/emacs/journal/2023/02/01/joblib_cache/joblib_cache'</span>
<span style="color: #BA36A5;">memory</span> = Memory(location, verbose=0)

a = 3
<span style="color: #6434A3;">@memory.cache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">f4</span>(x=1.0):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee while it runs'</span>)
    <span style="color: #0000FF;">return</span> a*x**2

<span style="color: #006FE0;">print</span>((f4(2), f4(2), f4(2)))
</pre>
</div>

<p>
The issue is that joblib uses the file name it thinks the function is from in the path it saves the results. The filename is different
</p>
</div>
</div>

<div id="outline-container-orgb8d7f30" class="outline-3">
<h3 id="orgb8d7f30"><span class="section-number-3">1.4.</span> Fragile cache invalidation</h3>
<div class="outline-text-3" id="text-1-4">
<p>
joblib uses the function source in its hash. That means <i>any</i> change to the source, including the function name, renaming variables, whitespace, comments or docstring changes invalidates the hash even though they may have no change in the output. That is an overabundance of caution, but simple to implement.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #6434A3;">@memory.cache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">f4</span>(x=1.0):
    <span style="color: #036A07;">'add a ds.'</span>
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">comment</span>
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee while it runs'</span>)
    <span style="color: #0000FF;">return</span> a*x**2

<span style="color: #006FE0;">print</span>((f4(2), f4(2), f4(2)))
</pre>
</div>

<p>
If you see this, go get a coffee while it runs
(0, 0, 0)
</p>
</div>
</div>
</div>


<div id="outline-container-orgd5fbbc2" class="outline-2">
<h2 id="orgd5fbbc2"><span class="section-number-2">2.</span> Some partial solutions with pycse.hashcache</h2>
<div class="outline-text-2" id="text-2">
<p>
I wrote <code>hashcache</code> to solve some of these problems. It is actually built on top of joblib.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> pycse
pycse.__version__, pycse.__file__
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2.2.1</td>
<td class="org-left">/Users/jkitchin/Dropbox/python/pycse/pycse/__init__.py</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> pycse.hashcache <span style="color: #0000FF;">import</span> hashcache
  
hashcache.<span style="color: #BA36A5;">location</span> = <span style="color: #008000;">"/Users/jkitchin/Dropbox/emacs/journal/2023/02/01/cache"</span>
hashcache.<span style="color: #BA36A5;">verbose</span> = <span style="color: #D0372D;">False</span>

<span style="color: #6434A3;">@hashcache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">h1</span>(x):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'This runs soo slow... Go get a coffee'</span>)
    <span style="color: #0000FF;">return</span> x**2

h1(2), h1(2)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">4</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orge7c0587" class="outline-3">
<h3 id="orge7c0587"><span class="section-number-3">2.1.</span> No known problem with global variables</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">a</span> = 3
<span style="color: #6434A3;">@hashcache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">h4</span>(x=1.0):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee while it runs'</span>)
    <span style="color: #0000FF;">return</span> a*x**2

(h4(2), h4(2), h4(2))

</pre>
</div>

<p>
If you see this, go get a coffee while it runs
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">12</td>
<td class="org-right">12</td>
<td class="org-right">12</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">a</span>=0
(h4(2), h4(2), h4(2))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>

<p>
Whew!!! we got the right answers. hashcache does a better job detecting the external change.
</p>
</div>
</div>

<div id="outline-container-org857113f" class="outline-3">
<h3 id="org857113f"><span class="section-number-3">2.2.</span> hashcache and mutable arguments</h3>
<div class="outline-text-3" id="text-2-2">
<p>
hashcache does not solve the mutable argument problem, but, it does warn you it detected it.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> ase.build <span style="color: #0000FF;">import</span> bulk
<span style="color: #0000FF;">from</span> ase.calculators.emt <span style="color: #0000FF;">import</span> EMT

<span style="color: #BA36A5;">atoms</span> = bulk(<span style="color: #008000;">'Pd'</span>)
atoms.set_calculator(EMT())

<span style="color: #6434A3;">@hashcache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">h</span>(atoms):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee.'</span>)
    <span style="color: #0000FF;">return</span> atoms.get_potential_energy()

(h(atoms), h(atoms), h(atoms))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.0003422625372841992</td>
<td class="org-right">0.0003422625372841992</td>
<td class="org-right">0.0003422625372841992</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org4925e4a" class="outline-3">
<h3 id="org4925e4a"><span class="section-number-3">2.3.</span> Reuse the cache when you run different ways</h3>
<div class="outline-text-3" id="text-2-3">
<p>
hashcache uses the same cache at the function and function environment level, so it avoids reruns even from different places. It is a judgement call by you to say if this is the right thing to do.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #006FE0;">print</span>(h1(2), h1(2))
</pre>
</div>

<p>
4 4
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> pycse.hashcache <span style="color: #0000FF;">import</span> hashcache
hashcache.<span style="color: #BA36A5;">location</span> = <span style="color: #008000;">"/Users/jkitchin/Dropbox/emacs/journal/2023/02/01/cache"</span>

<span style="color: #6434A3;">@hashcache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">h1</span>(x):
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'This runs soo slow... Go get a coffee'</span>)
    <span style="color: #0000FF;">return</span> x**2

<span style="color: #006FE0;">print</span>(h1(2), h1(2))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8461f88" class="outline-3">
<h3 id="org8461f88"><span class="section-number-3">2.4.</span> Insensitivity to unimportant changes</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Instead of hashing the source of the function, in hashcache I hash the bytecode instead. This is certainly less sensitive to unimportant changes like docstrings, comments or whitespace. I do use the function name in the hash, so even though that does not affect the output, I thought it might be confusing in the future.
</p>

<p>
Here, small changes like comments, docstrings, etc, don't affect the hash.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">a</span> = 3
<span style="color: #6434A3;">@hashcache</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">h4</span>(x=1.0):
    <span style="color: #036A07;">'doc string'</span>
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">comments</span>
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'If you see this, go get a coffee while it runs'</span>)
    <span style="color: #0000FF;">return</span> a*x**2    

(h4(2), h4(2), h4(2))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">12</td>
<td class="org-right">12</td>
<td class="org-right">12</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgfb0f2ed" class="outline-2">
<h2 id="orgfb0f2ed"><span class="section-number-2">3.</span> Is it the answer?</h2>
<div class="outline-text-2" id="text-3">
<p>
Probably not completely. It is almost certain I have not captured all the ways the cache should be invalidated, or when a new cache should be used. hashcache is for now, a proof of concept in understanding why this is a hard problem to solve. I prefer its behavior over the defaults in joblib so far though.
</p>
</div>
</div>
<p>Copyright (C) 2023 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2023/02/01/Caching-expensive-function-calls-so-you-don't-have-to-rerun-them.org">org-mode source</a></p>
<p>Org-mode version = 9.5.5</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2023/02/01/Caching-expensive-function-calls-so-you-don-t-have-to-rerun-them">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="2022-in-a-nutshell"></div>
      <h2 class="blog_post_title"><a href="/blog/2023/01/01/2022-in-a-nutshell/" rel="bookmark" title="Permanent Link to 2022 in a nutshell">2022 in a nutshell</a></h2>
      <p><small><span class="blog_post_date">Posted January 01, 2023 at 01:52 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/news/'>news</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org1ec64df">1. Research group accomplishments</a></li>
<li><a href="#orgd4c59e1">2. Publications</a></li>
<li><a href="#org00e82a2">3. Point Breeze Publishing, LLC</a></li>
<li><a href="#orgb58e56e">4. Outlook for 2023</a></li>
</ul>
</div>
</div>
<p>
2022 was an interesting one. I still did all of my teaching remotely, but spent more time going in to the office for meetings, and have gotten back to professional travel for meetings. 
</p>

<div id="outline-container-org1ec64df" class="outline-2">
<h2 id="org1ec64df"><span class="section-number-2">1.</span> Research group accomplishments</h2>
<div class="outline-text-2" id="text-1">
<p>
Minjie Liu and Yilin Yang both defended their PhDs and graduated in 2022. Luyang Liu, Ananya Srivastava and Karan Waghela all completed their MS degrees and graduated in 2022 also. Congratulations to all of them!
</p>

<p>
Maya Bhat and I participated in an iCorps workshop on a concept around design of experiments. 
</p>

<p>
We welcomed seven PhD students from the Ulissi group into the group while he is on leave at Meta. We also welcomed two new first year PhD students who will begin new collaborative projects with Carl Laird and Andy Gellman. The group is suddenly quite large!
</p>
</div>
</div>

<div id="outline-container-orgd4c59e1" class="outline-2">
<h2 id="orgd4c59e1"><span class="section-number-2">2.</span> Publications</h2>
<div class="outline-text-2" id="text-2">
<p>
Our work this past year was divided in a few efforts. We had some work in method development, e.g. in uncertainty quantification, automatic differentiation, and vector search.
</p>

<ol class="org-ol">
<li>Yang, Y., Achar, S. K., &amp; Kitchin, J. R. (2022). Evaluation of the degree of rate control via automatic differentiation. AIChE Journal, 68(6). <a href="http://dx.doi.org/10.1002/aic.17653">http://dx.doi.org/10.1002/aic.17653</a></li>
<li>Yang, Y., Liu, M., &amp; Kitchin, J. R. (2022). Neural network embeddings based similarity search method for atomistic systems. Digital Discovery. <a href="http://dx.doi.org/10.1039/d2dd00055e">http://dx.doi.org/10.1039/d2dd00055e</a></li>
<li>Zhan, N., &amp; Kitchin, J. R. (2022). Model-specific to model-general uncertainty for physical properties. Industrial &amp; Engineering Chemistry Research, 1‚Äì04706. <a href="http://dx.doi.org/10.1021/acs.iecr.1c04706">http://dx.doi.org/10.1021/acs.iecr.1c04706</a></li>
</ol>

<p>
This collaborative work on large catalyst models is was especially exciting. Stay tuned for many advances in this area in 2023.
</p>

<ol class="org-ol">
<li>Kolluru, A., Shuaibi, M., Palizhati, A., Shoghi, N., Das, A., Wood, B., Zitnick, C. L., ‚Ä¶ (2022). Open challenges in developing generalizable large-scale machine-learning models for catalyst discovery. ACS Catalysis, 12(14), 8572‚Äì8581. <a href="http://dx.doi.org/10.1021/acscatal.2c02291">http://dx.doi.org/10.1021/acscatal.2c02291</a></li>
</ol>

<p>
We also wrote some collaborative papers on our work in high-throughput discovery of hydrogen evolution catalysts and segregation.
</p>

<ol class="org-ol">
<li>Broderick, K., Lopato, E., Wander, B., Bernhard, S., Kitchin, J., &amp; Ulissi, Z. (2022). Identifying limitations in screening high-throughput photocatalytic bimetallic nanoparticles with machine-learned hydrogen adsorptions. Applied Catalysis B: Environmental, 121959. <a href="http://dx.doi.org/10.1016/j.apcatb.2022.121959">http://dx.doi.org/10.1016/j.apcatb.2022.121959</a></li>

<li>Bhat, M., Lopato, E., Simon, Z. C., Millstone, J. E., Bernhard, S., &amp; Kitchin, J. R. (2022). Accelerated optimization of pure metal and ligand compositions for light-driven hydrogen production. Reaction Chemistry &amp; Engineering. <a href="http://dx.doi.org/10.1039/d1re00441g">http://dx.doi.org/10.1039/d1re00441g</a></li>

<li>Yilin Yang, Zhitao Guo, Andrew Gellman and John Kitchin, Simulating segregation in a ternary Cu-Pd-Au alloy with density functional theory, machine learning and Monte Carlo simulations, J. Phys. Chem. C, 126, 4, 1800-1808. (2022). <a href="https://pubs.acs.org/doi/abs/10.1021/acs.jpcc.1c09647">https://pubs.acs.org/doi/abs/10.1021/acs.jpcc.1c09647</a></li>
</ol>

<p>
It was another big year in citations for us (<a href="https://scholar.google.com/citations?user=jD_4h7sAAAAJ">https://scholar.google.com/citations?user=jD_4h7sAAAAJ</a>)!
</p>

<p>
<figure><img src="/media/date-31-12-2022-time-12-35-28.png"></figure> 
</p>
</div>
</div>


<div id="outline-container-org00e82a2" class="outline-2">
<h2 id="org00e82a2"><span class="section-number-2">3.</span> Point Breeze Publishing, LLC</h2>
<div class="outline-text-2" id="text-3">
<p>
I started a publishing company this year <a href="https://pointbreezepubs.gumroad.com/">Point Breeze Publishing, LLC</a>. It is a way for me to sell booklets on using Python in Science and Engineering and to sustain the effort it takes to produce these. It has been a modest success so far, with about a dozen booklets that can help anyone get started from basic Python usage through data science and machine learning and design of experiments. For reading this, you can get 50% off all purchases with checkout code <code>2022-nutshell</code>. Check it out, and leave a review if you get anything! 
</p>

<p>
I am still working out what the next steps for this are. I have written most of the <code>pycse</code> content I had in mind now, 400+ pages of it. I would like to get these booklets in the hands of more students, and my stealthy advertising scheme on Twitter and YouTube has not made that happen yet. I have some ideas around molecular simulation, maybe a reboot of the DFT-book?, maybe something around scimax? Who knows, stay tuned!
</p>
</div>
</div>

<div id="outline-container-orgb58e56e" class="outline-2">
<h2 id="orgb58e56e"><span class="section-number-2">4.</span> Outlook for 2023</h2>
<div class="outline-text-2" id="text-4">
<p>
There will be lots of changes for the Kitchin Research Group in 2023. We had a massive growth at the end of 2022 as we welcomed many members of the Ulissi research group into our group while he is on leave at Meta for 2023. Last summer we had one PhD student and three MS students. Now we have 10 PhD students. That means we will start a lot of new research directions in large catalyst models and everything they enable. We have started several collaborations in the area of design of experiments, and look forward to seeing these grow. It should be exciting! 
</p>
</div>
</div>
<p>Copyright (C) 2023 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2023/01/01/2022-in-a-nutshell.org">org-mode source</a></p>
<p>Org-mode version = 9.5.5</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2023/01/01/2022-in-a-nutshell">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="New-publication-Identifying-limitations-in-screening-high-throughput-photocatalytic-bimetallic-nanoparticles-with-machine-learned-hydrogen-adsorptions"></div>
      <h2 class="blog_post_title"><a href="/blog/2022/09/29/New-publication-Identifying-limitations-in-screening-high-throughput-photocatalytic-bimetallic-nanoparticles-with-machine-learned-hydrogen-adsorptions/" rel="bookmark" title="Permanent Link to New publication - Identifying limitations in screening high-throughput photocatalytic bimetallic nanoparticles with machine-learned hydrogen adsorptions">New publication - Identifying limitations in screening high-throughput photocatalytic bimetallic nanoparticles with machine-learned hydrogen adsorptions</a></h2>
      <p><small><span class="blog_post_date">Posted September 29, 2022 at 05:23 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/news/'>news</a>, <a href='/blog/category/publication/'>publication</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Hydrogen adsorption energies have long been used in screening to identify promising hydrogen evolution catalysts. In this work we combine a high-throughput experimental study of 5300 different bimetallic catalysts with a high-throughput computational screen of 16M adsorption energies to see how well adsorption energies work for this purpose. We developed a workflow to combine these data sets that accounts for surface stability and adsorption site distributions on alloy surfaces. We find that thermodynamically favorable adsorption energies are necessary to observe high activity, but they are not sufficient, and do not always lead to high activity.  
</p>

<div class="org-src-container">
<pre class="src src-bibtex"><span style="color: #006699;">@article</span>{<span style="color: #D0372D;">broderick-2022-ident-limit</span>,
  <span style="color: #BA36A5;">author</span> = {Kirby Broderick and Eric Lopato and Brook Wander and Stefan Bernhard and John Kitchin and Zachary Ulissi},
  <span style="color: #BA36A5;">title</span> = {Identifying Limitations in Screening High-Throughput Photocatalytic Bimetallic Nanoparticles With Machine-Learned Hydrogen Adsorptions},
  <span style="color: #BA36A5;">journal</span> = {Applied Catalysis B: Environmental},
  <span style="color: #BA36A5;">volume</span> = {nil},
  <span style="color: #BA36A5;">number</span> = {nil},
  <span style="color: #BA36A5;">pages</span> = {121959},
  <span style="color: #BA36A5;">year</span> = {2022},
  <span style="color: #BA36A5;">doi</span> = {<span style="color: #006DAF; text-decoration: underline;">10.1016/j.apcatb.2022.121959</span>},
  <span style="color: #BA36A5;">url</span> = {<span style="color: #006DAF; text-decoration: underline;">http://dx.doi.org/10.1016/j.apcatb.2022.121959</span>},
  <span style="color: #BA36A5;">DATE_ADDED</span> = {Thu Sep 22 07:46:56 2022},
}
</pre>
</div>

<p>
<script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>
<div data-badge-type='medium-donut' class='altmetric-embed' data-badge-details='right' data-doi='10.1016/j.apcatb.2022.12195'></div>
9
</p>
<p>Copyright (C) 2022 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2022/09/29/New-publication---Identifying-limitations-in-screening-high-throughput-photocatalytic-bimetallic-nanoparticles-with-machine-learned-hydrogen-adsorptions.org">org-mode source</a></p>
<p>Org-mode version = 9.5.1</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2022/09/29/New-publication-Identifying-limitations-in-screening-high-throughput-photocatalytic-bimetallic-nanoparticles-with-machine-learned-hydrogen-adsorptions">Discuss on Twitter</a>

  <hr class="interblog" />
 <a href="/blog/page/2">Next Page ¬ª</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2023/02/25/MS-Word-comments-from-org-mode/">MS Word comments from org-mode</a></li>
      <li><a href="/blog/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve/">Update on finding the minimum distance from a point to a curve</a></li>
      <li><a href="/blog/2023/02/01/Caching-expensive-function-calls-so-you-don-t-have-to-rerun-them/">Caching expensive function calls so you don't have to rerun them</a></li>
      <li><a href="/blog/2023/01/01/2022-in-a-nutshell/">2022 in a nutshell</a></li>
      <li><a href="/blog/2022/09/29/New-publication-Identifying-limitations-in-screening-high-throughput-photocatalytic-bimetallic-nanoparticles-with-machine-learned-hydrogen-adsorptions/">New publication - Identifying limitations in screening high-throughput photocatalytic bimetallic nanoparticles with machine-learned hydrogen adsorptions</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2023
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



