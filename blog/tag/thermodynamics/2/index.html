

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition/" rel="bookmark" title="Permanent Link to The Gibbs free energy of a reacting mixture and the equilibrium composition">The Gibbs free energy of a reacting mixture and the equilibrium composition</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a></span> | tags: <a href='/blog/tag/reaction-engineering/'>reaction engineering</a>, <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/18/The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated September 10, 2014 at 12:21 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Summary</a></li>
</ul>
</div>
</div>
<p>
<a href="http://matlab.cheme.cmu.edu/2011/12/20/the-gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition/">Matlab post</a> 
</p>

<p>
In this post we derive the equations needed to find the equilibrium composition of a reacting mixture. We use the method of direct minimization of the Gibbs free energy of the reacting mixture.
</p>

<p>
The Gibbs free energy of a mixture is defined as \(G = \sum\limits_j \mu_j n_j\) where \(\mu_j\) is the chemical potential of species \(j\), and it is temperature and pressure dependent, and \(n_j\) is the number of moles of species \(j\).
</p>

<p>
We define the chemical potential as \(\mu_j = G_j^\circ + RT\ln a_j\), where \(G_j^\circ\) is the Gibbs energy in a standard state, and \(a_j\) is the activity of species \(j\) if the pressure and temperature are not at standard state conditions.
</p>

<p>
If a reaction is occurring, then the number of moles of each species are related to each other through the reaction extent \(\epsilon\) and stoichiometric coefficients: \(n_j = n_{j0} + \nu_j \epsilon\). Note that the reaction extent has units of moles.
</p>

<p>
Combining these three equations and expanding the terms leads to:
</p>

<p>
$$G = \sum\limits_j n_{j0}G_j^\circ +\sum\limits_j \nu_j G_j^\circ \epsilon +RT\sum\limits_j(n_{j0} + \nu_j\epsilon)\ln a_j $$
</p>

<p>
The first term is simply the initial Gibbs free energy that is present before any reaction begins, and it is a constant. It is difficult to evaluate, so we will move it to the left side of the equation in the next step, because it does not matter what its value is since it is a constant. The second term is related to the Gibbs free energy of reaction: \(\Delta_rG = \sum\limits_j \nu_j G_j^\circ\). With these observations we rewrite the equation as:
</p>

<p>
$$G - \sum\limits_j n_{j0}G_j^\circ = \Delta_rG \epsilon +RT\sum\limits_j(n_{j0} + \nu_j\epsilon)\ln a_j $$
</p>

<p>
Now, we have an equation that allows us to compute the change in Gibbs free energy as a function of the reaction extent, initial number of moles of each species, and the activities of each species. This difference in Gibbs free energy has no natural scale, and depends on the size of the system, i.e. on \(n_{j0}\). It is desirable to avoid this, so we now rescale the equation by the total initial moles present, \(n_{T0}\) and define a new variable \(\epsilon' = \epsilon/n_{T0}\), which is dimensionless. This leads to:
</p>

<p>
$$ \frac{G - \sum\limits_j n_{j0}G_j^\circ}{n_{T0}} = \Delta_rG \epsilon' + RT \sum\limits_j(y_{j0} + \nu_j\epsilon')\ln a_j $$
</p>

<p>
where \(y_{j0}\) is the initial mole fraction of species \(j\) present. The mole fractions are intensive properties that do not depend on the system size. Finally, we need to address \(a_j\). For an ideal gas, we know that \(A_j = \frac{y_j P}{P^\circ}\), where the numerator is the partial pressure of species \(j\) computed from the mole fraction of species \(j\) times the total pressure. To get the mole fraction we note:
</p>

<p>
$$y_j = \frac{n_j}{n_T} = \frac{n_{j0} + \nu_j \epsilon}{n_{T0} + \epsilon \sum\limits_j \nu_j} = \frac{y_{j0} + \nu_j \epsilon'}{1 + \epsilon'\sum\limits_j \nu_j} $$
</p>

<p>
This finally leads us to an equation that we can evaluate as a function of reaction extent:
</p>

<p>
$$ \frac{G - \sum\limits_j n_{j0}G_j^\circ}{n_{T0}} = \widetilde{\widetilde{G}} = \Delta_rG \epsilon' + RT\sum\limits_j(y_{j0} + \nu_j\epsilon') \ln\left(\frac{y_{j0}+\nu_j\epsilon'}{1+\epsilon'\sum\limits_j\nu_j} \frac{P}{P^\circ}\right) $$
</p>

<p>
we use a double tilde notation to distinguish this quantity from the quantity derived by Rawlings and Ekerdt which is further normalized by a factor of \(RT\). This additional scaling makes the quantities dimensionless, and makes the quantity have a magnitude of order unity, but otherwise has no effect on the shape of the graph.
</p>

<p>
Finally, if we know the initial mole fractions, the initial total pressure, the Gibbs energy of reaction, and the stoichiometric coefficients, we can plot the scaled reacting mixture energy as a function of reaction extent. At equilibrium, this energy will be a minimum. We consider the example in Rawlings and Ekerdt where isobutane (I) reacts with 1-butene (B) to form 2,2,3-trimethylpentane (P). The reaction occurs at a total pressure of 2.5 atm at 400K, with equal molar amounts of I and B. The standard Gibbs free energy of reaction at 400K is -3.72 kcal/mol. Compute the equilibrium composition.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">R</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">8</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">314</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">P</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">250000</span>  # <span style="color: #ff0000; font-weight: bold;">Pa</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">P0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">100000</span> # <span style="color: #ff0000; font-weight: bold;">Pa, approximately 1 atm</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">T</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">400</span> # <span style="color: #ff0000; font-weight: bold;">K</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">Grxn</span> = -<span style="color: #000000; background-color: #cccccc; font-weight: bold;">15564</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span> #<span style="color: #ff0000; font-weight: bold;">J/mol</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">yi0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>; <span style="color: #000000; background-color: #cccccc; font-weight: bold;">yb0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>; <span style="color: #000000; background-color: #cccccc; font-weight: bold;">yp0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>; # <span style="color: #ff0000; font-weight: bold;">initial mole fractions</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">yj0</span> = np.array([yi0, yb0, yp0])
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">nu_j</span> = np.array([-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, -<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>])   # <span style="color: #ff0000; font-weight: bold;">stoichiometric coefficients</span>

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">Gwigglewiggle</span>(extentp):
    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">diffg</span> = Grxn * extentp
    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">sum_nu_j</span> = np.sum(nu_j)
    <span style="color: #8b0000;">for</span> i,y <span style="color: #8b0000;">in</span><span style="color: #cd0000;"> enumerate</span>(yj0):
        <span style="color: #000000; background-color: #cccccc; font-weight: bold;">x1</span> = yj0[i] + nu_j[i] * extentp
        <span style="color: #000000; background-color: #cccccc; font-weight: bold;">x2</span> = x1 / (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span> + extentp*sum_nu_j)
        <span style="color: #000000; background-color: #cccccc; font-weight: bold;">diffg</span> += R * T * x1 * np.log(x2 * P / P0)
    <span style="color: #8b0000;">return</span> diffg
</pre>
</div>

<p>
There are bounds on how large \(\epsilon'\) can be. Recall that \(n_j = n_{j0} + \nu_j \epsilon\), and that \(n_j \ge 0\). Thus, \(\epsilon_{max} = -n_{j0}/\nu_j\), and the maximum value that \(\epsilon'\) can have is therefore \(-y_{j0}/\nu_j\) where \(y_{j0}>0\). When there are multiple species, you need the smallest \(epsilon'_{max}\) to avoid getting negative mole numbers.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #000000; background-color: #cccccc; font-weight: bold;">epsilonp_max</span> =<span style="color: #cd0000;"> min</span>(-yj0[yj0 &gt; <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>] / nu_j[yj0 &gt; <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>])
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">epsilonp</span> = np.linspace(1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>, epsilonp_max, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1000</span>);

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

plt.plot(epsilonp,Gwigglewiggle(epsilonp))
plt.xlabel(<span style="color: #228b22;">'$\epsilon$'</span>)
plt.ylabel(<span style="color: #228b22;">'Gwigglewiggle'</span>)
plt.savefig(<span style="color: #228b22;">'images/gibbs-minim-1.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; __main__:7: RuntimeWarning: divide by zero encountered in log
__main__:7: RuntimeWarning: invalid value encountered in multiply
[&lt;matplotlib.lines.Line2D object at 0x10b1c7710&gt;]
&lt;matplotlib.text.Text object at 0x10b1c3d10&gt;
&lt;matplotlib.text.Text object at 0x10b1c9b90&gt;
</pre>


<div class="figure">
<p><img src="/media/2013-02-18-The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition/gibbs-minim-1.png"> 
</p>
</div>

<p>
Now we simply minimize our Gwigglewiggle function. Based on the figure above, the miminum is near 0.45.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fminbound

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">epsilonp_eq</span> = fminbound(Gwigglewiggle, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>)
<span style="color: #8b0000;">print</span> epsilonp_eq

plt.plot([epsilonp_eq], [Gwigglewiggle(epsilonp_eq)], <span style="color: #228b22;">'ro'</span>)
plt.savefig(<span style="color: #228b22;">'images/gibbs-minim-2.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; 0.46959618249
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x10d4d3e50&gt;]
</pre>


<div class="figure">
<p><img src="/media/2013-02-18-The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition/gibbs-minim-2.png"> 
</p>
</div>

<p>
To compute equilibrium mole fractions we do this:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #000000; background-color: #cccccc; font-weight: bold;">yi</span> = (yi0 + nu_j[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>]*epsilonp_eq) / (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span> + epsilonp_eq*np.sum(nu_j))
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">yb</span> = (yb0 + nu_j[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]*epsilonp_eq) / (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span> + epsilonp_eq*np.sum(nu_j))
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">yp</span> = (yp0 + nu_j[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>]*epsilonp_eq) / (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span> + epsilonp_eq*np.sum(nu_j))

<span style="color: #8b0000;">print</span> yi, yb, yp

# <span style="color: #ff0000; font-weight: bold;">or this</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y_j</span> = (yj0 + np.dot(nu_j, epsilonp_eq)) / (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span> + epsilonp_eq*np.sum(nu_j))
<span style="color: #8b0000;">print</span> y_j
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.0573220186324 0.0573220186324 0.885355962735
&gt;&gt;&gt; ... &gt;&gt;&gt; [ 0.05732202  0.05732202  0.88535596]
</pre>

<p>
\(K = \frac{a_P}{a_I a_B} = \frac{y_p P/P^\circ}{y_i P/P^\circ y_b P/P^\circ} = \frac{y_P}{y_i y_b}\frac{P^\circ}{P}\).
</p>

<p>
We can express the equilibrium constant like this :\(K = \prod\limits_j a_j^{\nu_j}\), and compute it with a single line of code.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #000000; background-color: #cccccc; font-weight: bold;">K</span> = np.exp(-Grxn/R/T)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'K from delta G '</span>,K
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'K as ratio of mole fractions '</span>,yp / (yi * yb) * P0 / P
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'compact notation: '</span>,np.prod((y_j * P / P0)**nu_j)
</pre>
</div>

<pre class="example">
K from delta G  107.776294742
K as ratio of mole fractions  107.779200065
compact notation:  107.779200065
</pre>


<p>
These results are very close, and only disagree because of the default tolerance used in identifying the minimum of our function. You could tighten the tolerances by setting options to the fminbnd function.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Summary</h2>
<div class="outline-text-2" id="text-1">
<p>
In this post we derived an equation for the Gibbs free energy of a reacting mixture and used it to find the equilibrium composition. In future posts we will examine some alternate forms of the equations that may be more useful in some circumstances.</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="The-equal-area-method-for-the-van-der-Waals-equation"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation/" rel="bookmark" title="Permanent Link to The equal area method for the van der Waals equation">The equal area method for the van der Waals equation</a></h2>
      <p><small><span class="blog_post_date">Posted February 15, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/plotting/'>plotting</a></span> | tags: <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated September 25, 2013 at 09:13 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Compute areas</a></li>
</ul>
</div>
</div>
<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/11/the-equal-area-method-for-the-van-der-waals-equation/">Matlab post</a> 
</p>

<p>
When a gas is below its Tc the van der Waal equation oscillates. In the portion of the isotherm where \(\partial P_R/\partial V_r > 0\), the isotherm fails to describe real materials, which phase separate into a liquid and gas in this region.
</p>

<p>
Maxwell proposed to replace this region by a flat line, where the area above and below the curves are equal. Today, we examine how to identify where that line should be.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b008b;">Tr</span> = 0.9 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">A Tr below Tc:  Tr = T/Tc</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">analytical equation for Pr. This is the reduced form of the van der Waal</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">equation.</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">Prfh</span>(Vr):
    <span style="color: #8b0000;">return</span>  8.0 / 3.0 * Tr / (Vr - 1.0 / 3.0) - 3.0 / (Vr**2)

<span style="color: #8b008b;">Vr</span> = np.linspace(0.5, 4, 100)  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">vector of reduced volume</span>
<span style="color: #8b008b;">Pr</span> = Prfh(Vr)                 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">vector of reduced pressure</span>

plt.plot(Vr,Pr)
plt.ylim([0, 2])
plt.xlabel(<span style="color: #228b22;">'$V_R$'</span>)
plt.ylabel(<span style="color: #228b22;">'$P_R$'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-1.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x042FDAF0&gt;]
(0, 2)
&lt;matplotlib.text.Text object at 0x04237CB0&gt;
&lt;matplotlib.text.Text object at 0x042DC030&gt;
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-1.png"><p>
</p>
</div>

<p>
The idea is to pick a Pr and draw a line through the EOS. We want the areas between the line and EOS to be equal on each side of the middle intersection. Let us draw a line on the figure at y = 0.65.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">y</span> = 0.65

plt.plot([0.5, 4.0], [y, y], <span style="color: #228b22;">'k--'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-2.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x042FDCD0&gt;]
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-2.png"><p>
</p>
</div>

<p>
To find the areas, we need to know where the intersection of the vdW eqn with the horizontal line. This is the same as asking what are the roots of the vdW equation at that Pr. We need all three intersections so we can integrate from the first root to the middle root, and then the middle root to the third root. We take advantage of the polynomial nature of the vdW equation, which allows us to use the roots command to get all the roots at once. The polynomial is \(V_R^3 - \frac{1}{3}(1+8 T_R/P_R) + 3/P_R - 1/P_R = 0\). We use the coefficients t0 get the roots like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">vdWp</span> = [1.0, -1. / 3.0 * (1.0 + 8.0 * Tr / y), 3.0 / y, - 1.0 / y]
<span style="color: #8b008b;">v</span> = np.roots(vdWp)
v.sort()
<span style="color: #8b0000;">print</span> v

plt.plot(v[0], y, <span style="color: #228b22;">'bo'</span>, v[1], y, <span style="color: #228b22;">'bo'</span>, v[2], y, <span style="color: #228b22;">'bo'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-3.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [ 0.60286812  1.09743234  2.32534056]
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x0439C570&gt;, &lt;matplotlib.lines.Line2D object at 0x043933B0&gt;, &lt;matplotlib.lines.Line2D object at 0x04393CB0&gt;]
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-3.png"><p>
</p>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Compute areas</h2>
<div class="outline-text-2" id="text-1">
<p>
for A1, we need the area under the line minus the area under the vdW curve. That is the area between the curves. For A2, we want the area under the vdW curve minus the area under the line. The area under the line between root 2 and root 1 is just the width (root2 - root1)*y
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b008b;">A1</span>, <span style="color: #8b008b;">e1</span> = (v[1] - v[0]) * y - quad(Prfh,  v[0], v[1])
<span style="color: #8b008b;">A2</span>, <span style="color: #8b008b;">e2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1])* y 

<span style="color: #8b0000;">print</span> A1, A2
<span style="color: #8b0000;">print</span> e1, e2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">interesting these look so large</span>
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.063225945606 0.0580212098122
0.321466743765 -0.798140339268
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">equal_area</span>(y):
    <span style="color: #8b008b;">Tr</span> = 0.9
    <span style="color: #8b008b;">vdWp</span> = [1, -1.0 / 3 * ( 1.0 + 8.0 * Tr / y), 3.0 / y,  -1.0 / y]
    <span style="color: #8b008b;">v</span> = np.roots(vdWp)
    v.sort()
    <span style="color: #8b008b;">A1</span> = (v[1] - v[0]) * y - quad(Prfh, v[0], v[1])
    <span style="color: #8b008b;">A2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1]) * y
    <span style="color: #8b0000;">return</span>  A1 - A2

y_eq, = fsolve(equal_area, 0.65)
<span style="color: #8b0000;">print</span> y_eq

<span style="color: #8b008b;">Tr</span> = 0.9
<span style="color: #8b008b;">vdWp</span> = [1, -1.0 / 3 * ( 1.0 + 8.0 * Tr / y_eq), 3.0 / y_eq,  -1.0 / y_eq]
<span style="color: #8b008b;">v</span> = np.roots(vdWp)
v.sort()

<span style="color: #8b008b;">A1</span>, <span style="color: #8b008b;">e1</span> = (v[1] - v[0]) * y_eq - quad(Prfh,  v[0], v[1])
<span style="color: #8b008b;">A2</span>, <span style="color: #8b008b;">e2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1]) * y_eq

<span style="color: #8b0000;">print</span> A1, A2
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; ... ... ... ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; 0.646998351872
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.0617526473994 0.0617526473994
</pre>

<p>
Now let us plot the equal areas and indicate them by shading.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">fig</span> = plt.gcf()
<span style="color: #8b008b;">ax</span> = fig.add_subplot(111)

ax.plot(Vr,Pr)

<span style="color: #8b008b;">hline</span> = np.ones(Vr.size) * y_eq

ax.plot(Vr, hline)
ax.fill_between(Vr, hline, Pr, where=(Vr &gt;= v[0]) &amp; (Vr &lt;= v[1]), facecolor=<span style="color: #228b22;">'gray'</span>)
ax.fill_between(Vr, hline, Pr, where=(Vr &gt;= v[1]) &amp; (Vr &lt;= v[2]), facecolor=<span style="color: #228b22;">'gray'</span>)

plt.text(v[0], 1, <span style="color: #228b22;">'A1 = {0}'</span>.<span style="color: #cd0000;">format</span>(A1))
plt.text(v[2], 1, <span style="color: #228b22;">'A2 = {0}'</span>.<span style="color: #cd0000;">format</span>(A2))
plt.xlabel(<span style="color: #228b22;">'$V_R$'</span>)
plt.ylabel(<span style="color: #228b22;">'$P_R$'</span>)
plt.title(<span style="color: #228b22;">'$T_R$ = 0.9'</span>)

plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-4.png'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-4.svg'</span>)
</pre>
</div>


<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043939D0&gt;]
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043A7230&gt;]
&lt;matplotlib.collections.PolyCollection object at 0x047ADE70&gt;
&lt;matplotlib.collections.PolyCollection object at 0x047ADAB0&gt;
&gt;&gt;&gt; &lt;matplotlib.text.Text object at 0x0438E730&gt;
&lt;matplotlib.text.Text object at 0x047B7930&gt;
&lt;matplotlib.text.Text object at 0x04237CB0&gt;
&lt;matplotlib.text.Text object at 0x042DC030&gt;
&lt;matplotlib.text.Text object at 0x042EBCD0&gt;
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-4.png"><p></p>
</div>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Constrained-minimization-to-find-equilibrium-compositions"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/05/Constrained-minimization-to-find-equilibrium-compositions/" rel="bookmark" title="Permanent Link to Constrained minimization to find equilibrium compositions">Constrained minimization to find equilibrium compositions</a></h2>
      <p><small><span class="blog_post_date">Posted February 05, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a></span> | tags: <a href='/blog/tag/reaction-engineering/'>reaction engineering</a>, <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/05/Constrained-minimization-to-find-equilibrium-compositions#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated April 04, 2016 at 01:35 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
adapated from Chemical Reactor analysis and design fundamentals, Rawlings and Ekerdt, appendix A.2.3.
</p>

<p>
<a href="http://matlab.cheme.cmu.edu/2011/08/12/constrained-minimization-to-find-equilibrium-compositions/">Matlab post</a> 
</p>

<p>
The equilibrium composition of a reaction is the one that minimizes the total Gibbs free energy. The Gibbs free energy of a reacting ideal gas mixture depends on the mole fractions of each species, which are determined by the initial mole fractions of each species, the extent of reactions that convert each species, and the equilibrium constants.
</p>

<p>
Reaction 1: \(I + B \rightleftharpoons P1\)
</p>

<p>
Reaction 2: \(I + B \rightleftharpoons P2\)
</p>

<p>
Here we define the Gibbs free energy of the mixture as a function of the reaction extents.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #0000FF;">def</span> <span style="color: #006699;">gibbs</span>(E):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">'function defining Gibbs free energy as a function of reaction extents'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e1</span> = E[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e2</span> = E[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">known equilibrium constants and initial amounts</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">K1</span> = 108; <span style="color: #BA36A5;">K2</span> = 284; <span style="color: #BA36A5;">P</span> = 2.5
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yI0</span> = 0.5; <span style="color: #BA36A5;">yB0</span> = 0.5; <span style="color: #BA36A5;">yP10</span> = 0.0; <span style="color: #BA36A5;">yP20</span> = 0.0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute mole fractions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">d</span> = 1 - e1 - e2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yI</span> = (yI0 - e1 - e2) / d
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yB</span> = (yB0 - e1 - e2) / d
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yP1</span> = (yP10 + e1) / d
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yP2</span> = (yP20 + e2) / d
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">G</span> = (-(e1 * np.log(K1) + e2 * np.log(K2)) +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>d * np.log(P) + yI * d * np.log(yI) +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>yB * d * np.log(yB) + yP1 * d * np.log(yP1) + yP2 * d * np.log(yP2))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> G
</pre>
</div>

<p>
The equilibrium constants for these reactions are known, and we seek to find the equilibrium reaction extents so we can determine equilibrium compositions. The equilibrium reaction extents are those that minimize the Gibbs free energy.  We have the following constraints, written in standard less than or equal to form:
</p>

<p>
\(-\epsilon_1 \le 0\)
</p>

<p>
\(-\epsilon_2 \le 0\)
</p>

<p>
\(\epsilon_1 + \epsilon_2 \le 0.5\)
</p>

<p>
In Matlab we express this in matrix form as Ax=b where
</p>
\begin{equation}
A = \left[ \begin{array}{cc} -1 & 0 \\ 0 & -1 \\ 1 & 1 \end{array} \right]
\end{equation}

<p>
and
</p>

\begin{equation}
b = \left[ \begin{array}{c} 0 \\ 0 \\ 0.5\end{array} \right]
\end{equation}

<p>
Unlike in Matlab, in python we construct the inequality constraints as functions that are greater than or equal to zero when the constraint is met.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">constraint1</span>(E):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e1</span> = E[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> e1


<span style="color: #0000FF;">def</span> <span style="color: #006699;">constraint2</span>(E):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e2</span> = E[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> e2


<span style="color: #0000FF;">def</span> <span style="color: #006699;">constraint3</span>(E):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e1</span> = E[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e2</span> = E[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> 0.5 - (e1 + e2)
</pre>
</div>

<p>
Now, we minimize.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fmin_slsqp

<span style="color: #BA36A5;">X0</span> = [0.2, 0.2]
<span style="color: #BA36A5;">X</span> = fmin_slsqp(gibbs, X0, ieqcons=[constraint1, constraint2, constraint3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  bounds=((0.001, 0.499),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (0.001, 0.499)))
<span style="color: #0000FF;">print</span>(X)

<span style="color: #0000FF;">print</span>(gibbs(X))
</pre>
</div>

<pre class="example">
Optimization terminated successfully.    (Exit mode 0)
            Current function value: -2.55942394906
            Iterations: 7
            Function evaluations: 31
            Gradient evaluations: 7
[ 0.13336503  0.35066486]
-2.55942394906
</pre>



<p>
One way we can verify our solution is to plot the gibbs function and see where the minimum is, and whether there is more than one minimum. We start by making grids over the range of 0 to 0.5. Note we actually start slightly above zero because at zero there are some numerical imaginary elements of the gibbs function or it is numerically not defined since there are logs of zero there. We also set all elements where the sum of the two extents is greater than 0.5 to near zero, since those regions violate the constraints.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #0000FF;">def</span> <span style="color: #006699;">gibbs</span>(E):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">'function defining Gibbs free energy as a function of reaction extents'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e1</span> = E[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e2</span> = E[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">known equilibrium constants and initial amounts</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">K1</span> = 108; <span style="color: #BA36A5;">K2</span> = 284; <span style="color: #BA36A5;">P</span> = 2.5;
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yI0</span> = 0.5; <span style="color: #BA36A5;">yB0</span> = 0.5; <span style="color: #BA36A5;">yP10</span> = 0.0; <span style="color: #BA36A5;">yP20</span> = 0.0;
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute mole fractions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">d</span> = 1 - e1 - e2;
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yI</span> = (yI0 - e1 - e2)/d;
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yB</span> = (yB0 - e1 - e2)/d;
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yP1</span> = (yP10 + e1)/d;
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yP2</span> = (yP20 + e2)/d;
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">G</span> = (-(e1 * np.log(K1) + e2 * np.log(K2)) +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>d * np.log(P) + yI * d * np.log(yI) +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>yB * d * np.log(yB) + yP1 * d * np.log(yP1) + yP2 * d * np.log(yP2))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> G


<span style="color: #BA36A5;">a</span> = np.linspace(0.001, 0.5, 100)
<span style="color: #BA36A5;">E1</span>, <span style="color: #BA36A5;">E2</span> = np.meshgrid(a,a)

<span style="color: #BA36A5;">sumE</span> = E1 + E2
<span style="color: #BA36A5;">E1</span>[sumE &gt;= 0.5] = 0.00001
<span style="color: #BA36A5;">E2</span>[sumE &gt;= 0.5] = 0.00001

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now evaluate gibbs</span>
<span style="color: #BA36A5;">G</span> = np.zeros(E1.shape)
<span style="color: #BA36A5;">m</span>,<span style="color: #BA36A5;">n</span> = E1.shape

<span style="color: #BA36A5;">G</span> = gibbs([E1, E2])

<span style="color: #BA36A5;">CS</span> = plt.contour(E1, E2, G, levels=np.linspace(G.<span style="color: #006FE0;">min</span>(),G.<span style="color: #006FE0;">max</span>(),100))
plt.xlabel(<span style="color: #008000;">'$\epsilon_1$'</span>)
plt.ylabel(<span style="color: #008000;">'$\epsilon_2$'</span>)
plt.colorbar()

plt.plot([0.13336503],  [0.35066486], <span style="color: #008000;">'ro'</span>)

plt.savefig(<span style="color: #008000;">'images/gibbs-minimization-1.png'</span>)
plt.savefig(<span style="color: #008000;">'images/gibbs-minimization-1.svg'</span>)
plt.show()
</pre>
</div>


<div class="figure">
<p><img src="/media/2013-02-05-Constrained-minimization-to-find-equilibrium-compositions/gibbs-minimization-1.png"> 
</p>
</div>

<p>
You can see we found the minimum. We can compute the mole fractions pretty easily.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">e1</span> = X[0];
<span style="color: #BA36A5;">e2</span> = X[1];

<span style="color: #BA36A5;">yI0</span> = 0.5; <span style="color: #BA36A5;">yB0</span> = 0.5; <span style="color: #BA36A5;">yP10</span> = 0; <span style="color: #BA36A5;">yP20</span> = 0; <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">initial mole fractions</span>

<span style="color: #BA36A5;">d</span> = 1 - e1 - e2;
<span style="color: #BA36A5;">yI</span> = (yI0 - e1 - e2) / d
<span style="color: #BA36A5;">yB</span> = (yB0 - e1 - e2) / d
<span style="color: #BA36A5;">yP1</span> = (yP10 + e1) / d
<span style="color: #BA36A5;">yP2</span> = (yP20 + e2) / d

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'y_I = {0:1.3f} y_B = {1:1.3f} y_P1 = {2:1.3f} y_P2 = {3:1.3f}'</span>.<span style="color: #006FE0;">format</span>(yI,yB,yP1,yP2))
</pre>
</div>

<pre class="example">
y_I = 0.031 y_B = 0.031 y_P1 = 0.258 y_P2 = 0.680
</pre>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> summary</h2>
<div class="outline-text-2" id="text-1">
<p>
I found setting up the constraints in this example to be more confusing than the Matlab syntax.</p>
</div>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2013/02/05/Constrained-minimization-to-find-equilibrium-compositions.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/05/Constrained-minimization-to-find-equilibrium-compositions#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Estimating-the-boiling-point-of-water"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/04/Estimating-the-boiling-point-of-water/" rel="bookmark" title="Permanent Link to Estimating the boiling point of water">Estimating the boiling point of water</a></h2>
      <p><small><span class="blog_post_date">Posted February 04, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/uncategorized/'>uncategorized</a></span> | tags: <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/04/Estimating-the-boiling-point-of-water#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 04:30 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2012/01/01/estimating-the-boiling-point-of-water/" >Matlab post</a>
</p>

<p>
I got distracted looking for Shomate parameters for ethane today, and came across this <a href="http://senese.wordpress.com/2010/01/26/notebook-3-2-predicting-boiling-points-from-liquidvapor-gibbs-free-energy-functions/" >website</a> on predicting the boiling point of water using the Shomate equations. The basic idea is to find the temperature where the Gibbs energy of water as a vapor is equal to the Gibbs energy of the liquid.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
</pre>
</div>

<p>
Liquid water (\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&Units=SI&Mask=2#Thermo-Condensed})
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># valid over 298-500</span>

Hf_liq = -285.830   <span style="color: #ff0000; font-weight: bold;"># kJ/mol</span>
S_liq = 0.06995     <span style="color: #ff0000; font-weight: bold;"># kJ/mol/K</span>
shomateL = [-203.6060,
            1523.290,
           -3196.413,
            2474.455,
               3.855326,
            -256.5478,
            -488.7163,
            -285.8304]
</pre>
</div>

<p>
Gas phase water (\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&Units=SI&Mask=1&Type=JANAFG&Table=on#JANAFG})
</p>

<p>
Interestingly, these parameters are listed as valid only above 500K. That means we have to extrapolate the values down to 298K. That is risky for polynomial models, as they can deviate substantially outside the region they were fitted to.
</p>

<div class="org-src-container">

<pre class="src src-python">Hf_gas = -241.826  <span style="color: #ff0000; font-weight: bold;"># kJ/mol</span>
S_gas = 0.188835   <span style="color: #ff0000; font-weight: bold;"># kJ/mol/K</span>

shomateG = [30.09200,
             6.832514,
             6.793435,
            -2.534480,
             0.082139,
          -250.8810,
           223.3967,
          -241.8264]
</pre>
</div>

<p>
Now, we wan to compute G for each phase as a function of T
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

T = np.linspace(0, 200) + 273.15
t = T / 1000.0

sTT = np.vstack([np.log(t),
                 t,
                 (t**2) / 2.0,
                 (t**3) / 3.0,
                 -1.0 / (2*t**2),
                 0 * t,
                 t**0,
                 0 * t**0]).T / 1000.0

hTT = np.vstack([t,
                 (t**2)/2.0,
                 (t**3)/3.0,
                 (t**4)/4.0,
                 -1.0 / t,
                 1 * t**0,
                 0 * t**0,
                 -1 * t**0]).T

Gliq = Hf_liq + np.dot(hTT, shomateL) - T*(np.dot(sTT, shomateL))
Ggas = Hf_gas + np.dot(hTT, shomateG) - T*(np.dot(sTT, shomateG))
                 
<span style="color: #8b0000;">from</span> scipy.interpolate <span style="color: #8b0000;">import</span> interp1d
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

f = interp1d(T, Gliq - Ggas)
bp, = fsolve(f, 373)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The boiling point is {0} K'</span>.format(bp)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; The boiling point is 373.206081312 K
</pre>

<div class="org-src-container">

<pre class="src src-python">plt.figure(); plt.clf()
plt.plot(T-273.15, Gliq, T-273.15, Ggas)
plt.legend([<span style="color: #228b22;">'liquid water'</span>, <span style="color: #228b22;">'steam'</span>])

plt.xlabel(<span style="color: #228b22;">'Temperature $^\circ$C'</span>)
plt.ylabel(<span style="color: #228b22;">'$\Delta G$ (kJ/mol)'</span>)
plt.title(<span style="color: #228b22;">'The boiling point is approximately {0:1.2f} $^\circ$C'</span>.format(bp-273.15))
plt.savefig(<span style="color: #228b22;">'images/boiling-water.png'</span>)
</pre>
</div>

<pre class="example">
&lt;matplotlib.figure.Figure object at 0x050D2E30&gt;
[&lt;matplotlib.lines.Line2D object at 0x051AB610&gt;, &lt;matplotlib.lines.Line2D object at 0x051B4C90&gt;]
&lt;matplotlib.legend.Legend object at 0x051B9030&gt;
&gt;&gt;&gt; &lt;matplotlib.text.Text object at 0x0519E390&gt;
&lt;matplotlib.text.Text object at 0x050FB390&gt;
&lt;matplotlib.text.Text object at 0x050FBFB0&gt;
</pre>

<p><img src="/img/./images/boiling-water.png"><p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Summary</h2>
<div class="outline-text-2" id="text-1">
<p>
The answer we get us 0.05 K too high, which is not bad considering we estimated it using parameters that were fitted to thermodynamic data and that had finite precision and extrapolated the steam properties below the region the parameters were stated to be valid for.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/04/Estimating-the-boiling-point-of-water.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/04/Estimating-the-boiling-point-of-water#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/tag/thermodynamics/1">« Previous Page</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/01/27/New-publication-in-Topics-in-Catalysis/">New publication in Topics in Catalysis</a></li>
      <li><a href="/blog/2018/01/03/New-publication-in-Molecular-Simulation/">New publication in Molecular Simulation</a></li>
      <li><a href="/blog/2017/12/31/2017-in-a-nutshell-for-the-Kitchin-Research-group/">2017 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2017/11/29/Solving-an-eigenvalue-differential-equation-with-a-neural-network/">Solving an eigenvalue differential equation with a neural network</a></li>
      <li><a href="/blog/2017/11/28/Solving-ODEs-with-a-neural-network-and-autograd/">Solving ODEs with a neural network and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



