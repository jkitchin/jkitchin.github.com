

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A new mode for Python documentation</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            






<article>
  <div class="blog_post">
    <header>
      <div id="A-new-mode-for-Python-documentation"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/20/A-new-mode-for-Python-documentation/" rel="bookmark" title="Permanent Link to A new mode for Python documentation">A new mode for Python documentation</a></h2>
      <p><small><span class="blog_post_date">Posted December 20, 2014 at 03:02 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/20/A-new-mode-for-Python-documentation#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated December 22, 2014 at 10:12 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
<span class="timestamp-wrapper"><span class="timestamp">[2014-12-22 Mon]</span></span> update: See this in action at <a href="http://www.youtube.com/watch?v=G_r7wTcVK54">http://www.youtube.com/watch?v=G_r7wTcVK54</a> , and see the latest source at <a href="https://github.com/jkitchin/jmax/blob/master/pydoc.el">https://github.com/jkitchin/jmax/blob/master/pydoc.el</a> .
</p>

<p>
The emacs-lisp documentation in Emacs is inspiring. It is interlinked, you can click on links to open source files, other commands, etc&#x2026; Python documentation is not that nice. It should be.
</p>

<p>
I wrote a little pydoc function:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc</span> (name)
  <span style="color: #228b22;">"Display pydoc information for NAME in a buffer named *pydoc*."</span>
  (interactive <span style="color: #228b22;">"sName of function or module: "</span>)
  (switch-to-buffer-other-window <span style="color: #228b22;">"*pydoc*"</span>)
  (erase-buffer)
  (insert (shell-command-to-string (format <span style="color: #228b22;">"python -m pydoc %s"</span> name)))
  (goto-char (point-min)))
</pre>
</div>

<p>
which at least accesses python documentation in emacs. It looks like this:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-jasp.png"> 
</p>
</div>

<p>
But, this lacks functionality. I want there to be useful links in this, so I can click on the filename to open the source, or click on the packages to get their documentation. Below, we walk through a few functions that will operate on the buffer and put text properties on different pieces.
</p>

<p>
First, let us make the source file clickable so it opens the source.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-file-link</span> ()
  <span style="color: #228b22;">"Find FILE in a pydoc buffer and make it a clickable link"</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^FILE</span>
<span style="color: #228b22;">    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">.*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">$"</span> nil t)

    (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
          (start (match-beginning 1))
          (end (match-end 1))
          (source-file (match-string 1)))
      
      ;; <span style="color: #ff0000; font-weight: bold;">set file to be clickable to open the source</span>
      (define-key map [mouse-1]
        `(<span style="color: #8b0000;">lambda</span> ()
          (interactive)
          (find-file ,source-file)))

      (set-text-properties
       start end
       `(local-map, map
                   font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                   mouse-face highlight
                   help-echo <span style="color: #228b22;">"mouse-1: click to open"</span>)))))
</pre>
</div>

<pre class="example">
pydoc-make-file-link
</pre>

<p>
Next, sometimes there are URLs in the python documentation. These should all open up in a browser when you click on them. Here we propertize anything we recognize as a URL to make it open when clicked on.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-url-links</span> ()
  (goto-char (point-min))
  (<span style="color: #8b0000;">while</span> (re-search-forward <span style="color: #228b22;">"</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">http</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">s</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">?://.*$</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">"</span> nil t)
    (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
          (start (match-beginning 1))
          (end (match-end 1)))
        
      (define-key map [mouse-1]
        `(<span style="color: #8b0000;">lambda</span> ()
          (interactive)
          (browse-url ,(buffer-substring start end))))
        
      (set-text-properties
       start end
       `(local-map ,map
                   font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                   mouse-face highlight
                   help-echo (format <span style="color: #228b22;">"mouse-1: click to open"</span>))))))
</pre>
</div>

<p>
When we get documentation for a package, we should make each entry of the package clickable, so we can get to the documentation for that package easily. We store the name of the current package so we can construct the path to the subpackage.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-get-name</span> ()
  <span style="color: #228b22;">"get NAME and store locally"</span>
  (make-variable-buffer-local 'pydoc-name)
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^NAME</span>
<span style="color: #228b22;">\\s-*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">-][a-zA-Z]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">"</span> nil t)
    (setq pydoc-name (match-string 1))))


(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-package-links</span> ()
  <span style="color: #228b22;">"make links in PACKAGE CONTENTS"</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^PACKAGE CONTENTS"</span> nil t)
    (forward-line)

    (<span style="color: #8b0000;">while</span> (string-match
            <span style="color: #228b22;">"^    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[a-zA-Z0-9_]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">[ ]?</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">(package)</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">?"</span>
            (buffer-substring
             (line-beginning-position)
             (line-end-position)))
                
      (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
            (start (match-beginning 1))
            (end (match-end 1))
            (package (concat
                      pydoc-name <span style="color: #228b22;">"."</span>
                      (match-string 1
                                    (buffer-substring
                                     (line-beginning-position)
                                     (line-end-position))))))
        
        (define-key map [mouse-1]
          `(<span style="color: #8b0000;">lambda</span> ()
            (interactive)
            (pydoc ,package)))
          
        (set-text-properties
         (+ (line-beginning-position) start)
         (+ (line-beginning-position) end)
         `(local-map, map
                      font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                      mouse-face highlight
                      help-echo (format <span style="color: #228b22;">"mouse-1: click to open %s"</span> ,package))))
      (forward-line))))
</pre>
</div>

<p>
Next, we put some eye candy on function names and arguments. This won't do anything functionally, but it breaks up the monotony of all black text.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-colorize-functions</span> ()
  <span style="color: #228b22;">"Change color of function names and args."</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^Functions"</span> nil t)  
    (<span style="color: #8b0000;">while</span> (re-search-forward <span style="color: #228b22;">"    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[a-zA-z0-9-]+</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">(</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">)]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">)"</span> nil t)
      (set-text-properties
       (match-beginning 1)
       (match-end 1)
       '(font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"brown"</span>)))

      (set-text-properties
       (match-beginning 2)
       (match-end 2)
       '(font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"red"</span>))))))
</pre>
</div>

<p>
I have gotten used to the [back] link in emacs-lisp documentation, so we try to emulate it here.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-insert-back-link</span> ()
  <span style="color: #228b22;">"Insert link to previous buffer"</span>
  (goto-char (point-max)) 
  (insert <span style="color: #228b22;">"</span>
<span style="color: #228b22;">[back]"</span>)
  (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap)))
    
    ;; <span style="color: #ff0000; font-weight: bold;">set file to be clickable to open the source</span>
    (define-key map [mouse-1]
      (<span style="color: #8b0000;">lambda</span> ()
        (interactive)
        (pydoc *pydoc-last*)))

      (set-text-properties
       (line-beginning-position)
       (line-end-position)
       `(local-map, map
                    font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                    mouse-face highlight
                    help-echo <span style="color: #228b22;">"mouse-1: click to return"</span>))))
</pre>
</div>

<pre class="example">
pydoc-insert-back-link
</pre>

<p>
Ok, finally we remake the pydoc function. 
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defvar</span> <span style="color: #8b008b;">*pydoc-current*</span> nil
 <span style="color: #228b22;">"Stores current pydoc command"</span>)

(<span style="color: #8b0000;">defvar</span> <span style="color: #8b008b;">*pydoc-last*</span> nil
 <span style="color: #228b22;">"Stores the last pydoc command"</span>)

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc</span> (name)
  <span style="color: #228b22;">"Display pydoc information for NAME in a buffer named *pydoc*."</span>
  (interactive <span style="color: #228b22;">"sName of function or module: "</span>)

  (switch-to-buffer-other-window <span style="color: #228b22;">"*pydoc*"</span>)
  (setq buffer-read-only nil)
  (erase-buffer)
  (insert (shell-command-to-string (format <span style="color: #228b22;">"python -m pydoc %s"</span> name)))
  (goto-char (point-min))

  ;; <span style="color: #ff0000; font-weight: bold;">save </span>
  (<span style="color: #8b0000;">when</span> *pydoc-current*
      (setq *pydoc-last* *pydoc-current*))
  (setq *pydoc-current* name)


  (<span style="color: #8b0000;">save-excursion</span>
    (pydoc-get-name)
    (pydoc-make-url-links)
    (pydoc-make-file-link)
    (pydoc-make-package-links)
    (pydoc-colorize-functions)
    (pydoc-insert-back-link))

  ;; <span style="color: #ff0000; font-weight: bold;">make read-only and press q to quit</span>
  (setq buffer-read-only t)
  (use-local-map (copy-keymap org-mode-map))
  (local-set-key <span style="color: #228b22;">"q"</span> #'(<span style="color: #8b0000;">lambda</span> () (interactive) (kill-buffer)))

  (font-lock-mode))
</pre>
</div>

<pre class="example">
pydoc
</pre>

<p>
Now, we get a much more functional pydoc:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-enhanced-jasp.png"> 
</p>
<p><span class="figure-number">Figure 2:</span> Annotated screenshot</p>
</div>

<p>
and with the colorized function names:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-potcar.png"> 
</p>
</div>

<p>
Admittedly, there seems to be a lot of boilerplate code for propertizing the strings, but it doesn't seem too bad. I will probably use this documentation tool this spring, so maybe I will think of new functionality to add to pydoc. Any ideas?
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/20/A-new-mode-for-Python-documentation.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://jkitchin.github.io/blog/2014/12/20/A-new-mode-for-Python-documentation";
</script>
<script type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/embed.js"></script>
<noscript><a href="http://kitchinresearchgroup.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/01/27/New-publication-in-Topics-in-Catalysis/">New publication in Topics in Catalysis</a></li>
      <li><a href="/blog/2018/01/03/New-publication-in-Molecular-Simulation/">New publication in Molecular Simulation</a></li>
      <li><a href="/blog/2017/12/31/2017-in-a-nutshell-for-the-Kitchin-Research-group/">2017 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2017/11/29/Solving-an-eigenvalue-differential-equation-with-a-neural-network/">Solving an eigenvalue differential equation with a neural network</a></li>
      <li><a href="/blog/2017/11/28/Solving-ODEs-with-a-neural-network-and-autograd/">Solving ODEs with a neural network and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



