

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications/index.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Basic-statistics"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Basic-statistics/" rel="bookmark" title="Permanent Link to Basic statistics">Basic statistics</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/statistics/'>statistics</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Basic-statistics#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:35 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Given several measurements of a single quantity, determine the average value of the measurements, the standard deviation of the measurements and the 95% confidence interval for the average.
</p>

<p>
This is a recipe for computing the confidence interval. The strategy is:
</p>
<ol>
<li>compute the average
</li>
<li>Compute the standard deviation of your data
</li>
<li>Define the confidence interval, e.g. 95% = 0.95
</li>
<li>compute the student-t multiplier. This is a function of the confidence
</li>
</ol>
<p>
interval you specify, and the number of data points you have minus 1. You
subtract 1 because one degree of freedom is lost from calculating the
average. The confidence interval is defined as
ybar +- T_multiplier*std/sqrt(n).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.stats.distributions <span style="color: #8b0000;">import</span>  t

y = [8.1, 8.0, 8.1]

ybar = np.mean(y)
s = np.std(y)

ci = 0.95
alpha = 1.0 - ci

n = <span style="color: #8b0000;">len</span>(y)
T_multiplier = t.ppf(1-alpha/2.0, n-1)

ci95 = T_multiplier * s / np.sqrt(n-1)

<span style="color: #8b0000;">print</span> [ybar - ci95, ybar + ci95]
</pre>
</div>

<pre class="example">
[7.9232449090029595, 8.210088424330376]
</pre>

<p>
We are 95% certain the next measurement will fall in the interval above.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Basic-statistics.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Basic-statistics#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Calculating-a-bubble-point-pressure-of-a-mixture"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture/" rel="bookmark" title="Permanent Link to Calculating a bubble point pressure of a mixture">Calculating a bubble point pressure of a mixture</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-algebra/'>nonlinear algebra</a></span> | tags: <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 04:32 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/15/calculating-a-bubble-point-pressure/" >Matlab post</a>
</p>

<p>
Adapted from <a href="http://terpconnect.umd.edu/~nsw/ench250/bubpnt.htm" >http://terpconnect.umd.edu/~nsw/ench250/bubpnt.htm</a> (dead link)
</p>

<p>
We previously learned to read a datafile containing lots of Antoine coefficients into a database, and use the coefficients to estimate vapor pressure of a single compound. Here we use those coefficents to compute a bubble point pressure of a mixture. 
</p>

<p>
The bubble point is the temperature at which the sum of the component vapor pressures is equal to the the total pressure. This is where a bubble of vapor will first start forming, and the mixture starts to boil.
</p>

<p>
Consider an equimolar mixture of benzene, toluene, chloroform, acetone and methanol. Compute the bubble point at 760 mmHg, and the gas phase composition. The gas phase composition is given by: \(y_i = x_i*P_i/P_T\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #ff0000; font-weight: bold;"># load our thermodynamic data</span>
data = np.loadtxt(<span style="color: #228b22;">'data/antoine_data.dat'</span>,
                  dtype=[(<span style="color: #228b22;">'id'</span>, np.int),
                         (<span style="color: #228b22;">'formula'</span>, <span style="color: #228b22;">'S8'</span>),
                         (<span style="color: #228b22;">'name'</span>, <span style="color: #228b22;">'S28'</span>),
                         (<span style="color: #228b22;">'A'</span>, np.float),
                         (<span style="color: #228b22;">'B'</span>, np.float),
                         (<span style="color: #228b22;">'C'</span>, np.float),
                         (<span style="color: #228b22;">'Tmin'</span>, np.float),
                         (<span style="color: #228b22;">'Tmax'</span>, np.float),
                         (<span style="color: #228b22;">'??'</span>, <span style="color: #228b22;">'S4'</span>),
                         (<span style="color: #228b22;">'?'</span>, <span style="color: #228b22;">'S4'</span>)],
                  skiprows=7)

compounds = [<span style="color: #228b22;">'benzene'</span>, <span style="color: #228b22;">'toluene'</span>, <span style="color: #228b22;">'chloroform'</span>, <span style="color: #228b22;">'acetone'</span>, <span style="color: #228b22;">'methanol'</span>]

<span style="color: #ff0000; font-weight: bold;"># extract the data we want</span>
A = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'A'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
B = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'B'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
C = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'C'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
Tmin = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'Tmin'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
Tmax = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'Tmax'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])


<span style="color: #ff0000; font-weight: bold;"># we have an equimolar mixture</span>
x = np.array([0.2, 0.2, 0.2, 0.2, 0.2])

<span style="color: #ff0000; font-weight: bold;"># Given a T, we can compute the pressure of each species like this:</span>

T = 67 <span style="color: #ff0000; font-weight: bold;"># degC</span>
P = 10**(A - B / (T + C))
<span style="color: #8b0000;">print</span> P
<span style="color: #8b0000;">print</span> np.dot(x, P)  <span style="color: #ff0000; font-weight: bold;"># total mole-fraction weighted pressure</span>

Tguess = 67
Ptotal = 760

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(T):
    P = 10**(A - B / (T + C))
    <span style="color: #8b0000;">return</span> Ptotal - np.dot(x, P)
    
Tbubble, = fsolve(func, Tguess)

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The bubble point is {0:1.2f} degC'</span>.format(Tbubble)

<span style="color: #ff0000; font-weight: bold;"># double check answer is in a valid T range</span>
<span style="color: #8b0000;">if</span> np.any(Tbubble &lt; Tmin) <span style="color: #8b0000;">or</span> np.any(Tbubble &gt; Tmax):
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'T_bubble is out of range!'</span>

<span style="color: #ff0000; font-weight: bold;"># print gas phase composition</span>
y = x * 10**(A - B / (Tbubble + C))/Ptotal

<span style="color: #8b0000;">for</span> cmpd, yi <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(compounds, y):
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'y_{0:&lt;10s} = {1:1.3f}'</span>.format(cmpd, yi)
</pre>
</div>

<pre class="example">
[  498.4320267    182.16010994   898.31061294  1081.48181768   837.88860027]
699.654633507
The bubble point is 69.46 degC
y_benzene    = 0.142
y_toluene    = 0.053
y_chloroform = 0.255
y_acetone    = 0.308
y_methanol   = 0.242
</pre>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Fit-a-line-to-numerical-data"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Fit-a-line-to-numerical-data/" rel="bookmark" title="Permanent Link to Fit a line to numerical data">Fit a line to numerical data</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/data-analysis/'>data analysis</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Fit-a-line-to-numerical-data#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:38 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/08/04/fit-a-line-to-numerical-data/" >Matlab post</a>
</p>

<p>
We want to fit a line to this data:
</p>

<div class="org-src-container">

<pre class="src src-python">x = [0, 0.5, 1, 1.5, 2.0, 3.0, 4.0, 6.0, 10]
y = [0, -0.157, -0.315, -0.472, -0.629, -0.942, -1.255, -1.884, -3.147]
</pre>
</div>

<p>
We use the polyfit(x, y, n) command where n is the polynomial order, n=1 for a line.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

p = np.polyfit(x, y, 1)
<span style="color: #8b0000;">print</span> p
slope, intercept = p
<span style="color: #8b0000;">print</span> slope, intercept
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [-0.31452218  0.00062457]
&gt;&gt;&gt; -0.3145221843 0.00062457337884
</pre>

<p>
To show the fit, we can use numpy.polyval to evaluate the fit at many points.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

xfit = np.linspace(0, 10)
yfit = np.polyval(p, xfit)

plt.plot(x, y, <span style="color: #228b22;">'bo'</span>, label=<span style="color: #228b22;">'raw data'</span>)
plt.plot(xfit, yfit, <span style="color: #228b22;">'r-'</span>, label=<span style="color: #228b22;">'fit'</span>)
plt.xlabel(<span style="color: #228b22;">'x'</span>)
plt.ylabel(<span style="color: #228b22;">'y'</span>)
plt.legend()
plt.savefig(<span style="color: #228b22;">'images/linefit-1.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x053C1790&gt;]
[&lt;matplotlib.lines.Line2D object at 0x0313C610&gt;]
&lt;matplotlib.text.Text object at 0x052A4950&gt;
&lt;matplotlib.text.Text object at 0x052B9A10&gt;
&lt;matplotlib.legend.Legend object at 0x053C1CD0&gt;
</pre>

<p><img src="/img/./images/linefit-1.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Fit-a-line-to-numerical-data.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Fit-a-line-to-numerical-data#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Fitting-a-numerical-ODE-solution-to-data"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Fitting-a-numerical-ODE-solution-to-data/" rel="bookmark" title="Permanent Link to Fitting a numerical ODE solution to data">Fitting a numerical ODE solution to data</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-regression/'>nonlinear regression</a>, <a href='/blog/category/data-analysis/'>data analysis</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Fitting-a-numerical-ODE-solution-to-data#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:39 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/29/fitting-a-numerical-ode-solution-to-data/" >Matlab post</a>
</p>

<p>
Suppose we know the concentration of A follows this differential equation: \(\frac{dC_A}{dt} = -k C_A\), and we have data we want to fit to it. Here is an example of doing that.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> curve_fit
<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #ff0000; font-weight: bold;"># given data we want to fit</span>
tspan = [0, 0.1, 0.2, 0.4, 0.8, 1]
Ca_data = [2.0081,  1.5512,  1.1903,  0.7160,  0.2562,  0.1495]

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fitfunc</span>(t, k):
    <span style="color: #228b22;">'Function that returns Ca computed from an ODE for a k'</span>
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">myode</span>(Ca, t):
        <span style="color: #8b0000;">return</span> -k * Ca

    Ca0 = Ca_data[0]
    Casol = odeint(myode, Ca0, t)
    <span style="color: #8b0000;">return</span> Casol[:,0]

k_fit, kcov = curve_fit(fitfunc, tspan, Ca_data, p0=1.3)
<span style="color: #8b0000;">print</span> k_fit

tfit = np.linspace(0,1);
fit = fitfunc(tfit, k_fit)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.plot(tspan, Ca_data, <span style="color: #228b22;">'ro'</span>, label=<span style="color: #228b22;">'data'</span>)
plt.plot(tfit, fit, <span style="color: #228b22;">'b-'</span>, label=<span style="color: #228b22;">'fit'</span>)
plt.legend(loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/ode-fit.png'</span>)
</pre>
</div>

<pre class="example">
[ 2.58893455]
</pre>

<p><img src="/img/./images/ode-fit.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Fitting-a-numerical-ODE-solution-to-data.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Fitting-a-numerical-ODE-solution-to-data#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Graphical-methods-to-help-get-initial-guesses-for-multivariate-nonlinear-regression"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Graphical-methods-to-help-get-initial-guesses-for-multivariate-nonlinear-regression/" rel="bookmark" title="Permanent Link to Graphical methods to help get initial guesses for multivariate nonlinear regression">Graphical methods to help get initial guesses for multivariate nonlinear regression</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/plotting/'>plotting</a>, <a href='/blog/category/data-analysis/'>data analysis</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Graphical-methods-to-help-get-initial-guesses-for-multivariate-nonlinear-regression#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:40 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/10/09/graphical-methods-to-help-get-initial-guesses-for-multivariate-nonlinear-regression/" >Matlab post</a>
</p>

<p>
Fit the model f(x1,x2; a,b) = a*x1 + x2^b to the data given below. This model has two independent variables, and two parameters.
</p>

<p>
We want to do a nonlinear fit to find a and b that minimize the summed squared errors between the model predictions and the data. With only two variables, we can graph how the summed squared error varies with the parameters, which may help us get initial guesses. Let us assume the parameters lie in a range, here we choose 0 to 5. In other problems you would adjust this as needed.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> mpl_toolkits.mplot3d <span style="color: #8b0000;">import</span> Axes3D
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

x1 = [1.0, 2.0, 3.0, 4.0, 5.0, 6.0]
x2 = [0.2, 0.4, 0.8, 0.9, 1.1, 2.1]
X = np.column_stack([x1, x2]) <span style="color: #ff0000; font-weight: bold;"># independent variables</span>

f = [ 3.3079,    6.6358,   10.3143,   13.6492,   17.2755,   23.6271]

fig = plt.figure()
ax = fig.gca(projection = <span style="color: #228b22;">'3d'</span>)

ax.plot(x1, x2, f)
ax.set_xlabel(<span style="color: #228b22;">'x1'</span>)
ax.set_ylabel(<span style="color: #228b22;">'x2'</span>)
ax.set_zlabel(<span style="color: #228b22;">'f(x1,x2)'</span>)

plt.savefig(<span style="color: #228b22;">'images/graphical-mulvar-1.png'</span>)


arange = np.linspace(0,5);
brange = np.linspace(0,5);

A,B = np.meshgrid(arange, brange)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">model</span>(X, a, b):
    <span style="color: #228b22;">'Nested function for the model'</span>
    x1 = X[:, 0]
    x2 = X[:, 1]
    
    f = a * x1 + x2**b
    <span style="color: #8b0000;">return</span> f

<span style="color: #8b0000;">@np</span>.vectorize
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">errfunc</span>(a, b):
    <span style="color: #ff0000; font-weight: bold;"># function for the summed squared error</span>
    fit = model(X, a, b)
    sse = np.sum((fit - f)**2)
    <span style="color: #8b0000;">return</span> sse

SSE = errfunc(A, B)

plt.clf()
plt.contourf(A, B, SSE, 50)
plt.plot([3.2], [2.1], <span style="color: #228b22;">'ro'</span>)
plt.figtext( 3.4, 2.2, <span style="color: #228b22;">'Minimum near here'</span>, color=<span style="color: #228b22;">'r'</span>)

plt.savefig(<span style="color: #228b22;">'images/graphical-mulvar-2.png'</span>)

guesses = [3.18, 2.02]

<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> curve_fit

popt, pcov = curve_fit(model, X, f, guesses)
<span style="color: #8b0000;">print</span> popt

plt.plot([popt[0]], [popt[1]], <span style="color: #228b22;">'r*'</span>)
plt.savefig(<span style="color: #228b22;">'images/graphical-mulvar-3.png'</span>)

<span style="color: #8b0000;">print</span> model(X, *popt)

fig = plt.figure()
ax = fig.gca(projection = <span style="color: #228b22;">'3d'</span>)

ax.plot(x1, x2, f, <span style="color: #228b22;">'ko'</span>, label=<span style="color: #228b22;">'data'</span>)
ax.plot(x1, x2, model(X, *popt), <span style="color: #228b22;">'r-'</span>, label=<span style="color: #228b22;">'fit'</span>)
ax.set_xlabel(<span style="color: #228b22;">'x1'</span>)
ax.set_ylabel(<span style="color: #228b22;">'x2'</span>)
ax.set_zlabel(<span style="color: #228b22;">'f(x1,x2)'</span>)

plt.savefig(<span style="color: #228b22;">'images/graphical-mulvar-4.png'</span>)
</pre>
</div>

<pre class="example">
[ 3.21694798  1.9728254 ]
[  3.25873623   6.59792994  10.29473657  13.68011436  17.29161001
  23.62366445]
</pre>

<p><img src="/img/./images/graphical-mulvar-1.png"><p>

<p><img src="/img/./images/graphical-mulvar-2.png"><p>

<p><img src="/img/./images/graphical-mulvar-3.png"><p>

<p><img src="/img/./images/graphical-mulvar-4.png"><p>

<p>
It can be difficult to figure out initial guesses for nonlinear fitting problems. For one and two dimensional systems, graphical techniques may be useful to visualize how the summed squared error between the model and data depends on the parameters.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Graphical-methods-to-help-get-initial-guesses-for-multivariate-nonlinear-regression.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Graphical-methods-to-help-get-initial-guesses-for-multivariate-nonlinear-regression#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../80">« Previous Page</a>
  --  
 <a href="../82">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2016/06/16/Copy-formatted-org-mode-text-from-Emacs-to-other-applications/">Copy formatted org-mode text from Emacs to other applications</a></li>
      <li><a href="/blog/2016/06/14/Using-prefix-args-in-ivy-actions/">Using prefix args in ivy actions</a></li>
      <li><a href="/blog/2016/06/14/New-publication-in-International-Journal-on-Digital-Libraries/">New publication in International Journal on Digital Libraries</a></li>
      <li><a href="/blog/2016/06/13/Dynamic-sorting-with-ivy/">Dynamic sorting with ivy</a></li>
      <li><a href="/blog/2016/05/30/Writing-lisp-code-from-Python/">Writing lisp code from Python</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2016
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



