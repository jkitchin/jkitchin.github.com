

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Automating-Adobe-Acrobat-Pro-with-python"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/11/23/Automating-Adobe-Acrobat-Pro-with-python/" rel="bookmark" title="Permanent Link to Automating Adobe Acrobat Pro with python">Automating Adobe Acrobat Pro with python</a></h2>
      <p><small><span class="blog_post_date">Posted November 23, 2013 at 10:34 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/automation/'>automation</a>, <a href='/blog/category/pdf/'>pdf</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/11/23/Automating-Adobe-Acrobat-Pro-with-python#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Summary</a></li>
</ul>
</div>
</div>

<p>
I have a need to automate Adobe Pro for a couple of applications:
</p>

<ol class="org-ol">
<li>I could use Adobe Pro to automatically add rubric pages to assignments before grading them. The rubric has embedded javascript that stores the grade inside the pdf file.
</li>
<li>I could use Adobe Pro to extract information, e.g. grades, stored in a set of PDF files for analysis.
</li>
</ol>

<p>
I came across this <a href="http://win32com.goermezer.de/content/view/232/288/">script</a> to automate Adobe Pro using python and OLE automation.  Two other useful references are:
</p>

<ol class="org-ol">
<li><a href="http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/iac_api_reference.pdf">http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/iac_api_reference.pdf</a> 
</li>
<li><a href="http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/iac_developer_guide.pdf">http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/iac_developer_guide.pdf</a> 
</li>
</ol>

<p>
In this post, we look at some simple code to get data out of a pdf.  We start with just opening a PDF file.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> os
<span style="color: #8b0000;">from</span> win32com.client.dynamic <span style="color: #8b0000;">import</span> Dispatch
<span style="color: #8b008b;">src</span> = os.path.abspath(<span style="color: #228b22;">'writing-exams-in-orgmode.pdf'</span>)

<span style="color: #8b008b;">app</span> = Dispatch(<span style="color: #228b22;">"AcroExch.AVDoc"</span>)

app.Open(src, src)

app.Close(-1)  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">do not save on close</span>
</pre>
</div>

<p>
Opening and closing a file is not that useful.  Here, we can get some information out of the file. The pdf we looked at above has a custom property <code>PTEX.Fullbanner</code> from pdflatex. We can extract it like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> os
<span style="color: #8b0000;">from</span> win32com.client.dynamic <span style="color: #8b0000;">import</span> Dispatch
<span style="color: #8b008b;">src</span> = os.path.abspath(<span style="color: #228b22;">'writing-exams-in-orgmode.pdf'</span>)

<span style="color: #8b008b;">app</span> = Dispatch(<span style="color: #228b22;">"AcroExch.AVDoc"</span>)

app.Open(src, src)
<span style="color: #8b008b;">pddoc</span> = app.GetPDDoc()
<span style="color: #8b0000;">print</span> pddoc.GetInfo(<span style="color: #228b22;">'PTEX.Fullbanner'</span>)

<span style="color: #8b0000;">print</span> pddoc.GetNumPages()
app.Close(-1)  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">do not save on close</span>
</pre>
</div>

<pre class="example">
This is MiKTeX-pdfTeX 2.9.4535 (1.40.13)
5
</pre>


<p>
Finally, let us try inserting pages. I have a <a href="/media/2013-11-23-Automating-Adobe-Acrobat-Pro-with-python/rubric.pdf">rubric file </a> that I want to insert at the end of the <pre>writing-exams-in-orgmode.pdf</pre> above. We will open both documents, insert the rubric, and save the result as a new file.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> os
<span style="color: #8b0000;">from</span> win32com.client.dynamic <span style="color: #8b0000;">import</span> Dispatch
<span style="color: #8b008b;">src</span> = os.path.abspath(<span style="color: #228b22;">'../../CMU/classes/06-625/rubric/rubric.pdf'</span>)
<span style="color: #8b008b;">src2</span> = os.path.abspath(<span style="color: #228b22;">'writing-exams-in-orgmode.pdf'</span>)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">It seems I need two of these</span>
<span style="color: #8b008b;">avdoc1</span> = Dispatch(<span style="color: #228b22;">"AcroExch.AVDoc"</span>)
<span style="color: #8b008b;">avdoc2</span> = Dispatch(<span style="color: #228b22;">"AcroExch.AVDoc"</span>)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">this is the rubric</span>
avdoc1.Open(src, src)
<span style="color: #8b008b;">pddoc1</span> = avdoc1.GetPDDoc()
<span style="color: #8b008b;">N1</span> = pddoc1.GetNumPages()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">this is the other doc</span>
avdoc2.Open(src2, src2)
<span style="color: #8b008b;">pddoc2</span> = avdoc2.GetPDDoc()
<span style="color: #8b008b;">N2</span> = pddoc2.GetNumPages()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Insert rubric after last page of the other doc. pages start at 0</span>
pddoc2.InsertPages(N2 - 1, pddoc1, 0, N1, 0)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">save as a new file. 1 means full save at absolute path provided.</span>
pddoc2.Save(1, os.path.abspath(<span style="color: #228b22;">'./woohoo.pdf'</span>))

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">close files.</span>
avdoc1.Close(-1)
avdoc2.Close(-1)
</pre>
</div>

<p>
Here is our result: <a href="/media/2013-11-23-Automating-Adobe-Acrobat-Pro-with-python/woohoo.pdf">woohoo.pdf</a> . I went ahead and gave myself an A ;). 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Summary</h2>
<div class="outline-text-2" id="text-1">
<p>
It looks like I can replace the dependence of my box-course code on all the python-based pdf libraries (which are not fully functional, and do not work on all pdfs), and on pdftk, with this automation approach of Adobe Pro. It is unfortunate that it is not a free program, but i would expect it to work on all PDF files, and it provides features like combining PDFs with their javascript, that <i>no</i> other PDF package has. I have tried other PDF programs to combine the rubric and assignment page, but they all lose the javascript. With this method, I could keep a set of enriched rubric files for different types of assignments, and add them to assignments as part of the assessment process. 
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/11/23/Automating-Adobe-Acrobat-Pro-with-python.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/11/23/Automating-Adobe-Acrobat-Pro-with-python#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="New-PhD-students-join-the-Kitchin-Research-Group"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/11/15/New-PhD-students-join-the-Kitchin-Research-Group/" rel="bookmark" title="Permanent Link to New PhD students join the Kitchin Research Group">New PhD students join the Kitchin Research Group</a></h2>
      <p><small><span class="blog_post_date">Posted November 15, 2013 at 10:50 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/news/'>news</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/11/15/New-PhD-students-join-the-Kitchin-Research-Group#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated November 18, 2013 at 12:58 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Three new PhD students have joined the Kitchin Research Group! We are pleased to welcome Mehak Chawla, Qingqi (Victor) Fan, and John Michael (co-advised by Professor Paul Sides) to the group.
</p>

<p>
Mehak joins us from The Ohio State University. She will be using density functional theory to model metal alloy and oxide surface reactivity.
</p>

<p>
John completed his B.S. in Chemical Engineering at Miami University (OH). He will be using the imaging ammeter to screen electrocatalysts. He will be co-advised by Dr. Sides.
</p>

<p>
Victor joins us from the University of Tulsa. He will be studying oxygen evolution electrocatalysis on transition metal oxides.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/11/15/New-PhD-students-join-the-Kitchin-Research-Group.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/11/15/New-PhD-students-join-the-Kitchin-Research-Group#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="New-publication-in-Topics-in-Catalysis"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/11/11/New-publication-in-Topics-in-Catalysis/" rel="bookmark" title="Permanent Link to New publication in Topics in Catalysis">New publication in Topics in Catalysis</a></h2>
      <p><small><span class="blog_post_date">Posted November 11, 2013 at 08:20 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/news/'>news</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/11/11/New-publication-in-Topics-in-Catalysis#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated November 11, 2013 at 08:33 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
:END:
</p>


<p>
Simulating Temperature Programmed Desorption of Oxygen on Pt(111) Using DFT Derived Coverage Dependent Desorption Barriers

    Spencer D. Miller,
    Vladimir V. Pushkarev,
    Andrew J. Gellman,
    John R. Kitchin 

<a href="http://link.springer.com/article/10.1007/s11244-013-0166-3">http://link.springer.com/article/10.1007/s11244-013-0166-3</a> 

Abstract

The dissociative adsorption energy of oxygen on Pt(111) is known to be coverage dependent. Simple Redhead analysis of temperature programmed desorption (TPD) experiments that assumes a coverage independent desorption barrier can lead to errors in estimated properties such as desorption barriers and adsorption energies. A simple correction is to assume a linear coverage dependence of the desorption barrier, but there is usually no formal justification given for that functional form. More advanced TPD analysis methods that are suitable for determining coverage dependent adsorption parameters are limited by their need for large amounts of high quality, low noise data. We present a method to estimate the functional form of the coverage dependent desorption barrier from density functional theory calculations for use in analysis of TPD spectra. Density functional theory was employed to calculate the coverage dependence of the adsorption energy. Simulated TPD spectra were then produced by empirically scaling the DFT based adsorption energies utilizing the Bronstead-Evans-Polyani relationship between adsorption energies and desorption barriers. The resulting simulated spectra show better agreement with the experimental spectra than spectra predicted using barriers that are either coverage-independent or simply linearly dependent on coverage. The empirically derived scaling of the desorption barriers for Pt(111) is shown to be useful in predicting the low coverage desorption barriers for oxygen desorption from other metal surfaces, which showed reasonable agreement with the reported experimental values for those other metals.

The <a href="http://link.springer.com/content/esm/art:10.1007/s11244-013-0166-3/file/MediaObjects/11244_2013_166_MOESM1_ESM.pdf">supporting information</a> file is especially interesting because it has nearly all of the data files used in the paper embedded in it!
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/11/11/New-publication-in-Topics-in-Catalysis.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/11/11/New-publication-in-Topics-in-Catalysis#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="New-publication-in-Catalysis-Communications"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/11/11/New-publication-in-Catalysis-Communications/" rel="bookmark" title="Permanent Link to New publication in Catalysis Communications">New publication in Catalysis Communications</a></h2>
      <p><small><span class="blog_post_date">Posted November 11, 2013 at 08:18 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/news/'>news</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/11/11/New-publication-in-Catalysis-Communications#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Relating the Electronic Structure and Reactivity of the 3d Transition Metal Monoxide Surfaces
</p>

<p>
Zhongnan Xu, and  John R. Kitchin
</p>

<p>
We performed a series of density functional theory calculations of dissociative oxygen adsorption on fcc metals and their corresponding rocksalt monoxides to elucidate the relationship between the oxide electronic structure and its corresponding reactivity. We decomposed the dissociative adsorption energy of oxygen on an oxide surface into a sum of the adsorption energy on the metal and a change in adsorption energy caused by both expanding and oxidizing the lattice. We were able to identify the key features of the electronic structure that explains the trends in adsorption energies on 3d transition metal monoxide surfaces.
</p>

<p>
<a href="https://doi.org/10.1016/j.catcom.2013.10.028">https://doi.org/10.1016/j.catcom.2013.10.028</a>
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/11/11/New-publication-in-Catalysis-Communications.org">org-mode source</a><p>


    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/11/11/New-publication-in-Catalysis-Communications#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Add-subheadings-to-all-headings-in-an-org-file-at-some-level"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/10/29/Add-subheadings-to-all-headings-in-an-org-file-at-some-level/" rel="bookmark" title="Permanent Link to Add subheadings to all headings in an org-file at some level">Add subheadings to all headings in an org-file at some level</a></h2>
      <p><small><span class="blog_post_date">Posted October 29, 2013 at 10:05 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/org-mode/'>org-mode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/10/29/Add-subheadings-to-all-headings-in-an-org-file-at-some-level#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated October 29, 2013 at 02:25 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Class One</a>
<ul>
<li><a href="#sec-1-1">1.1. Student 1</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. Essay One</a></li>
<li><a href="#sec-1-1-2">1.1.2. Essay 2</a></li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. Student 2</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. Essay 2</a></li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Student 3</a>
<ul>
<li><a href="#sec-1-3-1">1.3.1. Essay One</a></li>
<li><a href="#sec-1-3-2">1.3.2. Essay 2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">2. Class Two</a>
<ul>
<li><a href="#sec-2-1">2.1. Student 1</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1. Essay 2</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. Student 2</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1. Essay 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<p>
On the org-mode mailing list someone asked how to insert a sub-heading with properties at some level in a tree. The application is they have a tree they use to store grades for a class, and they want to easily add a new level for an assignment for each student. The new level will have a title, and some properties to store the grade in. 
</p>

<p>
This can be done with <code>org-map-entries</code>. This will visit all the headlines and run a function. For this example, students are at level 3, and we want to add a headline at level 4 with the title "Essay 2", and with a property for the grade. The following code does this. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((MATCH t)
      (SCOPE 'file)
      (SKIP nil)
      (spacing nil))
  (org-map-entries
             (<span style="color: #8b0000;">lambda</span> ()
               (<span style="color: #8b0000;">let</span> ((level (nth 1 (org-heading-components))))
                 (<span style="color: #8b0000;">if</span> (= level 3)                     
                     (<span style="color: #8b0000;">save-restriction</span>
                       (org-narrow-to-subtree)
                       (goto-char (point-max))
                       
                       (org-insert-heading)
                       (insert <span style="color: #228b22;">"Essay 2\n"</span>)
                       (org-entry-put (point) <span style="color: #228b22;">"GRADE"</span> nil)
                       <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">now cut tree and paste at level 4</span>
                       (org-cut-subtree)
                       (org-paste-subtree 4)
                       )))) MATCH SCOPE SKIP))
</pre>
</div>

<p>
This code does not check for duplicates, so if you run it again, you get another set of entries for Essay 2. That might actually be hard to prevent without setting a unique ID for each new entry, something like Student-Name-Essay-2.
</p>

<p>
I found it necessary to cut and paste the new subtree to get to the level I wanted because in Class two, there were not already subtrees at level 4, and the code above went into a recursion loop.
</p>

<p>
I could not figure out why I had to narrow to the subtree, and go to the end of that subtree. Without doing that there was another recursion loop.
</p>

<p>
Below here is a slightly modified subtree showing a structure of two courses an instructor might have, with students in headlines at level 3. The code above has already added headlines at level 4 for "Essay 2". You have to check out the <a href="/media/2013-10-29-Add-subheadings-to-all-headings-in-an-org-file-at-some-level/add-subheadings-to-headings.org">actual org-file</a> to see that the properties are there.
</p>

<p>
For application, the code above could be put in an emacs-lisp file as an interactive command you could call with M-x.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Class One</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Student 1</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Essay One</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Here is my comment to the student on their essay.  The grade/mark itself will be stored as a property or priority.
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;HERE I'd like to add a node for "Essay Two"
</p>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> Essay 2</h4>
<div class="outline-text-4" id="text-1-1-2">
</div>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Student 2</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Comment on John's essay.
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; I to add the same node skeleton here, automatically
</p>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Essay 2</h4>
<div class="outline-text-4" id="text-1-2-1">
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Student 3</h3>
<div class="outline-text-3" id="text-1-3">
</div><div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> Essay One</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
Comment on Sally's essay.
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; And here.
</p>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> Essay 2</h4>
<div class="outline-text-4" id="text-1-3-2">
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Class Two</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Student 1</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> Essay 2</h4>
<div class="outline-text-4" id="text-2-1-1">
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Student 2</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Essay 2</h4>
<div class="outline-text-4" id="text-2-2-1">
</div>
</div>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/10/29/Add-subheadings-to-all-headings-in-an-org-file-at-some-level.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/10/29/Add-subheadings-to-all-headings-in-an-org-file-at-some-level#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../71">« Previous Page</a>
  --  
 <a href="../73">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2021/06/21/New-publication-Machine-learning-accelerated-geometry-optimization-in-molecular-simulation/">New publication "Machine-learning accelerated geometry optimization in molecular simulation"</a></li>
      <li><a href="/blog/2020/07/09/New-publication-SingleNN-Modified-Behler-Parrinello-Neural-Network-with-Shared-Weights-for-Atomistic-Simulations-with-Transferability/">New publication SingleNN - Modified Behler–Parrinello Neural Network with Shared Weights for Atomistic Simulations with Transferability</a></li>
      <li><a href="/blog/2019/10/02/Using-autograd-to-plot-implicit-functions/">Using autograd to plot implicit functions</a></li>
      <li><a href="/blog/2019/09/22/Solving-differential-algebraic-equations-with-help-from-autograd/">Solving differential algebraic equations with help from autograd</a></li>
      <li><a href="/blog/2019/09/13/Sensitivity-analysis-with-odeint-and-autograd/">Sensitivity analysis with odeint and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2021
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



