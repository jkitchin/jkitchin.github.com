

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Integrating-functions-in-python"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/02/Integrating-functions-in-python/" rel="bookmark" title="Permanent Link to Integrating functions in python">Integrating functions in python</a></h2>
      <p><small><span class="blog_post_date">Posted February 02, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a>, <a href='/blog/category/math/'>math</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:54 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/08/01/integrating-functions-in-matlab/" >Matlab post</a>
</p>

<p>
<b>Problem statement</b>
</p>

<p>
find the integral of a function f(x) from a to b i.e.
</p>

<p>
$$\int_a^b f(x) dx$$
</p>

<p>
In python we use numerical quadrature to achieve this with the scipy.integrate.quad command. 
</p>

<p>
as a specific example, lets integrate
</p>

<p>
$$y=x^2$$
</p>

<p>
from x=0 to x=1. You should be able to work out that the answer is 1/3.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">integrand</span>(x):
    <span style="color: #8b0000;">return</span> x**2

ans, err = quad(integrand, 0, 1)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
0.333333333333
</pre>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> double integrals</h2>
<div class="outline-text-2" id="text-1">
<p>
we use the scipy.integrate.dblquad command
</p>

<p>
Integrate \(f(x,y)=y sin(x)+x cos(y)\) over
</p>

<p>
\(\pi <= x <= 2\pi\)
</p>

<p>
\(0 <= y <= \pi\)
</p>

<p>
i.e.
</p>

<p>
\(\int_{x=\pi}^{2\pi}\int_{y=0}^{\pi}y sin(x)+x cos(y)dydx\)
</p>

<p>
The syntax in dblquad is a bit more complicated than in Matlab. We have to provide callable functions for the range of the y-variable. Here they are constants, so we create lambda functions that return the constants. Also, note that the order of arguments in the integrand is different than in Matlab.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> dblquad
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">integrand</span>(y, x):
    <span style="color: #228b22;">'y must be the first argument, and x the second.'</span>
    <span style="color: #8b0000;">return</span> y * np.sin(x) + x * np.cos(y)

ans, err = dblquad(integrand, np.pi, 2*np.pi,
                   <span style="color: #8b0000;">lambda</span> x: 0,
                   <span style="color: #8b0000;">lambda</span> x: np.pi)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
-9.86960440109
</pre>

<p>
we use the tplquad command  to integrate \(f(x,y,z)=y sin(x)+z cos(x)\) over the region
</p>

<p>
\(0 <= x <= \pi\)
</p>

<p>
\(0 <= y <= 1\)
</p>

<p>
\(-1 <= z <= 1\)
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> tplquad
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">integrand</span>(z, y, x):
    <span style="color: #8b0000;">return</span> y * np.sin(x) + z * np.cos(x)

ans, err = tplquad(integrand,
                   0, np.pi,  <span style="color: #ff0000; font-weight: bold;"># x limits</span>
                   <span style="color: #8b0000;">lambda</span> x: 0,
                   <span style="color: #8b0000;">lambda</span> x: 1, <span style="color: #ff0000; font-weight: bold;"># y limits</span>
                   <span style="color: #8b0000;">lambda</span> x,y: -1,
                   <span style="color: #8b0000;">lambda</span> x,y: 1) <span style="color: #ff0000; font-weight: bold;"># z limits</span>

<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
2.0
</pre>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Summary</h2>
<div class="outline-text-2" id="text-2">
<p>
scipy.integrate offers the same basic functionality as Matlab does. The syntax differs significantly for these simple examples, but the use of functions for the limits enables freedom to integrate over non-constant limits.</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/02/Integrating-functions-in-python.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/02/02/Integrating-functions-in-python">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Better-interpolate-than-never"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/02/Better-interpolate-than-never/" rel="bookmark" title="Permanent Link to Better interpolate than never">Better interpolate than never</a></h2>
      <p><small><span class="blog_post_date">Posted February 02, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/interpolation/'>interpolation</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:42 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>

<a href="http://matlab.cheme.cmu.edu/2012/02/02/better-interpolate-than-never/" >Matlab post</a>
</p>

<p>
We often have some data that we have obtained in the lab, and we want to solve some problem using the data. For example, suppose we have this data that describes the value of f at time t.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

t = [0.5, 1, 3, 6]
f = [0.6065,    0.3679,    0.0498,    0.0025]
plt.plot(t,f)
plt.xlabel(<span style="color: #228b22;">'t'</span>)
plt.ylabel(<span style="color: #228b22;">'f(t)'</span>)
plt.savefig(<span style="color: #228b22;">'images/interpolate-1.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x04D18730&gt;]
&lt;matplotlib.text.Text object at 0x04BEE8B0&gt;
&lt;matplotlib.text.Text object at 0x04C03970&gt;
</pre>

<p><img src="/img/./images/interpolate-1.png"><p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Estimate the value of f at t=2.</h2>
<div class="outline-text-2" id="text-1">
<p>
This is a simple interpolation problem.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.interpolate <span style="color: #8b0000;">import</span> interp1d

g = interp1d(t, f) <span style="color: #ff0000; font-weight: bold;"># default is linear interpolation</span>

<span style="color: #8b0000;">print</span> g(2)
<span style="color: #8b0000;">print</span> g([2, 3, 4])
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.20885
[ 0.20885     0.0498      0.03403333]
</pre>

<p>
The function we sample above is actually f(t) = exp(-t). The linearly interpolated example is not too accurate.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">print</span> np.exp(-2)
</pre>
</div>

<pre class="example">
0.135335283237
</pre>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> improved interpolation?</h2>
<div class="outline-text-2" id="text-2">
<p>

we can tell interp1d to use a different interpolation scheme such as cubic polynomial splines like this. For nonlinear functions, this may improve the accuracy of the interpolation, as it implicitly includes information about the curvature by fitting a cubic polynomial over neighboring points. 
</p>

<div class="org-src-container">

<pre class="src src-python">g2 = interp1d(t, f, <span style="color: #228b22;">'cubic'</span>)
<span style="color: #8b0000;">print</span> g2(2)
<span style="color: #8b0000;">print</span> g2([2, 3, 4])
</pre>
</div>

<pre class="example">
0.108481818182
[ 0.10848182  0.0498      0.08428727]
</pre>

<p>
Interestingly, this is a different value than Matlab's cubic interpolation. Let us show the cubic spline fit.
</p>

<div class="org-src-container">

<pre class="src src-python">plt.figure()
plt.plot(t,f)
plt.xlabel(<span style="color: #228b22;">'t'</span>)
plt.ylabel(<span style="color: #228b22;">'f(t)'</span>)

x = np.linspace(0.5, 6)
fit = g2(x)
plt.plot(x, fit, label=<span style="color: #228b22;">'fit'</span>)
plt.savefig(<span style="color: #228b22;">'images/interpolation-2.png'</span>)
</pre>
</div>

<pre class="example">
&lt;matplotlib.figure.Figure object at 0x04EF2430&gt;
[&lt;matplotlib.lines.Line2D object at 0x04F20ED0&gt;]
&lt;matplotlib.text.Text object at 0x04EF2FF0&gt;
&lt;matplotlib.text.Text object at 0x04F060D0&gt;
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x04F17570&gt;]
</pre>

<p><img src="/img/./images/interpolation-2.png"><p>

<p>
Wow. That is a weird looking fit. Very different from what Matlab <a href="http://matlab.cheme.cmu.edu/wp-content/uploads/2012/02/interp_methods_02.png" >produces</a>. This is a good teaching moment not to rely blindly on interpolation! We will rely on the linear interpolation from here out which behaves predictably.
</p>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> The inverse question</h2>
<div class="outline-text-2" id="text-3">
<p>
It is easy to interpolate a new value of f given a value of t. What if we want to know the time that f=0.2? We can approach this a few ways.
</p>
</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> method 1</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We setup a function that we can use fsolve on. The function will be equal to zero at the time. The second function will look like 0 = 0.2 - f(t). The answer for 0.2=exp(-t) is t = 1.6094. Since we use interpolation here, we will get an approximate answer. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(t):
    <span style="color: #8b0000;">return</span> 0.2 - g(t)

initial_guess = 2
ans, = fsolve(func, initial_guess)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 2.0556428796
</pre>
</div>
</div>
<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> method 2: switch the interpolation order</h3>
<div class="outline-text-3" id="text-3-2">
<p>
We can switch the order of the interpolation to solve this problem. An issue we have to address in this method is that the &ldquo;x&rdquo; values must be monotonically <i>increasing</i>. It is somewhat subtle to reverse a list in python. I will use the cryptic syntax of [::-1] instead of the list.reverse() function or reversed() function. list.reverse() actually reverses the list &ldquo;in place&rdquo;, which changes the contents of the variable. That is not what I want. reversed() returns an iterator which is also not what I want. [::-1] is a fancy indexing trick that returns a reversed list.
</p>

<div class="org-src-container">

<pre class="src src-python">g3 = interp1d(f[::-1], t[::-1])

<span style="color: #8b0000;">print</span> g3(0.2)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; 2.0556428796
</pre>
</div>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> A harder problem</h2>
<div class="outline-text-2" id="text-4">
<p>
Suppose we want to know at what time is 1/f = 100? Now we have to decide what do we interpolate: f(t) or 1/f(t). Let us look at both ways and decide what is best. The answer to \(1/exp(-t) = 100\) is 4.6052
</p>
</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> interpolate on f(t) then invert the interpolated number</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(t):
    <span style="color: #228b22;">'objective function. we do some error bounds because we cannot interpolate out of the range.'</span>
    <span style="color: #8b0000;">if</span> t &lt; 0.5: t=0.5
    <span style="color: #8b0000;">if</span> t &gt; 6: t = 6
    <span style="color: #8b0000;">return</span> 100 - 1.0 / g(t)   

initial_guess = 4.5
a1, = fsolve(func, initial_guess)
<span style="color: #8b0000;">print</span> a1
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The %error is {0:%}'</span>.format((a1 - 4.6052)/4.6052)
</pre>
</div>

<pre class="example">
... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 5.52431289641
The %error is 19.958154%
</pre>
</div>
</div>
<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> invert f(t) then interpolate on 1/f</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">

<pre class="src src-python">ig = interp1d(t, 1.0 / np.array(f))

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ifunc</span>(t):
    <span style="color: #8b0000;">if</span> t &lt; 0.5: t=0.5
    <span style="color: #8b0000;">if</span> t &gt; 6: t = 6
    <span style="color: #8b0000;">return</span> 100 - ig(t)   

initial_guess = 4.5
a2, = fsolve(ifunc, initial_guess)
<span style="color: #8b0000;">print</span> a2
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The %error is {0:%}'</span>.format((a2 - 4.6052)/4.6052)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 3.6310782241
The %error is -21.152649%
</pre>
</div>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Discussion</h2>
<div class="outline-text-2" id="text-5">
<p>
In this case you get different errors, one overestimates and one underestimates the answer, and by a lot: &plusmn; 20%. Let us look at what is happening.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.interpolate <span style="color: #8b0000;">import</span> interp1d

t = [0.5, 1, 3, 6]
f = [0.6065,    0.3679,    0.0498,    0.0025]

x = np.linspace(0.5, 6)


g = interp1d(t, f) <span style="color: #ff0000; font-weight: bold;"># default is linear interpolation</span>
ig = interp1d(t, 1.0 / np.array(f))

plt.figure()
plt.plot(t, 1 / np.array(f), <span style="color: #228b22;">'ko '</span>, label=<span style="color: #228b22;">'data'</span>)
plt.plot(x, 1 / g(x), label=<span style="color: #228b22;">'1/interpolated f(x)'</span>)
plt.plot(x, ig(x), label=<span style="color: #228b22;">'interpolate on 1/f(x)'</span>)
plt.plot(x, 1 / np.exp(-x), <span style="color: #228b22;">'k--'</span>, label=<span style="color: #228b22;">'1/exp(-x)'</span>)
plt.xlabel(<span style="color: #228b22;">'t'</span>)
plt.ylabel(<span style="color: #228b22;">'1/f(t)'</span>)
plt.legend(loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/interpolation-3.png'</span>)
</pre>
</div>

<p><img src="/img/./images/interpolation-3.png"><p>

<p>
You can see that the 1/interpolated f(x) underestimates the value, while interpolated (1/f(x)) overestimates the value. This is an example of where you clearly need more data in that range to make good estimates. Neither interpolation method is doing a great job. The trouble in reality is that you often do not know the real function to do this analysis. Here you can say the time is probably between 3.6 and 5.5 where 1/f(t) = 100, but you can not read much more than that into it. If you need a more precise answer, you need better data, or you need to use an approach other than interpolation. For example, you could fit an exponential function to the data and use that to estimate values at other times.
</p>

<p>
So which is the best to interpolate? I think you should interpolate the quantity that is linear in the problem you want to solve, so in this case I think interpolating 1/f(x) is better. When you use an interpolated function in a nonlinear function, strange, unintuitive things can happen. That is why the blue curve looks odd. Between data points are linear segments in the original interpolation, but when you invert them, you cause the curvature to form.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/02/Better-interpolate-than-never.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/02/02/Better-interpolate-than-never">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Solving-a-second-order-ode"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/02/Solving-a-second-order-ode/" rel="bookmark" title="Permanent Link to Solving a second order ode">Solving a second order ode</a></h2>
      <p><small><span class="blog_post_date">Posted February 02, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a>, <a href='/blog/category/ode/'>ode</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:32 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/26/solving-a-second-order-ode/" >Matlab post</a>

</p>

<p>
The odesolvers in scipy can only solve first order ODEs, or systems of first order ODES. To solve a second order ODE, we must convert it by changes of variables to a system of first order ODES. We consider the Van der Pol oscillator here:
</p>

<p>
$$\frac{d^2x}{dt^2} - \mu(1-x^2)\frac{dx}{dt} + x = 0$$
</p>

<p>
\(\mu\) is a constant. If we let \(y=x - x^3/3\) <a href="http://en.wikipedia.org/wiki/Van_der_Pol_oscillator" >http://en.wikipedia.org/wiki/Van_der_Pol_oscillator</a>, then we arrive at this set of equations:
</p>

<p>
$$\frac{dx}{dt} = \mu(x-1/3x^3-y)$$
</p>

<p>
$$\frac{dy}{dt} = \mu/x$$
</p>

<p>
here is how we solve this set of equations. Let \(\mu=1\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

mu = 1.0

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">vanderpol</span>(X, t):
    x = X[0]
    y = X[1]
    dxdt = mu * (x - 1./3.*x**3 - y)
    dydt = x / mu
    <span style="color: #8b0000;">return</span> [dxdt, dydt]

X0 = [1, 2]
t = np.linspace(0, 40, 250)

sol = odeint(vanderpol, X0, t)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
x = sol[:, 0]
y = sol[:, 1]

plt.plot(t,x, t, y)
plt.xlabel(<span style="color: #228b22;">'t'</span>)
plt.legend((<span style="color: #228b22;">'x'</span>, <span style="color: #228b22;">'y'</span>))
plt.savefig(<span style="color: #228b22;">'images/vanderpol-1.png'</span>)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">phase portrait</span>
plt.figure()
plt.plot(x,y)
plt.plot(x[0], y[0], <span style="color: #228b22;">'ro'</span>)
plt.xlabel(<span style="color: #228b22;">'x'</span>)
plt.ylabel(<span style="color: #228b22;">'y'</span>)
plt.savefig(<span style="color: #228b22;">'images/vanderpol-2.png'</span>)
</pre>
</div>

<p><img src="/img/./images/vanderpol-1.png"><p>

<p>
Here is the phase portrait. You can see that a limit cycle is approached, indicating periodicity in the solution.
</p>

<p><img src="/img/./images/vanderpol-2.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/02/Solving-a-second-order-ode.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/02/02/Solving-a-second-order-ode">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="On-the-quad-or-trapz-d-in-ChemE-heaven"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/02/On-the-quad-or-trapz-d-in-ChemE-heaven/" rel="bookmark" title="Permanent Link to On the quad or trapz'd in ChemE heaven">On the quad or trapz'd in ChemE heaven</a></h2>
      <p><small><span class="blog_post_date">Posted February 02, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/integration/'>integration</a>, <a href='/blog/category/python/'>python</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:53 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>


<a href="http://matlab.cheme.cmu.edu/2011/09/12/on-the-quad-or-trapzd-in-cheme-heaven/" >Matlab post</a>
</p>

<p>
What is the difference between quad and trapz? The short answer is that quad integrates functions (via a function handle) using numerical quadrature, and trapz performs integration of arrays of data using the trapezoid method.
</p>

<p>
Let us look at some examples. We consider the example of computing \(\int_0^2 x^3 dx\). the analytical integral is \(1/4 x^4\), so we know the integral evaluates to 16/4 = 4. This will be our benchmark for comparison to the numerical methods.
</p>

<p>
We use the scipy.integrate.quad command  to evaluate this \(\int_0^2 x^3 dx\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

ans, err = quad(<span style="color: #8b0000;">lambda</span> x: x**3, 0, 2)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
4.0
</pre>

<p>
you can also define a function for the integrand.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">integrand</span>(x):
    <span style="color: #8b0000;">return</span> x**3

ans, err = quad(integrand, 0, 2)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
4.0
</pre>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Numerical data integration</h2>
<div class="outline-text-2" id="text-1">
<p>
if we had numerical data like this, we use trapz to integrate it
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

x = np.array([0, 0.5, 1, 1.5, 2])
y = x**3

i2 = np.trapz(y, x)

error = (i2 - 4)/4

<span style="color: #8b0000;">print</span> i2, error
</pre>
</div>

<pre class="example">
4.25 0.0625
</pre>

<p>
Note the integral of these vectors is greater than 4! You can see why here.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
x = np.array([0, 0.5, 1, 1.5, 2])
y = x**3

x2 = np.linspace(0, 2)
y2 = x2**3

plt.plot(x, y, label=<span style="color: #228b22;">'5 points'</span>)
plt.plot(x2, y2, label=<span style="color: #228b22;">'50 points'</span>)
plt.legend()
plt.savefig(<span style="color: #228b22;">'images/quad-1.png'</span>)
</pre>
</div>

<p><img src="/img/./images/quad-1.png"><p>

<p>
The trapezoid method is overestimating the area significantly. With more points, we get much closer to the analytical value.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

x2 = np.linspace(0, 2, 100)
y2 = x2**3

<span style="color: #8b0000;">print</span> np.trapz(y2, x2)
</pre>
</div>

<pre class="example">
4.00040812162
</pre>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Combining numerical data with quad</h2>
<div class="outline-text-2" id="text-2">
<p>
You might want to combine numerical data with the quad function if you want to perform integrals easily. Let us say you are given this data:
</p>

<p>
x = [0 0.5 1 1.5 2];
y = [0    0.1250    1.0000    3.3750    8.0000];
</p>

<p>
and you want to integrate this from x = 0.25 to 1.75. We do not have data in those regions, so some interpolation is going to be needed. Here is one approach.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.interpolate <span style="color: #8b0000;">import</span> interp1d
<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

x = [0, 0.5, 1, 1.5, 2]
y = [0,    0.1250,    1.0000,    3.3750,    8.0000]

f = interp1d(x, y)

<span style="color: #ff0000; font-weight: bold;"># numerical trapezoid method</span>
xfine = np.linspace(0.25, 1.75)
yfine = f(xfine)
<span style="color: #8b0000;">print</span> np.trapz(yfine, xfine)

<span style="color: #ff0000; font-weight: bold;"># quadrature with interpolation</span>
ans, err = quad(f, 0.25, 1.75)
<span style="color: #8b0000;">print</span> ans
</pre>
</div>

<pre class="example">
2.53199187838
2.53125
</pre>

<p>
These approaches are very similar, and both rely on linear interpolation. The second approach is simpler, and uses fewer lines of code.
</p>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Summary</h2>
<div class="outline-text-2" id="text-3">
<p>
trapz and quad are functions for getting integrals. Both can be used with numerical data if interpolation is used. The syntax for the quad and trapz function is different in scipy than in Matlab.
</p>

<p>
Finally, see this <a href="http://matlab.cheme.cmu.edu/2011/08/30/solving-integral-equations/" >post</a> for an example of solving an integral equation using quad and fsolve.</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/02/On-the-quad-or-trapz'd-in-ChemE-heaven.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/02/02/On-the-quad-or-trapz-d-in-ChemE-heaven">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Water-gas-shift-equilibria-via-the-NIST-Webbook"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook/" rel="bookmark" title="Permanent Link to Water gas shift equilibria via the NIST Webbook">Water gas shift equilibria via the NIST Webbook</a></h2>
      <p><small><span class="blog_post_date">Posted February 01, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-algebra/'>nonlinear algebra</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:46 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/12/12/water-gas-shift-equilibria-via-the-nist-webbook/" >Matlab post</a>
</p>

<p>
The <a href="http://webbook.nist.gov/chemistry/" >NIST webbook</a> provides parameterized models of the enthalpy, entropy and heat capacity of many molecules. In this example, we will examine how to use these to compute the equilibrium constant for the water gas shift reaction \(CO + H_2O \rightleftharpoons CO_2 + H_2\) in the temperature range of 500K to 1000K.
</p>

<p>
Parameters are provided for:
</p>

<p>
Cp = heat capacity (J/mol*K)
H = standard enthalpy (kJ/mol)
S = standard entropy (J/mol*K)
</p>

<p>
with models in the form: \(Cp^\circ = A + B*t + C*t^2 + D*t^3 + E/t^2\)
</p>

<p>
\(H^\circ - H^\circ_{298.15}= A*t + B*t^2/2 + C*t^3/3 + D*t^4/4 - E/t + F - H\)
</p>

<p>
\(S^\circ = A*ln(t) + B*t + C*t^2/2 + D*t^3/3 - E/(2*t^2) + G\)
</p>

<p>
where \(t=T/1000\), and \(T\) is the temperature in Kelvin. We can use this data to calculate equilibrium constants in the following manner. First, we have heats of formation at standard state for each compound; for elements, these are zero by definition, and for non-elements, they have values available from the NIST webbook. There are also values for the absolute entropy at standard state. Then, we have an expression for the change in enthalpy from standard state as defined above, as well as the absolute entropy. From these we can derive the reaction enthalpy, free energy and entropy at standard state, as well as at other temperatures.
</p>

<p>
We will examine the water gas shift enthalpy, free energy and equilibrium constant from 500K to 1000K, and finally compute the equilibrium composition of a gas feed containing 5 atm of CO and H_2 at 1000K.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

T = np.linspace(500,1000) <span style="color: #ff0000; font-weight: bold;"># degrees K</span>
t = T/1000;
</pre>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> hydrogen</h2>
<div class="outline-text-2" id="text-1">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C1333740&Units=SI&Mask=1#Thermo-Gas}
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># T = 298-1000K valid temperature range</span>
A =  33.066178
B = -11.363417
C =  11.432816
D = -2.772874
E = -0.158558
F = -9.980797
G =  172.707974
H =  0.0

Hf_29815_H2 = 0.0 <span style="color: #ff0000; font-weight: bold;"># kJ/mol</span>
S_29815_H2 = 130.68 <span style="color: #ff0000; font-weight: bold;"># J/mol/K</span>

dH_H2 = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_H2 = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> H_{2}O</h2>
<div class="outline-text-2" id="text-2">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&Units=SI&Mask=1#Thermo-Gas}
</p>

<p>
Note these parameters limit the temperature range we can examine, as these parameters are not valid below 500K. There is another set of parameters for lower temperatures, but we do not consider them here.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># 500-1700 K valid temperature range</span>
A =   30.09200
B =   6.832514
C =   6.793435
D =  -2.534480
E =   0.082139
F =  -250.8810
G =   223.3967
H =  -241.8264

Hf_29815_H2O = -241.83 <span style="color: #ff0000; font-weight: bold;">#this is Hf.</span>
S_29815_H2O = 188.84

dH_H2O = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_H2O = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> CO</h2>
<div class="outline-text-2" id="text-3">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C630080&Units=SI&Mask=1#Thermo-Gas}
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># 298. - 1300K valid temperature range</span>
A =   25.56759
B =   6.096130
C =   4.054656
D =  -2.671301
E =   0.131021
F =  -118.0089
G =   227.3665
H = -110.5271

Hf_29815_CO = -110.53 <span style="color: #ff0000; font-weight: bold;">#this is Hf kJ/mol.</span>
S_29815_CO = 197.66

dH_CO = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_CO = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> CO_{2}</h2>
<div class="outline-text-2" id="text-4">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C124389&Units=SI&Mask=1#Thermo-Gas}
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># 298. - 1200.K valid temperature range</span>
A =   24.99735
B =   55.18696
C =  -33.69137
D =   7.948387
E =  -0.136638
F =  -403.6075
G =   228.2431
H =  -393.5224

Hf_29815_CO2 = -393.51 <span style="color: #ff0000; font-weight: bold;"># this is Hf.</span>
S_29815_CO2 = 213.79

dH_CO2 = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_CO2 = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Standard state heat of reaction</h2>
<div class="outline-text-2" id="text-5">
<p>
We compute the enthalpy and free energy of reaction at 298.15 K for the following reaction \(CO + H2O \rightleftharpoons H2 + CO2\).
</p>

<div class="org-src-container">

<pre class="src src-python">Hrxn_29815 = Hf_29815_CO2 + Hf_29815_H2 - Hf_29815_CO - Hf_29815_H2O;
Srxn_29815 = S_29815_CO2 + S_29815_H2 - S_29815_CO - S_29815_H2O;
Grxn_29815 = Hrxn_29815 - 298.15*(Srxn_29815)/1000;

<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'deltaH = {0:1.2f}'</span>.format(Hrxn_29815))
<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'deltaG = {0:1.2f}'</span>.format(Grxn_29815))
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; deltaH = -41.15
deltaG = -28.62
</pre>
</div>
</div>
<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Non-standard state \(\Delta H\) and \(\Delta G\)</h2>
<div class="outline-text-2" id="text-6">
<p>
We have to correct for temperature change away from standard state. We only correct the enthalpy for this temperature change. The correction looks like this:
</p>

<p>
$$ \Delta H_{rxn}(T) = \Delta H_{rxn}(T_{ref}) + \sum_i \nu_i (H_i(T)-H_i(T_{ref}))$$
</p>

<p>
Where \(\nu_i\) are the stoichiometric coefficients of each species, with appropriate sign for reactants and products, and \((H_i(T)-H_i(T_{ref})\) is precisely what is calculated for each species with the equations
</p>

<p>
The entropy is on an absolute scale, so we directly calculate entropy at each temperature. Recall that H is in kJ/mol and S is in J/mol/K, so we divide S by 1000 to make the units match.
</p>
<div class="org-src-container">

<pre class="src src-python">Hrxn = Hrxn_29815 + dH_CO2 + dH_H2 - dH_CO - dH_H2O
Grxn = Hrxn - T*(S_CO2 + S_H2 - S_CO - S_H2O)/1000
</pre>
</div>
</div>
</div>
<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Plot how the \(\Delta G\) varies with temperature</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.figure(); plt.clf()
plt.plot(T,Grxn, label=<span style="color: #228b22;">'$\Delta G_{rxn}$'</span>)
plt.plot(T,Hrxn, label=<span style="color: #228b22;">'$\Delta H_{rxn}$'</span>)
plt.xlabel(<span style="color: #228b22;">'Temperature (K)'</span>)
plt.ylabel(<span style="color: #228b22;">'(kJ/mol)'</span>)
plt.legend( loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/wgs-nist-1.png'</span>)
</pre>
</div>

<pre class="example">
&lt;matplotlib.figure.Figure object at 0x04199CF0&gt;
[&lt;matplotlib.lines.Line2D object at 0x0429BF30&gt;]
[&lt;matplotlib.lines.Line2D object at 0x0427DFB0&gt;]
&lt;matplotlib.text.Text object at 0x041B79F0&gt;
&lt;matplotlib.text.Text object at 0x040CEF70&gt;
&lt;matplotlib.legend.Legend object at 0x043CB5F0&gt;
</pre>

<p><img src="/img/./images/wgs-nist-1.png"><p>

<p>
Over this temperature range the reaction is exothermic, although near 1000K it is just barely exothermic. At higher temperatures we expect the reaction to become endothermic.
</p>
</div>
</div>
<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Equilibrium constant calculation</h2>
<div class="outline-text-2" id="text-8">
<p>
Note the equilibrium constant starts out high, i.e. strongly favoring the formation of products, but drops very quicky with increasing temperature.
</p>

<div class="org-src-container">

<pre class="src src-python">R = 8.314e-3 <span style="color: #ff0000; font-weight: bold;"># kJ/mol/K</span>
K = np.exp(-Grxn/R/T);

plt.figure()
plt.plot(T,K)
plt.xlim([500, 1000])
plt.xlabel(<span style="color: #228b22;">'Temperature (K)'</span>)
plt.ylabel(<span style="color: #228b22;">'Equilibrium constant'</span>)
plt.savefig(<span style="color: #228b22;">'images/wgs-nist-2.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &lt;matplotlib.figure.Figure object at 0x044DBE90&gt;
[&lt;matplotlib.lines.Line2D object at 0x045A53F0&gt;]
(500, 1000)
&lt;matplotlib.text.Text object at 0x04577470&gt;
&lt;matplotlib.text.Text object at 0x0457F410&gt;
</pre>

<p><img src="/img/./images/wgs-nist-2.png"><p>
</div>
</div>
<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Equilibrium yield of WGS</h2>
<div class="outline-text-2" id="text-9">
<p>
Now let us suppose we have a reactor with a feed of H_2O and CO at 10atm at 1000K. What is the equilibrium yield of H_2? Let \(\epsilon\) be the extent of reaction, so that \(F_i = F_{i,0} + \nu_i \epsilon\). For reactants, \(\nu_i\) is negative, and for products, \(\nu_i\) is positive. We have to solve for the extent of reaction that satisfies the equilibrium condition.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.interpolate <span style="color: #8b0000;">import</span> interp1d
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #ff0000; font-weight: bold;"># </span>
<span style="color: #ff0000; font-weight: bold;"># A = CO</span>
<span style="color: #ff0000; font-weight: bold;"># B = H2O</span>
<span style="color: #ff0000; font-weight: bold;"># C = H2</span>
<span style="color: #ff0000; font-weight: bold;"># D = CO2</span>

Pa0 = 5; Pb0 = 5; Pc0 = 0; Pd0 = 0;  <span style="color: #ff0000; font-weight: bold;"># pressure in atm</span>
R = 0.082;
Temperature = 1000;

<span style="color: #ff0000; font-weight: bold;"># we can estimate the equilibrium like this. We could also calculate it</span>
<span style="color: #ff0000; font-weight: bold;"># using the equations above, but we would have to evaluate each term. Above</span>
<span style="color: #ff0000; font-weight: bold;"># we simply computed a vector of enthalpies, entropies, etc... Here we interpolate</span>
K_func = interp1d(T,K);
K_Temperature = K_func(1000)


<span style="color: #ff0000; font-weight: bold;"># If we let X be fractional conversion then we have $C_A = C_{A0}(1-X)$,</span>
<span style="color: #ff0000; font-weight: bold;"># $C_B = C_{B0}-C_{A0}X$, $C_C = C_{C0}+C_{A0}X$, and $C_D =</span>
<span style="color: #ff0000; font-weight: bold;"># C_{D0}+C_{A0}X$. We also have $K(T) = (C_C C_D)/(C_A C_B)$, which finally</span>
<span style="color: #ff0000; font-weight: bold;"># reduces to $0 = K(T) - Xeq^2/(1-Xeq)^2$ under these conditions.</span>

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f</span>(X):
    <span style="color: #8b0000;">return</span> K_Temperature - X**2/(1-X)**2;

x0 = 0.5
Xeq, = fsolve(f, x0)

<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'The equilibrium conversion for these feed conditions is: {0:1.2f}'</span>.format(Xeq))
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... &gt;&gt;&gt; ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.54504291144
The equilibrium conversion for these feed conditions is: 0.55
</pre>
</div>
</div>
<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Compute gas phase pressures of each species</h2>
<div class="outline-text-2" id="text-10">
<p>
Since there is no change in moles for this reaction, we can directly calculation the pressures from the equilibrium conversion and the initial pressure of gases. you can see there is a slightly higher pressure of H_2 and CO_2 than the reactants, consistent with the equilibrium constant of about 1.44 at 1000K. At a lower temperature there would be a much higher yield of the products. For example, at 550K the equilibrium constant is about 58, and the pressure of H_2 is 4.4 atm due to a much higher equilibrium conversion of 0.88.
</p>

<div class="org-src-container">

<pre class="src src-python">P_CO = Pa0*(1-Xeq)
P_H2O = Pa0*(1-Xeq)
P_H2 = Pa0*Xeq
P_CO2 = Pa0*Xeq

<span style="color: #8b0000;">print</span> P_CO,P_H2O, P_H2, P_CO2
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 2.2747854428 2.2747854428 2.7252145572 2.7252145572
</pre>
</div>
</div>
<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Compare the equilibrium constants</h2>
<div class="outline-text-2" id="text-11">
<p>
We can compare the equilibrium constant from the Gibbs free energy and the one from the ratio of pressures. They should be the same!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> K_Temperature
<span style="color: #8b0000;">print</span> (P_CO2*P_H2)/(P_CO*P_H2O)
</pre>
</div>

<pre class="example">
1.43522674762
1.43522674762
</pre>

<p>
They are the same.
</p>
</div>
</div>
<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> Summary</h2>
<div class="outline-text-2" id="text-12">
<p>
The NIST Webbook provides a plethora of data for computing thermodynamic properties. It is a little tedious to enter it all into Matlab, and a little tricky to use the data to estimate temperature dependent reaction energies. A limitation of the Webbook is that it does not tell you have the thermodynamic properties change with pressure. Luckily, those changes tend to be small.
</p>

<p>
I noticed a different behavior in interpolation between scipy.interpolate.interp1d and Matlab's interp1. The scipy function returns an interpolating function, whereas the Matlab function directly interpolates new values, and returns the actual interpolated data. 
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook">Discuss on Twitter</a>

  <hr class="interblog" />
 <a href="../110">« Previous Page</a>
  --  
 <a href="../112">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2023/04/15/New-publication-High-throughput-discovery-of-ternary-Cu-Fe-Ru-alloy-catalysts-for-photo-driven-hydrogen-production/">New publication - High throughput discovery of ternary Cu-Fe-Ru alloy catalysts for photo-driven hydrogen production</a></li>
      <li><a href="/blog/2023/02/25/MS-Word-comments-from-org-mode/">MS Word comments from org-mode</a></li>
      <li><a href="/blog/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve/">Update on finding the minimum distance from a point to a curve</a></li>
      <li><a href="/blog/2023/02/01/Caching-expensive-function-calls-so-you-don-t-have-to-rerun-them/">Caching expensive function calls so you don't have to rerun them</a></li>
      <li><a href="/blog/2023/01/01/2022-in-a-nutshell/">2022 in a nutshell</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2023
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



