

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Separating-code-blocks-from-results-in-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/02/08/Separating-code-blocks-from-results-in-org-mode/" rel="bookmark" title="Permanent Link to Separating code blocks from results in org-mode">Separating code blocks from results in org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted February 08, 2014 at 08:54 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/org-mode/'>org-mode</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 08, 2014 at 09:15 AM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Appendix of code</a>
<ul>
<li><a href="#sec-1-1">1.1. Area of a circle</a></li>
<li><a href="#sec-1-2">1.2. Hello function</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
I often put my code blocks right where I need them in my org documents. It usually has a section explaining what I want to do, then the code block that implements the idea, following by the output. Sometimes the code blocks are long, however, and it might be desirable for that code to be in an appendix. <sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>
</p>

<p>
Org-mode enables this with #+CALL. For example, I have a function named <code>circle-area</code> in the appendix of this post that calculates the area of a circle given its radius. The function is "named" by a line like this:
</p>

<pre class="example">
#+name: function-name
</pre>

<p>
I can use the function like this:
</p>

<pre class="example">
#+CALL: circle-area(1)
</pre>

<pre class="example">
3.14159265359
</pre>

<p>
That is pretty nice. You can separate the code out from the main document. You still have to put the #+CALL: line in though. It may be appropriate to put a call inline with your text. If you add the following sentence, and put your cursor on the call<sub>circle</sub>-area and press C-c C-c, the output is put in verbatim markers right after it. 
</p>

<pre class="example">
The area of a circle with unit radius is call_circle-area(1).
</pre>

<p>
The area of a circle with unit radius is <code>3.14159265359</code>. 
</p>

<p>
Here is another interesting way to do it. We can specify a named results block. Let us consider another function named <code>hello-block</code> that prints output. We specify a named results block like this:
</p>

<pre class="example">
#+RESULTS: function-name
</pre>

<p>
Now, whenever you execute that block, the results will get put where this line is like this.
</p>

<pre class="example">
hello John
</pre>

<p>
These could be useful approaches to making the "top" of your document cleaner, with less code in it. The code of course is still in the document, but at the end, in an appendix for example. This kind of separation might make it a little harder to find the code, and to reevaluate it,<sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup> but it might improve the readability for others. 
</p>




<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Appendix of code</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Area of a circle</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<pre class="src src-python" id="circle-area"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">return</span> np.pi * r**2
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Hello function</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-python" id="hello-block"><span style="color: #8b0000;">print</span> <span style="color: #228b22;">'hello '</span> + name
</pre>
</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p>
I know I can pretty conveniently collapse a code block by pressing tab on the header. Sometimes that is not enough.
</p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p>
It is not much harder, C-s will let you search for the named block. I do not know if there are nice convenient navigation commands for this.
</p></div>


</div>
</div><p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/08/Separating-code-blocks-from-results-in-org-mode.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2014/02/08/Separating-code-blocks-from-results-in-org-mode">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="New-publication-in-Applied-Materials-and-Interfaces"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/02/06/New-publication-in-Applied-Materials-and-Interfaces/" rel="bookmark" title="Permanent Link to New publication in Applied Materials and Interfaces">New publication in Applied Materials and Interfaces</a></h2>
      <p><small><span class="blog_post_date">Posted February 06, 2014 at 04:04 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/news/'>news</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<b>Identifying Potential BO2 Oxide Polymorphs for Epitaxial Growth Candidates</b>,
by Prateek Mehta, Paul A. Salvador, and John R. Kitchin
<a href="http://pubs.acs.org/doi/full/10.1021/am4059149">http://pubs.acs.org/doi/full/10.1021/am4059149</a> 
</p>

<p>
Transition metal dioxides (BO2) exhibit a number of polymorphic structures with distinct properties, but the isolation of different polymorphs for a given composition is carried out using trial and error experimentation. We present computational studies of the relative stabilities and equations of state for six polymorphs (anatase, brookite, rutile, columbite, pyrite, and fluorite) of five different BO2 dioxides (B = Ti, V, Ru, Ir, and Sn). These properties were computed in a consistent fashion using several exchange correlation functionals within the density functional theory formalism, and the effects of the different functionals are discussed relative to their impact on predictive synthesis. We compare the computational results to prior observations of high-pressure synthesis and epitaxial film growth and then use this discussion to predict new accessible polymorphs in the context of epitaxial stabilization using isostructural substrates. For example, the relative stabilities of the columbite polymorph for VO2 and RuO2 are similar to those of TiO2 and SnO2, the latter two of which have been previously stabilized as epitaxial films.
</p>

<p>
As with other recent papers, the supporting information file contains embedded data files that enable the reproduction of the data and figures in the paper.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/06/New-publication-in-Applied-Materials-and-Interfaces.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2014/02/06/New-publication-in-Applied-Materials-and-Interfaces">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Invisible-text-in-emacs"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/02/06/Invisible-text-in-emacs/" rel="bookmark" title="Permanent Link to Invisible text in emacs">Invisible text in emacs</a></h2>
      <p><small><span class="blog_post_date">Posted February 06, 2014 at 09:02 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs/'>emacs</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 06, 2014 at 09:03 AM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#beginner">1. subsection 1</a></li>
<li><a href="#sec-2">2. subsection 2</a></li>
<li><a href="#sec-3">3. subsection 3</a></li>
</ul>
</div>
</div>
<p>
Emacs supports <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Invisible-Text.html">invisible text</a> . In other words, you can use code to set properties on text in a buffer that make it visible, or invisible. You can use code to change the invisibility properties of text. 
</p>

<p>
I have been exploring ways to conditionally navigate in org documents using links. These links may validate that some property has been set in a heading, for example. An alternative approach is to make regions visible, depending on some criteria. That is what we do today. You will probably want to see this  <a href="/media/2014-02-06-Invisible-text-in-emacs/invisible-text.swf">video</a> , since what happens in this post is dynamic, and you will not see visible and invisible text.
</p>

<p>
What I have below here are a set of headings with properties that indicate what "level" they are at: beginner, medium and advanced. 
First, we mark each org subtree  with an overlay that has an 'invisible property that contains the "level". Then, we add the "level" to the list of symbols that marks invisible sections.  If you run this block, the headings all disappear.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-map-entries (<span style="color: #8b0000;">lambda</span> () 
                   (<span style="color: #8b0000;">let</span> ((level (org-entry-get (point) <span style="color: #228b22;">"level"</span>))
                          (symbol-level))
                     (<span style="color: #8b0000;">when</span> level
                       (setq symbol-level (intern level))
                       (org-mark-subtree)                 
                       (overlay-put (make-overlay (point) (mark))
                                    'invisible 
                                    symbol-level)
                       <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">make regions with symbol-level invisible</span>
                       (add-to-invisibility-spec `(,symbol-level))))))
</pre>
</div>

<p>
Now, we can selectively make them appear with these links.
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(beginner))</pre> 
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(medium))</pre> 
</p>

<p>
<pre>elisp:(remove-from-invisibility-spec '(advanced))</pre> 
</p>

<p>
I imagine this could be useful to show selective content based on user choices. I am not sure it is better than links to external files. I imagine you would have to open this org file by some elisp command that would run the block at the top to make everything invisible, and then show it to the user. You could definitely build in more complex code to determine if a user was allowed to open a section. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">level2-p</span> ()
  <span style="color: #228b22;">"return if user is ready for level 2 based on value of property named correct"</span>
  (interactive)
  (<span style="color: #8b0000;">save-excursion</span>
    (org-open-link-from-string <span style="color: #228b22;">"[[#beginner]]"</span>)
    (<span style="color: #8b0000;">let</span> ((val (org-entry-get (point) <span style="color: #228b22;">"correct"</span>)))
      (<span style="color: #8b0000;">if</span> (and val (string= val <span style="color: #228b22;">"true"</span>))
          t
        nil))))
</pre>
</div>

<pre class="example">
level2-p
</pre>

<p>
Now, we can build this link: <pre>elisp:(when (level2-p) (remove-from-invisibility-spec '(medium)))</pre> 
</p>

<p>
This will show the medium level, provided we have already opened the beginner level and set the property value correctly.
</p>

<div id="outline-container-beginner" class="outline-2">
<h2 id="beginner"><a id="sec-1"></a><span class="section-number-2">1</span> subsection 1</h2>
<div class="outline-text-2" id="text-beginner">
<p>
some text in 1
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> subsection 2</h2>
<div class="outline-text-2" id="text-2">
<p>
more text in 2
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> subsection 3</h2>
<div class="outline-text-2" id="text-3">
<p>
last section 3
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/06/Invisible-text-in-emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2014/02/06/Invisible-text-in-emacs">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Add-time-to-a-deadline"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/02/05/Add-time-to-a-deadline/" rel="bookmark" title="Permanent Link to Add time to a deadline">Add time to a deadline</a></h2>
      <p><small><span class="blog_post_date">Posted February 05, 2014 at 09:41 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/org-mode/'>org-mode</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. s1</a></li>
<li><a href="#sec-2">2. s1</a></li>
<li><a href="#sec-3">3. s1</a></li>
</ul>
</div>
</div>
<p>
I have an application where an org-file is a template with some due dates in it. I would like to update the deadlines to make them all relative to today. In this post I explore a way to do that. The strategy is to find deadlines, parse the time out of the time stamp, add an appropriate amount of time, and replace the time stamp. For this exercise, we use this org-file, which has one DEADLINE of "2014-01-13 Mon", and I want to add 60 days to the time stamp. 
</p>

<p>
Amazingly, emacs can parse time strings into a format that it can understand. I do not claim to understand what this function returns, but it is some representation of time that emacs understands.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>)
</pre>
</div>

<p>
(21203 11392)
</p>

<p>
Now, we can add time to that format. Let us say I want to add 60 days. In emacs, we add seconds to a time, so 60 days is 60 days * 24 hours * 60 minutes * 60 seconds, or in elisp: (* 60 24 60 60).
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((sixty-days (seconds-to-time (* 60 24 60 60))))
  (time-add (date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>) sixty-days))
</pre>
</div>

<p>
(21282 18048 0 0)
</p>

<p>
That does not make too much sense, so we can use another function to format it like a new time stamp.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((sixty-days (seconds-to-time (* 60 24 60 60))))
  (format-time-string <span style="color: #228b22;">"&lt;%Y-%m-%d %a&gt;"</span>
                      (time-add (date-to-time <span style="color: #228b22;">"&lt;2014-01-13 Mon&gt;"</span>) sixty-days)))
</pre>
</div>

<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2014-03-13 Thu&gt;</span></span>
</p>

<p>
Beautiful. We just got a timestamp that is 60 days later than the original timestamp. Now we just search forward to find deadline, get the time stamp, add the time to it, and replace the line. I specifically want to change deadlines, so we will develop a regular expression for that. Here is a block that searches forward for a DEADLINE, parses it, adds 60 days to it, and replaces the deadline. The regular expression is limited to timestamps that look like &lt;yyyy-mm-dd day&gt;, i.e. no warnings or repeaters are found. In this post, there is subheading that looks like this initially:
</p>

<p>
#+BEGIN<sub>EXAMPLE</sub>
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> s1</h2>
<div class="outline-text-2" id="text-1">
<p>
#+END<sub>EXAMPLE</sub>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">progn</span>
  (<span style="color: #8b0000;">save-excursion</span>
    <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">go to timestamp</span>
    (re-search-forward <span style="color: #228b22;">"DEADLINE:\\s-*&lt;</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{4\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{2\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[0-9]\\{2\\}</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">\\s-</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">Mon</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Tue</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Wed</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Thu</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Fri</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Sat</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">|</span><span style="color: #228b22;">Sun</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">&gt;"</span>)
    (<span style="color: #8b0000;">let</span> ((ts (match-string 1)) <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">this is the timestamp</span>
          (sixty-days (seconds-to-time (* 60 24 60 60)))
          (new-ts))
      (setq new-ts (format-time-string <span style="color: #228b22;">"    DEADLINE: &lt;%Y-%m-%d %a&gt;"</span>
                                       (time-add (date-to-time ts) sixty-days)))
      <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">now we kill the old time stamp, and insert the new one</span>
      (beginning-of-line)
      (kill-line)
      (insert new-ts))))
</pre>
</div>

<p>
After we run the code above, the deadline looks like this:
#+BEGIN<sub>EXAMPLE</sub>
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> s1</h2>
<div class="outline-text-2" id="text-2">
<p>
#+END<sub>EXAMPLE</sub>
</p>

<p>
We succeeded in moving it by 60 days. An interesting application of this would be to make all the deadlines in an org-file relative to some baseline date. For example, you have a series of deadlines for assignments throughout a semester, and it would be tedious to update these by hand. Suppose you could just establish a new beginning date, and make all deadlines relative to that date with a command. That seems useful. 
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> s1</h2>
<div class="outline-text-2" id="text-3">
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/05/Add-time-to-a-deadline.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2014/02/05/Add-time-to-a-deadline">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Literate-programming-example-with-Fortran-and-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/02/04/Literate-programming-example-with-Fortran-and-org-mode/" rel="bookmark" title="Permanent Link to Literate programming example with Fortran and org-mode">Literate programming example with Fortran and org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted February 04, 2014 at 10:22 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/org-mode/'>org-mode</a>, <a href='/blog/category/literate-programming/'>literate-programming</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated February 06, 2014 at 10:28 AM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. A slightly more complicated example.</a></li>
<li><a href="#sec-2">2. Summary key points</a></li>
</ul>
</div>
</div>
<p>
Update: see a short video of how this post works here: <a href="/media/2014-02-04-Literate-programming-example-with-Fortran-and-org-mode/literate-programming.swf">video</a> 
</p>

<p>
I want to illustrate the literate programming capabilities of org-mode. One idea in literate programming is to have code in blocks surrounded by explanatory text. There is a process called "tangling", which extracts the code, and possibly compiles and runs it. I have typically used python and emacs-lisp in org-mode, but today we look at using Fortran. 
</p>

<p>
The first simple example is a hello world fortran program. Typically you create a file containing code like this:
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span style="color: #8b0000;">PROGRAM</span> <span style="color: #8b2323;">hello</span>

<span style="color: #8b0000;">PRINT</span> *, <span style="color: #228b22;">"Hello world"</span>

<span style="color: #8b0000;">END</span> <span style="color: #8b0000;">PROGRAM</span> <span style="color: #8b2323;">hello</span>
</pre>
</div>

<p>
That file can be named something like hello.f90. We specify that in the source block header like this:
</p>

<pre class="example">
:tangle hello.f90
</pre>

<p>
There are a variety of ways to build your program. Let us create a makefile to do it. We will specify that this block is tangled to a Makefile like this:
</p>
<pre class="example">
:tangle Makefile
</pre>

<p>
Our Makefile will have three targets: 
</p>
<ol class="org-ol">
<li>hello, which compiles our program to an executable called a.out. 
</li>
<li>execute, which depends on hello, and runs the executable
</li>
<li>clean, which deletes a.out if it exists
</li>
</ol>

<div class="org-src-container">

<pre class="src src-makefile"><span style="color: #8b2323;">hello</span>:  hello.f90
        gfortran hello.f90

<span style="color: #8b2323;">execute</span>: hello
        ./a.out

<span style="color: #8b2323;">clean</span>:
        rm -f a.out *.o
</pre>
</div>

<p>
Now, we can run <pre>elisp:(org-babel-tangle)</pre> , which will extract these files to the current directory. Here is evidence that the files exist.
</p>

<div class="org-src-container">

<pre class="src src-sh">ls
</pre>
</div>

<pre class="example">
hello.f90
literate.org
Makefile
</pre>

<p>
Let us go a step further, and use the makefile to execute our program. The first time you run this, you will see that the 
</p>

<div class="org-src-container">

<pre class="src src-sh">make clean execute
</pre>
</div>

<pre class="example">
rm -f a.out *.o
gfortran hello.f90
./a.out
 Hello world
</pre>

<p>
That works well! The only really inconvenient issue is that if you update the Fortran code above, you have to manually rerun  <pre>elisp:(org-babel-tangle)</pre> , then run the <code>make execute</code> command. We can combine that in a single block, where you do both things at once. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-babel-tangle)
(shell-command-to-string <span style="color: #228b22;">"make clean execute"</span>)
</pre>
</div>

<pre class="example">
rm -f a.out *.o
gfortran hello.f90
./a.out
 Hello world
</pre>

<p>
That is it in a nutshell. We had a source block for a Fortran program, and a source block for the Makefile. After tangling the org-file, we have those files available for us to use. Next, let us consider a little more complicated example.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> A slightly more complicated example.</h2>
<div class="outline-text-2" id="text-1">
<p>
Now, let us consider a Fortran code with two files. We will define a module file, and a program file. The module file contains a function to compute the area of a circle as a function of its radius. Here is our module file, which is tangled to circle.f90.
</p>

<div class="org-src-container">

<pre class="src src-fortran">MODULE Circle
      <span style="color: #4682b4;">implicit None</span>
      public :: area
<span style="color: #ff0000; font-weight: bold;">c</span><span style="color: #ff0000; font-weight: bold;">ontains</span>
      <span style="color: #8b0000;">function</span> <span style="color: #8b2323;">area</span>(r) 
      <span style="color: #4682b4;">implicit none</span>
      <span style="color: #4682b4;">real</span>, intent(in) :: r
      <span style="color: #4682b4;">real</span> :: area
      area = 3.14159 * r**2
      <span style="color: #8b0000;">return</span>
      <span style="color: #8b0000;">end</span> <span style="color: #8b0000;">function</span> <span style="color: #8b2323;">area</span>
<span style="color: #8b0000;">END</span> MODULE Circle
</pre>
</div>

<p>
Now, we write a program that will print a table of circle areas. Here we hard-code an array of 5 radius values, then loop through the values and get the area of the circle with that radius. We will print some output that generates an org-mode <a href="http://orgmode.org/manual/Tables.htm">table</a> . In this program, we <code>use</code> our module defined above.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span style="color: #8b0000;">program</span> <span style="color: #8b2323;">main</span>
      
use circle, only: area

<span style="color: #4682b4;">implicit none</span>
<span style="color: #4682b4;">integer</span> :: i
<span style="color: #4682b4;">REAL</span>, <span style="color: #4682b4;">DIMENSION</span>(<span style="color: #8b008b;">5</span>) :: R
R = (/1.0, 2.0, 3.0, 4.0, 5.0 /)

<span style="color: #8b0000;">print</span> *, <span style="color: #228b22;">"#+tblname: circle-area"</span>
<span style="color: #ff0000; font-weight: bold;">d</span><span style="color: #ff0000; font-weight: bold;">o i = 1, 5</span>
  <span style="color: #8b0000;">print</span> *, <span style="color: #228b22;">"|"</span>, R(i), <span style="color: #228b22;">"|"</span>, area(R(i)), <span style="color: #228b22;">"|"</span>
<span style="color: #8b0000;">end</span> <span style="color: #8b0000;">do</span>

<span style="color: #8b0000;">end</span> <span style="color: #8b0000;">program</span> <span style="color: #8b2323;">main</span>
</pre>
</div>

<p>
Now, we make a makefile that will build this program. I use a different name for the file, since we already have a Makefile in this directory from the last example.  I also put @ at the front of each command in the makefile to suppress it from being echoed when we run it. Later, we will use the makefile to compile the program, and then run it, and we only want the output of the program. 
</p>

<p>
The compiling instructions are more complex. We have to compile the circle module first, and then the main program. Here is our makefile. 
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span style="color: #8b2323;">circle</span>:
        <span style="color: #4682b4;">@</span>gfortran -c circle.f90

<span style="color: #8b2323;">main</span>: circle
        <span style="color: #4682b4;">@</span>gfortran -c main.f90
        <span style="color: #4682b4;">@</span>gfortran circle.o main.o -o main

<span style="color: #8b2323;">clean</span>:
        <span style="color: #4682b4;">@</span>rm -f *.o main
</pre>
</div>

<p>
Now, we run this block, which tangles out our new files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-babel-tangle)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">main.f90</td>
<td class="left">circle.f90</td>
<td class="left">hello.f90</td>
<td class="left">makefile-main</td>
<td class="left">Makefile</td>
</tr>
</tbody>
</table>

<p>
Note that results above show we have tangled <i>all</i> the source blocks in this file. You can limit the scope of tangling, by narrowing to a subtree, but that is beyond our aim for today.
</p>

<p>
Finally, we are ready to build our program. We specify the new makefile with the <code>-f</code> option to make. We use the clean target to get rid of old results, and then the main target with builds the program. Since main depends on circle, the circle file is compiled first. 
</p>

<p>
Note in this block I use this header:
</p>
<pre class="example">
#+BEGIN_SRC sh :results raw
</pre>

<p>
That will tell the block to output the results directly in the buffer. I have the fortran code prename the table, and put | around the entries, so this entry is output directly as an org table. 
</p>

<div class="org-src-container">

<pre class="src src-sh">make -f makefile-main clean main
./main
</pre>
</div>

<table id="circle-area" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">1.000000</td>
<td class="right">3.141590</td>
</tr>

<tr>
<td class="right">2.000000</td>
<td class="right">12.56636</td>
</tr>

<tr>
<td class="right">3.000000</td>
<td class="right">28.27431</td>
</tr>

<tr>
<td class="right">4.000000</td>
<td class="right">50.26544</td>
</tr>

<tr>
<td class="right">5.000000</td>
<td class="right">78.53975</td>
</tr>
</tbody>
</table>



<p>
It takes some skill getting used to using <code>:results raw</code>. The results are not replaced if you run the code again. That can be inconvenient if you print a very large table, which you must manually delete. 
</p>


<p>
Now that we have a named org table, I can use that table as data in other source blocks, e.g. here in python. You define variables in the header name by referring to the tblname like this.
</p>

<pre class="example">
#+BEGIN_SRC python :var data=circle-area
</pre>

<p>
Then, data is available as a variable in your code. Let us try it and plot the area vs. radius here. For more fun, we will make the plot <a href="http://xkcd.com/">xkcd</a> , so it looks like I sketched it by hand.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.xkcd()

<span style="color: #8b0000;">print</span> data <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">data is a list </span>
<span style="color: #8b008b;">data</span> = np.array(data)
plt.plot(data[:, 0], data[:, 1])
plt.xlabel(<span style="color: #228b22;">'radius'</span>)
plt.ylabel(<span style="color: #228b22;">'area'</span>)
plt.savefig(<span style="color: #228b22;">'circle-area.png'</span>)
</pre>
</div>

<pre class="example">
[[1.0, 3.14159], [2.0, 12.56636], [3.0, 28.27431], [4.0, 50.26544], [5.0, 78.53975]]
</pre>


<div class="figure">
<p><img src="/media/2014-02-04-Literate-programming-example-with-Fortran-and-org-mode/circle-area.png"> 
</p>
</div>

<p>
It appears the area increases quadratically with radius. No surprise there! For fun, let us show that. If we divide each area by \(r^2\), we should get back &pi;. Let us do this in emacs-lisp, just to illustrate how flexibly we can switch between languages. In lisp, the data structure will be a list of items like ((radius1 area1) (radius2 area2)&#x2026;). So, we just map a function that divides the area (the second element of an entry) by the square of the first element. My lisp-fu is only average, so I use the <code>nth</code> function to get those elements. We also load the calc library to get the math-pow function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">require</span> '<span style="color: #cd0000;">calc</span>)
(mapcar (<span style="color: #8b0000;">lambda</span> (x) (/ (nth 1 x) (math-pow (nth 0 x) 2))) data)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
<td class="right">3.14159</td>
</tr>
</tbody>
</table>


<p>
Indeed, we get &pi; for each element, which shows in fact that the area does increase quadratically with radius.
</p>

<p>
You can learn more about tangling source code from org-mode here <a href="http://orgmode.org/manual/Extracting-source-code.html">http://orgmode.org/manual/Extracting-source-code.html</a> .
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Summary key points</h2>
<div class="outline-text-2" id="text-2">
<ol class="org-ol">
<li>You can organize source files in org-mode as source blocks which can be "tangled" to "real" source code.
</li>
<li>You can build into your org-file(s) even the Makefile, or other building instructions.
</li>
<li>You can even run the build program, and the resulting programs from org-mode to capture data.
</li>
<li>Once that data is in org-mode, you can reuse it in other source blocks, including other languages. 
</li>
</ol>

<p>
What benefits could there be for this? One is you work in org-mode, which allows you to structure a document in different ways than code does. You can use headings to make the hierarchy you want. You can put links in places that allow you to easily navigate the document. Second, you can build in the whole workflow into your document, from building to execution. Third, you could have a self-contained file that extracts what someone else needs, but which has documentation and explanation built into it, <i>which you wrote as you developed the program</i>, rather than as an afterthought. You can still edit each block in its native emacs-mode, and have org-mode too. That is something like having cake, <i>and eating it too</i>!
</p>

<p>
Downsides? Probably. Most IDE/project type environments are designed for code. These tools offer nice navigation between functions and files. I don't use those tools, but I imagine if you are hooked on them, you might have to learn something new this way.
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/04/Literate-programming-example-with-Fortran-and-org-mode.org">org-mode source</a><p><p>Org-mode version = 8.2.5h</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2014/02/04/Literate-programming-example-with-Fortran-and-org-mode">Discuss on Twitter</a>

  <hr class="interblog" />
 <a href="../69">« Previous Page</a>
  --  
 <a href="../71">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2023/01/01/2022-in-a-nutshell/">2022 in a nutshell</a></li>
      <li><a href="/blog/2022/09/29/New-publication-Identifying-limitations-in-screening-high-throughput-photocatalytic-bimetallic-nanoparticles-with-machine-learned-hydrogen-adsorptions/">New publication - Identifying limitations in screening high-throughput photocatalytic bimetallic nanoparticles with machine-learned hydrogen adsorptions</a></li>
      <li><a href="/blog/2022/09/12/New-publication-Neural-network-embeddings-based-similarity-search-method-for-atomistic-systems/">New publication - Neural network embeddings based similarity search method for atomistic systems</a></li>
      <li><a href="/blog/2022/03/07/New-publication-Evaluation-of-the-Degree-of-Rate-Control-via-Automatic-Differentiation/">New publication - Evaluation of the Degree of Rate Control via Automatic Differentiation</a></li>
      <li><a href="/blog/2022/03/06/New-publication-Model-Specific-to-Model-General-Uncertainty-for-Physical-Properties/">New publication - Model-Specific to Model-General Uncertainty for Physical Properties</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2023
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



