

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Solving-a-second-order-ode"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/02/Solving-a-second-order-ode/" rel="bookmark" title="Permanent Link to Solving a second order ode">Solving a second order ode</a></h2>
      <p><small><span class="blog_post_date">Posted February 02, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/ode/'>ode</a>, <a href='/blog/category/math/'>math</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/02/Solving-a-second-order-ode#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:32 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/26/solving-a-second-order-ode/" >Matlab post</a>

</p>

<p>
The odesolvers in scipy can only solve first order ODEs, or systems of first order ODES. To solve a second order ODE, we must convert it by changes of variables to a system of first order ODES. We consider the Van der Pol oscillator here:
</p>

<p>
$$\frac{d^2x}{dt^2} - \mu(1-x^2)\frac{dx}{dt} + x = 0$$
</p>

<p>
\(\mu\) is a constant. If we let \(y=x - x^3/3\) <a href="http://en.wikipedia.org/wiki/Van_der_Pol_oscillator" >http://en.wikipedia.org/wiki/Van_der_Pol_oscillator</a>, then we arrive at this set of equations:
</p>

<p>
$$\frac{dx}{dt} = \mu(x-1/3x^3-y)$$
</p>

<p>
$$\frac{dy}{dt} = \mu/x$$
</p>

<p>
here is how we solve this set of equations. Let \(\mu=1\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

mu = 1.0

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">vanderpol</span>(X, t):
    x = X[0]
    y = X[1]
    dxdt = mu * (x - 1./3.*x**3 - y)
    dydt = x / mu
    <span style="color: #8b0000;">return</span> [dxdt, dydt]

X0 = [1, 2]
t = np.linspace(0, 40, 250)

sol = odeint(vanderpol, X0, t)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
x = sol[:, 0]
y = sol[:, 1]

plt.plot(t,x, t, y)
plt.xlabel(<span style="color: #228b22;">'t'</span>)
plt.legend((<span style="color: #228b22;">'x'</span>, <span style="color: #228b22;">'y'</span>))
plt.savefig(<span style="color: #228b22;">'images/vanderpol-1.png'</span>)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">phase portrait</span>
plt.figure()
plt.plot(x,y)
plt.plot(x[0], y[0], <span style="color: #228b22;">'ro'</span>)
plt.xlabel(<span style="color: #228b22;">'x'</span>)
plt.ylabel(<span style="color: #228b22;">'y'</span>)
plt.savefig(<span style="color: #228b22;">'images/vanderpol-2.png'</span>)
</pre>
</div>

<p><img src="/img/./images/vanderpol-1.png"><p>

<p>
Here is the phase portrait. You can see that a limit cycle is approached, indicating periodicity in the solution.
</p>

<p><img src="/img/./images/vanderpol-2.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/02/Solving-a-second-order-ode.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/02/Solving-a-second-order-ode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Some-of-this-sum-of-that"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/02/Some-of-this-sum-of-that/" rel="bookmark" title="Permanent Link to Some of this, sum of that">Some of this, sum of that</a></h2>
      <p><small><span class="blog_post_date">Posted February 02, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/miscellaneous/'>miscellaneous</a>, <a href='/blog/category/recursive/'>recursive</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/02/Some-of-this-sum-of-that#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:44 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2012/05/29/some-of-this-sum-of-that/" >Matlab plot</a>
</p>

<p>
Python provides a sum function to compute the sum of a list. However, the sum function does not work on every arrangement of numbers, and it certainly does not work on nested lists. We will solve this problem with recursion.
</p>

<p>
Here is a simple example.
</p>

<div class="org-src-container">

<pre class="src src-python">v = [1, 2, 3, 4, 5, 6, 7, 8, 9] <span style="color: #ff0000; font-weight: bold;"># a list</span>
<span style="color: #8b0000;">print</span> sum(v)

v = (1, 2, 3, 4, 5, 6, 7, 8, 9)  <span style="color: #ff0000; font-weight: bold;"># a tuple</span>
<span style="color: #8b0000;">print</span> sum(v)
</pre>
</div>

<pre class="example">
45
45
</pre>

<p>
If you have data in a dictionary, sum works by default on the keys. You can give the sum function the values like this.
</p>

<div class="org-src-container">

<pre class="src src-python">v = {<span style="color: #228b22;">'a'</span>:1, <span style="color: #228b22;">'b'</span>:3, <span style="color: #228b22;">'c'</span>:4}
<span style="color: #8b0000;">print</span> sum(v.values())
</pre>
</div>

<pre class="example">
8
</pre>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Nested lists</h2>
<div class="outline-text-2" id="text-1">
<p>
Suppose now we have nested lists. This kind of structured data might come up if you had grouped several things together. For example, suppose we have 5 departments, with 1, 5, 15, 7 and 17 people in them, and in each department they are divided into groups.
</p>

<p>
Department 1: 1 person
Department 2: group of 2 and group of 3
Department 3: group of 4 and 11, with a subgroups of 5 and 6 making
              up the group of 11.
Department 4: 7 people
Department 5: one group of 8 and one group of 9.
</p>

<p>
We might represent the data like this nested list. Now, if we want to compute the total number of people, we need to add up each group. We cannot simply sum the list, because some elements are single numbers, and others are lists, or lists of lists. We need to recurse through each entry until we get down to a number, which we can add to the running sum. 
</p>
<div class="org-src-container">

<pre class="src src-python">v = [1, 
    [2, 3],
    [4, [5, 6]],
    7,
    [8,9]]

<span style="color: #8b0000;">def</span> recursive_<span style="color: #8b0000;">sum</span>(X):
    <span style="color: #228b22;">'compute sum of arbitrarily nested lists'</span>
    s = 0 <span style="color: #ff0000; font-weight: bold;"># initial value of the sum</span>

    <span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(len(X)):
        <span style="color: #8b0000;">import</span> types  <span style="color: #ff0000; font-weight: bold;"># we use this to test if we got a number</span>
        <span style="color: #8b0000;">if</span> <span style="color: #8b0000;">isinstance</span>(X[i], (types.IntType,
                             types.LongType,
                             types.FloatType,
                             types.ComplexType)):
            <span style="color: #ff0000; font-weight: bold;"># this is the terminal step</span>
            s += X[i]
        <span style="color: #8b0000;">else:</span>
            <span style="color: #ff0000; font-weight: bold;"># we did not get a number, so we recurse</span>
            s += recursive_<span style="color: #8b0000;">sum</span>(X[i])
    <span style="color: #8b0000;">return</span> s

<span style="color: #8b0000;">print</span> recursive_<span style="color: #8b0000;">sum</span>(v)
<span style="color: #8b0000;">print</span> recursive_<span style="color: #8b0000;">sum</span>([1,2,3,4,5,6,7,8,9]) <span style="color: #ff0000; font-weight: bold;"># test on non-nested list</span>
</pre>
</div>

<pre class="example">
45
45
</pre>

<p>
In <a href="http://matlab.cheme.cmu.edu/2012/05/28/lather-rinse-and-repeat/" >Post 1970</a> we examined recursive functions that could be replaced by loops. Here we examine a function that can only work with recursion because the nature of the nested data structure is arbitrary. There are arbitary branches and depth in the data structure. Recursion is nice because you do not have to define that structure in advance.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/02/Some-of-this,-sum-of-that.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/02/Some-of-this-sum-of-that#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Water-gas-shift-equilibria-via-the-NIST-Webbook"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook/" rel="bookmark" title="Permanent Link to Water gas shift equilibria via the NIST Webbook">Water gas shift equilibria via the NIST Webbook</a></h2>
      <p><small><span class="blog_post_date">Posted February 01, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-algebra/'>nonlinear algebra</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:46 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/12/12/water-gas-shift-equilibria-via-the-nist-webbook/" >Matlab post</a>
</p>

<p>
The <a href="http://webbook.nist.gov/chemistry/" >NIST webbook</a> provides parameterized models of the enthalpy, entropy and heat capacity of many molecules. In this example, we will examine how to use these to compute the equilibrium constant for the water gas shift reaction \(CO + H_2O \rightleftharpoons CO_2 + H_2\) in the temperature range of 500K to 1000K.
</p>

<p>
Parameters are provided for:
</p>

<p>
Cp = heat capacity (J/mol*K)
H = standard enthalpy (kJ/mol)
S = standard entropy (J/mol*K)
</p>

<p>
with models in the form: \(Cp^\circ = A + B*t + C*t^2 + D*t^3 + E/t^2\)
</p>

<p>
\(H^\circ - H^\circ_{298.15}= A*t + B*t^2/2 + C*t^3/3 + D*t^4/4 - E/t + F - H\)
</p>

<p>
\(S^\circ = A*ln(t) + B*t + C*t^2/2 + D*t^3/3 - E/(2*t^2) + G\)
</p>

<p>
where \(t=T/1000\), and \(T\) is the temperature in Kelvin. We can use this data to calculate equilibrium constants in the following manner. First, we have heats of formation at standard state for each compound; for elements, these are zero by definition, and for non-elements, they have values available from the NIST webbook. There are also values for the absolute entropy at standard state. Then, we have an expression for the change in enthalpy from standard state as defined above, as well as the absolute entropy. From these we can derive the reaction enthalpy, free energy and entropy at standard state, as well as at other temperatures.
</p>

<p>
We will examine the water gas shift enthalpy, free energy and equilibrium constant from 500K to 1000K, and finally compute the equilibrium composition of a gas feed containing 5 atm of CO and H_2 at 1000K.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

T = np.linspace(500,1000) <span style="color: #ff0000; font-weight: bold;"># degrees K</span>
t = T/1000;
</pre>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> hydrogen</h2>
<div class="outline-text-2" id="text-1">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C1333740&Units=SI&Mask=1#Thermo-Gas}
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># T = 298-1000K valid temperature range</span>
A =  33.066178
B = -11.363417
C =  11.432816
D = -2.772874
E = -0.158558
F = -9.980797
G =  172.707974
H =  0.0

Hf_29815_H2 = 0.0 <span style="color: #ff0000; font-weight: bold;"># kJ/mol</span>
S_29815_H2 = 130.68 <span style="color: #ff0000; font-weight: bold;"># J/mol/K</span>

dH_H2 = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_H2 = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> H_{2}O</h2>
<div class="outline-text-2" id="text-2">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&Units=SI&Mask=1#Thermo-Gas}
</p>

<p>
Note these parameters limit the temperature range we can examine, as these parameters are not valid below 500K. There is another set of parameters for lower temperatures, but we do not consider them here.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># 500-1700 K valid temperature range</span>
A =   30.09200
B =   6.832514
C =   6.793435
D =  -2.534480
E =   0.082139
F =  -250.8810
G =   223.3967
H =  -241.8264

Hf_29815_H2O = -241.83 <span style="color: #ff0000; font-weight: bold;">#this is Hf.</span>
S_29815_H2O = 188.84

dH_H2O = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_H2O = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> CO</h2>
<div class="outline-text-2" id="text-3">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C630080&Units=SI&Mask=1#Thermo-Gas}
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># 298. - 1300K valid temperature range</span>
A =   25.56759
B =   6.096130
C =   4.054656
D =  -2.671301
E =   0.131021
F =  -118.0089
G =   227.3665
H = -110.5271

Hf_29815_CO = -110.53 <span style="color: #ff0000; font-weight: bold;">#this is Hf kJ/mol.</span>
S_29815_CO = 197.66

dH_CO = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_CO = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> CO_{2}</h2>
<div class="outline-text-2" id="text-4">
<p>
\url{http://webbook.nist.gov/cgi/cbook.cgi?ID=C124389&Units=SI&Mask=1#Thermo-Gas}
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># 298. - 1200.K valid temperature range</span>
A =   24.99735
B =   55.18696
C =  -33.69137
D =   7.948387
E =  -0.136638
F =  -403.6075
G =   228.2431
H =  -393.5224

Hf_29815_CO2 = -393.51 <span style="color: #ff0000; font-weight: bold;"># this is Hf.</span>
S_29815_CO2 = 213.79

dH_CO2 = A*t + B*t**2/2 + C*t**3/3 + D*t**4/4 - E/t + F - H;
S_CO2 = (A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G);
</pre>
</div>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Standard state heat of reaction</h2>
<div class="outline-text-2" id="text-5">
<p>
We compute the enthalpy and free energy of reaction at 298.15 K for the following reaction \(CO + H2O \rightleftharpoons H2 + CO2\).
</p>

<div class="org-src-container">

<pre class="src src-python">Hrxn_29815 = Hf_29815_CO2 + Hf_29815_H2 - Hf_29815_CO - Hf_29815_H2O;
Srxn_29815 = S_29815_CO2 + S_29815_H2 - S_29815_CO - S_29815_H2O;
Grxn_29815 = Hrxn_29815 - 298.15*(Srxn_29815)/1000;

<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'deltaH = {0:1.2f}'</span>.format(Hrxn_29815))
<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'deltaG = {0:1.2f}'</span>.format(Grxn_29815))
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; deltaH = -41.15
deltaG = -28.62
</pre>
</div>
</div>
<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Non-standard state \(\Delta H\) and \(\Delta G\)</h2>
<div class="outline-text-2" id="text-6">
<p>
We have to correct for temperature change away from standard state. We only correct the enthalpy for this temperature change. The correction looks like this:
</p>

<p>
$$ \Delta H_{rxn}(T) = \Delta H_{rxn}(T_{ref}) + \sum_i \nu_i (H_i(T)-H_i(T_{ref}))$$
</p>

<p>
Where \(\nu_i\) are the stoichiometric coefficients of each species, with appropriate sign for reactants and products, and \((H_i(T)-H_i(T_{ref})\) is precisely what is calculated for each species with the equations
</p>

<p>
The entropy is on an absolute scale, so we directly calculate entropy at each temperature. Recall that H is in kJ/mol and S is in J/mol/K, so we divide S by 1000 to make the units match.
</p>
<div class="org-src-container">

<pre class="src src-python">Hrxn = Hrxn_29815 + dH_CO2 + dH_H2 - dH_CO - dH_H2O
Grxn = Hrxn - T*(S_CO2 + S_H2 - S_CO - S_H2O)/1000
</pre>
</div>
</div>
</div>
<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Plot how the \(\Delta G\) varies with temperature</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
plt.figure(); plt.clf()
plt.plot(T,Grxn, label=<span style="color: #228b22;">'$\Delta G_{rxn}$'</span>)
plt.plot(T,Hrxn, label=<span style="color: #228b22;">'$\Delta H_{rxn}$'</span>)
plt.xlabel(<span style="color: #228b22;">'Temperature (K)'</span>)
plt.ylabel(<span style="color: #228b22;">'(kJ/mol)'</span>)
plt.legend( loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/wgs-nist-1.png'</span>)
</pre>
</div>

<pre class="example">
&lt;matplotlib.figure.Figure object at 0x04199CF0&gt;
[&lt;matplotlib.lines.Line2D object at 0x0429BF30&gt;]
[&lt;matplotlib.lines.Line2D object at 0x0427DFB0&gt;]
&lt;matplotlib.text.Text object at 0x041B79F0&gt;
&lt;matplotlib.text.Text object at 0x040CEF70&gt;
&lt;matplotlib.legend.Legend object at 0x043CB5F0&gt;
</pre>

<p><img src="/img/./images/wgs-nist-1.png"><p>

<p>
Over this temperature range the reaction is exothermic, although near 1000K it is just barely exothermic. At higher temperatures we expect the reaction to become endothermic.
</p>
</div>
</div>
<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Equilibrium constant calculation</h2>
<div class="outline-text-2" id="text-8">
<p>
Note the equilibrium constant starts out high, i.e. strongly favoring the formation of products, but drops very quicky with increasing temperature.
</p>

<div class="org-src-container">

<pre class="src src-python">R = 8.314e-3 <span style="color: #ff0000; font-weight: bold;"># kJ/mol/K</span>
K = np.exp(-Grxn/R/T);

plt.figure()
plt.plot(T,K)
plt.xlim([500, 1000])
plt.xlabel(<span style="color: #228b22;">'Temperature (K)'</span>)
plt.ylabel(<span style="color: #228b22;">'Equilibrium constant'</span>)
plt.savefig(<span style="color: #228b22;">'images/wgs-nist-2.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &lt;matplotlib.figure.Figure object at 0x044DBE90&gt;
[&lt;matplotlib.lines.Line2D object at 0x045A53F0&gt;]
(500, 1000)
&lt;matplotlib.text.Text object at 0x04577470&gt;
&lt;matplotlib.text.Text object at 0x0457F410&gt;
</pre>

<p><img src="/img/./images/wgs-nist-2.png"><p>
</div>
</div>
<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Equilibrium yield of WGS</h2>
<div class="outline-text-2" id="text-9">
<p>
Now let us suppose we have a reactor with a feed of H_2O and CO at 10atm at 1000K. What is the equilibrium yield of H_2? Let \(\epsilon\) be the extent of reaction, so that \(F_i = F_{i,0} + \nu_i \epsilon\). For reactants, \(\nu_i\) is negative, and for products, \(\nu_i\) is positive. We have to solve for the extent of reaction that satisfies the equilibrium condition.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.interpolate <span style="color: #8b0000;">import</span> interp1d
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #ff0000; font-weight: bold;"># </span>
<span style="color: #ff0000; font-weight: bold;"># A = CO</span>
<span style="color: #ff0000; font-weight: bold;"># B = H2O</span>
<span style="color: #ff0000; font-weight: bold;"># C = H2</span>
<span style="color: #ff0000; font-weight: bold;"># D = CO2</span>

Pa0 = 5; Pb0 = 5; Pc0 = 0; Pd0 = 0;  <span style="color: #ff0000; font-weight: bold;"># pressure in atm</span>
R = 0.082;
Temperature = 1000;

<span style="color: #ff0000; font-weight: bold;"># we can estimate the equilibrium like this. We could also calculate it</span>
<span style="color: #ff0000; font-weight: bold;"># using the equations above, but we would have to evaluate each term. Above</span>
<span style="color: #ff0000; font-weight: bold;"># we simply computed a vector of enthalpies, entropies, etc... Here we interpolate</span>
K_func = interp1d(T,K);
K_Temperature = K_func(1000)


<span style="color: #ff0000; font-weight: bold;"># If we let X be fractional conversion then we have $C_A = C_{A0}(1-X)$,</span>
<span style="color: #ff0000; font-weight: bold;"># $C_B = C_{B0}-C_{A0}X$, $C_C = C_{C0}+C_{A0}X$, and $C_D =</span>
<span style="color: #ff0000; font-weight: bold;"># C_{D0}+C_{A0}X$. We also have $K(T) = (C_C C_D)/(C_A C_B)$, which finally</span>
<span style="color: #ff0000; font-weight: bold;"># reduces to $0 = K(T) - Xeq^2/(1-Xeq)^2$ under these conditions.</span>

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f</span>(X):
    <span style="color: #8b0000;">return</span> K_Temperature - X**2/(1-X)**2;

x0 = 0.5
Xeq, = fsolve(f, x0)

<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'The equilibrium conversion for these feed conditions is: {0:1.2f}'</span>.format(Xeq))
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... &gt;&gt;&gt; ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.54504291144
The equilibrium conversion for these feed conditions is: 0.55
</pre>
</div>
</div>
<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Compute gas phase pressures of each species</h2>
<div class="outline-text-2" id="text-10">
<p>
Since there is no change in moles for this reaction, we can directly calculation the pressures from the equilibrium conversion and the initial pressure of gases. you can see there is a slightly higher pressure of H_2 and CO_2 than the reactants, consistent with the equilibrium constant of about 1.44 at 1000K. At a lower temperature there would be a much higher yield of the products. For example, at 550K the equilibrium constant is about 58, and the pressure of H_2 is 4.4 atm due to a much higher equilibrium conversion of 0.88.
</p>

<div class="org-src-container">

<pre class="src src-python">P_CO = Pa0*(1-Xeq)
P_H2O = Pa0*(1-Xeq)
P_H2 = Pa0*Xeq
P_CO2 = Pa0*Xeq

<span style="color: #8b0000;">print</span> P_CO,P_H2O, P_H2, P_CO2
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 2.2747854428 2.2747854428 2.7252145572 2.7252145572
</pre>
</div>
</div>
<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Compare the equilibrium constants</h2>
<div class="outline-text-2" id="text-11">
<p>
We can compare the equilibrium constant from the Gibbs free energy and the one from the ratio of pressures. They should be the same!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> K_Temperature
<span style="color: #8b0000;">print</span> (P_CO2*P_H2)/(P_CO*P_H2O)
</pre>
</div>

<pre class="example">
1.43522674762
1.43522674762
</pre>

<p>
They are the same.
</p>
</div>
</div>
<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> Summary</h2>
<div class="outline-text-2" id="text-12">
<p>
The NIST Webbook provides a plethora of data for computing thermodynamic properties. It is a little tedious to enter it all into Matlab, and a little tricky to use the data to estimate temperature dependent reaction energies. A limitation of the Webbook is that it does not tell you have the thermodynamic properties change with pressure. Luckily, those changes tend to be small.
</p>

<p>
I noticed a different behavior in interpolation between scipy.interpolate.interp1d and Matlab's interp1. The scipy function returns an interpolating function, whereas the Matlab function directly interpolates new values, and returns the actual interpolated data. 
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Linear-programming-example-with-inequality-constraints"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/01/31/Linear-programming-example-with-inequality-constraints/" rel="bookmark" title="Permanent Link to Linear programming example with inequality constraints">Linear programming example with inequality constraints</a></h2>
      <p><small><span class="blog_post_date">Posted January 31, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a>, <a href='/blog/category/linear-programming/'>linear programming</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/01/31/Linear-programming-example-with-inequality-constraints#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:44 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>

<a href="http://matlab.cheme.cmu.edu/2011/10/21/linear-programming-example-with-inequality-constraints/" >Matlab post</a>
</p>

<p>
adapted from <a href="http://www.matrixlab-examples.com/linear-programming.html" >http://www.matrixlab-examples.com/linear-programming.html</a> which solves this problem with fminsearch.
</p>

<p>
Let us suppose that a merry farmer has 75 roods (4 roods = 1 acre) on which to plant two crops: wheat and corn. To produce these crops, it costs the farmer (for seed, water, fertilizer, etc. ) $120 per rood for the wheat, and $210 per rood for the corn. The farmer has $15,000 available for expenses, but after the harvest the farmer must store the crops while awaiting favorable or good market conditions. The farmer has storage space for 4,000 bushels. Each rood yields an average of 110 bushels of wheat or 30 bushels of corn. If the net profit per bushel of wheat (after all the expenses) is $1.30 and for corn is $2.00, how should the merry farmer plant the 75 roods to maximize profit?
</p>

<p>
Let \(x\) be the number of roods of wheat planted, and \(y\) be the number of roods of corn planted. The profit function is: \( P = (110)($1.3)x + (30)($2)y = 143x + 60y \)
</p>

<p>
There are some constraint inequalities, specified by the limits on expenses, storage and roodage. They are:
</p>

<p>
\(\$120x + \$210y <= \$15000\) (The total amount spent cannot exceed the amount the farm has)
</p>

<p>
\(110x + 30y <= 4000\) (The amount generated should not exceed storage space.)
</p>

<p>
\(x + y <= 75\) (We cannot plant more space than we have.)
</p>

<p>
\(0 <= x and 0 <= y \) (all amounts of planted land must be positive.)
</p>

<p>
To solve this problem, we cast it as a linear programming problem, which minimizes a function f(X) subject to some constraints. We create a proxy function for the negative of profit, which we seek to minimize.
</p>

<p>
f = -(143*x + 60*y)
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fmin_cobyla

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">objective</span>(X):
    <span style="color: #228b22;">'''objective function to minimize. It is the negative of profit,</span>
<span style="color: #228b22;">    which we seek to maximize.'''</span>
    x, y = X
    <span style="color: #8b0000;">return</span> -(143*x + 60*y)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">c1</span>(X):
    <span style="color: #228b22;">'Ensure 120x + 210y &lt;= 15000'</span>
    x,y = X
    <span style="color: #8b0000;">return</span> 15000 - 120 * x - 210*y

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">c2</span>(X):
    <span style="color: #228b22;">'ensure 110x + 30y &lt;= 4000'</span>
    x,y = X
    <span style="color: #8b0000;">return</span> 4000 - 110*x - 30 * y

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">c3</span>(X):
    <span style="color: #228b22;">'Ensure x + y is less than or equal to 75'</span>
    x,y = X
    <span style="color: #8b0000;">return</span> 75 - x - y

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">c4</span>(X):
    <span style="color: #228b22;">'Ensure x &gt;= 0'</span>
    <span style="color: #8b0000;">return</span> X[0]

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">c5</span>(X):
    <span style="color: #228b22;">'Ensure y &gt;= 0'</span>
    <span style="color: #8b0000;">return</span> X[1]

X = fmin_cobyla(objective, x0=[20, 30], cons=[c1, c2, c3, c4, c5])

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'We should plant {0:1.2f} roods of wheat.'</span>.format(X[0])
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'We should plant {0:1.2f} roods of corn'</span>.format(X[1])
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The maximum profit we can earn is ${0:1.2f}.'</span>.format(-objective(X))
</pre>
</div>

<pre class="example">
   Normal return from subroutine COBYLA

   NFVALS =   40   F =-6.315625E+03    MAXCV = 4.547474E-13
   X = 2.187500E+01   5.312500E+01
We should plant 21.88 roods of wheat.
We should plant 53.12 roods of corn
The maximum profit we can earn is $6315.62.
</pre>

<p>
This code is not exactly the same as the original <a href="http://matlab.cheme.cmu.edu/2011/10/21/linear-programming-example-with-inequality-constraints/" >post</a>, but we get to the same answer. The linear programming capability in scipy is currently somewhat limited in 0.10. It is a little better in 0.11, but probably not as advanced as Matlab. There are some external libraries available:
</p>

<ol>
<li><a href="http://abel.ee.ucla.edu/cvxopt/" >http://abel.ee.ucla.edu/cvxopt/</a>
</li>
<li><a href="http://openopt.org/LP" >http://openopt.org/LP</a>
</li>
</ol>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/01/31/Linear-programming-example-with-inequality-constraints.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/01/31/Linear-programming-example-with-inequality-constraints#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Smooth-transitions-between-discontinuous-functions"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/01/31/Smooth-transitions-between-discontinuous-functions/" rel="bookmark" title="Permanent Link to Smooth transitions between discontinuous functions">Smooth transitions between discontinuous functions</a></h2>
      <p><small><span class="blog_post_date">Posted January 31, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-algebra/'>nonlinear algebra</a>, <a href='/blog/category/miscellaneous/'>miscellaneous</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/01/31/Smooth-transitions-between-discontinuous-functions#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 06:25 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
<a href="http://matlab.cheme.cmu.edu/2011/10/30/smooth-transitions-between-discontinuous-functions/" >original post</a>
</p>

<p>
In <a href="http://matlab.cheme.cmu.edu/2011/10/27/compute-pipe-diameter/" >Post 1280</a> we used a correlation for the Fanning friction factor for turbulent flow in a pipe. For laminar flow (Re &lt; 3000), there is another correlation that is commonly used: \(f_F = 16/Re\). Unfortunately, the correlations for laminar flow and turbulent flow have different values at the transition that should occur at Re = 3000. This discontinuity can cause a lot of problems for numerical solvers that rely on derivatives.
</p>

<p>
Today we examine a strategy for smoothly joining these two functions. First we define the two functions.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fF_laminar</span>(Re):
    <span style="color: #8b0000;">return</span> 16.0 / Re

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fF_turbulent_unvectorized</span>(Re):
    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Nikuradse correlation for turbulent flow</span>
    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">1/np.sqrt(f) = (4.0*np.log10(Re*np.sqrt(f))-0.4)</span>
    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">we have to solve this equation to get f</span>
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(f):
        <span style="color: #8b0000;">return</span> 1/np.sqrt(f) - (4.0*np.log10(Re*np.sqrt(f))-0.4)
    fguess = 0.01
    f, = fsolve(func, fguess)
    <span style="color: #8b0000;">return</span> f

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">this enables us to pass vectors to the function and get vectors as</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">solutions</span>
fF_turbulent = np.vectorize(fF_turbulent_unvectorized)
</pre>
</div>

<p>
Now we plot the correlations.
</p>

<div class="org-src-container">

<pre class="src src-python">Re1 = np.linspace(500, 3000)
f1 = fF_laminar(Re1)

Re2 = np.linspace(3000, 10000)
f2 = fF_turbulent(Re2)

plt.figure(1); plt.clf()
plt.plot(Re1, f1, label=<span style="color: #228b22;">'laminar'</span>)
plt.plot(Re2, f2, label=<span style="color: #228b22;">'turbulent'</span>)
plt.xlabel(<span style="color: #228b22;">'Re'</span>)
plt.ylabel(<span style="color: #228b22;">'$f_F$'</span>)
plt.legend()
plt.savefig(<span style="color: #228b22;">'images/smooth-transitions-1.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &lt;matplotlib.figure.Figure object at 0x051FF630&gt;
[&lt;matplotlib.lines.Line2D object at 0x05963C10&gt;]
[&lt;matplotlib.lines.Line2D object at 0x0576DD70&gt;]
&lt;matplotlib.text.Text object at 0x0577CFF0&gt;
&lt;matplotlib.text.Text object at 0x05798790&gt;
&lt;matplotlib.legend.Legend object at 0x05798030&gt;
</pre>

<p><img src="/img/./images/smooth-transitions-1.png"><p>

<p>
You can see the discontinuity at Re = 3000. What we need is a method to join these two functions smoothly. We can do that with a sigmoid function.
Sigmoid functions
</p>

<p>
A sigmoid function smoothly varies from 0 to 1 according to the equation: \(\sigma(x) = \frac{1}{1 + e^{-(x-x0)/\alpha}}\). The transition is centered on \(x0\), and \(\alpha\) determines the width of the transition.
</p>

<div class="org-src-container">

<pre class="src src-python">x = np.linspace(-4,4);
y = 1.0 / (1 + np.exp(-x / 0.1))
plt.figure(2); plt.clf()
plt.plot(x, y)
plt.xlabel(<span style="color: #228b22;">'x'</span>); plt.ylabel(<span style="color: #228b22;">'y'</span>); plt.title(<span style="color: #228b22;">'$\sigma(x)$'</span>)
plt.savefig(<span style="color: #228b22;">'images/smooth-transitions-sigma.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &lt;matplotlib.figure.Figure object at 0x0596CF10&gt;
[&lt;matplotlib.lines.Line2D object at 0x05A26D90&gt;]
&lt;matplotlib.text.Text object at 0x059A6050&gt;
&lt;matplotlib.text.Text object at 0x059AF0D0&gt;
&lt;matplotlib.text.Text object at 0x059BEA30&gt;
</pre>

<p><img src="/img/./images/smooth-transitions-sigma.png"><p>

<p>
If we have two functions, \(f_1(x)\) and \(f_2(x)\) we want to smoothly join, we do it like this: \(f(x) = (1-\sigma(x))f_1(x) + \sigma(x)f_2(x)\). There is no formal justification for this form of joining, it is simply a mathematical convenience to get a numerically smooth function. Other functions besides the sigmoid function could also be used, as long as they smoothly transition from 0 to 1, or from 1 to zero.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fanning_friction_factor</span>(Re):
    <span style="color: #228b22;">'''combined, continuous correlation for the fanning friction factor.</span>
<span style="color: #228b22;">    the alpha parameter is chosen to provide the desired smoothness.</span>
<span style="color: #228b22;">    The transition region is about +- 4*alpha. The value 450 was</span>
<span style="color: #228b22;">    selected to reasonably match the shape of the correlation</span>
<span style="color: #228b22;">    function provided by Morrison (see last section of this file)'''</span>
    sigma =  1. / (1 + np.exp(-(Re - 3000.0) / 450.0));
    f = (1-sigma) * fF_laminar(Re) + sigma * fF_turbulent(Re)
    <span style="color: #8b0000;">return</span> f

Re = np.linspace(500,10000);
f = fanning_friction_factor(Re);

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">add data to figure 1</span>
plt.figure(1)
plt.plot(Re,f, label=<span style="color: #228b22;">'smooth transition'</span>)
plt.xlabel(<span style="color: #228b22;">'Re'</span>)
plt.ylabel(<span style="color: #228b22;">'$f_F$'</span>)
plt.legend()
plt.savefig(<span style="color: #228b22;">'images/smooth-transitions-3.png'</span>)
</pre>
</div>

<pre class="example">
... ... ... ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... &lt;matplotlib.figure.Figure object at 0x051FF630&gt;
[&lt;matplotlib.lines.Line2D object at 0x05786310&gt;]
&lt;matplotlib.text.Text object at 0x0577CFF0&gt;
&lt;matplotlib.text.Text object at 0x05798790&gt;
&lt;matplotlib.legend.Legend object at 0x05A302B0&gt;
</pre>

<p><img src="/img/./images/smooth-transitions-3.png"><p>

<p>
You can see that away from the transition the combined function is practically equivalent to the original two functions. That is because away from the transition the sigmoid function is 0 or 1. Near Re = 3000 is a smooth transition from one curve to the other curve.
</p>

<p>
<a href="http://www.chem.mtu.edu/~fmorriso/DataCorrelationForSmoothPipes2010.pdf" >Morrison</a> derived a single function for the friction factor correlation over all Re: \(f = \frac{0.0076\left(\frac{3170}{Re}\right)^{0.165}}{1 + \left(\frac{3171}{Re}\right)^{7.0}} + \frac{16}{Re}\). Here we show the comparison with the approach used above. The friction factor differs slightly at high Re, because Morrison's is based on the Prandlt correlation, while the work here is based on the Nikuradse correlation. They are similar, but not the same.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">add this correlation to figure 1</span>
h, = plt.plot(Re, 16.0/Re + (0.0076 * (3170 / Re)**0.165) / (1 + (3170.0 / Re)**7))

ax = plt.gca()
handles, labels = ax.get_legend_handles_labels()

handles.append(h)
labels.append(<span style="color: #228b22;">'Morrison'</span>)
ax.legend(handles, labels)
plt.savefig(<span style="color: #228b22;">'images/smooth-transitions-morrison.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &lt;matplotlib.legend.Legend object at 0x05A5AEB0&gt;
</pre>

<p><img src="/img/./images/smooth-transitions-morrison.png"><p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Summary</h2>
<div class="outline-text-2" id="text-1">
<p>
The approach demonstrated here allows one to smoothly join two discontinuous functions that describe physics in different regimes, and that must transition over some range of data. It should be emphasized that the method has no physical basis, it simply allows one to create a mathematically smooth function, which could be necessary for some optimizers or solvers to work.</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/01/31/Smooth-transitions-between-discontinuous-functions.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/01/31/Smooth-transitions-between-discontinuous-functions#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../105">« Previous Page</a>
  --  
 <a href="../107">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2019/02/12/Using-results-from-one-code-block-in-another-org-mode/">Using results from one code block in another org-mode</a></li>
      <li><a href="/blog/2018/12/31/2018-in-a-nutshell-for-the-Kitchin-Research-Group/">2018 in a nutshell for the Kitchin Research Group</a></li>
      <li><a href="/blog/2018/11/16/Line-integrals-in-Python-with-autograd/">Line integrals in Python with autograd</a></li>
      <li><a href="/blog/2018/11/05/Using-autograd-for-error-propagation/">Using autograd for error propagation</a></li>
      <li><a href="/blog/2018/11/03/Constrained-optimization-with-Lagrange-multipliers-and-autograd/">Constrained optimization with Lagrange multipliers and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2019
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



