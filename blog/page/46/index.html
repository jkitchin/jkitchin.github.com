

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Using-Pymacs-to-integrate-Python-into-Emacs"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/10/19/Using-Pymacs-to-integrate-Python-into-Emacs/" rel="bookmark" title="Permanent Link to Using Pymacs to integrate Python into Emacs">Using Pymacs to integrate Python into Emacs</a></h2>
      <p><small><span class="blog_post_date">Posted October 19, 2014 at 09:33 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/10/19/Using-Pymacs-to-integrate-Python-into-Emacs#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="https://github.com/pinard/Pymacs">Pymacs</a> is a project that aims to integrate Python into Emacs, and vice versa. In this post, I am going to examine the Python into Emacs integration. I cloned the git repository, ran make install, and setup my init.el file like this, as suggested in the manual.
</p>

<pre class="example">
(add-to-list 'load-path (expand-file-name "Pymacs" starter-kit-dir))
(require 'pymacs)
(autoload 'pymacs-apply "pymacs")
(autoload 'pymacs-call "pymacs")
(autoload 'pymacs-eval "pymacs" nil t)
(autoload 'pymacs-exec "pymacs" nil t)
(autoload 'pymacs-load "pymacs" nil t)
(autoload 'pymacs-autoload "pymacs")
</pre>

<p>
Pymacs provides some mapping of Python modules to emacs-lisp functions. You load modules in emacs-lisp, and then a dash-mangled version of the Python functions are available, <i>in emacs lisp</i>. Here is an example. We will load numpy, and find the maximum element of an array. For comparison, here is the Python script.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">print</span> np.max(np.array([[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>], [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>]]))
</pre>
</div>

<pre class="example">
4
</pre>

<p>
Now, the corresponding emacs version using Pymacs.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(pymacs-load <span style="color: #228b22;">"numpy"</span> <span style="color: #228b22;">"np-"</span>)
(np-max (np-array '((1 1) (2 4))))
</pre>
</div>

<pre class="example">
4
</pre>

<p>
Neat! The dot notation is basically replaced with dash notation, and we use a lisp list as the argument instead of an array. Otherwise, this looks almost identical. Now, let us consider something more complicated, and get the determinant of the array. We add a PREFIX to the load statement for numpy.linalg similar to what we would do in Python:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> numpy.linalg <span style="color: #8b0000;">as</span> la
<span style="color: #8b0000;">print</span> la.det(np.array([[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>], [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>]]))
</pre>
</div>

<pre class="example">
2.0
</pre>

<p>
And in emacs-lisp:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(pymacs-load <span style="color: #228b22;">"numpy"</span> <span style="color: #228b22;">"np-"</span>)
(pymacs-load <span style="color: #228b22;">"numpy.linalg"</span> <span style="color: #228b22;">"la-"</span>)
(la-det (np-array '((1 1) (2 4))))
</pre>
</div>

<pre class="example">
2.0
</pre>

<p>
We can call functions from matplotlib to make a figure. For example:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(pymacs-load <span style="color: #228b22;">"matplotlib.pyplot"</span> <span style="color: #228b22;">"plt-"</span>)
(<span style="color: #8b0000;">let*</span> ((x  '(1 2 3 4))
       (y  (mapcar (<span style="color: #8b0000;">lambda</span> (z) (* z z)) x)))
  (plt-plot x y)
  (plt-xlabel <span style="color: #228b22;">"x values"</span>)
  (plt-ylabel <span style="color: #228b22;">"x$^2$"</span>)
  (plt-savefig <span style="color: #228b22;">"plt-pymacs.png"</span>))
</pre>
</div>


<div class="figure">
<p><img src="/media/2014-10-19-Using-Pymacs-to-integrate-Python-into-Emacs/plt-pymacs.png"> 
</p>
</div>

<p>
This was a little subtle. It was necessary to save the lists as variables, and use the variables in the plot command.
</p>

<p>
I am not sure what this offers over just having a Python block present in org-mode though. Maybe it is more useful in emacs-lisp libraries where you want to bring in some numerical analysis. Or if you have some custom library of Python you would like to use in elisp. Here is a highly contrived example. Suppose we have a Python module with this special function that converts an argument to "J":
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">special_func</span>(x):
    <span style="color: #8b0000;">return</span> <span style="color: #228b22;">"J"</span>
</pre>
</div>

<p>
In Python, we might use it like this:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> my_python <span style="color: #8b0000;">as</span> mp
<span style="color: #8b0000;">print</span> [mp.special_func(x) <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>]]
</pre>
</div>

<pre class="example">
['J', 'J', 'J']
</pre>

<p>
We can import the module, and use the function in emacs-lisp too. The underscore in the function name is turned into a dash, which is a little confusing, but it works otherwise.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(pymacs-load <span style="color: #228b22;">"my_python"</span> <span style="color: #228b22;">"mp-"</span>)
(mapcar 'mp-special-func '(1 2 3))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">J</td>
<td class="left">J</td>
<td class="left">J</td>
</tr>
</tbody>
</table>


<p>
It does not seem possible to do everything though. For example, It is not clear how to pass functions through either side. For example, this does not work for fsolve, although it seems like it should. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(pymacs-load <span style="color: #228b22;">"scipy.optimize"</span> <span style="color: #228b22;">"so-"</span>)

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">objective</span> (x)
  (- x 5))

(so-fsolve 'objective 3)
</pre>
</div>

<p>
I get an error like this:
</p>
<pre class="example">
Pymacs loading scipy.optimize...done
pymacs-report-error: Python: Emacs: "(wrong-type-argument number-or-marker-p (pymacs-python . 47))"
</pre>

<p>
The Python equivalent is here:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">objective</span>(x):
    <span style="color: #8b0000;">return</span> x - <span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>

<span style="color: #8b0000;">print</span> fsolve(objective, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>)
</pre>
</div>

<pre class="example">
[ 5.]
</pre>

<p>
There is an open question on StackOverflow <a href="http://stackoverflow.com/questions/25471580/can-you-use-a-function-as-an-argument-to-a-python-function-in-pymacs">here</a> on this issue. Overall, I find the project very interesting. It would be awesome if you could extend emacs more easily in other languages, especially scripting languages such as Python that have numerical and plotting capabilities. Right now, this is possible in limited ways. For example, Xah Lee describes an <a href="http://ergoemacs.org/emacs/elisp_perl_wrapper.html">approach</a> where an arbitrary script can take data on stdin, process it, and output the results to stdout. Emacs can capture this and use it to modify the buffer. This uses the <code>shell-command</code> features in Emacs. These scripts could be written in Python, Perl, Ruby, etc&#x2026; This seems like a simpler and more flexible approach, except that it requires creating the shell commands and putting them on the executable path (as opposed to having Python modules on a PYTHONPATH). These lack the deep integration of documentation you get with emacs-lisp and Python functions.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/10/19/Using-Pymacs-to-integrate-Python-into-Emacs.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/10/19/Using-Pymacs-to-integrate-Python-into-Emacs#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Generate-emacs-lisp-documentation"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/10/17/Generate-emacs-lisp-documentation/" rel="bookmark" title="Permanent Link to Generate emacs-lisp documentation">Generate emacs-lisp documentation</a></h2>
      <p><small><span class="blog_post_date">Posted October 17, 2014 at 02:39 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs-lisp/'>emacs_lisp</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/10/17/Generate-emacs-lisp-documentation#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Emacs has some pretty amazing features to get help on a function (describe-function), to navigate quickly to functions in an elisp file (speedbar and imenu). Other languages have tools for generating documentation for all the functions in a file, e.g. epydoc, javadoc, Doxygen,&#x2026; I have not found an equivalent to this in emacs-lisp. Here, we explore some options to get something similar to this. Our goal will be to take an emacs-lisp file, and generate an org-file of documentation, and then convert that to PDF for reading.
</p>

<p>
Say we have a function, jmax-bibtex-next-entry, and we want some information about it. Here are three functions that give us the argument list, documentation string, and function definition.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(help-function-arglist 'jmax-bibtex-next-entry)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">&amp;optional</td>
<td class="left">n</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(documentation 'jmax-bibtex-next-entry)
</pre>
</div>

<pre class="example">
Jump to the beginning of the next bibtex entry. N is a prefix
argument. If it is numeric, jump that many entries
forward. Negative numbers do nothing.
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(symbol-function 'jmax-bibtex-next-entry)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">lambda</td>
<td class="left">(&amp;optional n)</td>
<td class="left">Jump to the beginning of the next bibtex entry. N is a prefix\nargument. If it is numeric, jump that many entries\nforward. Negative numbers do nothing.</td>
<td class="left">(interactive P)</td>
<td class="left">(if (= (point) (save-excursion (bibtex-beginning-of-entry))) (progn (forward-char) (bibtex-next-entry)))</td>
<td class="left">(if (re-search-forward bibtex-entry-head nil t (and (numberp n) n)) (progn (bibtex-beginning-of-entry)))</td>
</tr>
</tbody>
</table>

<p>
That will not always be the code we wrote, but it is functionally similar.
</p>

<p>
So we could create an org-entry like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">fun2org</span> (function-symbol)
  (<span style="color: #8b0000;">let</span> ((args (help-function-arglist function-symbol))
        (doc  (documentation function-symbol))
        (code (symbol-function function-symbol)))
    (format <span style="color: #228b22;">"** %s %s</span>
<span style="color: #228b22;">%s</span>

<span style="color: #228b22;">#+BEGIN_SRC emacs-lisp</span>
<span style="color: #228b22;">%S</span>
<span style="color: #228b22;">#+END_SRC</span>
<span style="color: #228b22;">"</span> function-symbol args doc code)))

(fun2org 'jmax-bibtex-next-entry)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #8b008b;">** jmax-bibtex-next-entry (&amp;optional n)</span>
Jump to the beginning of the next bibtex entry. N is a prefix
argument. If it is numeric, jump that many entries
forward. Negative numbers do nothing.

<span style="color: #ff0000; font-weight: bold;">#+BEGIN_SRC emacs-lisp</span>
<span style="background-color: #b0c4de;">(</span><span style="color: #8b0000; background-color: #b0c4de;">lambda</span><span style="background-color: #b0c4de;"> (</span><span style="color: #4682b4; background-color: #b0c4de;">&amp;optional</span><span style="background-color: #b0c4de;"> n) </span><span style="color: #228b22; background-color: #b0c4de;">"Jump to the beginning of the next bibtex entry. N is a prefix</span><span style="background-color: #b0c4de;">
</span><span style="color: #228b22; background-color: #b0c4de;">argument. If it is numeric, jump that many entries</span><span style="background-color: #b0c4de;">
</span><span style="color: #228b22; background-color: #b0c4de;">forward. Negative numbers do nothing."</span><span style="background-color: #b0c4de;"> (interactive </span><span style="color: #228b22; background-color: #b0c4de;">"P"</span><span style="background-color: #b0c4de;">) (</span><span style="color: #8b0000; background-color: #b0c4de;">if</span><span style="background-color: #b0c4de;"> (= (point) (</span><span style="color: #8b0000; background-color: #b0c4de;">save-excursion</span><span style="background-color: #b0c4de;"> (bibtex-beginning-of-entry))) (</span><span style="color: #8b0000; background-color: #b0c4de;">progn</span><span style="background-color: #b0c4de;"> (forward-char) (bibtex-next-entry))) (</span><span style="color: #8b0000; background-color: #b0c4de;">if</span><span style="background-color: #b0c4de;"> (re-search-forward bibtex-entry-head nil t (and (numberp n) n)) (</span><span style="color: #8b0000; background-color: #b0c4de;">progn</span><span style="background-color: #b0c4de;"> (bibtex-beginning-of-entry))))
</span><span style="color: #ff0000; font-weight: bold;">#+END_SRC</span>
</pre>
</div>

<p>
The code is not that beautifully indented, but it is optional. 
</p>

<p>
For variables, there are similar functions to get their documentation:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(documentation-property 'jmax-bibtex-journal-abbreviations 'variable-documentation)
</pre>
</div>

<pre class="example">
List of (string journal-full-name journal-abbreviation). Find abbreviations at http://cassi.cas.org/search.jsp.
</pre>

<p>
The problem still is, you have to know the variable and function names in advance. I want to take a file, and generate this for each function, and variable. 
</p>

<p>
I posted a question on <a href="http://stackoverflow.com/questions/26330363/how-do-i-get-a-list-of-functions-defined-in-an-emacs-lisp-file/26360946?iemail=1&noredirect=1#26360946">StackOverflow</a> on how to get the functions defined in a file. The most feasible suggestion was to use the variable load-history, which contains a history of the variables and functions loaded, and the files they are in.
</p>

<p>
Here is an example of getting the entries associated with jmax-bibtex.el
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(cdr (assoc <span style="color: #228b22;">"/Users/jkitchin/Dropbox/kitchingroup/jmax/jmax-bibtex.el"</span> load-history ))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(jmax-bibtex-journal-abbreviations
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-bibtex-generate-longtitles)
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-bibtex-generate-shorttitles)
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-stringify-journal-name)
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-set-journal-string)
 jmax-nonascii-latex-replacements
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-replace-nonascii)
 jmax-lower-case-words
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-title-case-article)
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-sentence-case-article)
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-bibtex-next-entry)
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-bibtex-previous-entry)
 (<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">.</span> jmax-bibtex-mode-keys)
 (<span style="color: #8b0000;">provide</span> <span style="color: #cd0000;">.</span> jmax-bibtex))
</pre>
</div>

<p>
Each element in this case is either a variable, defun or provide. Here, we can use this to print some information about the variables defined in this file. I think it is sufficient to check if the element in the list is a symbol, because all the other elements are cons elements. I suppose there are other possibilities, including defcustom, defgroup, defalias, defsubst, and maybe others.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">dolist</span> (element (cdr
                  (assoc
                   <span style="color: #228b22;">"/Users/jkitchin/Dropbox/kitchingroup/jmax/jmax-bibtex.el"</span>
                   load-history )))
  (<span style="color: #8b0000;">when</span> (symbolp element)
    (princ 
    (format <span style="color: #228b22;">"%s</span>
<span style="color: #228b22;">Documentation: %s</span>

<span style="color: #228b22;">"</span> element (documentation-property element 'variable-documentation)))))
</pre>
</div>

<pre class="example">
jmax-bibtex-journal-abbreviations
Documentation: List of (string journal-full-name journal-abbreviation). Find abbreviations at http://cassi.cas.org/search.jsp.

jmax-nonascii-latex-replacements
Documentation: Cons list of non-ascii characters and their LaTeX representations

jmax-lower-case-words
Documentation: List of words to keep lowercase
</pre>

<p>
We can handle functions by checking if an element is a cons cell with a first element of defun.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">dolist</span> (element (cdr
                  (assoc
                   <span style="color: #228b22;">"/Users/jkitchin/Dropbox/kitchingroup/jmax/jmax-bibtex.el"</span>
                   load-history )))
  (<span style="color: #8b0000;">when</span> (and (consp element)
             (eq (car element) 'defun))
    (princ (format <span style="color: #228b22;">"%s is a function\n"</span> (cdr element))))))
</pre>
</div>

<pre class="example">
jmax-bibtex-generate-longtitles is a function
jmax-bibtex-generate-shorttitles is a function
jmax-stringify-journal-name is a function
jmax-set-journal-string is a function
jmax-replace-nonascii is a function
jmax-title-case-article is a function
jmax-sentence-case-article is a function
jmax-bibtex-next-entry is a function
jmax-bibtex-previous-entry is a function
jmax-bibtex-mode-keys is a function
</pre>


<p>
So, we have the important pieces to mash up what I am looking for. Let us refine the goal. I want to create a PDF documentation of what is in an elisp file with a section on variables, and a section on functions. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((elements (cdr
                  (assoc
                   <span style="color: #228b22;">"/Users/jkitchin/Dropbox/kitchingroup/jmax/jmax-bibtex.el"</span>
                   load-history)))
       (vars (-filter 'symbolp elements))
       (funcons (-filter (<span style="color: #8b0000;">lambda</span> (x)
                           (and (consp x)
                                (eq 'defun (car x))))
                         elements))
       (funcs (mapcar 'cdr funcons)))
  (switch-to-buffer <span style="color: #228b22;">"*org-doc*"</span>)
  (erase-buffer)
  (insert (format <span style="color: #228b22;">"#+TITLE: Documentation for %s</span>
<span style="color: #228b22;">#+OPTIONS: toc:nil</span>
<span style="color: #228b22;">\\maketitle</span>
<span style="color: #228b22;">\\tableofcontents</span>
<span style="color: #228b22;">"</span> <span style="color: #228b22;">"/Users/jkitchin/Dropbox/kitchingroup/jmax/jmax-bibtex.el"</span>))
  (insert <span style="color: #228b22;">"* Variables\n"</span>)
  (<span style="color: #8b0000;">dolist</span> (var (sort vars 'string-lessp))
    (insert (format <span style="color: #228b22;">"** %s</span>
<span style="color: #228b22;">Documentation: %s\n\n"</span> var  (documentation-property var 'variable-documentation))))

  (insert <span style="color: #228b22;">"* Functions\n\n"</span>)
  (<span style="color: #8b0000;">dolist</span> (funcs (sort funcs 'string-lessp))
    (insert (format <span style="color: #228b22;">"** %s %s</span>
<span style="color: #228b22;">Documentation: %s</span>

<span style="color: #228b22;">Code:</span>
<span style="color: #228b22;">#+BEGIN_SRC emacs-lisp</span>
<span style="color: #228b22;">%S</span>
<span style="color: #228b22;">#+END_SRC</span>
<span style="color: #228b22;">"</span>
                    funcs
                    (or (help-function-arglist funcs) <span style="color: #228b22;">""</span>)
                    (documentation funcs)
                    (symbol-function funcs))))

  (org-mode)
  (write-file <span style="color: #228b22;">"jmax-bibtex-doc.org"</span>)
  (org-export-to-file 'latex <span style="color: #228b22;">"jmax-bibtex-doc.tex"</span>)
  (org-latex-compile <span style="color: #228b22;">"jmax-bibtex-doc.tex"</span>)
  (kill-buffer <span style="color: #228b22;">"*org-doc*"</span>)
  (kill-buffer <span style="color: #228b22;">"jmax-bibtex-doc.org"</span>))
</pre>
</div>

<p>
Here is the resulting pdf: <a href="/media/2014-10-17-Generate-emacs-lisp-documentation/jmax-bibtex-doc.pdf">jmax-bibtex-doc.pdf</a> . It is not too bad. The code is not beautiful, and it would take some work to get that looking nice. It might be nice to find all instances of '` and replace them with links to variable names, but I leave that for another day. There is also no information about the header comments, but I leave this for another day to.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/10/17/Generate-emacs-lisp-documentation.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/10/17/Generate-emacs-lisp-documentation#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Sentence-casing-your-bibtex-entry-journal-titles"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/10/14/Sentence-casing-your-bibtex-entry-journal-titles/" rel="bookmark" title="Permanent Link to Sentence casing your bibtex entry journal titles">Sentence casing your bibtex entry journal titles</a></h2>
      <p><small><span class="blog_post_date">Posted October 14, 2014 at 08:48 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bib/'>bib</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/10/14/Sentence-casing-your-bibtex-entry-journal-titles#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
I previously talked about <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/10/12/Title-casing-bibtex-entry-journal-titles/">title-casing</a> the titles of journal articles in bibtex entries. Here we describe an alternative transformation: sentence-casing. In sentence case the first word is capitalized, and all others (except proper nouns). We also should capitalize the first word of any subtitles, which we take to be the first word after a :. That is usually correct. We should also ignore any LaTeX commands, or protected words in the title.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">jmax-sentence-case-article</span> (<span style="color: #4682b4;">&amp;optional</span> key start end)
  <span style="color: #228b22;">"Convert a bibtex entry article title to sentence-case. The</span>
<span style="color: #228b22;">arguments are optional, and are only there so you can use this</span>
<span style="color: #228b22;">function with `</span><span style="color: #cd0000;">bibtex-map-entries</span><span style="color: #228b22;">' to change all the title</span>
<span style="color: #228b22;">entries in articles."</span>
  (interactive)
  (bibtex-beginning-of-entry)

  (<span style="color: #8b0000;">let*</span> ((title (bibtex-autokey-get-field <span style="color: #228b22;">"title"</span>))
         (words (split-string title))
         (start 0))
    (<span style="color: #8b0000;">when</span>
        (string= <span style="color: #228b22;">"article"</span> (downcase (cdr (assoc <span style="color: #228b22;">"=type="</span> (bibtex-parse-entry)))))
      (setq words (mapcar
                   (<span style="color: #8b0000;">lambda</span> (word)
                     (<span style="color: #8b0000;">if</span>
                         ;; <span style="color: #ff0000; font-weight: bold;">match words containing {} or \ which are probably</span>
                         ;; <span style="color: #ff0000; font-weight: bold;">LaTeX or protected words</span>
                         (string-match <span style="color: #228b22;">"\\$</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">|</span><span style="color: #228b22;">{</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">|</span><span style="color: #228b22;">}</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">|</span><span style="color: #228b22;">\\\\"</span> word)
                         word
                       (s-downcase word)))
                   words))
      
      ;; <span style="color: #ff0000; font-weight: bold;">capitalize first word</span>
      (setf (car words) (s-capitalize (car words)))

      ;; <span style="color: #ff0000; font-weight: bold;">join the words</span>
      (setq title (mapconcat 'identity words <span style="color: #228b22;">" "</span>))

      ;; <span style="color: #ff0000; font-weight: bold;">capitalize a word after a :, eg. a subtitle, and protect it</span>
      (<span style="color: #8b0000;">while</span>
          (string-match <span style="color: #228b22;">"[a-z]:\\s-+</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[A-Z]</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">"</span> title start)
        (<span style="color: #8b0000;">let</span> ((char (substring title (match-beginning 1) (match-end 1))))
          (setf (substring title (match-beginning 1) (match-end 1))
                (format <span style="color: #228b22;">"%s"</span> (upcase char)))
          (setq start (match-end 1))))
            
      ;; <span style="color: #ff0000; font-weight: bold;">this is defined in doi-utils</span>
      (bibtex-set-field
       <span style="color: #228b22;">"title"</span> title)

      ;; <span style="color: #ff0000; font-weight: bold;">clean and refill entry so it looks nice</span>
      (bibtex-clean-entry)
      (bibtex-fill-entry))))
</pre>
</div>

<pre class="example">
jmax-sentence-case-article
</pre>

<p>
Now, we can easily convert this entry in title-case:
</p>
<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">arroyave-2005-ab-ni</span>,
  <span style="color: #8b008b;">author</span> =       {R. Arroyave and D. Shin and Z.-K. Liu},
  <span style="color: #8b008b;">title</span> =        {Ab Initio Thermodynamic Properties of Stoichiometric
                  Phases in the {Ni-Al} System},
  <span style="color: #8b008b;">journal</span> =      {Acta Materialia },
  <span style="color: #8b008b;">volume</span> =       53,
  <span style="color: #8b008b;">number</span> =       6,
  <span style="color: #8b008b;">pages</span> =        {1809 - 1819},
  <span style="color: #8b008b;">year</span> =         2005,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1016/j.actamat.2004.12.030</span>},
  <span style="color: #8b008b;">url</span> =
                  {http://www.sciencedirect.com/science/article/pii/S1359645404007669},
  <span style="color: #8b008b;">issn</span> =         {1359-6454},
  <span style="color: #8b008b;">keywords</span> =     {Ab initio},
}
</pre>
</div>

<p>
To this in sentence case:
</p>
<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">arroyave-2005-ab-ni</span>,
  <span style="color: #8b008b;">author</span> =       {R. Arroyave and D. Shin and Z.-K. Liu},
  <span style="color: #8b008b;">title</span> =        {Ab initio thermodynamic properties of stoichiometric
                  phases in the {Ni-Al} system},
  <span style="color: #8b008b;">journal</span> =      {Acta Materialia },
  <span style="color: #8b008b;">volume</span> =       53,
  <span style="color: #8b008b;">number</span> =       6,
  <span style="color: #8b008b;">pages</span> =        {1809 - 1819},
  <span style="color: #8b008b;">year</span> =         2005,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1016/j.actamat.2004.12.030</span>},
  <span style="color: #8b008b;">url</span> =
                  {http://www.sciencedirect.com/science/article/pii/S1359645404007669},
  <span style="color: #8b008b;">issn</span> =         {1359-6454},
  <span style="color: #8b008b;">keywords</span> =     {Ab initio},
}
</pre>
</div>

<p>
The function is written so you can use it with bibtex-map-entries to change all the titles in one shot like this:
</p>

<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #ff0000; font-weight: bold;">% (bibtex-map-entries 'jmax-sentence-case-article)</span>
</pre>
</div>

<p>
The function is <i>not</i> perfect. For example in this next entry, the chemical symbols Mn, Fe, Co, Ni, are incorrectly lower-cased.
</p>

<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">arroyo-2010-first-princ</span>,
  <span style="color: #8b008b;">author</span> =       {Arroyo y de Dompablo, M. E. and Lee, Yueh-Lin and
                  Morgan, D.},
  <span style="color: #8b008b;">title</span> =        {First principles investigation of oxygen vacancies
                  in columbite \ce{MNb_2O_6} ({M = Mn, Fe, Co, Ni,
                  Cu})},
  <span style="color: #8b008b;">journal</span> =      {Chemistry of Materials},
  <span style="color: #8b008b;">volume</span> =       22,
  <span style="color: #8b008b;">number</span> =       3,
  <span style="color: #8b008b;">pages</span> =        {906-913},
  <span style="color: #8b008b;">year</span> =         2010,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1021/cm901723j</span>},
  <span style="color: #8b008b;">url</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">http://pubs.acs.org/doi/abs/10.1021/cm901723j</span>},
  <span style="color: #8b008b;">eprint</span> =       {http://pubs.acs.org/doi/pdf/10.1021/cm901723j},
}
</pre>
</div>

<p>
Here is the result of sentence casing:
</p>
<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">arroyo-2010-first-princ</span>,
  <span style="color: #8b008b;">author</span> =       {Arroyo y de Dompablo, M. E. and Lee, Yueh-Lin and
                  Morgan, D.},
  <span style="color: #8b008b;">title</span> =        {First principles investigation of oxygen vacancies
                  in columbite \ce{MNb_2O_6} ({M = mn, fe, co, ni,
                  Cu})},
  <span style="color: #8b008b;">journal</span> =      {Chemistry of Materials},
  <span style="color: #8b008b;">volume</span> =       22,
  <span style="color: #8b008b;">number</span> =       3,
  <span style="color: #8b008b;">pages</span> =        {906-913},
  <span style="color: #8b008b;">year</span> =         2010,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1021/cm901723j</span>},
  <span style="color: #8b008b;">url</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">http://pubs.acs.org/doi/abs/10.1021/cm901723j</span>},
  <span style="color: #8b008b;">eprint</span> =       {http://pubs.acs.org/doi/pdf/10.1021/cm901723j},
}
</pre>
</div>

<p>
The Cu is not lower-cased because it has a } attached to it after the title is split into words. The original entry is not properly formatted, in my opinion. I was lazy in wrapping the whole string in braces, {M = Mn, Fe, Co, Ni, Cu}, to protect the capitalization of the elements in bibtex. The correct way to do this is the more verbose: {M} = {M}n, {F}e, {C}o, {N}i, {C}u, where each letter is individually protected.
</p>

<p>
Still, the function can save a lot of keystrokes. You should still inspect the final results, to catch any unusual modifications. You do have your bibtex file under version control right?
</p>

<p>
This function can also be found at <a href="https://github.com/jkitchin/jmax/blob/master/jmax-bibtex.el">https://github.com/jkitchin/jmax/blob/master/jmax-bibtex.el</a> .
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/10/14/Sentence-casing-your-bibtex-entry-journal-titles.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/10/14/Sentence-casing-your-bibtex-entry-journal-titles#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Navigating-your-bibtex-file"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/10/13/Navigating-your-bibtex-file/" rel="bookmark" title="Permanent Link to Navigating your bibtex file">Navigating your bibtex file</a></h2>
      <p><small><span class="blog_post_date">Posted October 13, 2014 at 10:22 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bibtex/'>bibtex</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/10/13/Navigating-your-bibtex-file#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
You may be able to tell I am spending some time cleaning up bibtex files these days. One of the things I need to do is navigate around a bibtex file easily. There are some built-in navigation keys within an entry.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">navigation</th>
<th scope="col" class="left">key strokes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">next field</td>
<td class="left">C-j</td>
</tr>

<tr>
<td class="left">end of field</td>
<td class="left">TAB</td>
</tr>

<tr>
<td class="left">beginning of entry</td>
<td class="left">C-M-a</td>
</tr>

<tr>
<td class="left">end of entry</td>
<td class="left">C-M-e</td>
</tr>
</tbody>
</table>

<p>
I am not aware of an easy way to navigate to the next or previous entry though. I would like something simple to do that. There is a regexp defined in bibtex "bibtex-entry-head", to search for the next or previous entry.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">bibtex-entry-head
</pre>
</div>

<pre class="example">
^[      ]*\(@[  ]*\(?:\(?:Article\|Book\(?:let\)?\|In\(?:Book\|Collection\|Proceedings\)\|M\(?:a\(?:nual\|stersThesis\)\|isc\)\|P\(?:\(?:hdThesi\|roceeding\)s\)\|TechReport\|Unpublished\)\)\)[        ]*[({][         
]*\([][[:alnum:].:;?!`'/*@+|()&lt;&gt;&amp;_^$-]+\)
</pre>

<p>
Here are two functions that do it. This was a little more subtle than I anticipated.  The subtlety comes about if you are at the beginning of the entry, we need to move the cursor by a character, and then search forward because of the way re-search-forward works. I also wrote in an option for a prefix argument, so you can go forward or backward several entries.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">bibtex-next-entry</span> (<span style="color: #4682b4;">&amp;optional</span> n)
  <span style="color: #228b22;">"Jump to the beginning of the next bibtex entry. N is a prefix</span>
<span style="color: #228b22;">argument. If it is numeric, jump that many entries</span>
<span style="color: #228b22;">forward. Negative numbers do nothing."</span>
  (interactive <span style="color: #228b22;">"P"</span>)
  ;; <span style="color: #ff0000; font-weight: bold;">Note if we start at the beginning of an entry, nothing</span>
  ;; <span style="color: #ff0000; font-weight: bold;">happens. We need to move forward a char, and call again.</span>
  (<span style="color: #8b0000;">when</span> (= (point) (<span style="color: #8b0000;">save-excursion</span>
                     (bibtex-beginning-of-entry)))
    (forward-char)
    (bibtex-next-entry))

  ;; <span style="color: #ff0000; font-weight: bold;">search forward for an entry </span>
  (<span style="color: #8b0000;">when</span> 
      (re-search-forward bibtex-entry-head nil t (and (numberp n) n))
    ;; <span style="color: #ff0000; font-weight: bold;">go to beginning of the entry</span>
    (bibtex-beginning-of-entry)))


(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">bibtex-previous-entry</span> (<span style="color: #4682b4;">&amp;optional</span> n)
  <span style="color: #228b22;">"Jump to beginning of the previous bibtex entry. N is a prefix</span>
<span style="color: #228b22;">argument. If it is numeric, jump that many entries back."</span>
  (interactive <span style="color: #228b22;">"P"</span>)
  (bibtex-beginning-of-entry)
 (<span style="color: #8b0000;">when</span> 
     (re-search-backward bibtex-entry-head nil t (and (numberp n) n))
   (bibtex-beginning-of-entry)))
</pre>
</div>

<pre class="example">
bibtex-previous-entry
</pre>

<p>
That is pretty simple. Let us go ahead and bind these to M-n, and M-p, but only in bibtex-mode. Thanks to <a href="http://ergoemacs.org/emacs/emacs_set_keys_for_major_mode.html">Xah Lee</a> for this idea. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">jmax-bibtex-mode-keys</span> ()
  <span style="color: #228b22;">"Modify keymaps used by `</span><span style="color: #cd0000;">bibtex-mode</span><span style="color: #228b22;">'."</span>
  (local-set-key (kbd <span style="color: #228b22;">"M-n"</span>) 'bibtex-next-entry)
  (local-set-key (kbd <span style="color: #228b22;">"M-p"</span>) 'bibtex-previous-entry))

;; <span style="color: #ff0000; font-weight: bold;">add to bibtex-mode-hook</span>
(add-hook 'bibtex-mode-hook 'jmax-bibtex-mode-keys)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">jmax-bibtex-mode-keys</td>
</tr>
</tbody>
</table>

<p>
Now, C-n moves forward an entry, C-u 2 C-n moves you two entries, etc&#x2026; and C-p moves you back an entry, while C-u 2 C-p moves you back two entries. 
</p>

<p>
Finally, I sometimes want to jump to a field in an entry. Basically, I want a completion enabled function that lists the fields in the current entry, and then jumps to the selected field. Yes, you could simply do an incremental search forward or backward that is about as simple. But, then I would not get to remind myself how to do a completion command ;)
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">jmax-bibtex-get-fields</span> ()
  <span style="color: #228b22;">"Get a list of fields in a bibtex entry."</span>
  (bibtex-beginning-of-entry)
  (remove <span style="color: #228b22;">"=type="</span>
          (remove <span style="color: #228b22;">"=key="</span>
                  (mapcar 'car (bibtex-parse-entry)))))

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">jmax-bibtex-jump-to-field</span> (field)
  <span style="color: #228b22;">"Jump to FIELD in the current bibtex entry"</span>
  (interactive
   (list
    (ido-completing-read <span style="color: #228b22;">"Field: "</span> (jmax-bibtex-get-fields))))
  (<span style="color: #8b0000;">save-restriction</span>
    (bibtex-narrow-to-entry)
    (bibtex-beginning-of-entry)
    (<span style="color: #8b0000;">when</span>
        ;; <span style="color: #ff0000; font-weight: bold;">fields start with spaces, a field name, possibly more</span>
        ;; <span style="color: #ff0000; font-weight: bold;">spaces, then =</span>
        (re-search-forward (format <span style="color: #228b22;">"^\\s-*%s\\s-*="</span> field) nil t))))
</pre>
</div>

<pre class="example">
jmax-bibtex-jump-to-field
</pre>

<p>
These functions live in <a href="https://github.com/jkitchin/jmax/blob/master/jmax-bibtex.el">https://github.com/jkitchin/jmax/blob/master/jmax-bibtex.el</a> , which is the version we use on a regular basis.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/10/13/Navigating-your-bibtex-file.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/10/13/Navigating-your-bibtex-file#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Title-casing-bibtex-entry-journal-titles"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/10/12/Title-casing-bibtex-entry-journal-titles/" rel="bookmark" title="Permanent Link to Title casing bibtex entry journal titles">Title casing bibtex entry journal titles</a></h2>
      <p><small><span class="blog_post_date">Posted October 12, 2014 at 09:23 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bibtex/'>bibtex</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/10/12/Title-casing-bibtex-entry-journal-titles#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
I mostly love bibtex. You keep bibliographic entries in a central file, and you can cite them in your writing. Bibtex takes care of <i>most</i> of the formatting for you, but not always all of it. Lately, we have been writing some manuscripts for submission to ACS journals. They want the titles of journal articles included in the bibliography, preferrably in title-case, or in sentence case, but all the same format either way. Unfortunately, the achemso.bst bibtex format does not make this happen. You have to title-case or sentence case the titles themselves in your bibtex file. Well, at least we can get Emacs to do the heavy lifting on that for us. 
</p>

<p>
First, the manual approach. Open your bibtex file, navigate to a title field, put your cursor on the first letter of the title, and press M-c until you get to the end of the title. That runs (capitalize-word). For a few titles, you might just do this. It does not take long.
</p>

<p>
For a lot of entries though, you might prefer some code to do it. Here we consider how to convert all article titles to Title case. The current code can be found at <a href="https://github.com/jkitchin/jmax/blob/master/jmax-bibtex.el">https://github.com/jkitchin/jmax/blob/master/jmax-bibtex.el</a> .
</p>

<p>
First, we need to decide on some rules. We will capitalize every word in a title except for words like a, an, the, &#x2026; unless they start the title. We do not want to change words with $, {} in them, or \, because these are either protected or LaTeX commands and we probably do not want to change them. The gist of our idea is to get the title, split it into words, capitalize each word that needs to be,  join the words together, and then set the entry title to the new capitalized title. 
</p>

<p>
We use functions from <a href="https://github.com/magnars/s.el">s.el</a> , and <a href="https://github.com/jkitchin/jmax/blob/master/org/doi-utils.org">doi-utils.org</a> here.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defvar</span> <span style="color: #8b008b;">jmax-lower-case-words</span>
  '(<span style="color: #228b22;">"a"</span> <span style="color: #228b22;">"an"</span> <span style="color: #228b22;">"on"</span> <span style="color: #228b22;">"and"</span> <span style="color: #228b22;">"for"</span>
    <span style="color: #228b22;">"the"</span> <span style="color: #228b22;">"of"</span> <span style="color: #228b22;">"in"</span>)
  <span style="color: #228b22;">"List of words to keep lowercase"</span>)

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">jmax-title-case-article</span> (<span style="color: #4682b4;">&amp;optional</span> key start end)
  <span style="color: #228b22;">"Convert a bibtex entry article title to title-case. The</span>
<span style="color: #228b22;">arguments are optional, and are only there so you can use this</span>
<span style="color: #228b22;">function with `</span><span style="color: #cd0000;">bibtex-map-entries</span><span style="color: #228b22;">' to change all the title</span>
<span style="color: #228b22;">entries in articles."</span>
  (interactive)
  (bibtex-beginning-of-entry)

  (<span style="color: #8b0000;">let*</span> ((title (bibtex-autokey-get-field <span style="color: #228b22;">"title"</span>))
         (words (split-string title))
         (lower-case-words '(<span style="color: #228b22;">"a"</span> <span style="color: #228b22;">"an"</span> <span style="color: #228b22;">"on"</span> <span style="color: #228b22;">"and"</span> <span style="color: #228b22;">"for"</span>
                             <span style="color: #228b22;">"the"</span> <span style="color: #228b22;">"of"</span> <span style="color: #228b22;">"in"</span>)))
    (<span style="color: #8b0000;">when</span>
        (string= <span style="color: #228b22;">"article"</span> (downcase (cdr (assoc <span style="color: #228b22;">"=type="</span> (bibtex-parse-entry)))))
      (setq words (mapcar
                   (<span style="color: #8b0000;">lambda</span> (word)
                     (<span style="color: #8b0000;">if</span> (or
                          ;; <span style="color: #ff0000; font-weight: bold;">match words containing {} or \ which are probably</span>
                          ;; <span style="color: #ff0000; font-weight: bold;">LaTeX or protected words</span>
                          (string-match <span style="color: #228b22;">"\\$</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">|</span><span style="color: #228b22;">{</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">|</span><span style="color: #228b22;">}</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">|</span><span style="color: #228b22;">\\\\"</span> word)
                          ;; <span style="color: #ff0000; font-weight: bold;">these words should not be capitalized, unless they</span>
                          ;; <span style="color: #ff0000; font-weight: bold;">are the first word</span>
                          (-contains? lower-case-words (s-downcase word)))
                         word
                       (s-capitalize word)))
                   words))

      ;; <span style="color: #ff0000; font-weight: bold;">Check if first word should be capitalized</span>
      (<span style="color: #8b0000;">when</span> (-contains? jmax-lower-case-words (car words))
        (setf (car words) (s-capitalize (car words))))
            
      ;; <span style="color: #ff0000; font-weight: bold;">this is defined in doi-utils</span>
      (bibtex-set-field
       <span style="color: #228b22;">"title"</span>
       (mapconcat 'identity words <span style="color: #228b22;">" "</span>))
      (bibtex-fill-entry))))
</pre>
</div>

<pre class="example">
jmax-title-case-article
</pre>


<p>
Now, a single command converts this:
</p>

<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">campbell-2013-enthal-entrop</span>,
  <span style="color: #8b008b;">author</span> =       {Charles T. Campbell and Jason R. V. Sellers},
  <span style="color: #8b008b;">title</span> =        {Enthalpies and entropies of adsorption on
                  well-defined oxide surfaces: experimental
                  measurements},
  <span style="color: #8b008b;">journal</span> =      CR,
  <span style="color: #8b008b;">volume</span> =       113,
  <span style="color: #8b008b;">number</span> =       6,
  <span style="color: #8b008b;">pages</span> =        {4106-4135},
  <span style="color: #8b008b;">year</span> =         2013,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1021/cr300329s</span>},
  <span style="color: #8b008b;">url</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">http://dx.doi.org/10.1021/cr300329s</span>},
  <span style="color: #8b008b;">month</span> =        6,
}
</pre>
</div>

<p>
to this:
</p>

<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">campbell-2013-enthal-entrop</span>,
  <span style="color: #8b008b;">author</span> =       {Charles T. Campbell and Jason R. V. Sellers},
  <span style="color: #8b008b;">title</span> =        {Enthalpies and Entropies of Adsorption on
                  Well-defined Oxide Surfaces: Experimental
                  Measurements},
  <span style="color: #8b008b;">journal</span> =      CR,
  <span style="color: #8b008b;">volume</span> =       113,
  <span style="color: #8b008b;">number</span> =       6,
  <span style="color: #8b008b;">pages</span> =        {4106-4135},
  <span style="color: #8b008b;">year</span> =         2013,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1021/cr300329s</span>},
  <span style="color: #8b008b;">url</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">http://dx.doi.org/10.1021/cr300329s</span>},
  <span style="color: #8b008b;">month</span> =        6,
}
</pre>
</div>

<p>
We wrote the title case function so we can use it with bibtex-map-entries. That means we can fix every entry in a file by putting a comment at the top like this:
</p>

<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #ff0000; font-weight: bold;">% (bibtex-map-entries 'jmax-title-case-article)  &lt;- put cursor here. C-x C-e</span>
</pre>
</div>

<p>
The function is not perfect, and does not include every word that should not be capitalized. You will still want to review your entries, but hopefully this saves some typing in the end.</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/10/12/Title-casing-bibtex-entry-journal-titles.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/10/12/Title-casing-bibtex-entry-journal-titles#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../45">« Previous Page</a>
  --  
 <a href="../47">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/01/27/New-publication-in-Topics-in-Catalysis/">New publication in Topics in Catalysis</a></li>
      <li><a href="/blog/2018/01/03/New-publication-in-Molecular-Simulation/">New publication in Molecular Simulation</a></li>
      <li><a href="/blog/2017/12/31/2017-in-a-nutshell-for-the-Kitchin-Research-group/">2017 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2017/11/29/Solving-an-eigenvalue-differential-equation-with-a-neural-network/">Solving an eigenvalue differential equation with a neural network</a></li>
      <li><a href="/blog/2017/11/28/Solving-ODEs-with-a-neural-network-and-autograd/">Solving ODEs with a neural network and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



