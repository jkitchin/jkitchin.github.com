

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Advanced-string-formatting"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/20/Advanced-string-formatting/" rel="bookmark" title="Permanent Link to Advanced string formatting">Advanced string formatting</a></h2>
      <p><small><span class="blog_post_date">Posted February 20, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/20/Advanced-string-formatting#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:50 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
There are several more advanced ways to include formatted values in a string. In the previous case we examined replacing format specifiers by <i>positional</i> arguments in the format command. We can instead use <i>keyword</i> arguments. 
</p>

<div class="org-src-container">

<pre class="src src-python">s = <span style="color: #228b22;">'The {speed} {color} fox'</span>.format(color=<span style="color: #228b22;">'brown'</span>, speed=<span style="color: #228b22;">'quick'</span>)
<span style="color: #8b0000;">print</span> s
</pre>
</div>

<pre class="example">
The quick brown fox
</pre>

<p>
If you have a lot of variables already defined in a script, it is convenient to use them in string formatting with the locals command:
</p>

<div class="org-src-container">

<pre class="src src-python">speed = <span style="color: #228b22;">'slow'</span>
color= <span style="color: #228b22;">'blue'</span>

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The {speed} {color} fox'</span>.format(**<span style="color: #8b0000;">locals</span>())
</pre>
</div>

<pre class="example">
The slow blue fox
</pre>

<p>
If you want to access attributes on an object, you can specify them directly in the format identifier.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">class</span> <span style="color: #4682b4;">A</span>:
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__init__</span>(<span style="color: #8b0000;">self</span>, a, b, c):
        <span style="color: #8b0000;">self</span>.a = a
        <span style="color: #8b0000;">self</span>.b = b
        <span style="color: #8b0000;">self</span>.c = c

mya = A(3,4,5)

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'a = {obj.a}, b = {obj.b}, c = {obj.c:1.2f}'</span>.format(obj=mya)
</pre>
</div>

<pre class="example">
a = 3, b = 4, c = 5.00
</pre>

<p>
You can access values of a dictionary:
</p>
<div class="org-src-container">

<pre class="src src-python">d = {<span style="color: #228b22;">'a'</span>: 56, <span style="color: #228b22;">"test"</span>:<span style="color: #228b22;">'woohoo!'</span>}

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">"the value of a in the dictionary is {obj[a]}. It works {obj[test]}"</span>.format(obj=d)
</pre>
</div>

<pre class="example">
the value of a in the dictionary is 56. It works woohoo!.
</pre>

<p>
And, you can access elements of a list. Note, however you cannot use -1 as an index in this case.
</p>

<div class="org-src-container">

<pre class="src src-python">L = [4, 5, <span style="color: #228b22;">'cat'</span>]

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'element 0 = {obj[0]}, and the last element is {obj[2]}'</span>.format(obj=L)
</pre>
</div>

<pre class="example">
element 0 = 4, and the last element is cat
</pre>

<p>
There are three different ways to &ldquo;print&rdquo; an object. If an object has a <span style="text-decoration:underline;"><span style="text-decoration:underline;">format</span></span> function, that is the default used in the format command. It may be helpful to use the <code>str</code> or <code>repr</code> of an object instead. We get this with !s for <code>str</code> and !r for <code>repr</code>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">class</span> <span style="color: #4682b4;">A</span>:
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__init__</span>(<span style="color: #8b0000;">self</span>, a, b):
        <span style="color: #8b0000;">self</span>.a = a; <span style="color: #8b0000;">self</span>.b = b

    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__format__</span>(<span style="color: #8b0000;">self</span>, format):
        s = <span style="color: #228b22;">'a={{0:{0}}} b={{1:{0}}}'</span>.format(format)
        <span style="color: #8b0000;">return</span> s.format(<span style="color: #8b0000;">self</span>.a, <span style="color: #8b0000;">self</span>.b)

    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__str__</span>(<span style="color: #8b0000;">self</span>):
        <span style="color: #8b0000;">return</span> <span style="color: #228b22;">'str: class A, a={0} b={1}'</span>.format(<span style="color: #8b0000;">self</span>.a, <span style="color: #8b0000;">self</span>.b)

    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__repr__</span>(<span style="color: #8b0000;">self</span>):
        <span style="color: #8b0000;">return</span> <span style="color: #228b22;">'representing: class A, a={0}, b={1}'</span>.format(<span style="color: #8b0000;">self</span>.a, <span style="color: #8b0000;">self</span>.b)

mya = A(3, 4)

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0}'</span>.format(mya)   <span style="color: #ff0000; font-weight: bold;"># uses __format__</span>
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0!s}'</span>.format(mya) <span style="color: #ff0000; font-weight: bold;"># uses __str__</span>
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0!r}'</span>.format(mya) <span style="color: #ff0000; font-weight: bold;"># uses __repr__</span>
</pre>
</div>

<pre class="example">
a=3 b=4
str: class A, a=3 b=4
representing: class A, a=3, b=4
</pre>

<p>
This covers the majority of string formatting requirements I have come across. If there are more sophisticated needs, they can be met with various string templating python modules. the one I have used most is <a href="http://www.cheetahtemplate.org/" >Cheetah</a>.</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/20/Advanced-string-formatting.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/20/Advanced-string-formatting#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Subclassing-an-ase-calculators-vasp-calculator-to-do-post-analysis"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/19/Subclassing-an-ase-calculators-vasp-calculator-to-do-post-analysis/" rel="bookmark" title="Permanent Link to Subclassing an ase.calculators.vasp calculator to do post analysis">Subclassing an ase.calculators.vasp calculator to do post analysis</a></h2>
      <p><small><span class="blog_post_date">Posted February 19, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/vasp/'>vasp</a>, <a href='/blog/category/ase/'>ase</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/19/Subclassing-an-ase-calculators-vasp-calculator-to-do-post-analysis#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 01, 2013 at 02:54 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Recently someone <a href="https://listserv.fysik.dtu.dk/pipermail/ase-users/2013-February/001683.html" >reported</a> on the ase-users mail list an issue they had with the Vasp calculator where the maximum number of electronic steps and then stops, even though the calculation is not converged. They asked how to make this raise an exception. This is not a built in feature in ase.calculators.vasp, but we can add it via a subclass. The idea is create a new class that inherits from ase.calculators.vasp, and then augment the calculate function to do some post analysis. In this case, we will parse the OUTCAR file looking for lines like:
</p>

<pre class="example">
----------------------------------------- Iteration    1(   1)  ---------------------------------------
</pre>

<p>
I think the first integer corresponds to an ionic iteration, while the number in parentheses corresponds to an electronic iteration.  We will just count them up, and see if they match the values we specified. If they do, we can print an error message, or raise an exception. Here is the code:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.calculators.vasp <span style="color: #8b0000;">import</span> Vasp
<span style="color: #8b0000;">from</span> ase <span style="color: #8b0000;">import</span> Atom, Atoms
<span style="color: #8b0000;">import</span> os, re

os.chdir(<span style="color: #228b22;">'h2o-relax'</span>)

<span style="color: #8b0000;">class</span> <span style="color: #4682b4;">myvasp</span>(Vasp):
    <span style="color: #228b22;">'''subclass to run VASP and then check OUTCAR to see if the number</span>
<span style="color: #228b22;">    of electronic steps is equal to the max NELM specified, or if the</span>
<span style="color: #228b22;">    number of geometry steps is equal to NSW. Either case indicates</span>
<span style="color: #228b22;">    VASP may not be converged, but just stopped because it was told</span>
<span style="color: #228b22;">    too.'''</span>

    <span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">save original function</span>
    
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">calculate</span>(<span style="color: #8b0000;">self</span>, *args):
        <span style="color: #228b22;">'Run VASP, then check if nsw or nelm is met'</span>

        <span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">run original calculate method</span>
        Vasp.calculate(<span style="color: #8b0000;">self</span>, *args)
        
        <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">now do post analysis</span>
        NELM = <span style="color: #8b0000;">self</span>.int_params[<span style="color: #228b22;">'nelm'</span>]
        NSW = <span style="color: #8b0000;">self</span>.int_params[<span style="color: #228b22;">'nsw'</span>]

        max_nelm, max_nsw = 0, 0

        <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">open OUTCAR and check for what you want</span>
        <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">parse this line: - Iteration    1(   1)</span>
        regexp = re.compile(<span style="color: #228b22;">'Iteration\s+(?P&lt;nsw&gt;\d*)\(\s+(?P&lt;nelm&gt;\d*)\)'</span>)
        count = 0
        <span style="color: #8b0000;">with</span> <span style="color: #8b0000;">open</span>(<span style="color: #228b22;">'OUTCAR'</span>) <span style="color: #8b0000;">as</span> f:
            <span style="color: #8b0000;">for</span> line <span style="color: #8b0000;">in</span> f:
                <span style="color: #8b0000;">if</span> <span style="color: #228b22;">'Iteration'</span> <span style="color: #8b0000;">in</span> line:
                    m = regexp.search(line)
                    nsw = <span style="color: #8b0000;">int</span>(m.groupdict().get(<span style="color: #228b22;">'nsw'</span>))
                    <span style="color: #8b0000;">if</span> nsw &gt; max_nsw:
                        max_nsw = nsw
                    nelm = <span style="color: #8b0000;">int</span>(m.groupdict().get(<span style="color: #228b22;">'nelm'</span>))
                    <span style="color: #8b0000;">if</span> nelm &gt; max_nelm:
                        max_nelm = nelm

        <span style="color: #8b0000;">if</span> max_nelm == NELM:
            <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">raise exception here if you prefer</span>
            <span style="color: #8b0000;">print</span> (<span style="color: #228b22;">'{0} NELM steps taken! check convergence'</span>.format(max_nelm))
        <span style="color: #8b0000;">if</span> max_nsw == NSW:
            <span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'{0} NSW steps taken! check convergence'</span>.format(max_nsw))


atoms = Atoms([Atom(<span style="color: #228b22;">'H'</span>, [0.5960812, -0.7677068, 0.0000000]),
               Atom(<span style="color: #228b22;">'O'</span>, [0.0000000, 0.0000000, 0.0000000]),
               Atom(<span style="color: #228b22;">'H'</span>, [0.5960812, 0.7677068, 0.0000000])],
               cell=(8, 8, 8))

calc = myvasp(xc=<span style="color: #228b22;">'PBE'</span>,
              nelm=2,
              encut=400,
              ismear=0,<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Gaussian smearing</span>
              ibrion=2,
              ediff=1e-8,
              nsw=3)

atoms.set_calculator(calc)

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'Forces'</span>
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'==========================='</span>
<span style="color: #8b0000;">print</span> atoms.get_forces()
</pre>
</div>

<pre class="example">
Forces
===========================
 running on    1 nodes
 distr:  one band on    1 nodes,    1 groups
 vasp.5.2.12 11Nov11 complex                                                    
  
 POSCAR found :  2 types and       3 ions
 LDA part: xc-table for Pade appr. of Perdew
 found WAVECAR, reading the header
 POSCAR, INCAR and KPOINTS ok, starting setup
 WARNING: small aliasing (wrap around) errors must be expected
 FFT: planning ...(           1 )
 reading WAVECAR
 the WAVECAR file was read sucessfully
 initial charge from wavefunction
 entering main loop
       N       E                     dE             d eps       ncg     rms          rms(c)
DAV:   1    -0.142298749169E+02   -0.14230E+02   -0.10298E-01    24   0.330E+00    0.231E-01
DAV:   2    -0.142281671566E+02    0.17078E-02   -0.36659E-03    24   0.581E-01
   1 F= -.14228167E+02 E0= -.14228167E+02  d E =-.142282E+02
 curvature:   0.00 expect dE= 0.000E+00 dE for cont linesearch  0.000E+00
 trial: gam= 0.00000 g(F)=  0.114E-04 g(S)=  0.000E+00 ort = 0.000E+00 (trialstep = 0.100E+01)
 search vector abs. value=  0.114E-04
 bond charge predicted
       N       E                     dE             d eps       ncg     rms          rms(c)
DAV:   1    -0.142273929196E+02    0.24820E-02   -0.17613E-03    24   0.419E-01    0.149E-02
DAV:   2    -0.142274190765E+02   -0.26157E-04   -0.20256E-04    16   0.115E-01
   2 F= -.14227419E+02 E0= -.14227419E+02  d E =0.748080E-03
 trial-energy change:    0.000748  1 .order   -0.000006   -0.000011   -0.000001
 step:   1.0700(harm=  1.0700)  dis= 0.00047  next Energy=   -14.228173 (dE=-0.609E-05)
 bond charge predicted
       N       E                     dE             d eps       ncg     rms          rms(c)
DAV:   1    -0.142274279955E+02   -0.35076E-04   -0.72088E-06    32   0.308E-02    0.758E-03
DAV:   2    -0.142274385490E+02   -0.10553E-04   -0.97783E-07    24   0.858E-03
   3 F= -.14227439E+02 E0= -.14227439E+02  d E =0.728608E-03
 curvature:  -0.53 expect dE=-0.133E-03 dE for cont linesearch -0.931E-08
 trial: gam=21.74088 g(F)=  0.248E-03 g(S)=  0.000E+00 ort = 0.445E-06 (trialstep = 0.204E-02)
 search vector abs. value=  0.565E-02
 writing wavefunctions
Running vanilla serial job
2 NELM steps taken! check convergence
3 NSW steps taken! check convergence
[[ 0.024 -0.028  0.   ]
 [-0.048  0.     0.   ]
 [ 0.024  0.028  0.   ]]
</pre>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/19/Subclassing-an-ase.calculators.vasp-calculator-to-do-post-analysis.org">org-mode source</a><p>


    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/19/Subclassing-an-ase-calculators-vasp-calculator-to-do-post-analysis#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Are-averages-different"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Are-averages-different/" rel="bookmark" title="Permanent Link to Are averages different">Are averages different</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/data-analysis/'>data analysis</a>, <a href='/blog/category/statistics/'>statistics</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Are-averages-different#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:35 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2012/01/28/are-two-averages-different/" >Matlab post</a>
</p>

<p>
Adapted from <a href="http://stattrek.com/ap-statistics-4/unpaired-means.aspx" >http://stattrek.com/ap-statistics-4/unpaired-means.aspx</a>
</p>

<p>
Class A had 30 students who received an average test score of 78, with standard deviation of 10. Class B had 25 students an average test score of 85, with a standard deviation of 15. We want to know if the difference in these averages is statistically relevant. Note that we only have estimates of the true average and standard deviation for each class, and there is uncertainty in those estimates. As a result, we are unsure if the averages are really different. It could have just been luck that a few students in class B did better.
</p>

<p>
The hypothesis:
</p>

<p>
the true averages are the same. We need to perform a two-sample t-test of the hypothesis that \(\mu_1 - \mu_2 = 0\) (this is often called the null hypothesis). we use a two-tailed test because we do not care if the difference is positive or negative, either way means the averages are not the same.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

n1 = 30  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">students in class A</span>
x1 = 78.0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">average grade in class A</span>
s1 = 10.0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">std dev of exam grade in class A</span>

n2 = 25  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">students in class B</span>
x2 = 85.0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">average grade in class B</span>
s2 = 15.0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">std dev of exam grade in class B</span>

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">the standard error of the difference between the two averages. </span>
SE = np.sqrt(s1**2 / n1 + s2**2 / n2)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">compute DOF</span>
DF = (n1 - 1) + (n2 - 1)
</pre>
</div>

<p>
see the discussion at <a href="http://stattrek.com/Help/Glossary.aspx?Target=Two-sample%20t-test" >http://stattrek.com/Help/Glossary.aspx?Target=Two-sample%20t-test</a> for a more complex definition of degrees of freedom. Here we simply subtract one from each sample size to account for the estimation of the average of each sample.
</p>


<p>
compute the t-score for our data
</p>

<p>
The difference between two averages determined from small sample numbers follows the t-distribution. the t-score is the difference between the difference of the means and the hypothesized difference of the means, normalized by the standard error. we compute the absolute value of the t-score to make sure it is positive for convenience later.
</p>
<div class="org-src-container">

<pre class="src src-python">tscore = np.abs(((x1 - x2) - 0) / SE)
<span style="color: #8b0000;">print</span> tscore
</pre>
</div>

<pre class="example">
1.99323179108
</pre>

<p>
Interpretation
</p>

<p>
A way to approach determinining if the difference is significant or not is to ask, does our computed average fall within a confidence range of the hypothesized value (zero)? If it does, then we can attribute the difference to statistical variations at that confidence level. If it does not, we can say that statistical variations do not account for the difference at that confidence level, and hence the averages must be different.
</p>

<p>
Let us compute the t-value that corresponds to a 95% confidence level for a mean of zero with the degrees of freedom computed earlier. This means that 95% of the t-scores we expect to get will fall within \(\pm\) t95.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.stats.distributions <span style="color: #8b0000;">import</span>  t

ci = 0.95;
alpha = 1 - ci;
t95 = t.ppf(1.0 - alpha/2.0, DF)

<span style="color: #8b0000;">print</span> t95
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 2.00574599354
</pre>

<p>
since tscore &lt; t95, we conclude that at the 95% confidence level we cannot say these averages are statistically different because our computed t-score falls in the expected range of deviations. Note that our t-score is very close to the 95% limit. Let us consider a smaller confidence interval.
</p>

<div class="org-src-container">

<pre class="src src-python">ci = 0.94
alpha = 1 - ci;
t95 = t.ppf(1.0 - alpha/2.0, DF)

<span style="color: #8b0000;">print</span> t95
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 1.92191364181
</pre>

<p>
at the 94% confidence level, however, tscore &gt; t94, which means we can say with 94% confidence that the two averages are different; class B performed better than class A did. Alternatively, there is only about a 6% chance we are wrong about that statement.
another way to get there
</p>

<p>
An alternative way to get the confidence that the averages are different is to directly compute it from the cumulative t-distribution function. We compute the difference between all the t-values less than tscore and the t-values less than -tscore, which is the fraction of measurements that are between them. You can see here that we are practically 95% sure that the averages are different.
</p>

<div class="org-src-container">

<pre class="src src-python">f = t.cdf(tscore, DF) - t.cdf(-tscore, DF)
<span style="color: #8b0000;">print</span> f
</pre>
</div>

<pre class="example">
0.948605075732
</pre>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Are-averages-different.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Are-averages-different#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Basic-statistics"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Basic-statistics/" rel="bookmark" title="Permanent Link to Basic statistics">Basic statistics</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/statistics/'>statistics</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Basic-statistics#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:35 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Given several measurements of a single quantity, determine the average value of the measurements, the standard deviation of the measurements and the 95% confidence interval for the average.
</p>

<p>
This is a recipe for computing the confidence interval. The strategy is:
</p>
<ol>
<li>compute the average
</li>
<li>Compute the standard deviation of your data
</li>
<li>Define the confidence interval, e.g. 95% = 0.95
</li>
<li>compute the student-t multiplier. This is a function of the confidence
</li>
</ol>
<p>
interval you specify, and the number of data points you have minus 1. You
subtract 1 because one degree of freedom is lost from calculating the
average. The confidence interval is defined as
ybar +- T_multiplier*std/sqrt(n).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.stats.distributions <span style="color: #8b0000;">import</span>  t

y = [8.1, 8.0, 8.1]

ybar = np.mean(y)
s = np.std(y)

ci = 0.95
alpha = 1.0 - ci

n = <span style="color: #8b0000;">len</span>(y)
T_multiplier = t.ppf(1-alpha/2.0, n-1)

ci95 = T_multiplier * s / np.sqrt(n-1)

<span style="color: #8b0000;">print</span> [ybar - ci95, ybar + ci95]
</pre>
</div>

<pre class="example">
[7.9232449090029595, 8.210088424330376]
</pre>

<p>
We are 95% certain the next measurement will fall in the interval above.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Basic-statistics.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Basic-statistics#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Calculating-a-bubble-point-pressure-of-a-mixture"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture/" rel="bookmark" title="Permanent Link to Calculating a bubble point pressure of a mixture">Calculating a bubble point pressure of a mixture</a></h2>
      <p><small><span class="blog_post_date">Posted February 18, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-algebra/'>nonlinear algebra</a></span> | tags: <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 04:32 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/15/calculating-a-bubble-point-pressure/" >Matlab post</a>
</p>

<p>
Adapted from <a href="http://terpconnect.umd.edu/~nsw/ench250/bubpnt.htm" >http://terpconnect.umd.edu/~nsw/ench250/bubpnt.htm</a> (dead link)
</p>

<p>
We previously learned to read a datafile containing lots of Antoine coefficients into a database, and use the coefficients to estimate vapor pressure of a single compound. Here we use those coefficents to compute a bubble point pressure of a mixture. 
</p>

<p>
The bubble point is the temperature at which the sum of the component vapor pressures is equal to the the total pressure. This is where a bubble of vapor will first start forming, and the mixture starts to boil.
</p>

<p>
Consider an equimolar mixture of benzene, toluene, chloroform, acetone and methanol. Compute the bubble point at 760 mmHg, and the gas phase composition. The gas phase composition is given by: \(y_i = x_i*P_i/P_T\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #ff0000; font-weight: bold;"># load our thermodynamic data</span>
data = np.loadtxt(<span style="color: #228b22;">'data/antoine_data.dat'</span>,
                  dtype=[(<span style="color: #228b22;">'id'</span>, np.int),
                         (<span style="color: #228b22;">'formula'</span>, <span style="color: #228b22;">'S8'</span>),
                         (<span style="color: #228b22;">'name'</span>, <span style="color: #228b22;">'S28'</span>),
                         (<span style="color: #228b22;">'A'</span>, np.float),
                         (<span style="color: #228b22;">'B'</span>, np.float),
                         (<span style="color: #228b22;">'C'</span>, np.float),
                         (<span style="color: #228b22;">'Tmin'</span>, np.float),
                         (<span style="color: #228b22;">'Tmax'</span>, np.float),
                         (<span style="color: #228b22;">'??'</span>, <span style="color: #228b22;">'S4'</span>),
                         (<span style="color: #228b22;">'?'</span>, <span style="color: #228b22;">'S4'</span>)],
                  skiprows=7)

compounds = [<span style="color: #228b22;">'benzene'</span>, <span style="color: #228b22;">'toluene'</span>, <span style="color: #228b22;">'chloroform'</span>, <span style="color: #228b22;">'acetone'</span>, <span style="color: #228b22;">'methanol'</span>]

<span style="color: #ff0000; font-weight: bold;"># extract the data we want</span>
A = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'A'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
B = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'B'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
C = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'C'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
Tmin = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'Tmin'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])
Tmax = np.array([data[data[<span style="color: #228b22;">'name'</span>] == x][<span style="color: #228b22;">'Tmax'</span>][0] <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> compounds])


<span style="color: #ff0000; font-weight: bold;"># we have an equimolar mixture</span>
x = np.array([0.2, 0.2, 0.2, 0.2, 0.2])

<span style="color: #ff0000; font-weight: bold;"># Given a T, we can compute the pressure of each species like this:</span>

T = 67 <span style="color: #ff0000; font-weight: bold;"># degC</span>
P = 10**(A - B / (T + C))
<span style="color: #8b0000;">print</span> P
<span style="color: #8b0000;">print</span> np.dot(x, P)  <span style="color: #ff0000; font-weight: bold;"># total mole-fraction weighted pressure</span>

Tguess = 67
Ptotal = 760

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(T):
    P = 10**(A - B / (T + C))
    <span style="color: #8b0000;">return</span> Ptotal - np.dot(x, P)
    
Tbubble, = fsolve(func, Tguess)

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The bubble point is {0:1.2f} degC'</span>.format(Tbubble)

<span style="color: #ff0000; font-weight: bold;"># double check answer is in a valid T range</span>
<span style="color: #8b0000;">if</span> np.any(Tbubble &lt; Tmin) <span style="color: #8b0000;">or</span> np.any(Tbubble &gt; Tmax):
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'T_bubble is out of range!'</span>

<span style="color: #ff0000; font-weight: bold;"># print gas phase composition</span>
y = x * 10**(A - B / (Tbubble + C))/Ptotal

<span style="color: #8b0000;">for</span> cmpd, yi <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(compounds, y):
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'y_{0:&lt;10s} = {1:1.3f}'</span>.format(cmpd, yi)
</pre>
</div>

<pre class="example">
[  498.4320267    182.16010994   898.31061294  1081.48181768   837.88860027]
699.654633507
The bubble point is 69.46 degC
y_benzene    = 0.142
y_toluene    = 0.053
y_chloroform = 0.255
y_acetone    = 0.308
y_methanol   = 0.242
</pre>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../92">« Previous Page</a>
  --  
 <a href="../94">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/01/27/New-publication-in-Topics-in-Catalysis/">New publication in Topics in Catalysis</a></li>
      <li><a href="/blog/2018/01/03/New-publication-in-Molecular-Simulation/">New publication in Molecular Simulation</a></li>
      <li><a href="/blog/2017/12/31/2017-in-a-nutshell-for-the-Kitchin-Research-group/">2017 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2017/11/29/Solving-an-eigenvalue-differential-equation-with-a-neural-network/">Solving an eigenvalue differential equation with a neural network</a></li>
      <li><a href="/blog/2017/11/28/Solving-ODEs-with-a-neural-network-and-autograd/">Solving ODEs with a neural network and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



