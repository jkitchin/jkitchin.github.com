

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="http://www.researcherid.com/rid/A-2363-2010" target="_new">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/group.html"
             class="">Group</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>
    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="A-novel-way-to-numerically-estimate-the-derivative-of-a-function-complex-step-derivative-approximation"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/27/A-novel-way-to-numerically-estimate-the-derivative-of-a-function-complex-step-derivative-approximation/" rel="bookmark" title="Permanent Link to A novel way to numerically estimate the derivative of a function - complex-step derivative approximation">A novel way to numerically estimate the derivative of a function - complex-step derivative approximation</a></h2>
      <p><small><span class="blog_post_date">Posted February 27, 2013 at 02:51 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/27/A-novel-way-to-numerically-estimate-the-derivative-of-a-function-complex-step-derivative-approximation#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated July 09, 2013 at 08:53 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>

</p>

<p>
<a href="http://matlab.cheme.cmu.edu/2011/12/24/a-novel-way-to-numerically-estimate-the-derivative-of-a-function-complex-step-derivative-approximation/">Matlab post</a>
</p>

<p>
Adapted from <a href="http://biomedicalcomputationreview.org/2/3/8.pdf">http://biomedicalcomputationreview.org/2/3/8.pdf</a> and
<a href="http://dl.acm.org/citation.cfm?id=838250.838251">http://dl.acm.org/citation.cfm?id=838250.838251</a>
</p>

<p>
This posts introduces a novel way to numerically estimate the derivative
of a function that does not involve finite difference schemes. Finite
difference schemes are approximations to derivatives that become more and
more accurate as the step size goes to zero, except that as the step size
approaches the limits of machine accuracy, new errors can appear in the
approximated results. In the references above, a new way to compute the
derivative is presented that does not rely on differences!
</p>

<p>
The new way is: \(f'(x) = \rm{imag}(f(x + i\Delta x)/\Delta x)\) where the
function \(f\) is evaluated in imaginary space with a small \(\Delta x\) in
the complex plane. The derivative is miraculously equal to the imaginary
part of the result in the limit of \(\Delta x \rightarrow 0\)!
</p>

<p>
This example comes from the first link. The derivative must be evaluated
using the chain rule.  We compare a forward difference, central
difference and complex-step derivative approximations.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f</span>(x):   <span style="color: #8b0000;">return</span> np.sin(3*x)*np.log(x)

x = 0.7
h = 1e-7

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">analytical derivative</span>
dfdx_a = 3 * np.cos( 3*x)*np.log(x) + np.sin(3*x) / x

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">finite difference</span>
dfdx_fd = (f(x + h) - f(x))/h

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">central difference</span>
dfdx_cd = (f(x+h)-f(x-h))/(2*h)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">complex method</span>
dfdx_I = np.imag(f(x + np.complex(0, h))/h)

<span style="color: #8b0000;">print</span> dfdx_a
<span style="color: #8b0000;">print</span> dfdx_fd
<span style="color: #8b0000;">print</span> dfdx_cd
<span style="color: #8b0000;">print</span> dfdx_cd
</pre>
</div>

<pre class="example">
1.77335410624
1.7733539398
1.77335410523
1.77335410523
</pre>

<p>
These are all the same to 4 decimal places. The simple finite difference is the least accurate, and the central differences is practically the same as the complex number approach.
</p>

<p>
Let us use this method to verify the fundamental Theorem of Calculus, i.e.
to evaluate the derivative of an integral function. Let \(f(x) =
\int\limits_1^{x^2} tan(t^3)dt\), and we now want to compute df/dx.
Of course, this can be done
<a href="http://mathmistakes.info/facts/CalculusFacts/learn/doi/doif.html">analytically</a>, but it is not trivial!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f_</span>(z):
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">integrand</span>(t):
        <span style="color: #8b0000;">return</span> np.tan(t**3)
    <span style="color: #8b0000;">return</span> quad(integrand, 0, z**2)

f = np.vectorize(f_)

x = np.linspace(0, 1)

h = 1e-7

dfdx = np.imag(f(x + <span style="color: #8b0000;">complex</span>(0, h)))/h
dfdx_analytical = 2 * x * np.tan(x**6)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

plt.plot(x, dfdx, x, dfdx_analytical, <span style="color: #228b22;">'r--'</span>)
plt.show()
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; c:\Python27\lib\site-packages\scipy\integrate\quadpack.py:312: ComplexWarning: Casting complex values to real discards the imaginary part
  return _quadpack._qagse(func,a,b,args,full_output,epsabs,epsrel,limit)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "c:\Python27\lib\site-packages\numpy\lib\function_base.py", line 1885, in __call__
    for x, c in zip(self.ufunc(*newargs), self.otypes)])
  File "&lt;stdin&gt;", line 4, in f_
  File "c:\Python27\lib\site-packages\scipy\integrate\quadpack.py", line 247, in quad
    retval = _quad(func,a,b,args,full_output,epsabs,epsrel,limit,points)
  File "c:\Python27\lib\site-packages\scipy\integrate\quadpack.py", line 312, in _quad
    return _quadpack._qagse(func,a,b,args,full_output,epsabs,epsrel,limit)
TypeError: can't convert complex to float
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
NameError: name 'dfdx' is not defined
</pre>

<p>
Interesting this fails.</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/A-novel-way-to-numerically-estimate-the-derivative-of-a-function---complex-step-derivative-approximation.org">org-mode source</a><p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/27/A-novel-way-to-numerically-estimate-the-derivative-of-a-function-complex-step-derivative-approximation#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Vectorized-numeric-derivatives"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/27/Vectorized-numeric-derivatives/" rel="bookmark" title="Permanent Link to Vectorized numeric derivatives">Vectorized numeric derivatives</a></h2>
      <p><small><span class="blog_post_date">Posted February 27, 2013 at 02:51 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/27/Vectorized-numeric-derivatives#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 06:26 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>

Loops are usually not great for performance. Numpy offers some vectorized methods that allow us to compute derivatives without loops, although this comes at the mental cost of harder to understand syntax
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

x = np.linspace(0, 2 * np.pi, 100)
y = np.sin(x)
dy_analytical = np.cos(x)


<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">we need to specify the size of dy ahead because diff returns</span>
<span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">an array of n-1 elements</span>
dy = np.zeros(y.shape, np.float) <span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">we know it will be this size</span>
dy[0:-1] = np.diff(y) / np.diff(x)
dy[-1] = (y[-1] - y[-2]) / (x[-1] - x[-2])


<span style="color: #228b22;">'''</span>
<span style="color: #228b22;">calculate dy by center differencing using array slices</span>
<span style="color: #228b22;">'''</span>

dy2 = np.zeros(y.shape,np.float) <span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">we know it will be this size</span>
dy2[1:-1] = (y[2:] - y[0:-2]) / (x[2:] - x[0:-2])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">now the end points</span>
dy2[0] = (y[1] - y[0]) / (x[1] - x[0])
dy2[-1] = (y[-1] - y[-2]) / (x[-1] - x[-2])

plt.plot(x,y)
plt.plot(x,dy_analytical,label=<span style="color: #228b22;">'analytical derivative'</span>)
plt.plot(x,dy,label=<span style="color: #228b22;">'forward diff'</span>)
plt.plot(x,dy2,<span style="color: #228b22;">'k--'</span>,lw=2,label=<span style="color: #228b22;">'centered diff'</span>)
plt.legend(loc=<span style="color: #228b22;">'lower left'</span>)
plt.savefig(<span style="color: #228b22;">'images/vectorized-diffs.png'</span>)
plt.show()
</pre>
</div>

<p><img src="/img/./images/vectorized-diffs.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/Vectorized-numeric-derivatives.org">org-mode source</a><p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/27/Vectorized-numeric-derivatives#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Numeric-derivatives-by-differences"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/27/Numeric-derivatives-by-differences/" rel="bookmark" title="Permanent Link to Numeric derivatives by differences">Numeric derivatives by differences</a></h2>
      <p><small><span class="blog_post_date">Posted February 27, 2013 at 02:51 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/27/Numeric-derivatives-by-differences#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 06:27 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>




numpy has a function called numpy.diff() that is similar to the one found in matlab. It calculates the differences between the elements in your list, and returns a list that is one element shorter, which makes it unsuitable for plotting the derivative of a function.
</p>

<p>
Loops in python are pretty slow (relatively speaking) but they are usually trivial to understand. In this script we show some simple ways to construct derivative vectors using loops. It is implied in these formulas that the data points are equally spaced. If they are not evenly spaced, you need a different approach.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> pylab <span style="color: #8b0000;">import</span> *
<span style="color: #8b0000;">import</span> time

<span style="color: #228b22;">'''</span>
<span style="color: #228b22;">These are the brainless way to calculate numerical derivatives. They</span>
<span style="color: #228b22;">work well for very smooth data. they are surprisingly fast even up to</span>
<span style="color: #228b22;">10000 points in the vector.</span>
<span style="color: #228b22;">'''</span>

x = np.linspace(0.78,0.79,100)
y = np.sin(x)
dy_analytical = np.cos(x)
<span style="color: #228b22;">'''</span>
<span style="color: #228b22;">lets use a forward difference method:</span>
<span style="color: #228b22;">that works up until the last point, where there is not</span>
<span style="color: #228b22;">a forward difference to use. there, we use a backward difference.</span>
<span style="color: #228b22;">'''</span>

tf1 = time.time()
dyf = [0.0]*<span style="color: #8b0000;">len</span>(x)
<span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(len(y)-1):
    dyf[i] = (y[i+1] - y[i])/(x[i+1]-x[i])
<span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">set last element by backwards difference</span>
dyf[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">' Forward difference took %1.1f seconds'</span> % (time.time() - tf1)

<span style="color: #228b22;">'''and now a backwards difference'''</span>
tb1 = time.time()
dyb = [0.0]*<span style="color: #8b0000;">len</span>(x)
<span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">set first element by forward difference</span>
dyb[0] = (y[0] - y[1])/(x[0] - x[1])
<span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(1,<span style="color: #8b0000;">len</span>(y)):
    dyb[i] = (y[i] - y[i-1])/(x[i]-x[i-1])

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">' Backward difference took %1.1f seconds'</span> % (time.time() - tb1)

<span style="color: #228b22;">'''and now, a centered formula'''</span>
tc1 = time.time()
dyc = [0.0]*<span style="color: #8b0000;">len</span>(x)
dyc[0] = (y[0] - y[1])/(x[0] - x[1])
<span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(1,<span style="color: #8b0000;">len</span>(y)-1):
    dyc[i] = (y[i+1] - y[i-1])/(x[i+1]-x[i-1])
dyc[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">' Centered difference took %1.1f seconds'</span> % (time.time() - tc1)

<span style="color: #228b22;">'''</span>
<span style="color: #228b22;">the centered formula is the most accurate formula here</span>
<span style="color: #228b22;">'''</span>

plt.plot(x,dy_analytical,label=<span style="color: #228b22;">'analytical derivative'</span>)
plt.plot(x,dyf,<span style="color: #228b22;">'--'</span>,label=<span style="color: #228b22;">'forward'</span>)
plt.plot(x,dyb,<span style="color: #228b22;">'--'</span>,label=<span style="color: #228b22;">'backward'</span>)
plt.plot(x,dyc,<span style="color: #228b22;">'--'</span>,label=<span style="color: #228b22;">'centered'</span>)

plt.legend(loc=<span style="color: #228b22;">'lower left'</span>)
plt.savefig(<span style="color: #228b22;">'images/simple-diffs.png'</span>)
plt.show()
</pre>
</div>

<pre class="example">
Forward difference took 0.0 seconds
Backward difference took 0.0 seconds
Centered difference took 0.0 seconds
</pre>

<p><img src="/img/./images/simple-diffs.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/Numeric-derivatives-by-differences.org">org-mode source</a><p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/27/Numeric-derivatives-by-differences#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Indexing-vectors-and-arrays-in-Python"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/27/Indexing-vectors-and-arrays-in-Python/" rel="bookmark" title="Permanent Link to Indexing vectors and arrays in Python">Indexing vectors and arrays in Python</a></h2>
      <p><small><span class="blog_post_date">Posted February 27, 2013 at 02:50 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/basic/'>basic</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/27/Indexing-vectors-and-arrays-in-Python#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 06:27 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/08/24/indexing-vectors-and-arrays-in-matlab/" >Matlab post</a>
There are times where you have a lot of data in a vector or array and you want to extract a portion of the data for some analysis. For example, maybe you want to plot column 1 vs column 2, or you want the integral of data between x = 4 and x = 6, but your vector covers 0 &lt; x &lt; 10. Indexing is the way to do these things.
</p>

<p>
A key point to remember is that in python array/vector indices start at 0. Unlike Matlab, which uses parentheses to index a array, we use brackets in python.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

x = np.linspace(-np.pi, np.pi, 10)
<span style="color: #8b0000;">print</span> x

<span style="color: #8b0000;">print</span> x[0]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">first element</span>
<span style="color: #8b0000;">print</span> x[2]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">third element</span>
<span style="color: #8b0000;">print</span> x[-1] <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">last element</span>
<span style="color: #8b0000;">print</span> x[-2] <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">second to last element</span>
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [-3.14159265 -2.44346095 -1.74532925 -1.04719755 -0.34906585  0.34906585
  1.04719755  1.74532925  2.44346095  3.14159265]
&gt;&gt;&gt; -3.14159265359
-1.74532925199
3.14159265359
2.44346095279
</pre>

<p>
We can select a range of elements too. The syntax a:b extracts the a^{th} to (b-1)^{th} elements. The syntax a:b:n starts at a, skips nelements up to the index b.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> x[1:4]     <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">second to fourth element. Element 5 is not included</span>
<span style="color: #8b0000;">print</span> x[0:-1:2]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">every other element</span>
<span style="color: #8b0000;">print</span> x[:]       <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">print the whole vector</span>
<span style="color: #8b0000;">print</span> x[-1:0:-1] <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">reverse the vector!</span>
</pre>
</div>

<pre class="example">
[-2.44346095 -1.74532925 -1.04719755]
[-3.14159265 -1.74532925 -0.34906585  1.04719755  2.44346095]
[-3.14159265 -2.44346095 -1.74532925 -1.04719755 -0.34906585  0.34906585
  1.04719755  1.74532925  2.44346095  3.14159265]
[ 3.14159265  2.44346095  1.74532925  1.04719755  0.34906585 -0.34906585
 -1.04719755 -1.74532925 -2.44346095]
</pre>

<p>
Suppose we want the part of the vector where x &gt; 2. We could do that by inspection, but there is a better way. We can create a mask of boolean (0 or 1) values that specify whether x &gt; 2 or not, and then use the mask as an index.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> x[x &gt; 2]
</pre>
</div>

<pre class="example">
[ 2.44346095  3.14159265]
</pre>

<p>
You can use this to analyze subsections of data, for example to integrate the function y = sin(x) where x &gt; 2.
</p>

<div class="org-src-container">

<pre class="src src-python">y = np.sin(x)

<span style="color: #8b0000;">print</span> np.trapz( x[x &gt; 2], y[x &gt; 2])
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; -1.79500162881
</pre>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 2d arrays</h2>
<div class="outline-text-2" id="text-1">
<p>
In 2d arrays, we use  row, column notation. We use a : to indicate all rows or all columns.
</p>

<div class="org-src-container">

<pre class="src src-python">a = np.array([[1, 2, 3], 
              [4, 5, 6], 
              [7, 8, 9]])

<span style="color: #8b0000;">print</span> a[0, 0]
<span style="color: #8b0000;">print</span> a[-1, -1]

<span style="color: #8b0000;">print</span> a[0, :] <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">row one</span>
<span style="color: #8b0000;">print</span> a[:, 0] <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">column one</span>
<span style="color: #8b0000;">print</span> a[:]
</pre>
</div>

<pre class="example">
... &gt;&gt;&gt; &gt;&gt;&gt; 1
9
&gt;&gt;&gt; [1 2 3]
[1 4 7]
[[1 2 3]
 [4 5 6]
 [7 8 9]]
</pre>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Using indexing to assign values to rows and columns</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-python">b = np.zeros((3, 3))
<span style="color: #8b0000;">print</span> b

b[:, 0] = [1, 2, 3] <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">set column 0</span>
b[2, 2] = 12        <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">set a single element</span>
<span style="color: #8b0000;">print</span> b

b[2] = 6  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">sets everything in row 2 to 6!</span>
<span style="color: #8b0000;">print</span> b
</pre>
</div>

<pre class="example">
[[ 0.  0.  0.]
 [ 0.  0.  0.]
 [ 0.  0.  0.]]
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [[  1.   0.   0.]
 [  2.   0.   0.]
 [  3.   0.  12.]]
&gt;&gt;&gt; &gt;&gt;&gt; [[ 1.  0.  0.]
 [ 2.  0.  0.]
 [ 6.  6.  6.]]
</pre>

<p>
Python does not have the linear assignment method like Matlab does. You can achieve something like that as follows. We flatten the array to 1D, do the linear assignment, and reshape the result back to the 2D array.
</p>

<div class="org-src-container">

<pre class="src src-python">c = b.flatten()
c[2] = 34
b[:] = c.reshape(b.shape)
<span style="color: #8b0000;">print</span> b
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [[  1.   0.  34.]
 [  2.   0.   0.]
 [  6.   6.   6.]]
</pre>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 3D arrays</h2>
<div class="outline-text-2" id="text-3">
<p>
The 3d array is like book of 2D matrices. Each page has a 2D matrix on it. think about the indexing like this: (row, column, page)
</p>

<div class="org-src-container">

<pre class="src src-python">M = np.random.uniform(size=(3,3,3))  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">a 3x3x3 array</span>
<span style="color: #8b0000;">print</span> M
</pre>
</div>

<pre class="example">
[[[ 0.78557795  0.36454381  0.96090072]
  [ 0.76133373  0.03250485  0.08517174]
  [ 0.96007909  0.08654002  0.29693648]]

 [[ 0.58270738  0.60656083  0.47703339]
  [ 0.62551477  0.62244626  0.11030327]
  [ 0.2048839   0.83081982  0.83660668]]

 [[ 0.12489176  0.20783996  0.38481792]
  [ 0.05234762  0.03989146  0.09731516]
  [ 0.67427208  0.51793637  0.89016255]]]
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> M[:, :, 0]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">2d array on page 0</span>
<span style="color: #8b0000;">print</span> M[:, 0, 0]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">column 0 on page 0</span>
<span style="color: #8b0000;">print</span> M[1, :, 2]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">row 1 on page 2</span>
</pre>
</div>

<pre class="example">
[[ 0.78557795  0.76133373  0.96007909]
 [ 0.58270738  0.62551477  0.2048839 ]
 [ 0.12489176  0.05234762  0.67427208]]
[ 0.78557795  0.58270738  0.12489176]
[ 0.47703339  0.11030327  0.83660668]
</pre>
</div>
</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Summary</h2>
<div class="outline-text-2" id="text-4">
<p>
The most common place to use indexing is probably when a function returns an array with the independent variable in column 1 and solution in column 2, and you want to plot the solution. Second is when you want to analyze one part of the solution. There are also applications in numerical methods, for example in assigning values to the elements of a matrix or vector.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/Indexing-vectors-and-arrays-in-Python.org">org-mode source</a><p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/27/Indexing-vectors-and-arrays-in-Python#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Advanced-function-creation"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/27/Advanced-function-creation/" rel="bookmark" title="Permanent Link to Advanced function creation">Advanced function creation</a></h2>
      <p><small><span class="blog_post_date">Posted February 27, 2013 at 02:49 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/27/Advanced-function-creation#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 06:28 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Python has some nice features in creating functions. You can create default values for variables, have optional variables and optional keyword variables.
In this function f(a,b), <code>a</code> and <code>b</code> are called positional arguments, and they are required, and must be provided in the same order as the function defines.
</p>

<p>
If we provide a default value for an argument, then the argument is called a keyword argument, and it becomes optional. You can combine positional arguments and keyword arguments, but positional arguments must come first. Here is an example.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(a, n=2):
    <span style="color: #228b22;">"compute the nth power of a"</span>
    <span style="color: #8b0000;">return</span> a**n

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">three different ways to call the function</span>
<span style="color: #8b0000;">print</span> func(2)
<span style="color: #8b0000;">print</span> func(2, 3)
<span style="color: #8b0000;">print</span> func(2, n=4)
</pre>
</div>

<pre class="example">
4
8
16
</pre>

<p>
In the first call to the function, we only define the argument <code>a</code>, which is a mandatory, positional argument. In the second call, we define <code>a</code> and <code>n</code>, in the order they are defined in the function. Finally, in the third call, we define <code>a</code> as a positional argument, and <code>n</code> as a keyword argument.
</p>

<p>
If all of the arguments are optional, we can even call the function with no arguments. If you give arguments as positional arguments, they are used in the order defined in the function. If you use keyword arguments, the order is arbitrary.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(a=1, n=2):
    <span style="color: #228b22;">"compute the nth power of a"</span>
    <span style="color: #8b0000;">return</span> a**n

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">three different ways to call the function</span>
<span style="color: #8b0000;">print</span> func()
<span style="color: #8b0000;">print</span> func(2, 4)
<span style="color: #8b0000;">print</span> func(n=4, a=2)
</pre>
</div>

<pre class="example">
1
16
16
</pre>

<p>
It is occasionally useful to allow an arbitrary number of arguments in a function. Suppose we want a function that can take an arbitrary number of positional arguments and return the sum of all the arguments. We use the syntax <code>*args</code> to indicate arbitrary positional arguments. Inside the function the variable <code>args</code> is a tuple containing all of the arguments passed to the function. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(*args):
    <span style="color: #8b0000;">sum</span> = 0
    <span style="color: #8b0000;">for</span> arg <span style="color: #8b0000;">in</span> args:
        <span style="color: #8b0000;">sum</span> += arg
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">sum</span>

<span style="color: #8b0000;">print</span> func(1, 2, 3, 4)
</pre>
</div>

<pre class="example">
10
</pre>

<p>
A more &ldquo;functional programming&rdquo; version of the last function is given here. This is an advanced approach that is less readable to new users, but more compact and likely more efficient for large numbers of arguments.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> operator
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(*args):
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">reduce</span>(operator.add, args)
<span style="color: #8b0000;">print</span> func(1, 2, 3, 4)
</pre>
</div>

<pre class="example">
10
</pre>

<p>
It is possible to have arbitrary keyword arguments. This is a common pattern when you call another function within your function that takes keyword arguments. We use <code>**kwargs</code> to indicate that arbitrary keyword arguments can be given to the function. Inside the function, kwargs is variable containing a dictionary of the keywords and values passed in.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(**kwargs):
    <span style="color: #8b0000;">for</span> kw <span style="color: #8b0000;">in</span> kwargs:
        <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0} = {1}'</span>.format(kw, kwargs[kw])

func(t1=6, color=<span style="color: #228b22;">'blue'</span>)
</pre>
</div>

<pre class="example">
color = blue
t1 = 6
</pre>

<p>
A typical example might be:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">myplot</span>(x, y, fname=<span style="color: #8b0000;">None</span>, **kwargs):
    <span style="color: #228b22;">"make plot of x,y. save to fname if not None. provide kwargs to plot"</span>
    plt.plot(x, y, **kwargs)
    plt.xlabel(<span style="color: #228b22;">'X'</span>)
    plt.ylabel(<span style="color: #228b22;">'Y'</span>)
    plt.title(<span style="color: #228b22;">'My plot'</span>)
    <span style="color: #8b0000;">if</span> fname:
        plt.savefig(fname)
    <span style="color: #8b0000;">else:</span>
        plt.show()

x = [1, 3, 4, 5]
y = [3, 6, 9, 12]

myplot(x, y, <span style="color: #228b22;">'images/myfig.png'</span>, color=<span style="color: #228b22;">'orange'</span>, marker=<span style="color: #228b22;">'s'</span>)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">you can use a dictionary as kwargs</span>
d = {<span style="color: #228b22;">'color'</span>:<span style="color: #228b22;">'magenta'</span>,
     <span style="color: #228b22;">'marker'</span>:<span style="color: #228b22;">'d'</span>}

myplot(x, y, <span style="color: #228b22;">'images/myfig2.png'</span>, **d)
</pre>
</div>

<p><img src="/img/./images/myfig.png"><p>

<p><img src="/img/./images/myfig2.png"><p>

<p>
In that example we wrap the matplotlib plotting commands in a function, which we can call the way we want to, with arbitrary optional arguments. In this example, you cannot pass keyword arguments that are illegal to the plot command or you will get an error.
</p>

<p>
It is possible to combine all the options at once. I admit it is hard to imagine where this would be really useful, but it can be done!
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(a, b=2, *args, **kwargs):
    <span style="color: #228b22;">"return a**b + sum(args) and print kwargs"</span>
    <span style="color: #8b0000;">for</span> kw <span style="color: #8b0000;">in</span> kwargs:
        <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'kw: {0} = {1}'</span>.format(kw, kwargs[kw])

    <span style="color: #8b0000;">return</span> a**b + np.sum(args)

<span style="color: #8b0000;">print</span> func(2, 3, 4, 5, mysillykw=<span style="color: #228b22;">'hahah'</span>)
</pre>
</div>

<pre class="example">
kw: mysillykw = hahah
17
</pre>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/27/Advanced-function-creation.org">org-mode source</a><p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/27/Advanced-function-creation#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../38">« Previous Page</a>
  --  
 <a href="../40">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
Search
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kitchingroup.cheme.cmu.edu" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
    <li><a href="http://enthought.com">Enthought Python</a></li>
    <li><a href="/pycse">Pycse</a></li>
    <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2014/10/11/Abbreviated-journal-names-in-bibtex/">Abbreviated journal names in bibtex</a></li>
      <li><a href="/blog/2014/09/28/Editing-org-mode-python-source-blocks-in-an-external-editor-Canopy/">Editing org-mode python source blocks in an external editor (Canopy)</a></li>
      <li><a href="/blog/2014/09/27/Improved-debugging-of-Python-code-blocks-in-org-mode/">Improved debugging of Python code blocks in org-mode</a></li>
      <li><a href="/blog/2014/09/23/Generating-an-atomic-stoichiometric-matrix/">Generating an atomic stoichiometric matrix</a></li>
      <li><a href="/blog/2014/09/22/Showing-what-data-went-into-a-code-block-on-export/">Showing what data went into a code block on export</a></li>
    </ul>
  </section>

  <section>
 <h1 class="post_header_gradient theme_font"><a href="http://www.citeulike.org/user/jkitchin" class="external text" title="http://www.citeulike.org/user/jkitchin" rel="nofollow">CiteULike</a> Reading List</h1>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {

var d = new Date();
curr_year = d.getFullYear();

$.getJSON('http://www.citeulike.org/json/user/jkitchin/,,?callback=?&per_page=5',
function(data) {
  var items = [];
  year=curr_year
  $.each(data, function(i) {
    year=data[i].published[0];
    var cit='<li id="' + i + '">' + '<a class="pap" href="http://dx.doi.org/'+data[i].doi+'">'+ data[i].title + '</a><br>';
    cit+='</li>';
    items.push( cit )      
  });

  $('<ul/>', {
    'class': 'my-new-list',
    html: items.join('')
  }).appendTo('#papers2');
});
});
</script>

<div id="papers2"></div>

  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
<ul id="my-github-projects">
    <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2014
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



