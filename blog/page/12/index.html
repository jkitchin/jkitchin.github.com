

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Redirecting-stderr-in-org-mode-shell-blocks"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/01/04/Redirecting-stderr-in-org-mode-shell-blocks/" rel="bookmark" title="Permanent Link to Redirecting stderr in org-mode shell blocks">Redirecting stderr in org-mode shell blocks</a></h2>
      <p><small><span class="blog_post_date">Posted January 04, 2015 at 08:59 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/01/04/Redirecting-stderr-in-org-mode-shell-blocks#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated January 11, 2015 at 11:39 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Org-mode shell source blocks do not capture stderr. For example, in this block, with the default setup:
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #006FE0;">echo</span> <span style="color: #008000;">"testing stdout"</span> &gt;&amp;1
<span style="color: #006FE0;">echo</span> <span style="color: #008000;">"testing stderr"</span> &gt;&amp;2
</pre>
</div>

<pre class="example">
testing stdout
</pre>

<p>
You can see the second line is not in the output.
</p>

<p>
If you run this command, you get an <b>Org-Babel Error Output</b> buffer saying it is an illegal option.
</p>

<div class="org-src-container">

<pre class="src src-sh">date -g
</pre>
</div>

<p>
It would be nice to just capture that error, and show it.
</p>

<p>
We solved this problem in <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/12/21/Capturing-stderr-from-Python-in-org-mode-take-2/">Python</a> by redirecting stderr at runtime. It is not that simple in shell blocks, but we can do a similar thing. The code block is executed (I think) by saving the block to a temporary file, and then running org-babel-sh-command on the file. That magic happens inside the command shell-command-on-region. We just need to make that command redirect stderr. Here is a new shell command that does this. This next block can be tangled out to an executable command. This script takes one argument, which I believe is a filename (the temporary file containing the source block region).
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/bin/</span><span style="color: #0000FF;">bash</span>
{
bash $<span style="color: #BA36A5;">1</span>
} 2&gt;&amp;1
</pre>
</div>

<p>
Now, we set org-babel-sh-command to our new shell command.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-babel-sh-command <span style="color: #008000;">"./sh_stderr.sh"</span>)
</pre>
</div>

<pre class="example">
./sh_stderr.sh
</pre>

<p>
Now, it appears we get what we want:
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #006FE0;">echo</span> <span style="color: #008000;">"testing stdout"</span> &gt;&amp;1
<span style="color: #006FE0;">echo</span> <span style="color: #008000;">"testing stderr"</span> &gt;&amp;2
</pre>
</div>
<pre class="example">
testing stdout
testing stderr
</pre>

<p>
And, with the bad option to date, we get:
</p>

<div class="org-src-container">

<pre class="src src-sh">date -g
<span style="color: #006FE0;">echo</span>
</pre>
</div>
<pre class="example">
date: illegal option -- g
usage: date [-jnu] [-d dst] [-r seconds] [-t west] [-v[+|-]val[ymwdHMS]] ...
            [-f fmt date | [[[mm]dd]HH]MM[[cc]yy][.ss]] [+format]
</pre>

<p>
Not bad! I have not tested this very thoroughly, i.e. beyond these little examples, but it seems like it could work.
</p>

<p>
Achim Gratz suggested this simpler approach that does not involve any external scripts. The : at the end is important!
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #0000FF;">exec</span> 2&gt;&amp;1
<span style="color: #006FE0;">echo</span> <span style="color: #008000;">"testing stdout"</span> &gt;&amp;1
<span style="color: #006FE0;">echo</span> <span style="color: #008000;">"testing stderr"</span> &gt;&amp;2
date -g
:
</pre>
</div>
<pre class="example">
testing stdout
testing stderr
date: illegal option -- g
usage: date [-jnu] [-d dst] [-r seconds] [-t west] [-v[+|-]val[ymwdHMS]] ...
            [-f fmt date | [[[mm]dd]HH]MM[[cc]yy][.ss]] [+format]
</pre>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/01/04/Redirecting-stderr-in-org-mode-shell-blocks.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/01/04/Redirecting-stderr-in-org-mode-shell-blocks#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="New-publication-in-ACS-Catalysis-on-alloy-reactivity-across-composition-space"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/24/New-publication-in-ACS-Catalysis-on-alloy-reactivity-across-composition-space/" rel="bookmark" title="Permanent Link to New publication in ACS Catalysis on alloy reactivity across composition space">New publication in ACS Catalysis on alloy reactivity across composition space</a></h2>
      <p><small><span class="blog_post_date">Posted December 24, 2014 at 01:15 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/news/'>news</a>, <a href='/blog/category/publication/'>publication</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/24/New-publication-in-ACS-Catalysis-on-alloy-reactivity-across-composition-space#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated December 24, 2014 at 01:18 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
In this new paper we present a method to estimate the reactivity of an alloy surface with a distribution of active sites across composition space. We use hydrogen-deuterium exchange as the probe reaction, and compare our results to experiments from the Gellman group. Congratulations Jake!
</p>


<div class="org-src-container">

<pre class="src src-bibtex"><span style="color: #8b2323;">@article</span>{<span style="color: #cd0000;">boes-2014-estim-bulk</span>,
  <span style="color: #8b008b;">author</span> =       {Jacob R. Boes and Gamze Gumuslu and James B. Miller
                  and Andrew J. Gellman and John R. Kitchin},
  <span style="color: #8b008b;">title</span> =        {Estimating Bulk Composition Dependent H<span style="color: #228b22;">$_2$</span>
                  Adsorption Energies on Cu<span style="color: #228b22;">$_x$</span>Pd<span style="color: #228b22;">$_{1-x}$</span> Alloy (111)
                  Surfaces},
  <span style="color: #8b008b;">journal</span> =      {ACS Catalysis},
  <span style="color: #8b008b;">volume</span> =       0,
  <span style="color: #8b008b;">number</span> =       {ja},
  <span style="color: #8b008b;">pages</span> =        {null},
  <span style="color: #8b008b;">year</span> =         2014,
  <span style="color: #8b008b;">doi</span> =          {<span style="color: #3a5fcd; text-decoration: underline;">10.1021/cs501585k</span>},
  <span style="color: #8b008b;">url</span> =          {<span style="color: #3a5fcd; text-decoration: underline;"> http://dx.doi.org/10.1021/cs501585k </span>},
  <span style="color: #8b008b;">eprint</span> =       { http://dx.doi.org/10.1021/cs501585k },
}
</pre>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/24/New-publication-in-ACS-Catalysis-on-alloy-reactivity-across-composition-space.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/12/24/New-publication-in-ACS-Catalysis-on-alloy-reactivity-across-composition-space#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="A-prototype-implementation-of-jasp-in-emacs-lisp"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/24/A-prototype-implementation-of-jasp-in-emacs-lisp/" rel="bookmark" title="Permanent Link to A prototype implementation of jasp in emacs-lisp">A prototype implementation of jasp in emacs-lisp</a></h2>
      <p><small><span class="blog_post_date">Posted December 24, 2014 at 11:41 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/lisp/'>lisp</a>, <a href='/blog/category/vasp/'>vasp</a>, <a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/ase/'>ase</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/24/A-prototype-implementation-of-jasp-in-emacs-lisp#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. The Atom class</a></li>
<li><a href="#sec-2">2. The Atoms class</a></li>
<li><a href="#sec-3">3. The Calculator class</a></li>
<li><a href="#sec-4">4. Putting it all together to run calculations</a></li>
<li><a href="#sec-5">5. Summary thoughts</a></li>
</ul>
</div>
</div>

<p>
I want to try implementing an interface to <a href="http://www.vasp.at">VASP</a> in emacs-lisp. VASP is a program that uses density functional theory to calculate properties of materials. VASP was designed for the user to create several text-based input files that contain an atomic geometry, and calculation parameters. Then you run the VASP program, which reads those input files and generates output files. Finally, you parse out the results you want from the output files. 
</p>

<p>
It is moderately tedious to do that, so we already have a very extensive Python interface (<a href="http://github.com/jkitchin/jasp">http://github.com/jkitchin/jasp</a> ) that automates the input file creation and output file parsing, and with org-mode we have a pretty good literate research environment to document what we do. But, the Python/emacs environment is not as integrated as the emacs-lisp/emacs environment is, particularly when it comes to accessing documentation. So, I want to try out a lisp approach to see what this would look like, and if it has any benefits.
</p>

<p>
The bare bones implementation will have an Atom object, to store the type of atom and its coordinates, an Atoms object which will be a collection of atoms, and a unit cell, and a Calculator object that will store calculation parameters.
</p>

<p>
Then, we will try using it to see what advantages it might have. This will be a moderately long post.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> The Atom class</h2>
<div class="outline-text-2" id="text-1">
<p>
This is my first serious effort to use the <a href="https://www.gnu.org/software/emacs/manual/html_node/eieio/">object system</a> in emacs-lisp, so I do not claim it is optimal, or beautiful. It is functional though. We make a simple Atom class that holds the chemical symbol, and xyz coordinates. We do not consider having a magnetic moment at this point, and this class has no methods.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defclass</span> <span style="color: #4682b4;">Atom</span> ()
  ((symbol <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:symbol</span>
           <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"A string for the chemical symbol"</span>)
   (x <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:x</span>
      <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"The x coordinate"</span>)
   (y <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:y</span>
      <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"The y coordinate"</span>)
   (z <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:z</span>
      <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"The z coordinate"</span>))
 <span style="color: #228b22;">"A class to represent an atom."</span>)

(<span style="color: #8b0000;">provide</span> '<span style="color: #cd0000;">Atom</span>)
</pre>
</div>

<pre class="example">
Atom
</pre>

<p>
Let us try it out. We make an Atom, then get the symbol using the oref function. I don't think we need a "Name" for the atom, so the second argument is nil.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
</pre>
</div>

<pre class="example">
[object Atom nil "C" 0 0 0]
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((a1 (Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0  <span style="color: #cd0000;">:z</span> 0)))
  (oref a1 symbol))
</pre>
</div>

<pre class="example">
C
</pre>

<p>
It is not difficult to modify an Atom object. We use oset.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((a1 (Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0  <span style="color: #cd0000;">:z</span> 0)))
  (oset a1 x 2.5)
  a1)
</pre>
</div>

<pre class="example">
[object Atom nil "C" 2.5 0 0]
</pre>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> The Atoms class</h2>
<div class="outline-text-2" id="text-2">
<p>
We need at Atoms object, which will store a list of Atom objects, and a unit cell. I do not know how to make this class act like a list the way that the Atoms object in ase acts. We will have to access the list of atoms as a slot. We define one method here to get the ith atom from the object.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defclass</span> <span style="color: #4682b4;">Atoms</span> ()
  ((atoms <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:atoms</span>
          <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"A list of `</span><span style="color: #cd0000;">Atom</span><span style="color: #228b22;">' objects"</span>)
   (cell <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:cell</span>
         <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"A 3-tuple of lengths of an orthorhombic unit cell"</span>))
  <span style="color: #228b22;">"A class to represent an atoms object."</span>)


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">get-atom</span> ((atoms Atoms) <span style="color: #4682b4;">&amp;rest</span> args)
  <span style="color: #228b22;">"Get a list of atoms in ARGS.</span>
<span style="color: #228b22;">Return atom if ARGS contains one element, a list of atom objects</span>
<span style="color: #228b22;">otherwise."</span>
  (<span style="color: #8b0000;">cond</span>
   ((= 1 (length args))
    (elt (oref atoms atoms) (car args)))
   (t
    (mapcar (<span style="color: #8b0000;">lambda</span> (i)
              (elt (oref atoms atoms) i))
            args))))

(<span style="color: #8b0000;">provide</span> '<span style="color: #cd0000;">Atoms</span>)
</pre>
</div>

<pre class="example">
get-atom
</pre>

<p>
That seems to do what we need. It has some limitations:
</p>
<ol class="org-ol">
<li>We only allowed for orthorhombic unit cells
</li>
<li>We did not enable any constraints or magnetic moments on the atoms.
</li>
</ol>

<p>
Here is an example Atoms object. Note we use `, notation to ensure each Atom is created, since Atom is a constructor function that returns the object.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(Atoms nil
       <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
       <span style="color: #cd0000;">:cell</span> '(8 9 10))
</pre>
</div>

<pre class="example">
[object Atoms nil ([object Atom nil "C" 0 0 0] [object Atom nil "O" 1.1 0 0]) (8 9 10)]
</pre>

<p>
We can drill into the object, e.g. to get the second atom:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((A1 (Atoms nil
                 <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                          ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
                 <span style="color: #cd0000;">:cell</span> '(8 9 10))))
  (get-atom A1 1))
</pre>
</div>

<pre class="example">
[object Atom nil "O" 1.1 0 0]
</pre>

<p>
We can modify the atoms in place like this. Suppose we want to change the symbol of the first atom to "O". We use setf for this too.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((A1 (Atoms nil
                 <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                          ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
                 <span style="color: #cd0000;">:cell</span> '(8 9 10))))
  (oset (get-atom A1 0) symbol <span style="color: #228b22;">"O"</span>)
  A1)
</pre>
</div>

<pre class="example">
[object Atoms nil ([object Atom nil "O" 0 0 0] [object Atom nil "O" 1.1 0 0]) (8 9 10)]
</pre>

<p>
The only think I do not like about this syntax is the need to get the list of atoms from the object. That is a little clunkier than the Python analog where the object is a list itself. That may be just my inexperience with emacs-lisp. Probably you can define some getter function to smooth this over.
</p>

<p>
This Atoms class lacks much of the functionality of the <a href="https://wiki.fysik.dtu.dk/ase/ase/atoms.html">ase.Atoms</a> class, but it is sufficient for this prototype.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> The Calculator class</h2>
<div class="outline-text-2" id="text-3">
<p>
Next, we need our Calculator. This will store the parameters, and be responsible for creating the INCAR, POSCAR, KPOINTS, and POTCAR files, running a calculation, and getting data from the output. We also create a with-current-directory macro that will temporarily change the working directory since VASP uses the same filenames over and over, but in different directories. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defmacro</span> <span style="color: #8b2323;">with-current-directory</span> (directory <span style="color: #4682b4;">&amp;rest</span> body)
  <span style="color: #228b22;">"Set the working directory temporarily set to DIRECTORY and run BODY.</span>
<span style="color: #228b22;">DIRECTORY is expanded, and create it and its parents if needed."</span>
  `(<span style="color: #8b0000;">progn</span>
     (<span style="color: #8b0000;">unless</span> (file-exists-p (file-name-as-directory
                             (expand-file-name ,directory)))
       (make-directory ,directory t))
     
     (<span style="color: #8b0000;">let</span> ((default-directory (file-name-as-directory
                                (expand-file-name ,directory)))) 
        ,@body)))


(<span style="color: #8b0000;">defclass</span> <span style="color: #4682b4;">Jasp</span> ()
  ((wd <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:wd</span>
       <span style="color: #cd0000;">:initform</span> <span style="color: #228b22;">"."</span>  ; <span style="color: #ff0000; font-weight: bold;">default to the current working directory</span>
       <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"Directory to run calculation in."</span>)
   (encut <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:encut</span>
          <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"Positive number in eV for planewave cutoff.</span>
<span style="color: #228b22;">See URL `</span><span style="color: #cd0000;">http://cms.mpi.univie.ac.at/vasp/vasp/ENCUT_tag.html</span><span style="color: #228b22;">'."</span>)
   (nbands <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:nbands</span>
           <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"Integer number of bands.</span>
<span style="color: #228b22;">See URL `</span><span style="color: #cd0000;">http://cms.mpi.univie.ac.at/vasp/vasp/NBANDS_tag.html</span><span style="color: #228b22;">'."</span>)
   (kpts <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:kpts</span>
         <span style="color: #cd0000;">:initform</span> (1 1 1)  ; <span style="color: #ff0000; font-weight: bold;">default value</span>
         <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"3-tuple for Monkhorst-Pack K-point grid."</span>)
   (xc <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:xc</span>
       <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"String of exchange correlation functional."</span>)
   (atoms <span style="color: #cd0000;">:initarg</span> <span style="color: #cd0000;">:atoms</span>
          <span style="color: #cd0000;">:documentation</span> <span style="color: #228b22;">"An `</span><span style="color: #cd0000;">Atoms</span><span style="color: #228b22;">' object."</span>))
 <span style="color: #228b22;">"A class to represent a calculator that runs VASP."</span>)


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">view-atoms</span> ((calc Jasp))
  <span style="color: #228b22;">"Open the ase-gui"</span>
  (<span style="color: #8b0000;">unless</span> (and (file-exists-p <span style="color: #228b22;">"POSCAR"</span>)
               (file-exists-p <span style="color: #228b22;">"POTCAR"</span>))
    (write-poscar calc)
    (write-potcar calc))
  (shell-command <span style="color: #228b22;">"ase-gui POSCAR"</span>))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-poscar</span> ((calc Jasp))
  <span style="color: #228b22;">"create a POSCAR file for CALC."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"POSCAR"</span>
    (insert <span style="color: #228b22;">"Created by jasp.el\n"</span>)
    (insert <span style="color: #228b22;">"  1.0"</span>) ; <span style="color: #ff0000; font-weight: bold;">unit cell scale factor</span>
    (<span style="color: #8b0000;">let*</span> ((atoms (oref calc atoms))
           (cell (oref atoms cell)))
      (loop for v in cell
            for i below (length cell)     
            do
            (insert <span style="color: #228b22;">"\n"</span>)
            (loop for j below (length cell)
                  do
                  (<span style="color: #8b0000;">if</span> (equal i j)
                      (insert (format <span style="color: #228b22;">" %f "</span> (float (elt cell i))))
                    (insert (format <span style="color: #228b22;">" %f "</span> 0.0 ))))))
    ;; <span style="color: #ff0000; font-weight: bold;">The next line is counts for each atom type. For each number in</span>
    ;; <span style="color: #ff0000; font-weight: bold;">this line, there will be a copy of the POTCAR in the POTCAR</span>
    ;; <span style="color: #ff0000; font-weight: bold;">file. In ase, we sort the atoms and group them so that there is</span>
    ;; <span style="color: #ff0000; font-weight: bold;">only one POTCAR per atom. We do not do that here yet. We will</span>
    ;; <span style="color: #ff0000; font-weight: bold;">have a POTCAR for each atom.</span>
    (insert <span style="color: #228b22;">"\n"</span>)
    (loop for atom in (oref (oref calc atoms) atoms)
          do (insert (format <span style="color: #228b22;">"1 "</span>)))
    
    ;; <span style="color: #ff0000; font-weight: bold;">now we do the atoms</span>
    (insert <span style="color: #228b22;">"\nCartesian\n"</span>)
    (loop for atom in (oref (oref calc atoms) atoms)
          do
          (insert
           (format <span style="color: #228b22;">"%f %f %f\n"</span>
                   (oref atom x)
                   (oref atom y)
                   (oref atom z))))
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-kpoints</span> ((calc Jasp))
  <span style="color: #228b22;">"Create KPOINTS file for CALC. </span>
<span style="color: #228b22;">Limited to automatic generation, and no offset."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"KPOINTS"</span>
    (insert <span style="color: #228b22;">"Automatic mesh</span>
<span style="color: #228b22;">0</span>
<span style="color: #228b22;">Monkhorst-Pack</span>
<span style="color: #228b22;">"</span>)
    (<span style="color: #8b0000;">dolist</span> (k (oref calc kpts))
      (insert (format <span style="color: #228b22;">"%4d "</span> k)))
    (insert <span style="color: #228b22;">"\n0.0 0.0 0.0"</span>)
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-potcar</span> ((calc Jasp))
  <span style="color: #228b22;">"Generate the POTCAR file for CALC.</span>
<span style="color: #228b22;">No `</span><span style="color: #cd0000;">Atom</span><span style="color: #228b22;">' grouping is done, there is one POTCAR for each atom."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"POTCAR"</span>
    (<span style="color: #8b0000;">let</span> ((xc (oref calc xc))
          (atoms (oref calc atoms))
          (vasp_pp_path (getenv <span style="color: #228b22;">"VASP_PP_PATH"</span>)))
      (loop for atom in (oref atoms atoms)
            do
            (insert-file-contents
             (f-join
              vasp_pp_path
              (concat <span style="color: #228b22;">"potpaw_"</span> xc)
              (oref atom symbol)
              <span style="color: #228b22;">"POTCAR"</span>))))
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">write-incar</span> ((calc Jasp))
  <span style="color: #228b22;">"Generate the INCAR file for CALC."</span>
  (<span style="color: #8b0000;">with-temp-file</span> <span style="color: #228b22;">"INCAR"</span>
    (insert (format <span style="color: #228b22;">"ENCUT = %f\n"</span> (oref calc encut)))
    (insert (format <span style="color: #228b22;">"NBANDS = %d\n"</span> (oref calc nbands)))
    (buffer-string)))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">run</span> ((calc Jasp))
  <span style="color: #228b22;">"Write out input files, and run VASP as a simple shell command"</span>
  (write-poscar calc)
  (write-kpoints calc)
  (write-potcar calc)
  (write-incar calc)
  (shell-command <span style="color: #228b22;">"vasp"</span>))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">update</span> ((calc Jasp))
  <span style="color: #228b22;">"Run vasp if needed for CALC.</span>
<span style="color: #228b22;">We just check for a properly ended OUTCAR."</span>
  (with-current-directory
   (oref calc wd)
   (<span style="color: #8b0000;">unless</span> (and (file-exists-p <span style="color: #228b22;">"OUTCAR"</span>)
                (<span style="color: #8b0000;">with-temp-buffer</span>
                  (insert-file-contents <span style="color: #228b22;">"OUTCAR"</span>)
                  (re-search-forward
                  <span style="color: #228b22;">"                 Voluntary context switches:"</span>
                  (point-max)
                  t)))
     (run calc))))


(<span style="color: #8b0000;">defmethod</span> <span style="color: #8b2323;">get-potential-energy</span> ((calc Jasp))
  <span style="color: #228b22;">"Get potential energy from CALC."</span>
  (update calc)
  (with-current-directory
   (oref calc wd)
   (<span style="color: #8b0000;">with-temp-buffer</span>
     (insert-file-contents <span style="color: #228b22;">"OUTCAR"</span>)
     ;; <span style="color: #ff0000; font-weight: bold;">go to last entry</span>
     (<span style="color: #8b0000;">while</span> (re-search-forward
             <span style="color: #228b22;">"free  energy   TOTEN  =\\s-*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[-]?[0-9]*\\.[0-9]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;"> eV"</span>
             (point-max)
             t)
       nil)
     ;; <span style="color: #ff0000; font-weight: bold;">return last match</span>
     (string-to-number  (match-string 1)))))

(<span style="color: #8b0000;">provide</span> '<span style="color: #cd0000;">jasp</span>)
</pre>
</div>

<pre class="example">
get-potential-energy
</pre>


<p>
This is worth some discussion. On one hand, the constructor is a bit more verbose than the implementation in Python. In Python we use a context handler in place of the macro here. On the other hand, that verbosity comes with detailed, accessible documentation for each argument. We only considered the simplest of input arguments. It might be trickier to include lists, and other types of input. But I think those can all be worked out like they were in ase. We only implemented the simplest job control logic, but that also can be worked out. The biggest challenge might be getting more complex data from the output. Nearly everything can be obtained from vasprun.xml also, in the event that parsing is to slow or difficult.
</p>

<p>
Now, let us test this out. We can make a calculator:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq calc (Jasp
            nil
            <span style="color: #cd0000;">:xc</span> <span style="color: #228b22;">"PBE"</span>
            <span style="color: #cd0000;">:encut</span> 350
            <span style="color: #cd0000;">:nbands</span> 6
            <span style="color: #cd0000;">:atoms</span> (Atoms
                    nil
                    <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                             ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
                    <span style="color: #cd0000;">:cell</span> '(8 9 10))))
</pre>
</div>

<pre class="example">
[object Jasp nil "." 350 6 (1 1 1) "PBE" [object Atoms nil ([object Atom nil "C" 0 0 0] [object Atom nil "O" 1.1 0 0]) (8 9 10)]]
</pre>

<p>
We can call the class functions like this. Here we write out the corresponding POSCAR:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-poscar calc)
</pre>
</div>

<pre class="example">
Created by jasp.el
  1.0
 8.000000  0.000000  0.000000 
 0.000000  9.000000  0.000000 
 0.000000  0.000000  10.000000 
1 1 
Cartesian
0.000000 0.000000 0.000000
1.100000 0.000000 0.000000
</pre>

<p>
It looks a little backward if you have only seen Python, where this would be calc.write<sub>poscar</sub>(). It is almost the same characters, just a different order (and no . in lisp)!
</p>

<p>
Here we get the KPOINTS file:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-kpoints calc)
</pre>
</div>

<pre class="example">
Automatic mesh
0
Monkhorst-Pack
   1    1    1 
0.0 0.0 0.0
</pre>


<p>
I cannot show the POTCAR file for licensing reasons, but it works.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-potcar calc)
</pre>
</div>

<p>
and the INCAR file:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(write-incar calc)
</pre>
</div>

<pre class="example">
ENCUT = 350.000000
NBANDS = 6
</pre>

<p>
We run a calculation like this. This will run vasp directly (not through the queue system). 
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(run calc)
</pre>
</div>

<pre class="example">
0
</pre>

<p>
The returned 0 means the shell command finished correctly.
</p>

<p>
And we retrieve the potential energy like this:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(get-potential-energy calc)
</pre>
</div>

<pre class="example">
-14.687906
</pre>

<p>
Not bad. That is close to the result we got from a similar calculation <a href="http://kitchingroup.cheme.cmu.edu/dft-book/dft.html#sec-3-3-1">here</a> . 
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Putting it all together to run calculations</h2>
<div class="outline-text-2" id="text-4">
<p>
If we put this all together the way we might use it in practice, it looks like this. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(load-file <span style="color: #228b22;">"Atom.el"</span>)
(load-file <span style="color: #228b22;">"Atoms.el"</span>)
(load-file <span style="color: #228b22;">"Jasp.el"</span>)

(<span style="color: #8b0000;">let*</span> ((co (Atoms
            nil
            <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                     ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
            <span style="color: #cd0000;">:cell</span> '(8 9 10)))

       (calc (Jasp
              nil
              <span style="color: #cd0000;">:xc</span> <span style="color: #228b22;">"PBE"</span>
              <span style="color: #cd0000;">:nbands</span> 6
              <span style="color: #cd0000;">:encut</span> 350
              <span style="color: #cd0000;">:atoms</span> co)))
  
  (get-potential-energy calc))
</pre>
</div>

<pre class="example">
-14.687906
</pre>

<p>
Compare this with this Python code which does approximately the same thing:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase <span style="color: #8b0000;">import</span> Atoms, Atom
<span style="color: #8b0000;">from</span> jasp <span style="color: #8b0000;">import</span> *

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">co</span> = Atoms([Atom(<span style="color: #228b22;">'C'</span>, [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>]),
            Atom(<span style="color: #228b22;">'O'</span>, [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>])],
            <span style="color: #000000; background-color: #cccccc; font-weight: bold;">cell</span>=(<span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>., <span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>., <span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>.))

<span style="color: #8b0000;">with</span> jasp(<span style="color: #228b22;">'molecules/simple-co'</span>, <span style="color: #ff0000; font-weight: bold;">#output dir</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">xc</span>=<span style="color: #228b22;">'PBE'</span>,  <span style="color: #ff0000; font-weight: bold;"># the exchange-correlation functional</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">nbands</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>,  <span style="color: #ff0000; font-weight: bold;"># number of bands</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">encut</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">350</span>, <span style="color: #ff0000; font-weight: bold;"># planewave cutoff</span>
          <span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span>=co) <span style="color: #8b0000;">as</span> calc:
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'energy = {0} eV'</span>.format(co.get_potential_energy())
</pre>
</div>

<p>
They look pretty similar. One thing clearly missing from emacs-lisp that Python has is full support for numerics and plotting. Some of this could be addressed via <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/10/19/Using-Pymacs-to-integrate-Python-into-Emacs/">Pymacs</a> , but certainly not all of it. Some of it could also be handled using org-mode to enable data from emacs-lisp to go to other code blocks that can handle it. 
</p>

<p>
Finally, for a little fun, we illustrate mapping over a range of bond lengths. There is more than one way to do this. For example, we could create a list of calculators, and then run over them. Here we create one calculator, and just change the x position in a loop. We use the more general setf approach instead of oset to see what it looks like.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((co (Atoms
            nil
            <span style="color: #cd0000;">:atoms</span> `(,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"C"</span> <span style="color: #cd0000;">:x</span> 0 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0)
                     ,(Atom nil <span style="color: #cd0000;">:symbol</span> <span style="color: #228b22;">"O"</span> <span style="color: #cd0000;">:x</span> 1.1 <span style="color: #cd0000;">:y</span> 0 <span style="color: #cd0000;">:z</span> 0))
            <span style="color: #cd0000;">:cell</span> '(8 9 10)))
       (calc (Jasp
              nil
              <span style="color: #cd0000;">:wd</span> nil
              <span style="color: #cd0000;">:xc</span> <span style="color: #228b22;">"PBE"</span>
              <span style="color: #cd0000;">:nbands</span> 6
              <span style="color: #cd0000;">:encut</span> 350
              <span style="color: #cd0000;">:atoms</span> co)))
  (<span style="color: #8b0000;">dolist</span> (d '(1.05 1.1 1.15 1.2 1.25))
    ;; <span style="color: #ff0000; font-weight: bold;">change working directory</span>
    (setf (oref calc wd) (format <span style="color: #228b22;">"co-%s"</span> d))
    ;; <span style="color: #ff0000; font-weight: bold;">set x-coordinate on oxygen atom</span>
    (setf (oref (elt (oref co atoms) 1) x) d)
    (print (format <span style="color: #228b22;">"d = %s\nEnergy = %s eV"</span>
                   d
                   (get-potential-energy calc)))))
</pre>
</div>

<pre class="example">
"d = 1.05
Energy = -14.195892 eV"

"d = 1.1
Energy = -14.698456 eV"

"d = 1.15
Energy = -14.814809 eV"

"d = 1.2
Energy = -14.660395 eV"

"d = 1.25
Energy = -14.319904 eV"
</pre>

<p>
See <a href="http://kitchingroup.cheme.cmu.edu/dft-book/dft.html#sec-3-4-1">http://kitchingroup.cheme.cmu.edu/dft-book/dft.html#sec-3-4-1</a> for how this was done in Python. It looks pretty similar to me.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Summary thoughts</h2>
<div class="outline-text-2" id="text-5">
<p>
We implemented a bare bones emacs-lisp calculator for VASP. The library automates creation of input files, running the calculation, and parsing the output.
</p>

<p>
It seems pretty feasible to implement a pretty complete interface to VASP in emacs-lisp. The main reasons to do this are:
</p>
<ol class="org-ol">
<li>Integrated access to documentation
</li>
<li>Emacs editing of emacs-lisp code 
</li>
<li>Integration with org-mode
</li>
</ol>

<p>
Even with Python editor that had access to documentation as deeply integrated as emacs has with emacs-lisp, it would still just be a Python editor, i.e. you probably could not use the editor to write org-mode, LaTeX, etc&#x2026; It is time to recognize we need both scientific document creation <i>and</i> code editing capability in the same place! This kind of suggests a need to get a better Python environment going in Emacs, which deeper integration of the documentation. See <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/12/20/A-new-mode-for-Python-documentation/">this</a> post for some progress in that area!
</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/24/A-prototype-implementation-of-jasp-in-emacs-lisp.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/12/24/A-prototype-implementation-of-jasp-in-emacs-lisp#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="New-export-function-for-Matlab-posts-in-blogofile"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/24/New-export-function-for-Matlab-posts-in-blogofile/" rel="bookmark" title="Permanent Link to New export function for Matlab posts in blogofile">New export function for Matlab posts in blogofile</a></h2>
      <p><small><span class="blog_post_date">Posted December 24, 2014 at 10:41 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/matlab/'>matlab</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/24/New-export-function-for-Matlab-posts-in-blogofile#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>New export function for Matlab posts in blogofile</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-12-24"><meta name="DC.source" content="blogofile.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>New export function for Matlab posts in blogofile</h1><!--introduction--><p>categories: matlab</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Summary</a></li><li><a href="#3">Conclusions</a></li></ul></div><h2>Summary<a name="1"></a></h2><p>This is just a test blog post to see if I can publish an m-file to my blogofile blog. You should be able to do interesting things in Matlab like</p><pre class="language-matlab">grabcode(<span class="string">'this url'</span>)
</pre><p>to get the code in this post.</p><p><img src="/media/2014-12-24-New-export-function-for-Matlab-posts-in-blogofile/blogofile_eq17467035999183504765.png" alt="$$e^{\pi i} + 1 = 0$$"></p><pre class="codeinput">exp(pi*i) + 1
</pre><pre class="codeoutput">
ans =

   0.0000e+00 + 1.2246e-16i

</pre><h2>Conclusions<a name="3"></a></h2><p>It works! Have a happy holiday!</p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
 ##### SOURCE BEGIN #####
%% New export function for Matlab posts in blogofile
%
% categories: matlab
% 

%% Summary
% This is just a test blog post to see if I can publish an m-file to my
% blogofile blog. You should be able to do interesting things in Matlab
% like 
% 
%   grabcode('this url')
% 
% to get the code in this post.

%%
% 
% $$e^{\pi i} + 1 = 0$$
% 
exp(pi*i) + 1

%% Conclusions
% It works! Have a happy holiday!

##### SOURCE END ##### 
--></body></html>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/12/24/New-export-function-for-Matlab-posts-in-blogofile#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Building-atomic-clusters-in-ase"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/22/Building-atomic-clusters-in-ase/" rel="bookmark" title="Permanent Link to Building atomic clusters in ase">Building atomic clusters in ase</a></h2>
      <p><small><span class="blog_post_date">Posted December 22, 2014 at 08:55 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a>, <a href='/blog/category/ase/'>ase</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/22/Building-atomic-clusters-in-ase#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
I was perusing the <a href="https://wiki.fysik.dtu.dk/ase/epydoc/">ase</a> codebase, and came across the <a href="https://wiki.fysik.dtu.dk/ase/epydoc/ase.cluster-module.html">cluster module</a> . This does not seem to be documented in the main docs, so here are some examples of using it. The module provides some functions to make atomic clusters for simulations.
</p>

<p>
Below I show some typical usage. First, we look at an icosahedron with three shells.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.icosahedron <span style="color: #8b0000;">import</span> Icosahedron
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = Icosahedron(<span style="color: #228b22;">'Au'</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">noshells</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>)
<span style="color: #8b0000;">print</span> atoms

write(<span style="color: #228b22;">'images/Au-icosahedron-3.png'</span>, atoms)
</pre>
</div>

<pre class="example">
Atoms(symbols='Au55', positions=..., tags=..., cell=[9.816495585723144, 9.816495585723144, 9.816495585723144], pbc=[False, False, False])
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/Au-icosahedron-3.png"> 
</p>
</div>

<p>
Even with only three shells, there are already 55 atoms in this cluster!
</p>


<p>
How about a decahedron? There are more parameters to set here. I am not sure what the depth of the Marks re-entrance is.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.decahedron <span style="color: #8b0000;">import</span> Decahedron
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = Decahedron(<span style="color: #228b22;">'Pt'</span>,
                   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">p</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>,  <span style="color: #ff0000; font-weight: bold;"># natoms on 100 face normal to 5-fold axis</span>
                   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">q</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,  <span style="color: #ff0000; font-weight: bold;"># natoms 0n 100 parallel to 5-fold axis</span>
                   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">r</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>)  <span style="color: #ff0000; font-weight: bold;"># depth of the Marks re-entrance?</span>

<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'#atoms = {}'</span>.format<span style="color: #cd0000;">(len</span>(atoms)))

write(<span style="color: #228b22;">'images/decahedron.png'</span>, atoms)
</pre>
</div>

<pre class="example">
#atoms = 156
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/decahedron.png"> 
</p>
</div>

<p>
You can see the 5-fold symmetry here. We can make octahedra too. Here, the length is the number of atoms on the edge.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.octahedron <span style="color: #8b0000;">import</span> Octahedron
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = Octahedron(<span style="color: #228b22;">'Cu'</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">length</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>)
<span style="color: #8b0000;">print</span> atoms
write(<span style="color: #228b22;">'images/octahedron.png'</span>, atoms)
</pre>
</div>

<pre class="example">
Cluster(symbols='Cu85', positions=..., cell=[14.44, 14.44, 14.44], pbc=[False, False, False])
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/octahedron.png"> 
</p>
</div>

<p>
Finally, we can make particles based on a Wulff construction! We provide a list of surfaces, and their surface energies, with an approximate size we want, the structure to make the particle in, and what to do if there is not an exact number of atoms matching our size. We choose to round below here, so that the particle is not bigger than our size. In this example I totally made up the surface energies, with (100) as the lowest, so the particle comes out looking like a cube.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.wulff <span style="color: #8b0000;">import</span> wulff_construction
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = wulff_construction(<span style="color: #228b22;">'Pd'</span>,
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">surfaces</span>=[(<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>),
                                     (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>),
                                     (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>)],
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">energies</span>=[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">15</span>],
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">size</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">100</span>,
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">structure</span>=<span style="color: #228b22;">'fcc'</span>,
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">rounding</span>=<span style="color: #228b22;">'below'</span>)

<span style="color: #8b0000;">print</span> atoms
write(<span style="color: #228b22;">'images/wulff.png'</span>, atoms)
</pre>
</div>
<pre class="example">
Cluster(symbols='Pd63', positions=..., cell=[7.779999999999999, 7.779999999999999, 7.779999999999999], pbc=[False, False, False])
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/wulff.png"> 
</p>
</div>

<p>
This is one handy module, if you need to make clusters for some kind of simulation!</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/22/Building-atomic-clusters-in-ase.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/12/22/Building-atomic-clusters-in-ase#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../11"> Previous Page</a>
  --  
 <a href="../13">Next Page </a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
    <li><a href="http://enthought.com">Enthought Python</a></li>
    <li><a href="/pycse">Pycse</a></li>
    <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2015/07/03/Using-swish-e-to-index-org-files-as-html/">Using swish-e to index org files as html</a></li>
      <li><a href="/blog/2015/07/02/Pyparsing-meets-Emacs-to-find-chemical-formulas/">Pyparsing meets Emacs to find chemical formulas</a></li>
      <li><a href="/blog/2015/07/01/Spoken-translations-in-Emacs/">Spoken translations in Emacs</a></li>
      <li><a href="/blog/2015/06/30/Get-spoken-definitions-from-the-Meriam-dictionary/">Get spoken definitions from the Meriam dictionary</a></li>
      <li><a href="/blog/2015/06/29/Getting-Emacs-to-read-to-me/">Getting Emacs to read to me</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2015
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



