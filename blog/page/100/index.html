

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="The-equal-area-method-for-the-van-der-Waals-equation"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation/" rel="bookmark" title="Permanent Link to The equal area method for the van der Waals equation">The equal area method for the van der Waals equation</a></h2>
      <p><small><span class="blog_post_date">Posted February 15, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/plotting/'>plotting</a></span> | tags: <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated September 25, 2013 at 09:13 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Compute areas</a></li>
</ul>
</div>
</div>
<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/11/the-equal-area-method-for-the-van-der-waals-equation/">Matlab post</a> 
</p>

<p>
When a gas is below its Tc the van der Waal equation oscillates. In the portion of the isotherm where \(\partial P_R/\partial V_r > 0\), the isotherm fails to describe real materials, which phase separate into a liquid and gas in this region.
</p>

<p>
Maxwell proposed to replace this region by a flat line, where the area above and below the curves are equal. Today, we examine how to identify where that line should be.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b008b;">Tr</span> = 0.9 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">A Tr below Tc:  Tr = T/Tc</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">analytical equation for Pr. This is the reduced form of the van der Waal</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">equation.</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">Prfh</span>(Vr):
    <span style="color: #8b0000;">return</span>  8.0 / 3.0 * Tr / (Vr - 1.0 / 3.0) - 3.0 / (Vr**2)

<span style="color: #8b008b;">Vr</span> = np.linspace(0.5, 4, 100)  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">vector of reduced volume</span>
<span style="color: #8b008b;">Pr</span> = Prfh(Vr)                 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">vector of reduced pressure</span>

plt.plot(Vr,Pr)
plt.ylim([0, 2])
plt.xlabel(<span style="color: #228b22;">'$V_R$'</span>)
plt.ylabel(<span style="color: #228b22;">'$P_R$'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-1.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x042FDAF0&gt;]
(0, 2)
&lt;matplotlib.text.Text object at 0x04237CB0&gt;
&lt;matplotlib.text.Text object at 0x042DC030&gt;
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-1.png"><p>
</p>
</div>

<p>
The idea is to pick a Pr and draw a line through the EOS. We want the areas between the line and EOS to be equal on each side of the middle intersection. Let us draw a line on the figure at y = 0.65.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">y</span> = 0.65

plt.plot([0.5, 4.0], [y, y], <span style="color: #228b22;">'k--'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-2.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x042FDCD0&gt;]
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-2.png"><p>
</p>
</div>

<p>
To find the areas, we need to know where the intersection of the vdW eqn with the horizontal line. This is the same as asking what are the roots of the vdW equation at that Pr. We need all three intersections so we can integrate from the first root to the middle root, and then the middle root to the third root. We take advantage of the polynomial nature of the vdW equation, which allows us to use the roots command to get all the roots at once. The polynomial is \(V_R^3 - \frac{1}{3}(1+8 T_R/P_R) + 3/P_R - 1/P_R = 0\). We use the coefficients t0 get the roots like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">vdWp</span> = [1.0, -1. / 3.0 * (1.0 + 8.0 * Tr / y), 3.0 / y, - 1.0 / y]
<span style="color: #8b008b;">v</span> = np.roots(vdWp)
v.sort()
<span style="color: #8b0000;">print</span> v

plt.plot(v[0], y, <span style="color: #228b22;">'bo'</span>, v[1], y, <span style="color: #228b22;">'bo'</span>, v[2], y, <span style="color: #228b22;">'bo'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-3.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [ 0.60286812  1.09743234  2.32534056]
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x0439C570&gt;, &lt;matplotlib.lines.Line2D object at 0x043933B0&gt;, &lt;matplotlib.lines.Line2D object at 0x04393CB0&gt;]
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-3.png"><p>
</p>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Compute areas</h2>
<div class="outline-text-2" id="text-1">
<p>
for A1, we need the area under the line minus the area under the vdW curve. That is the area between the curves. For A2, we want the area under the vdW curve minus the area under the line. The area under the line between root 2 and root 1 is just the width (root2 - root1)*y
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b008b;">A1</span>, <span style="color: #8b008b;">e1</span> = (v[1] - v[0]) * y - quad(Prfh,  v[0], v[1])
<span style="color: #8b008b;">A2</span>, <span style="color: #8b008b;">e2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1])* y 

<span style="color: #8b0000;">print</span> A1, A2
<span style="color: #8b0000;">print</span> e1, e2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">interesting these look so large</span>
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.063225945606 0.0580212098122
0.321466743765 -0.798140339268
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">equal_area</span>(y):
    <span style="color: #8b008b;">Tr</span> = 0.9
    <span style="color: #8b008b;">vdWp</span> = [1, -1.0 / 3 * ( 1.0 + 8.0 * Tr / y), 3.0 / y,  -1.0 / y]
    <span style="color: #8b008b;">v</span> = np.roots(vdWp)
    v.sort()
    <span style="color: #8b008b;">A1</span> = (v[1] - v[0]) * y - quad(Prfh, v[0], v[1])
    <span style="color: #8b008b;">A2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1]) * y
    <span style="color: #8b0000;">return</span>  A1 - A2

y_eq, = fsolve(equal_area, 0.65)
<span style="color: #8b0000;">print</span> y_eq

<span style="color: #8b008b;">Tr</span> = 0.9
<span style="color: #8b008b;">vdWp</span> = [1, -1.0 / 3 * ( 1.0 + 8.0 * Tr / y_eq), 3.0 / y_eq,  -1.0 / y_eq]
<span style="color: #8b008b;">v</span> = np.roots(vdWp)
v.sort()

<span style="color: #8b008b;">A1</span>, <span style="color: #8b008b;">e1</span> = (v[1] - v[0]) * y_eq - quad(Prfh,  v[0], v[1])
<span style="color: #8b008b;">A2</span>, <span style="color: #8b008b;">e2</span> = quad(Prfh, v[1], v[2]) - (v[2] - v[1]) * y_eq

<span style="color: #8b0000;">print</span> A1, A2
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; ... ... ... ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; 0.646998351872
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 0.0617526473994 0.0617526473994
</pre>

<p>
Now let us plot the equal areas and indicate them by shading.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">fig</span> = plt.gcf()
<span style="color: #8b008b;">ax</span> = fig.add_subplot(111)

ax.plot(Vr,Pr)

<span style="color: #8b008b;">hline</span> = np.ones(Vr.size) * y_eq

ax.plot(Vr, hline)
ax.fill_between(Vr, hline, Pr, where=(Vr &gt;= v[0]) &amp; (Vr &lt;= v[1]), facecolor=<span style="color: #228b22;">'gray'</span>)
ax.fill_between(Vr, hline, Pr, where=(Vr &gt;= v[1]) &amp; (Vr &lt;= v[2]), facecolor=<span style="color: #228b22;">'gray'</span>)

plt.text(v[0], 1, <span style="color: #228b22;">'A1 = {0}'</span>.<span style="color: #cd0000;">format</span>(A1))
plt.text(v[2], 1, <span style="color: #228b22;">'A2 = {0}'</span>.<span style="color: #cd0000;">format</span>(A2))
plt.xlabel(<span style="color: #228b22;">'$V_R$'</span>)
plt.ylabel(<span style="color: #228b22;">'$P_R$'</span>)
plt.title(<span style="color: #228b22;">'$T_R$ = 0.9'</span>)

plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-4.png'</span>)
plt.savefig(<span style="color: #228b22;">'images/maxwell-eq-area-4.svg'</span>)
</pre>
</div>


<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043939D0&gt;]
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043A7230&gt;]
&lt;matplotlib.collections.PolyCollection object at 0x047ADE70&gt;
&lt;matplotlib.collections.PolyCollection object at 0x047ADAB0&gt;
&gt;&gt;&gt; &lt;matplotlib.text.Text object at 0x0438E730&gt;
&lt;matplotlib.text.Text object at 0x047B7930&gt;
&lt;matplotlib.text.Text object at 0x04237CB0&gt;
&lt;matplotlib.text.Text object at 0x042DC030&gt;
&lt;matplotlib.text.Text object at 0x042EBCD0&gt;
</pre>


<div class="figure">
<p><p><img src="/img/./images/maxwell-eq-area-4.png"><p></p>
</div>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Find-the-minimum-distance-from-a-point-to-a-curve"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/14/Find-the-minimum-distance-from-a-point-to-a-curve/" rel="bookmark" title="Permanent Link to Find the minimum distance from a point to a curve.">Find the minimum distance from a point to a curve.</a></h2>
      <p><small><span class="blog_post_date">Posted February 14, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/14/Find-the-minimum-distance-from-a-point-to-a-curve#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:44 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>

A problem that can be cast as a constrained minimization problem is to find the minimum distance from a point to a curve. Suppose we have \(f(x) = x^2\), and the point (0.5, 2). what is the minimum distance from that point to \(f(x)\)?
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fmin_cobyla

P = (0.5, 2)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f</span>(x):
    <span style="color: #8b0000;">return</span> x**2

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">objective</span>(X):
    x,y = X
    <span style="color: #8b0000;">return</span> np.sqrt((x - P[0])**2 + (y - P[1])**2)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">c1</span>(X):
    x,y = X
    <span style="color: #8b0000;">return</span> f(x) - y

X = fmin_cobyla(objective, x0=[0.5,0.5], cons=[c1])

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The minimum distance is {0:1.2f}'</span>.format(objective(X))

<span style="color: #ff0000; font-weight: bold;"># Verify the vector to this point is normal to the tangent of the curve</span>
<span style="color: #ff0000; font-weight: bold;"># position vector from curve to point</span>
v1 = np.array(P) - np.array(X)
<span style="color: #ff0000; font-weight: bold;"># position vector</span>
v2 = np.array([1, 2.0 * X[0]])
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'dot(v1, v2) = '</span>,np.dot(v1, v2)

x = np.linspace(-2, 2, 100)

plt.plot(x, f(x), <span style="color: #228b22;">'r-'</span>, label=<span style="color: #228b22;">'f(x)'</span>)
plt.plot(P[0], P[1], <span style="color: #228b22;">'bo'</span>, label=<span style="color: #228b22;">'point'</span>)
plt.plot([P[0], X[0]], [P[1], X[1]], <span style="color: #228b22;">'b-'</span>, label=<span style="color: #228b22;">'shortest distance'</span>)
plt.plot([X[0], X[0] + 1], [X[1], X[1] + 2.0 * X[0]], <span style="color: #228b22;">'g-'</span>, label=<span style="color: #228b22;">'tangent'</span>)
plt.axis(<span style="color: #228b22;">'equal'</span>)
plt.xlabel(<span style="color: #228b22;">'x'</span>)
plt.ylabel(<span style="color: #228b22;">'y'</span>)
plt.legend(loc=<span style="color: #228b22;">'best'</span>)
plt.savefig(<span style="color: #228b22;">'images/min-dist-p-func.png'</span>)
</pre>
</div>

<pre class="example">
The minimum distance is 0.86
dot(v1, v2) =  0.000336477214214

   Normal return from subroutine COBYLA

   NFVALS =   44   F = 8.579598E-01    MAXCV = 0.000000E+00
   X = 1.300793E+00   1.692061E+00
</pre>

<p><img src="/img/./images/min-dist-p-func.png"><p>

<p>
In the code above, we demonstrate that the point we find on the curve that minimizes the distance satisfies the property that a vector from that point to our other point is normal to the tangent of the curve at that point. This is shown by the fact that the dot product of the two vectors is very close to zero. It is not zero because of the accuracy criteria that is used to stop the minimization is not high enough.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/14/Find-the-minimum-distance-from-a-point-to-a-curve..org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/14/Find-the-minimum-distance-from-a-point-to-a-curve#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Plane-poiseuelle-flow-solved-by-finite-difference"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/14/Plane-poiseuelle-flow-solved-by-finite-difference/" rel="bookmark" title="Permanent Link to Plane poiseuelle flow solved by finite difference">Plane poiseuelle flow solved by finite difference</a></h2>
      <p><small><span class="blog_post_date">Posted February 14, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bvp/'>bvp</a></span> | tags: <a href='/blog/tag/fluids/'>fluids</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/14/Plane-poiseuelle-flow-solved-by-finite-difference#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 06:32 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/09/30/plane-poiseuelle-flow-solved-by-finite-difference/" >Matlab post</a>
</p>

<p>
Adapted from <a href="http://www.physics.arizona.edu/~restrepo/475B/Notes/sourcehtml/node24.html" >http://www.physics.arizona.edu/~restrepo/475B/Notes/sourcehtml/node24.html</a>
</p>

<p>
We want to solve a linear boundary value problem of the form: y'' = p(x)y' + q(x)y + r(x) with boundary conditions y(x1) = alpha and y(x2) = beta.
</p>

<p>
For this example, we solve the plane poiseuille flow problem using a finite difference approach. An advantage of the approach we use here is we do not have to rewrite the second order ODE as a set of coupled first order ODEs, nor do we have to provide guesses for the solution. We do, however, have to discretize the derivatives and formulate a linear algebra problem.
</p>

<p>
we want to solve u'' = 1/mu*DPDX with u(0)=0 and u(0.1)=0. for this problem we let the plate separation be d=0.1, the viscosity \(\mu = 1\), and \(\frac{\Delta P}{\Delta x} = -100\).
</p>

<p>
The idea behind the finite difference method is to approximate the derivatives by finite differences on a grid. See here for details. By discretizing the ODE, we arrive at a set of linear algebra equations of the form \(A y = b\), where \(A\) and \(b\) are defined as follows.
</p>

<p>
\[A = \left [ \begin{array}{ccccc} %
 2 + h^2 q_1         & -1 + \frac{h}{2} p_1 & 0                    & 0 & 0 \\
-1 - \frac{h}{2} p_2 & 2 + h^2 q_2          & -1 + \frac{h}{2} p_2 & 0 & 0 \\
0                    & \ddots               & \ddots               & \ddots & 0 \\
0                    & 0                    & -1 - \frac{h}{2} p_{N-1} & 2 + h^2 q_{N-1} & -1 + \frac{h}{2} p_{N-1} \\
0                    & 0                    & 0  & -1 - \frac{h}{2} p_N & 2 + h^2 q_N \end{array} \right ] \]
</p>

<p>
\[ y = \left [ \begin{array}{c} y_i \\ \vdots \\ y_N \end{array} \right ] \]
</p>

<p>
\[ b = \left [ \begin{array}{c} -h^2 r_1 + ( 1 + \frac{h}{2} p_1) \alpha \\
-h^2 r_2 \\
\vdots \\
-h^2 r_{N-1} \\
-h^2 r_N + (1 - \frac{h}{2} p_N) \beta \end{array} \right] \]
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">we use the notation for y'' = p(x)y' + q(x)y + r(x)</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">p</span>(x): <span style="color: #8b0000;">return</span> 0
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">q</span>(x): <span style="color: #8b0000;">return</span> 0
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">r</span>(x): <span style="color: #8b0000;">return</span> -100

<span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">we use the notation y(x1) = alpha and y(x2) = beta</span>

x1 = 0; alpha = 0.0
x2 = 0.1; beta = 0.0

npoints = 100

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">compute interval width</span>
h = (x2-x1)/npoints;

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">preallocate and shape the b vector and A-matrix</span>
b = np.zeros((npoints - 1, 1));
A = np.zeros((npoints - 1, npoints - 1));
X = np.zeros((npoints - 1, 1));

<span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">now we populate the A-matrix and b vector elements</span>
<span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(npoints - 1):
    X[i,0] = x1 + (i + 1) * h

    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">get the value of the BVP Odes at this x</span>
    pi = p(X[i])
    qi = q(X[i])
    ri = r(X[i])

    <span style="color: #8b0000;">if</span> i == 0:
        <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">first boundary condition</span>
        b[i] = -h**2 * ri + (1 + h / 2 * pi)*alpha; 
    <span style="color: #8b0000;">elif</span> i == npoints - 1:
        <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">second boundary condition</span>
        b[i] = -h**2 * ri + (1 - h / 2 * pi)*beta; 
    <span style="color: #8b0000;">else:</span>
        b[i] = -h**2 * ri <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">intermediate points</span>
    
    <span style="color: #8b0000;">for</span> j <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(npoints - 1):
        <span style="color: #8b0000;">if</span> j == i: <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">the diagonal</span>
            A[i,j] = 2 + h**2 * qi
        <span style="color: #8b0000;">elif</span> j == i - 1: <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">left of the diagonal</span>
            A[i,j] = -1 - h / 2 * pi
        <span style="color: #8b0000;">elif</span> j == i + 1: <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">right of the diagonal</span>
            A[i,j] = -1 + h / 2 * pi
        <span style="color: #8b0000;">else:</span>
            A[i,j] = 0 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">off the tri-diagonal</span>
 
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">solve the equations A*y = b for Y</span>
Y = np.linalg.solve(A,b)

x = np.hstack([x1, X[:,0], x2])
y = np.hstack([alpha, Y[:,0], beta])

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

plt.plot(x, y)

mu = 1
d = 0.1
x = np.linspace(0,0.1);
Pdrop = -100 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">this is DeltaP/Deltax</span>
u = -(Pdrop) * d**2 / 2.0 / mu * (x / d - (x / d)**2)
plt.plot(x,u,<span style="color: #228b22;">'r--'</span>)

plt.xlabel(<span style="color: #228b22;">'distance between plates'</span>)
plt.ylabel(<span style="color: #228b22;">'fluid velocity'</span>)
plt.legend((<span style="color: #228b22;">'finite difference'</span>, <span style="color: #228b22;">'analytical soln'</span>))
plt.savefig(<span style="color: #228b22;">'images/pp-bvp-fd.png'</span>)
plt.show()
</pre>
</div>

<p><img src="/img/./images/pp-bvp-fd.png"><p>

<p>
You can see excellent agreement here between the numerical and analytical solution.</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/14/Plane-poiseuelle-flow-solved-by-finite-difference.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/14/Plane-poiseuelle-flow-solved-by-finite-difference#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/13/Numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead/" rel="bookmark" title="Permanent Link to Numerically calculating an effectiveness factor for a porous catalyst bead">Numerically calculating an effectiveness factor for a porous catalyst bead</a></h2>
      <p><small><span class="blog_post_date">Posted February 13, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bvp/'>bvp</a></span> | tags: <a href='/blog/tag/reaction-engineering/'>reaction engineering</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/13/Numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated January 05, 2015 at 09:59 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/11/18/numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead/">Matlab post</a> 
</p>

<p>
If reaction rates are fast compared to diffusion in a porous catalyst pellet, then the observed kinetics will appear to be slower than they really are because not all of the catalyst surface area will be effectively used. For example, the reactants may all be consumed in the near surface area of a catalyst bead, and the inside of the bead will be unutilized because no reactants can get in due to the high reaction rates.
</p>

<p>
References: Ch 12. Elements of Chemical Reaction Engineering, Fogler, 4th edition.
</p>

<p>
A mole balance on the particle volume in spherical coordinates with a first order reaction leads to: <img src="ltxpng/pycse_583fc34e02e0dfd7da742eac8e08f28fed0361fb.png" alt="$\frac{d^2Ca}{dr^2} + \frac{2}{r}\frac{dCa}{dr}-\frac{k}{D_e}C_A=0$" /> with boundary conditions <img src="ltxpng/pycse_4866f4778622517d6c40909af5ddee8dd88e4e4b.png" alt="$C_A(R) = C_{As}$" /> and <img src="ltxpng/pycse_c6b9758ef2d8da94f97a02ad3267e4546ed89545.png" alt="$\frac{dCa}{dr}=0$" /> at <img src="ltxpng/pycse_bf76d476f1b6de028534649c02962bb23035ae13.png" alt="$r=0$" />. We convert this equation to a system of first order ODEs by letting <img src="ltxpng/pycse_cfb3bc1cb2bda6ef332c07d9817aeac44dea4a8b.png" alt="$W_A=\frac{dCa}{dr}$" />. Then, our two equations become:
</p>

<p>
<img src="ltxpng/pycse_2a2b847add5fa85ab01423d270fe3702f9eafe38.png" alt="\(\frac{dCa}{dr} = W_A\)" />
</p>

<p>
and
</p>

<p>
<img src="ltxpng/pycse_d57c97774a37a7ef56fbf47b93b687c9f5d6725e.png" alt="\(\frac{dW_A}{dr} = -\frac{2}{r} W_A + \frac{k}{D_E} C_A\)" />
</p>

<p>
We have a condition of no flux (<img src="ltxpng/pycse_f8e519b8e68d9b04fdd5ceee6a4c5b1ce76f1a7c.png" alt="$W_A=0$" />) at r=0 and Ca(R) = CAs, which makes this a boundary value problem. We use the shooting method here, and guess what Ca(0) is and iterate the guess to get Ca(R) = CAs.
</p>

<p>
The value of the second differential equation at r=0 is tricky because at this place we have a 0/0 term. We use L'Hopital's rule to evaluate it. The derivative of the top is <img src="ltxpng/pycse_092ea3e2d18ee85c9af99247db455c8cccce06d5.png" alt="$\frac{dW_A}{dr}$" /> and the derivative of the bottom is 1. So, we have 
<img src="ltxpng/pycse_5460cdb1bbc54e713c3a2f9bb18a2126a0575198.png" alt="\(\frac{dW_A}{dr} = -2\frac{dW_A}{dr} + \frac{k}{D_E} C_A\)" />
</p>

<p>
Which leads to:
</p>

<p>
<img src="ltxpng/pycse_195ccf4fd71c1883fbc31726cb636c64719b6ddf.png" alt="\(3 \frac{dW_A}{dr} =  \frac{k}{D_E} C_A\)" />
</p>

<p>
or <img src="ltxpng/pycse_2d1800a78e5c0ef322ba22f10481b52c3b6bc358.png" alt="\(\frac{dW_A}{dr} =  \frac{3k}{D_E} C_A\)" /> at <img src="ltxpng/pycse_bf76d476f1b6de028534649c02962bb23035ae13.png" alt="$r=0$" />.
</p>

<p>
Finally, we implement the equations in Python and solve.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> scipy.integrate <span style="color: #0000FF;">import</span> odeint
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">De</span> = <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>.<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">1</span>    <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># diffusivity cm^2/s</span>
<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">R</span> = <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>.<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">5</span>    <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># particle radius, cm</span>
<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">k</span> = <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">6</span>.<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">4</span>    <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># rate constant (1/s)</span>
<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">CAs</span> = <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>.<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">2</span>   <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># concentration of A at outer radius of particle (mol/L)</span>


<span style="color: #0000FF;">def</span> <span style="color: #006699;">ode</span>(Y, r):
    <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">Wa</span> = Y[<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>]  <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># molar rate of delivery of A to surface of particle</span>
    <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">Ca</span> = Y[<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">1</span>]  <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># concentration of A in the particle at r</span>
    <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># this solves the singularity at r = 0</span>
    <span style="color: #0000FF;">if</span> <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">r</span> == <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>:
        <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">dWadr</span> = k / <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">3</span>.<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span> * De * Ca
    <span style="color: #0000FF;">else</span>:
        <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">dWadr</span> = -<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">2</span> * Wa / r + k / De * Ca
    <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">dCadr</span> = Wa
    <span style="color: #0000FF;">return</span> [dWadr, dCadr]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-weight: bold; font-style: italic;">Initial conditions</span>
<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">Ca0</span> = <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>.<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">029315</span>  <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># Ca(0) (mol/L) guessed to satisfy Ca(R) = CAs</span>
<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">Wa0</span> = <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>         <span style="color: #8D8D84; font-weight: bold; font-style: italic;"># no flux at r=0 (mol/m^2/s)</span>

<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">rspan</span> = np.linspace(<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span>, R, <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">500</span>)

<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">Y</span> = odeint(ode, [Wa0, Ca0], rspan)

<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">Ca</span> = Y[:, <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">1</span>]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-weight: bold; font-style: italic;">here we check that Ca(R) = Cas</span>
<span style="color: #0000FF;">print</span> <span style="color: #036A07;">'At r={0} Ca={1}'</span>.format(rspan[-<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">1</span>], Ca[-<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">1</span>])

plt.plot(rspan, Ca)
plt.xlabel(<span style="color: #036A07;">'Particle radius'</span>)
plt.ylabel(<span style="color: #036A07;">'$C_A$'</span>)
plt.savefig(<span style="color: #036A07;">'images/effectiveness-factor.png'</span>)

<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">r</span> = rspan
<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">eta_numerical</span> = (np.trapz(k * Ca * <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">4</span> * np.pi * (r**<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">2</span>), r)
                 / np.trapz(k * CAs * <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">4</span> * np.pi * (r**<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">2</span>), r))

<span style="color: #0000FF;">print</span>(eta_numerical)

<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">phi</span> = R * np.sqrt(k / De)
<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">eta_analytical</span> = (<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">3</span> / phi**<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">2</span>) * (phi * (<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">1</span>.<span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">0</span> / np.tanh(phi)) - <span style="color: #333333; background-color: #FFFFFF; font-weight: bold;">1</span>)
<span style="color: #0000FF;">print</span>(eta_analytical)
</pre>
</div>

<pre class="example">
At r=0.5 Ca=0.200001488652
[&lt;matplotlib.lines.Line2D object at 0x114275550&gt;]
&lt;matplotlib.text.Text object at 0x10d5fe890&gt;
&lt;matplotlib.text.Text object at 0x10d5ff890&gt;
0.563011348314

0.563003362801
</pre>


<div class="figure">
<p><img src="/media/2013-02-13-Numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead/effectiveness-factor.png"> 
</p>
</div>

<p>
You can see the concentration of A inside the particle is significantly lower than outside the particle. That is because it is reacting away faster than it can diffuse into the particle. Hence, the overall reaction rate in the particle is lower than it would be without the diffusion limit.
</p>

<p>
The effectiveness factor is the ratio of the actual reaction rate in the particle with diffusion limitation to the ideal rate in the particle if there was no concentration gradient:
</p>

<p>
<img src="ltxpng/pycse_e4d91f15d6b5776f2048ac79e7be69f850f309e0.png" alt="$$\eta = \frac{\int_0^R k'' a C_A(r) 4 \pi r^2 dr}{\int_0^R k'' a C_{As} 4 \pi r^2 dr}$$" />
</p>

<p>
We will evaluate this numerically from our solution and compare it to the analytical solution. The results are in good agreement, and you can make the numerical estimate better by increasing the number of points in the solution so that the numerical integration is more accurate.
</p>

<p>
Why go through the numerical solution when an analytical solution exists? The analytical solution here is only good for 1st order kinetics in a sphere. What would you do for a complicated rate law? You might be able to find some limiting conditions where the analytical equation above is relevant, and if you are lucky, they are appropriate for your problem. If not, it is a good thing you can figure this out numerically!
</p>

<p>
Thanks to Radovan Omorjan for helping me figure out the ODE at r=0!
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/13/Numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/13/Numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Computing-a-pipe-diameter"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/12/Computing-a-pipe-diameter/" rel="bookmark" title="Permanent Link to Computing a pipe diameter">Computing a pipe diameter</a></h2>
      <p><small><span class="blog_post_date">Posted February 12, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-algebra/'>nonlinear algebra</a></span> | tags: <a href='/blog/tag/fluids/'>fluids</a>
        | <a href="http://jkitchin.github.io/blog/2013/02/12/Computing-a-pipe-diameter#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 04:38 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/10/27/compute-pipe-diameter/" >Matlab post</a>
A heat exchanger must handle 2.5 L/s of water through a smooth pipe with length of 100 m. The pressure drop cannot exceed 103 kPa at 25 degC. Compute the minimum pipe diameter required for this application.
</p>

<p>
Adapted from problem 8.8 in Problem solving in chemical and Biochemical Engineering with Polymath, Excel, and Matlab. page 303.
</p>

<p>
We need to estimate the Fanning friction factor for these conditions so we can estimate the frictional losses that result in a pressure drop for a uniform, circular pipe. The frictional forces are given by \(F_f = 2f_F \frac{\Delta L v^2}{D}\), and the corresponding pressure drop is given by \(\Delta P = \rho F_f\). In these equations, \(\rho\) is the fluid density, \(v\) is the fluid velocity, \(D\) is the pipe diameter, and \(f_F\) is the Fanning friction factor. The average fluid velocity is given by \(v = \frac{q}{\pi D^2/4}\).
</p>

<p>
For laminar flow, we estimate \(f_F = 16/Re\), which is a linear equation, and for turbulent flow (\(Re > 2100\)) we have the implicit equation \(\frac{1}{\sqrt{f_F}}=4.0 \log(Re \sqrt{f_F})-0.4\). Of course, we define \(Re = \frac{D v\rho}{\mu}\) where \(\mu\) is the viscosity of the fluid.
</p>

<p>
It is known that \(\rho(T) = 46.048 + 9.418 T -0.0329 T^2 +4.882\times10^{-5}-2.895\times10^{-8}T^4\) and \(\mu = \exp\left({-10.547 + \frac{541.69}{T-144.53}}\right)\) where \(\rho\) is in kg/m^3 and \(\mu\) is in kg/(m*s).
</p>

<p>
The aim is to find \(D\) that solves: \(\Delta p = \rho 2 f_F \frac{\Delta L v^2}{D}\). This is a nonlinear equation in \(D\), since D affects the fluid velocity, the Re, and the Fanning friction factor. Here is the solution
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

T = 25 + 273.15
Q = 2.5e-3       <span style="color: #ff0000; font-weight: bold;"># m^3/s</span>
deltaP = 103000  <span style="color: #ff0000; font-weight: bold;"># Pa</span>
deltaL = 100     <span style="color: #ff0000; font-weight: bold;"># m</span>

<span style="color: #ff0000; font-weight: bold;">#Note these correlations expect dimensionless T, where the magnitude</span>
<span style="color: #ff0000; font-weight: bold;"># of T is in K</span>

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">rho</span>(T):
    <span style="color: #8b0000;">return</span> 46.048 + 9.418 * T -0.0329 * T**2 +4.882e-5 * T**3 - 2.895e-8 * T**4

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">mu</span>(T):
    <span style="color: #8b0000;">return</span> np.exp(-10.547 + 541.69 / (T - 144.53))

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fanning_friction_factor_</span>(Re):
    <span style="color: #8b0000;">if</span> Re &lt; 2100:
        <span style="color: #8b0000;">raise</span> <span style="color: #cd0000;">Exception</span>(<span style="color: #228b22;">'Flow is probably not turbulent, so this correlation is not appropriate.'</span>)
    <span style="color: #ff0000; font-weight: bold;"># solve the Nikuradse correlation to get the friction factor</span>
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fz</span>(f): <span style="color: #8b0000;">return</span> 1.0/np.sqrt(f) - (4.0*np.log10(Re*np.sqrt(f))-0.4)
    sol, = fsolve(fz, 0.01)
    <span style="color: #8b0000;">return</span> sol

fanning_friction_factor = np.vectorize(fanning_friction_factor_)

Re = np.linspace(2200, 9000)
f = fanning_friction_factor(Re)

plt.plot(Re, f)
plt.xlabel(<span style="color: #228b22;">'Re'</span>)
plt.ylabel(<span style="color: #228b22;">'fanning friction factor'</span>)
<span style="color: #ff0000; font-weight: bold;"># You can see why we use 0.01 as an initial guess for solving for the</span>
<span style="color: #ff0000; font-weight: bold;"># Fanning friction factor; it falls in the middle of ranges possible</span>
<span style="color: #ff0000; font-weight: bold;"># for these Re numbers.</span>
plt.savefig(<span style="color: #228b22;">'images/pipe-diameter-1.png'</span>)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">objective</span>(D):
    v = Q / (np.pi * D**2 / 4)
    Re = D * v * rho(T) / mu(T)

    fF = fanning_friction_factor(Re)

    <span style="color: #8b0000;">return</span> deltaP - 2 * fF * rho(T) * deltaL * v**2 / D
    
D, = fsolve(objective, 0.04)

<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'The minimum pipe diameter is {0} m\n'</span>.format(D))
</pre>
</div>

<pre class="example">
The minimum pipe diameter is 0.0389653369531 m
</pre>
<p>
Any pipe diameter smaller than that value will result in a larger pressure drop at the same volumetric flow rate, or a smaller volumetric flowrate at the same pressure drop. Either way, it will not meet the design specification.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/12/Computing-a-pipe-diameter.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/12/Computing-a-pipe-diameter#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../99">« Previous Page</a>
  --  
 <a href="../101">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/09/24/Solving-nonlinear-algebra-problems-with-internal-state-information/">Solving nonlinear algebra problems with internal state information</a></li>
      <li><a href="/blog/2018/09/05/Integration-of-the-heat-capacity/">Integration of the heat capacity</a></li>
      <li><a href="/blog/2018/09/04/A-new-ode-integrator-function-in-scipy/">A new ode integrator function in scipy</a></li>
      <li><a href="/blog/2018/07/01/Getting-geo-tagged-information-from-photos-for-blogging/">Getting geo-tagged information from photos for blogging</a></li>
      <li><a href="/blog/2018/05/17/Literate-programming-with-python-doctests/">Literate programming with python doctests</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



