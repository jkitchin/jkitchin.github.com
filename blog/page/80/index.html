

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Handling-units-with-the-quantities-module"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/22/Handling-units-with-the-quantities-module/" rel="bookmark" title="Permanent Link to Handling units with the quantities module">Handling units with the quantities module</a></h2>
      <p><small><span class="blog_post_date">Posted March 22, 2013 at 10:00 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/units/'>units</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/03/22/Handling-units-with-the-quantities-module#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 23, 2013 at 09:22 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
The quantities module (<a href="https://pypi.python.org/pypi/quantities" >https://pypi.python.org/pypi/quantities</a>) is another option for handling units in python. We are going to try the previous example. It does not work, because scipy.optimize.fsolve is not designed to work with units. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> quantities <span style="color: #8b0000;">as</span> u
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve
CA0 = 1 * u.mol / u.L
CA = 0.01 * u.mol / u.L
k = 1.0 / u.s

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(t):
    <span style="color: #8b0000;">return</span> CA - CA0 * np.exp(-k * t)

tguess = 4 * u.s

<span style="color: #8b0000;">print</span> func(tguess)

<span style="color: #8b0000;">print</span> fsolve(func, tguess)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; -0.00831563888873 mol/L
&gt;&gt;&gt; Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "c:\Python27\lib\site-packages\scipy\optimize\minpack.py", line 115, in fsolve
    _check_func('fsolve', 'func', func, x0, args, n, (n,))
  File "c:\Python27\lib\site-packages\scipy\optimize\minpack.py", line 13, in _check_func
    res = atleast_1d(thefunc(*((x0[:numinputs],) + args)))
  File "&lt;stdin&gt;", line 2, in func
  File "c:\Python27\lib\site-packages\quantities-0.10.1-py2.7.egg\quantities\quantity.py", line 231, in __array_prepare__
    res._dimensionality = p_dict[uf](*objs)
  File "c:\Python27\lib\site-packages\quantities-0.10.1-py2.7.egg\quantities\dimensionality.py", line 347, in _d_dimensionless
    raise ValueError("quantity must be dimensionless")
ValueError: quantity must be dimensionless
</pre>

<p>
Our function works fine with units, but fsolve does not pass numbers with units back to the function, so this function fails because the exponential function gets an argument with dimensions in it.  We can create a new function that solves this problem. We need to &ldquo;wrap&rdquo; the function we want to solve to make sure that it uses units, but returns a float number. Then, we put the units back onto the final solved value. Here is how we do that.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> quantities <span style="color: #8b0000;">as</span> u
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve <span style="color: #8b0000;">as</span> _fsolve

CA0 = 1 * u.mol / u.L
CA = 0.01 * u.mol / u.L
k = 1.0 / u.s

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(t):
    <span style="color: #8b0000;">return</span> CA - CA0 * np.exp(-k * t)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fsolve</span>(func, t0):
    <span style="color: #228b22;">'wrapped fsolve command to work with units'</span>
    tU = t0 / <span style="color: #8b0000;">float</span>(t0)  <span style="color: #ff0000; font-weight: bold;"># units on initial guess, normalized</span>
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">wrapped_func</span>(t):
        <span style="color: #228b22;">'t will be unitless, so we add unit to it. t * tU has units.'</span>
        <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">float</span>(func(t * tU))

    sol, = _fsolve(wrapped_func, t0)
    <span style="color: #8b0000;">return</span> sol * tU
    
tguess = 4 * u.s

<span style="color: #8b0000;">print</span> fsolve(func, tguess)
</pre>
</div>

<pre class="example">
4.60517018599 s
</pre>

<p>
It is a little tedious to do this, but we might only have to do it once if we store the new fsolve command in a module. You might notice the wrapped function we wrote above only works for one dimensional problems. If there are multiple dimensions, we have to be a little more careful. In the next example, we expand the wrapped function definition to do both one and multidimensional problems. It appears we cannot use numpy.array element-wise multiplication because you cannot mix units in an array. We will use lists instead. When the problem is one-dimensional, the function will take a scalar, but when it is multidimensional it will take a list or array. We will use try/except blocks to handle these two cases. We will assume multidimensional cases, and if that raises an exception because the argument is not a list, we assume it is scalar. Here is the more robust code example. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> quantities <span style="color: #8b0000;">as</span> u
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve <span style="color: #8b0000;">as</span> _fsolve

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fsolve</span>(func, t0):
    <span style="color: #228b22;">'''wrapped fsolve command to work with units. We get the units on</span>
<span style="color: #228b22;">    the function argument, then wrap the function so we can add units</span>
<span style="color: #228b22;">    to the argument and return floats. Finally we call the original</span>
<span style="color: #228b22;">    fsolve from scipy. Note: this does not support all of the options</span>
<span style="color: #228b22;">    to fsolve.'''</span> 

    <span style="color: #8b0000;">try:</span>
        tU = [t / <span style="color: #8b0000;">float</span>(t) <span style="color: #8b0000;">for</span> t <span style="color: #8b0000;">in</span> t0]  <span style="color: #ff0000; font-weight: bold;"># units on initial guess, normalized</span>
    <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
        tU = t0 / <span style="color: #8b0000;">float</span>(t0)
    
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">wrapped_func</span>(t):
        <span style="color: #228b22;">'t will be unitless, so we add unit to it. t * tU has units.'</span>    
        <span style="color: #8b0000;">try:</span>
            T = [x1 * x2 <span style="color: #8b0000;">for</span> x1,x2 <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(t, tU)]
        <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
            T = t * tU

        <span style="color: #8b0000;">try:</span>
            <span style="color: #8b0000;">return</span> [<span style="color: #8b0000;">float</span>(x) <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> func(T)]
        <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
            <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">float</span>(func(T))

    sol = _fsolve(wrapped_func, t0)
    <span style="color: #8b0000;">try:</span>
        <span style="color: #8b0000;">return</span> [x1 * x2 <span style="color: #8b0000;">for</span> x1,x2 <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(sol, tU)]
    <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
        <span style="color: #8b0000;">return</span> sol * tU

<span style="color: #ff0000; font-weight: bold;">### Problem 1</span>
CA0 = 1 * u.mol / u.L
CA = 0.01 * u.mol / u.L
k = 1.0 / u.s

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(t):
    <span style="color: #8b0000;">return</span> CA - CA0 * np.exp(-k * t)


tguess = 4 * u.s
sol1, = fsolve(func, tguess)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'sol1 = '</span>,sol1

<span style="color: #ff0000; font-weight: bold;">### Problem 2</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func2</span>(X):
    a,b = X
    <span style="color: #8b0000;">return</span> [a**2 - 4*u.kg**2,
            b**2 - 25*u.J**2]

Xguess = [2.2*u.kg, 5.2*u.J]
s2a, s2b = fsolve(func2, Xguess)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'s2a = {0}\ns2b = {1}'</span>.format(s2a, s2b)
</pre>
</div>

<pre class="example">
sol1 =  4.60517018599 s
s2a = 2.0 kg
s2b = 5.0 J
</pre>

<p>
That is pretty good. There is still room for improvement in the wrapped function, as it does not support all of the options that scipy.optimize.fsolve supports. Here is a draft of a function that does that. We have to return different numbers of arguments depending on the value of full_output. This function works, but I have not fully tested all the options. Here are three examples that work, including one with an argument.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> quantities <span style="color: #8b0000;">as</span> u
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve <span style="color: #8b0000;">as</span> _fsolve

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fsolve</span>(func, t0, args=(), 
           fprime=<span style="color: #8b0000;">None</span>, full_output=0, col_deriv=0, 
           xtol=1.49012e-08, maxfev=0, band=<span style="color: #8b0000;">None</span>, 
           epsfcn=0.0, factor=100, diag=<span style="color: #8b0000;">None</span>):
    <span style="color: #228b22;">'''wrapped fsolve command to work with units. We get the units on</span>
<span style="color: #228b22;">    the function argument, then wrap the function so we can add units</span>
<span style="color: #228b22;">    to the argument and return floats. Finally we call the original</span>
<span style="color: #228b22;">    fsolve from scipy. '''</span> 

    <span style="color: #8b0000;">try:</span>
        tU = [t / <span style="color: #8b0000;">float</span>(t) <span style="color: #8b0000;">for</span> t <span style="color: #8b0000;">in</span> t0]  <span style="color: #ff0000; font-weight: bold;"># units on initial guess, normalized</span>
    <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
        tU = t0 / <span style="color: #8b0000;">float</span>(t0)
    
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">wrapped_func</span>(t, *args):
        <span style="color: #228b22;">'t will be unitless, so we add unit to it. t * tU has units.'</span>    
        <span style="color: #8b0000;">try:</span>
            T = [x1 * x2 <span style="color: #8b0000;">for</span> x1,x2 <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(t, tU)]
        <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
            T = t * tU

        <span style="color: #8b0000;">try:</span>
            <span style="color: #8b0000;">return</span> [<span style="color: #8b0000;">float</span>(x) <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> func(T, *args)]
        <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
            <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">float</span>(func(T))

    sol = _fsolve(wrapped_func, t0, args, 
           fprime, full_output, col_deriv, 
           xtol, maxfev, band, 
           epsfcn, factor, diag)

    <span style="color: #8b0000;">if</span> full_output:
        x, infodict, ier, mesg = sol
        <span style="color: #8b0000;">try:</span>
            x = [x1 * x2 <span style="color: #8b0000;">for</span> x1,x2 <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(x, tU)]
        <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
            x = x * tU
        <span style="color: #8b0000;">return</span> x, infodict, ier, mesg
    <span style="color: #8b0000;">else:</span>
        <span style="color: #8b0000;">try:</span>
            x = [x1 * x2 <span style="color: #8b0000;">for</span> x1,x2 <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(sol, tU)]
        <span style="color: #8b0000;">except</span> <span style="color: #cd0000;">TypeError</span>:
            x = sol * tU
        <span style="color: #8b0000;">return</span> x

<span style="color: #ff0000; font-weight: bold;">### Problem 1</span>
CA0 = 1 * u.mol / u.L
CA = 0.01 * u.mol / u.L
k = 1.0 / u.s

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(t):
    <span style="color: #8b0000;">return</span> CA - CA0 * np.exp(-k * t)


tguess = 4 * u.s
sol1, = fsolve(func, tguess)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'sol1 = '</span>,sol1

<span style="color: #ff0000; font-weight: bold;">### Problem 2</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func2</span>(X):
    a,b = X
    <span style="color: #8b0000;">return</span> [a**2 - 4*u.kg**2,
            b**2 - 25*u.J**2]

Xguess = [2.2*u.kg, 5.2*u.J]
sol, infodict, ier, mesg = fsolve(func2, Xguess, full_output=1)
s2a, s2b = sol
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'s2a = {0}\ns2b = {1}'</span>.format(s2a, s2b)

<span style="color: #ff0000; font-weight: bold;">### Problem 3 - with an arg</span>
<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func3</span>(a, arg):
    <span style="color: #8b0000;">return</span> a**2 - 4*u.kg**2 + arg**2

Xguess = 1.5 * u.kg
arg = 0.0* u.kg

sol3, = fsolve(func3, Xguess, args=(arg,))
print<span style="color: #228b22;">'sol3 = '</span>, sol3
</pre>
</div>

<pre class="example">
sol1 =  4.60517018599 s
s2a = 2.0 kg
s2b = 5.0 J
sol3 =  2.0 kg
</pre>

<p>
The only downside I can see in the quantities module is that it only handle temperature differences, and not absolute temperatures. If you only use absolute temperatures, this would not be a problem I think. But, if you have mixed temperature scales, the quantities module does not convert them on an absolute scale.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> quantities <span style="color: #8b0000;">as</span> u

T = 20 * u.degC

<span style="color: #8b0000;">print</span> T.rescale(u.K)
<span style="color: #8b0000;">print</span> T.rescale(u.degF)
</pre>
</div>

<pre class="example">
20.0 K
36.0 degF
</pre>

<p>
Nevertheless, this module seems pretty promising, and there are a lot more features than shown here. Some documentation can be found at <a href="http://pythonhosted.org/quantities/" >http://pythonhosted.org/quantities/</a>.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/22/Handling-units-with-the-quantities-module.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/03/22/Handling-units-with-the-quantities-module#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Potential-gotchas-in-linear-algebra-in-numpy"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/12/Potential-gotchas-in-linear-algebra-in-numpy/" rel="bookmark" title="Permanent Link to Potential gotchas in linear algebra in numpy">Potential gotchas in linear algebra in numpy</a></h2>
      <p><small><span class="blog_post_date">Posted March 12, 2013 at 10:19 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/linear-algebra/'>linear algebra</a>, <a href='/blog/category/gotcha/'>gotcha</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/03/12/Potential-gotchas-in-linear-algebra-in-numpy#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Numpy has some gotcha features for linear algebra purists. The first is that a 1d array is neither a row, nor a column vector. That is, \(a\) = \(a^T\) if \(a\) is a 1d array. That means you can take the dot product of \(a\) with itself, without transposing the second argument. This would not be allowed in Matlab.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

a = np.array([0, 1, 2])
<span style="color: #8b0000;">print</span> a.shape
<span style="color: #8b0000;">print</span> a
<span style="color: #8b0000;">print</span> a.T

<span style="color: #8b0000;">print</span>
<span style="color: #8b0000;">print</span> np.dot(a, a)
<span style="color: #8b0000;">print</span> np.dot(a, a.T)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; (3L,)
[0 1 2]
[0 1 2]
&gt;&gt;&gt;
5
5
</pre>

<p>
Compare the previous behavior with this 2d array. In this case, you cannot take the dot product of \(b\) with itself, because the dimensions are incompatible. You must transpose the second argument to make it dimensionally consistent. Also, the result of the dot product is not a simple scalar, but a 1 &times; 1 array.
</p>

<div class="org-src-container">

<pre class="src src-python">b = np.array([[0, 1, 2]])
<span style="color: #8b0000;">print</span> b.shape
<span style="color: #8b0000;">print</span> b
<span style="color: #8b0000;">print</span> b.T

<span style="color: #8b0000;">print</span> np.dot(b, b)    <span style="color: #ff0000; font-weight: bold;"># this is not ok, the dimensions are wrong.</span>
<span style="color: #8b0000;">print</span> np.dot(b, b.T)
<span style="color: #8b0000;">print</span> np.dot(b, b.T).shape
</pre>
</div>

<pre class="example">
(1L, 3L)
[[0 1 2]]
[[0]
 [1]
 [2]]
&gt;&gt;&gt; Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ValueError: objects are not aligned
[[5]]
(1L, 1L)
</pre>

<p>
Try to figure this one out! x is a column vector, and y is a 1d vector. Just by adding them you get a 2d array.
</p>
<div class="org-src-container">

<pre class="src src-python">x = np.array([[2], [4], [6], [8]])
y = np.array([1, 1, 1, 1, 1, 2])
<span style="color: #8b0000;">print</span> x + y
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; [[ 3  3  3  3  3  4]
 [ 5  5  5  5  5  6]
 [ 7  7  7  7  7  8]
 [ 9  9  9  9  9 10]]
</pre>

<p>
Or this crazy alternative way to do the same thing.
</p>
<div class="org-src-container">

<pre class="src src-python">x = np.array([2, 4, 6, 8])
y = np.array([1, 1, 1, 1, 1, 1, 2])

<span style="color: #8b0000;">print</span> x[:, np.newaxis] + y
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [[ 3  3  3  3  3  3  4]
 [ 5  5  5  5  5  5  6]
 [ 7  7  7  7  7  7  8]
 [ 9  9  9  9  9  9 10]]
</pre>

<p>
In the next example,  we have a 3 element vector and a 4 element vector. We convert \(b\) to a 2D array with np.newaxis, and compute the outer product of the two arrays. The result is a 4 &times; 3 array.
</p>
<div class="org-src-container">

<pre class="src src-python">a = np.array([1, 2, 3])
b = np.array([10, 20, 30, 40])

<span style="color: #8b0000;">print</span> a * b[:, np.newaxis]
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; [[ 10  40  90]
 [ 20  80 180]
 [ 30 120 270]
 [ 40 160 360]]
</pre>

<p>
These concepts are known in numpy as array broadcasting. See <a href="http://www.scipy.org/EricsBroadcastingDoc" >http://www.scipy.org/EricsBroadcastingDoc</a> and <a href="http://docs.scipy.org/doc/numpy/user/basics.broadcasting.html" >http://docs.scipy.org/doc/numpy/user/basics.broadcasting.html</a> for more details.
</p>

<p>
These are points to keep in mind, as the operations do not strictly follow the conventions of linear algebra, and may be confusing at times.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/12/Potential-gotchas-in-linear-algebra-in-numpy.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/03/12/Potential-gotchas-in-linear-algebra-in-numpy#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Solving-the-Blasius-equation"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/11/Solving-the-Blasius-equation/" rel="bookmark" title="Permanent Link to Solving the Blasius equation">Solving the Blasius equation</a></h2>
      <p><small><span class="blog_post_date">Posted March 11, 2013 at 10:44 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bvp/'>bvp</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/03/11/Solving-the-Blasius-equation#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated November 27, 2017 at 07:32 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
In fluid mechanics the Blasius equation comes up (<a href="http://en.wikipedia.org/wiki/Blasius_boundary_layer">http://en.wikipedia.org/wiki/Blasius_boundary_layer</a>) to describe the boundary layer that forms near a flat plate with fluid moving by it. The nonlinear differential equation is:
</p>

\begin{eqnarray}
f''' + \frac{1}{2} f f'' &=& 0 \\
f(0) &=& 0 \\
f'(0) &=& 0 \\
f'(\infty) &=& 1
\end{eqnarray}

<p>
This is a nonlinear, boundary value problem. The point of solving this equation is to get the value of \(f''(0)\) to evaluate the shear stress at the plate.
</p>

<p>
We have to convert this to a system of first-order differential equations. Let \(f_1 = f\), \(f_2 = f_1'\) and \(f_3 = f_2'\). This leads to:
</p>

\begin{eqnarray}
f_1' = f_2 \\
f_2' = f_3 \\
f_3' = -\frac{1}{2} f_1 f_3 \\
f_1(0) = 0 \\
f_2(0) = 0 \\
f_2(\infty) = 1
\end{eqnarray}

<p>
It is not possible to specify a boundary condition at \(\infty\) numerically, so we will have to use a large number, and verify it is "large enough". From the solution, we evaluate the derivatives at \(\eta=0\), and we have \(f''(0) = f_3(0)\).
</p>

<p>
We have to provide initial guesses for f_1, f_2 and f_3. This is the hardest part about this problem. We know that f_1 starts at zero, and is flat there (f'(0)=0), but at large eta, it has a constant slope of one. We will guess a simple line of slope = 1 for f_1. That is correct at large eta, and is zero at &eta;=0. If the slope of the function is constant at large \(\eta\), then the values of higher derivatives must tend to zero. We choose an exponential decay as a guess.
</p>

<p>
Finally, we let a solver iteratively find a solution for us, and find the answer we want. The solver is in the pycse module.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> pycse <span style="color: #0000FF;">import</span> bvp

<span style="color: #0000FF;">def</span> <span style="color: #006699;">odefun</span>(F, x):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">f1</span>, <span style="color: #BA36A5;">f2</span>, <span style="color: #BA36A5;">f3</span> = F.T
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> np.column_stack([f2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   -0.5 * f1 * f3])

<span style="color: #0000FF;">def</span> <span style="color: #006699;">bcfun</span>(Y):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">fa</span>, <span style="color: #BA36A5;">fb</span> = Y[0, :], Y[-1, :]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> [fa[0],        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">f1(0) =  0</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   fa[1],        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">f2(0) = 0</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   1.0 - fb[1]]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">f2(inf) = 1</span>

<span style="color: #BA36A5;">eta</span> = np.linspace(0, 6, 100)
<span style="color: #BA36A5;">f1init</span> = eta
<span style="color: #BA36A5;">f2init</span> = np.exp(-eta)
<span style="color: #BA36A5;">f3init</span> = np.exp(-eta)

<span style="color: #BA36A5;">Finit</span> = np.column_stack([f1init, f2init, f3init])

<span style="color: #BA36A5;">sol</span> = bvp(odefun, bcfun, eta, Finit)
<span style="color: #BA36A5;">f1</span>, <span style="color: #BA36A5;">f2</span>, <span style="color: #BA36A5;">f3</span> = sol.T

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">"f''(0) = f_3(0) = {0}"</span>.<span style="color: #006FE0;">format</span>(f3[0]))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(eta, f1)
plt.xlabel(<span style="color: #008000;">'$\eta$'</span>)
plt.ylabel(<span style="color: #008000;">'$f(\eta)$'</span>)
plt.savefig(<span style="color: #008000;">'images/blasius.png'</span>)
</pre>
</div>

<pre class="example">
f''(0) = f_3(0) = 0.3324911095517483

</pre>


<p>
<img src="/media/blasius.png"> 
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2017-05-17 Wed&gt; </span></span> You need pycse 1.6.4 for this example.
</p>
<p>Copyright (C) 2017 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2013/03/11/Solving-the-Blasius-equation.org">org-mode source</a></p>
<p>Org-mode version = 9.1.2</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/03/11/Solving-the-Blasius-equation#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Another-look-at-nonlinear-BVPs"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/11/Another-look-at-nonlinear-BVPs/" rel="bookmark" title="Permanent Link to Another look at nonlinear BVPs">Another look at nonlinear BVPs</a></h2>
      <p><small><span class="blog_post_date">Posted March 11, 2013 at 10:44 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bvp/'>bvp</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/03/11/Another-look-at-nonlinear-BVPs#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 11, 2013 at 04:31 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Adapted from <a href="http://www.mathworks.com/help/matlab/ref/bvp4c.html" >http://www.mathworks.com/help/matlab/ref/bvp4c.html</a>

</p>

<p>
Boundary value problems may have more than one solution. Let us consider the BVP:
</p>

\begin{eqnarray}
y'' + |y| &=& 0 \\
y(0) &=& 0 \\
y(4) &=& -2
\end{eqnarray}

<p>
We will see this equation has two answers, depending on your initial guess. We convert this to the following set of coupled equations:
</p>

\begin{eqnarray}
y_1' &=& y_2 \\
y_2' &=& -|y_1| \\
y_1(0)&=& 0\\
y_1(4) &=& -2
\end{eqnarray}

<p>
This BVP is nonlinear because of the absolute value. We will have to guess solutions to get started. We will guess two different solutions, both of which will be constant values.  We will use pycse.bvp to solve the equation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> pycse <span style="color: #8b0000;">import</span> bvp
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">odefun</span>(Y, x):
    y1, y2 = Y
    dy1dx = y2
    dy2dx = -np.abs(y1)
    <span style="color: #8b0000;">return</span> [dy1dx, dy2dx]

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">bcfun</span>(Ya, Yb):
    y1a, y2a = Ya
    y1b, y2b = Yb

    <span style="color: #8b0000;">return</span> [y1a, -2 - y1b]

x = np.linspace(0, 4, 100)

y1 = 1.0 * np.ones(x.shape)
y2 = 0.0 * np.ones(x.shape)

Yinit = np.vstack([y1, y2])

sol = bvp(odefun, bcfun, x, Yinit)

plt.plot(x, sol[0])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">another initial guess</span>
y1 = -1.0 * np.ones(x.shape)
y2 = 0.0 * np.ones(x.shape)

Yinit = np.vstack([y1, y2])

sol = bvp(odefun, bcfun, x, Yinit)

plt.plot(x, sol[0])
plt.legend([<span style="color: #228b22;">'guess 1'</span>, <span style="color: #228b22;">'guess 2'</span>])
plt.savefig(<span style="color: #228b22;">'images/bvp-another-nonlin-1.png'</span>)
plt.show()
</pre>
</div>


<p><img src="/img/./images/bvp-another-nonlin-1.png"><p>

<p>
This example shows that a nonlinear BVP may have different solutions, and which one you get depends on the guess you make for the solution. This is analogous to solving nonlinear algebraic equations (which is what is done in solving this problem!).
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/11/Another-look-at-nonlinear-BVPs.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/03/11/Another-look-at-nonlinear-BVPs#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Numerical-Simpsons-rule"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/08/Numerical-Simpsons-rule/" rel="bookmark" title="Permanent Link to Numerical Simpsons rule">Numerical Simpsons rule</a></h2>
      <p><small><span class="blog_post_date">Posted March 08, 2013 at 06:18 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a>, <a href='/blog/category/integration/'>integration</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/03/08/Numerical-Simpsons-rule#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>

A more accurate numerical integration than the trapezoid method is <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.simps.html" >Simpson's rule</a>. The syntax is similar to trapz, but the method is in scipy.integrate.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> simps, romb

a = 0.0; b = np.pi / 4.0;
N = 10  <span style="color: #ff0000; font-weight: bold;"># this is the number of intervals</span>

x = np.linspace(a, b, N)
y = np.cos(x)

t = np.trapz(y, x)
s = simps(y, x)
a = np.sin(b) - np.sin(a)

<span style="color: #8b0000;">print</span>
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'trapz = {0} ({1:%} error)'</span>.format(t, (t - a)/a)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'simps = {0} ({1:%} error)'</span>.format(s, (s - a)/a)
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'analy = {0}'</span>.format(a)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;
trapz = 0.70665798038 (-0.063470% error)
simps = 0.707058914216 (-0.006769% error)
analy = 0.707106781187
</pre>

<p>
You can see the Simpson's method is more accurate than the trapezoid method.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/08/Numerical-Simpsons-rule.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/03/08/Numerical-Simpsons-rule#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../79">« Previous Page</a>
  --  
 <a href="../81">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/01/27/New-publication-in-Topics-in-Catalysis/">New publication in Topics in Catalysis</a></li>
      <li><a href="/blog/2018/01/03/New-publication-in-Molecular-Simulation/">New publication in Molecular Simulation</a></li>
      <li><a href="/blog/2017/12/31/2017-in-a-nutshell-for-the-Kitchin-Research-group/">2017 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2017/11/29/Solving-an-eigenvalue-differential-equation-with-a-neural-network/">Solving an eigenvalue differential equation with a neural network</a></li>
      <li><a href="/blog/2017/11/28/Solving-ODEs-with-a-neural-network-and-autograd/">Solving ODEs with a neural network and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



