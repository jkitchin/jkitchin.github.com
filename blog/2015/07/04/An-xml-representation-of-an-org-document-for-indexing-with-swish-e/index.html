

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications/index.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            






<article>
  <div class="blog_post">
    <header>
      <div id="An-xml-representation-of-an-org-document-for-indexing-with-swish-e"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/07/04/An-xml-representation-of-an-org-document-for-indexing-with-swish-e/" rel="bookmark" title="Permanent Link to An xml representation of an org document for indexing with swish-e">An xml representation of an org document for indexing with swish-e</a></h2>
      <p><small><span class="blog_post_date">Posted July 04, 2015 at 11:49 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/search/'>search</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/07/04/An-xml-representation-of-an-org-document-for-indexing-with-swish-e#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated July 04, 2015 at 07:34 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Swish-e can index xml data, and enable searching by tag. Here we push our org-mode indexing idea a little further. Initially we indexed org files as text. Then, we exported it to html, and indexed the html. That enabled some richer searching. Now, we will create an xml representation of the org file for indexing. This will enable us to use a custom tag system and search for specific text in tables, or src-blocks, or in headlines, or for headlines with certain tags, todo state or properties.
</p>

<p>
Incidentally, this is a general strategy for indexing arbitrary files. You just make an xml representation of the file containing the data to be indexed, and use swish-e to index that xml.
</p>

<p>
Let us start with code to generate xml. I adapted this from some code in <a href="http://landoflisp.com">Land Of Lisp</a> . First, a function that simply prints a tag with attributes.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">print-tag</span> (name attrs <span style="color: #6434A3;">&amp;optional</span> closingp)
  <span style="color: #036A07;">"Print an xml tag with symbol NAME and ATTRS (a cons list of (attribute . value)).</span>
<span style="color: #036A07;">if CLOSINGP print the closing tag instead."</span>
  (format
   <span style="color: #008000;">"&lt;%s%s%s&gt;"</span>
   (<span style="color: #0000FF;">if</span> closingp <span style="color: #008000;">"/"</span> <span style="color: #008000;">""</span>)
   name
   (<span style="color: #0000FF;">if</span> (<span style="color: #0000FF;">and</span> attrs (not closingp))
       (concat
        <span style="color: #008000;">" "</span>
        (mapconcat
         (<span style="color: #0000FF;">lambda</span> (x)
           (format <span style="color: #008000;">"%s=\"%s\""</span>
                   (car x)
                   (xml-escape-string (cdr x))))
         attrs
         <span style="color: #008000;">" "</span>))
     <span style="color: #008000;">""</span>)))

(print-tag 'html '((color . <span style="color: #008000;">"blue"</span>) (label . <span style="color: #008000;">"test"</span>)))
</pre>
</div>

<pre class="example">
&lt;html color="blue" label="test"&gt;
</pre>

<p>
XML tags almost always come in pairs. We define a macro to make this happen here. The macro prints the opening tag, evaluates the body, and prints the closing body. Note that the body may contain other tags, or a string. The string should be escaped to avoid illegal xml characters.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">tag</span> (name attributes <span style="color: #6434A3;">&amp;rest</span> body)
  `(format <span style="color: #008000;">"%s%s%s"</span>
           (print-tag ,name ,attributes nil)
           (concat
           ,@body)
           (print-tag ,name nil t)))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">example usage</span>
(<span style="color: #0000FF;">tag</span> <span style="color: #008000;">"xml"</span> '((test . <span style="color: #008000;">"id"</span>))
     (<span style="color: #0000FF;">tag</span> <span style="color: #008000;">"body"</span> nil
          (<span style="color: #0000FF;">tag</span> <span style="color: #008000;">"p"</span> nil (xml-escape-string <span style="color: #008000;">"paragraph &amp; &lt; 1"</span>))
          (<span style="color: #0000FF;">tag</span> <span style="color: #008000;">"p"</span> nil <span style="color: #008000;">"paragraph 2"</span>)))
</pre>
</div>

<pre class="example">
&lt;xml test="id"&gt;&lt;body&gt;&lt;p&gt;paragraph &amp;amp; &amp;lt; 1&lt;/p&gt;&lt;p&gt;paragraph 2&lt;/p&gt;&lt;/body&gt;&lt;/xml&gt;
</pre>

<p>
Now, we can use this to get an xml representation of the source blocks, e.g.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(mapconcat 'identity
           (org-element-map
               (org-element-parse-buffer)
               'src-block
             (<span style="color: #0000FF;">lambda</span> (element)
               (<span style="color: #0000FF;">tag</span>
                'src-block
                `((language . ,(org-element-property <span style="color: #006FE0;">:language</span> element)))
                (<span style="color: #0000FF;">tag</span> 'contents ()
                     (xml-escape-string
                      (org-element-property <span style="color: #006FE0;">:value</span> element))))))
           <span style="color: #008000;">""</span>)
</pre>
</div>

<pre class="example">
&lt;src-block language="emacs-lisp"&gt;&lt;contents&gt;(defun print-tag (name attrs &amp;amp;optional closingp)
  &amp;quot;Print an xml tag with symbol NAME and ATTRS (a cons list of (attribute . value)).
if CLOSINGP print the closing tag instead.&amp;quot;
  (format
   &amp;quot;&amp;lt;%s%s%s&amp;gt;&amp;quot;
   (if closingp &amp;quot;/&amp;quot; &amp;quot;&amp;quot;)
   name
   (if (and attrs (not closingp))
       (concat
	&amp;quot; &amp;quot;
	(mapconcat
	 (lambda (x)
	   (format &amp;quot;%s=\&amp;quot;%s\&amp;quot;&amp;quot;
		   (car x)
		   (xml-escape-string (cdr x))))
	 attrs
	 &amp;quot; &amp;quot;))
     &amp;quot;&amp;quot;)))

(print-tag &amp;apos;html &amp;apos;((color . &amp;quot;blue&amp;quot;) (label . &amp;quot;test&amp;quot;)))
&lt;/contents&gt;&lt;/src-block&gt;&lt;src-block language="emacs-lisp"&gt;&lt;contents&gt;(defmacro tag (name attributes &amp;amp;rest body)
  `(format &amp;quot;%s%s%s&amp;quot;
	   (print-tag ,name ,attributes nil)
           (concat
	   ,@body)
	   (print-tag ,name nil t)))

(tag &amp;quot;xml&amp;quot; &amp;apos;((test . &amp;quot;id&amp;quot;))
     (tag &amp;quot;body&amp;quot; nil
	  (tag &amp;quot;p&amp;quot; nil (xml-escape-string &amp;quot;paragraph &amp;amp; &amp;lt; 1&amp;quot;))
	  (tag &amp;quot;p&amp;quot; nil &amp;quot;paragraph 2&amp;quot;)))
&lt;/contents&gt;&lt;/src-block&gt;&lt;src-block language="emacs-lisp"&gt;&lt;contents&gt;(mapconcat &amp;apos;identity
	   (org-element-map
	       (org-element-parse-buffer)
	       &amp;apos;src-block
	     (lambda (element)
	       (tag
		&amp;apos;src-block
		`((language . ,(org-element-property :language element)))
		(tag &amp;apos;contents ()
		     (xml-escape-string
		      (org-element-property :value element))))))
	   &amp;quot;&amp;quot;)
&lt;/contents&gt;&lt;/src-block&gt;&lt;src-block language="emacs-lisp"&gt;&lt;contents&gt;(let ((xml (tag &amp;apos;root `((filename . ,(buffer-file-name))
			(indexed-on . ,(current-time-string)))
		;; map the headlines
		(mapconcat
		 &amp;apos;identity
		 (org-map-entries
		  (lambda ()
		    (let* ((tags (org-get-tags))
			   (heading-components (org-heading-components))
			   (title (nth 4 heading-components))
			   (level (nth 0 heading-components))
			   (properties (org-entry-properties))
			   (elem (org-element-at-point))
			   (bp (org-element-property :contents-begin elem))
			   (ep (org-element-property :contents-end elem))
			   (content (buffer-substring bp ep)))
		      (tag &amp;apos;heading `((level . ,level))
			   (tag &amp;apos;title () (xml-escape-string title))
			   (tag &amp;apos;tags () (mapconcat &amp;apos;identity tags &amp;quot; &amp;quot;))
			   (tag &amp;apos;properties ()
				(mapconcat
				 (lambda (x)
				   (tag &amp;apos;property `((label . (car ,x))) (cdr x)))
				 properties
				 &amp;quot;&amp;quot;))
			   (tag &amp;apos;content ()
				(format &amp;quot;%s&amp;quot; (xml-escape-string content)))))))
		 &amp;quot;&amp;quot;)

		;; map specific element types
		(tag &amp;apos;source-blocks ()
		     (mapconcat
		      &amp;apos;identity
		      (org-element-map
			  (org-element-parse-buffer)
			  &amp;apos;src-block
			(lambda (element)
			  (tag &amp;apos;src-block
			       `((language .
					   ,(org-element-property
					     :language element)))
			       (tag &amp;apos;contents ()
				    (xml-escape-string
				     (org-element-property :value element)))))) &amp;quot;&amp;quot;))

		(tag &amp;apos;tables ()
		     (mapconcat
		      &amp;apos;identity
		      (org-element-map
			  (org-element-parse-buffer)
			  &amp;apos;table
			(lambda (element)
			  (tag &amp;apos;table ()
			       (when (org-element-property :caption element)
				 (tag &amp;apos;caption ()
				(caaar (org-element-property :caption element))))
			       (xml-escape-string
				(buffer-substring
				 (org-element-property :contents-begin element)
				 (org-element-property :contents-end element))))))
		      &amp;quot;&amp;quot;))

		(tag &amp;apos;paragraphs ()
		     (mapconcat
		      &amp;apos;identity
		      (org-element-map
			  (org-element-parse-buffer)
			  &amp;apos;paragraph
			(lambda (element)
			  (tag &amp;apos;paragraph ()
			       (xml-escape-string
				(buffer-substring
				 (org-element-property :contents-begin element)
				 (org-element-property :contents-end element))))))
		      &amp;quot;&amp;quot;
		      ))
		)))
  (with-temp-file &amp;quot;org2xml.xml&amp;quot;
    (insert xml)))
&lt;/contents&gt;&lt;/src-block&gt;&lt;src-block language="emacs-lisp"&gt;&lt;contents&gt;(xml-parse-file &amp;quot;org2xml.xml&amp;quot;)
&lt;/contents&gt;&lt;/src-block&gt;
</pre>

<p>
So, finally we can map the entries to get some information about them, e.g. the tags, properties, todo state, etc&#x2026; Then we create xml representing all that information so we can have a more precise search. Instead of looking for a word, we can specify that the word be in a property for example. Then, we make xml representations of the tables, src-blocks and paragraphs.
</p>

<p>
I am going to follow the example <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/07/03/Using-swish-e-to-index-org-files-as-html/">here</a> that we worked out before on html and create a filter function that takes an org-file and spits out xml at the command line.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">:<span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">exec emacs -batch -l $0 -f main "$@"</span>
(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">org</span>)
(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">xml</span>)

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">print-tag</span> (name attrs <span style="color: #6434A3;">&amp;optional</span> closingp)
  <span style="color: #036A07;">"Print an xml tag with symbol NAME and ATTRS (a cons list of (attribute . value)).</span>
<span style="color: #036A07;">if CLOSINGP print the closing tag instead.</span>
<span style="color: #036A07;">You should use `</span><span style="color: #D0372D;">xml-escape-string</span><span style="color: #036A07;">' on text going into the attributes to avoid errors."</span>
  (format
   <span style="color: #008000;">"&lt;%s%s%s&gt;"</span>
   (<span style="color: #0000FF;">if</span> closingp <span style="color: #008000;">"/"</span> <span style="color: #008000;">""</span>)
   name
   (<span style="color: #0000FF;">if</span> (<span style="color: #0000FF;">and</span> attrs (not closingp))
       (concat
        <span style="color: #008000;">" "</span>
        (mapconcat
         (<span style="color: #0000FF;">lambda</span> (x)
           (format <span style="color: #008000;">"%s=\"%s\""</span> (car x) (cdr x)))
           attrs
           <span style="color: #008000;">" "</span>))
     <span style="color: #008000;">""</span>)))

(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">tag</span> (name attributes <span style="color: #6434A3;">&amp;rest</span> body)
  `(format <span style="color: #008000;">"%s%s%s"</span>
           (print-tag ,name ,attributes nil)
           (concat
           ,@body)
           (print-tag ,name nil t)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">main</span> ()
  (find-file (car command-line-args-left))
  (princ (<span style="color: #0000FF;">tag</span> 'root `((filename . ,(buffer-file-name))
                      (indexed-on . ,(current-time-string)))
              <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">map the headlines</span>
              (mapconcat
               'identity
               (org-map-entries
                (<span style="color: #0000FF;">lambda</span> ()
                  (<span style="color: #0000FF;">let*</span> ((tags (org-get-tags))
                         (heading-components (org-heading-components))
                         (todo (nth 2 heading-components))
                         (headline (nth 4 heading-components))
                         (thislevel (nth 0 heading-components))
                         (properties (org-entry-properties)))
                    (<span style="color: #0000FF;">tag</span> 'heading `((level . ,thislevel))
                         (<span style="color: #0000FF;">tag</span> 'headline () (xml-escape-string headline))
                         (<span style="color: #0000FF;">tag</span> 'tags () (mapconcat 'identity tags <span style="color: #008000;">" "</span>))
                         (<span style="color: #0000FF;">when</span> todo
                           (<span style="color: #0000FF;">tag</span> 'todo () todo))
                         (<span style="color: #0000FF;">tag</span> 'properties ()
                              (mapconcat
                               (<span style="color: #0000FF;">lambda</span> (x)
                                 (<span style="color: #0000FF;">tag</span> 'property `((name . ,(xml-escape-string (car x))))
                                      (xml-escape-string (cdr x))))
                               properties
                               <span style="color: #008000;">""</span>))))))
               <span style="color: #008000;">""</span>)

              <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">get file keywords, TITLE, authors, etc...</span>
              (<span style="color: #0000FF;">tag</span> 'file-keywords ()
                   (mapconcat 'identity
                              (org-element-map (org-element-parse-buffer 'element) 'keyword
                                (<span style="color: #0000FF;">lambda</span> (keyword)
                                  (<span style="color: #0000FF;">tag</span> (xml-escape-string (org-element-property <span style="color: #006FE0;">:key</span> keyword)) ()
                                       (xml-escape-string (org-element-property <span style="color: #006FE0;">:value</span> keyword)))))
                              <span style="color: #008000;">""</span>))

              <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">map specific element types</span>
              (<span style="color: #0000FF;">tag</span> 'source-blocks ()
                   (mapconcat
                    'identity
                    (org-element-map
                        (org-element-parse-buffer)
                        'src-block
                      (<span style="color: #0000FF;">lambda</span> (element)
                        (<span style="color: #0000FF;">tag</span> 'src-block
                             `((language .
                                         ,(org-element-property
                                           <span style="color: #006FE0;">:language</span> element)))
                             (<span style="color: #0000FF;">tag</span> 'contents ()
                                  (xml-escape-string
                                   (org-element-property <span style="color: #006FE0;">:value</span> element)))))) <span style="color: #008000;">""</span>))

              (<span style="color: #0000FF;">tag</span> 'tables ()
                   (mapconcat
                    'identity
                    (org-element-map
                        (org-element-parse-buffer)
                        'table
                      (<span style="color: #0000FF;">lambda</span> (element)
                        (<span style="color: #0000FF;">tag</span> 'table ()
                             (<span style="color: #0000FF;">when</span> (org-element-property <span style="color: #006FE0;">:caption</span> element)
                               (<span style="color: #0000FF;">tag</span> 'caption ()
                                    (format
                                     <span style="color: #008000;">"%s"</span>
                                     (org-element-property
                                      <span style="color: #006FE0;">:caption</span> element))))
                             (xml-escape-string
                              (buffer-substring
                               (org-element-property <span style="color: #006FE0;">:contents-begin</span> element)
                               (org-element-property <span style="color: #006FE0;">:contents-end</span> element))))))
                    <span style="color: #008000;">""</span>))

              (<span style="color: #0000FF;">tag</span> 'paragraphs ()
                   (mapconcat
                    'identity
                    (org-element-map
                        (org-element-parse-buffer)
                        'paragraph
                      (<span style="color: #0000FF;">lambda</span> (element)
                        (<span style="color: #0000FF;">tag</span> 'paragraph ()
                             (xml-escape-string
                              (buffer-substring
                               (org-element-property <span style="color: #006FE0;">:contents-begin</span> element)
                               (org-element-property <span style="color: #006FE0;">:contents-end</span> element))))))
                    <span style="color: #008000;">""</span>
                    )))))
</pre>
</div>

<p>
We could do more, e.g. links, or images, but this is pretty good for now. Now, let's configure a swish indexer. We instruct swish-e to use some metanames, and attributes so we can search on them later.
</p>

<div class="org-src-container">

<pre class="src src-text"># Example configuration file

# Tell Swish-e what to directories to index
IndexDir /Users/jkitchin/blogofile-jkitchin.github.com/_site

# where to save the index
IndexFile /Users/jkitchin/blogofile-jkitchin.github.com/_blog/index-org2xml.swish-e

# What to index
IndexOnly .org

# Tell Swish-e that .txt files are to use the HTML parser.
IndexContents XML* .org

FileFilter .org /Users/jkitchin/blogofile-jkitchin.github.com/_blog/org2xml.el

# index all tags for searching
UndefinedMetaTags auto
UndefinedXMLAttributes auto
</pre>
</div>

<p>
And now, run the index command. I did this at the command line. There might be some problems with the script as there were some warnings about non-zero exits, but there was only a few so we ignore them for now.
</p>

<div class="org-src-container">

<pre class="src src-sh">swish-e -c swish-org2xml.conf
</pre>
</div>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Examples of searching for org-files</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Files with words in the filename</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Here we look for filenames with the word "Extracting" in them.
</p>

<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w root.filename=Extracting
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: root.filename=Extracting
# Removed stopwords:
# Number of hits: 2
# Search time: 0.000 seconds
# Run time: 0.007 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2014/02/19/Extracting-bibtex-file-from-an-org-buffer.org "Extracting-bibtex-file-from-an-org-buffer.org" 6094
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/media/2014-02-19-Extracting-bibtex-file-from-an-org-buffer/notes.org "notes.org" 195515
.
</pre>

<p>
Or, thanks to the date being in the path, we can find by year, How about July of 2012?
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w root.filename=<span style="color: #008000;">"(2012/07)"</span>
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: root.filename=(2012/07)
# Removed stopwords:
# Number of hits: 1
# Search time: 0.000 seconds
# Run time: 0.007 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2012/07/15/Professor-Kitchin-was-awarded-the-Presidential-Early-Career-Award-for-Scientists-and-Engineers-(PECASE).org "Professor-Kitchin-was-awarded-the-Presidential-Early-Career-Award-for-Scientists-and-Engineers-(PECASE).org" 311
.
</pre>

<p>
Interesting we have to use the parentheses here.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> <span class="done DONE">DONE</span> Files with headlines containing a word</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Now, lets find documents with "Compiled" in a heading title with level=2
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w heading.level=2 <span style="color: #BA36A5;">title</span>=Compiled -m5
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: heading.level=2 title=Compiled
# Removed stopwords:
# Number of hits: 1
# Search time: 0.000 seconds
# Run time: 0.007 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/media/2014-07-12-Org-mode-is-awesome/why-org-mode.org "why-org-mode.org" 13522
.
</pre>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Headlines marked TODO</h3>
<div class="outline-text-3" id="text-1-3">
<p>
We can find documents with headlines marked TODO:
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e  -w <span style="color: #008000;">"todo=TODO"</span> -m 5
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: todo=TODO
# Removed stopwords:
# Number of hits: 12
# Search time: 0.000 seconds
# Run time: 0.008 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/media/2014-01-27-Clocking-your-time-in-org-mode/blog.org "blog.org" 134160
624 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2014/02/16/A-dynamic-snippet-for-a-task-due-7-days-from-now.org "A-dynamic-snippet-for-a-task-due-7-days-from-now.org" 2587
425 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2014/02/16/END.org "END.org" 1531
269 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2015/02/01/Handling-multiple-selections-in-helm.org "Handling-multiple-selections-in-helm.org" 3290
269 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2015/01/30/More-adventures-in-helm---more-than-one-action.org "More-adventures-in-helm---more-than-one-action.org" 3236
.
</pre>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> For a table</h3>
<div class="outline-text-3" id="text-1-4">
<p>
so2-capacity-1
</p>

<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w <span style="color: #BA36A5;">table</span>=<span style="color: #008000;">"energy"</span>
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: table=energy
# Removed stopwords:
# Number of hits: 2
# Search time: 0.000 seconds
# Run time: 0.007 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2014/08/21/Using-org-entries-like-a-database.org "Using-org-entries-like-a-database.org" 53035
633 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/07/04/Estimating-uncertainties-in-equations-of-state.org "Estimating-uncertainties-in-equations-of-state.org" 3117
.
</pre>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Tagged headlines</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Find entries with a "slide" tag.
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w <span style="color: #008000;">"tags=slide"</span>
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: tags=slide
# Removed stopwords:
# Number of hits: 1
# Search time: 0.000 seconds
# Run time: 0.009 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/media/2014-07-12-Org-mode-is-awesome/why-org-mode.org "why-org-mode.org" 13522
.
</pre>

<p>
Evidently there is one file where I talk about slides in org-show.
</p>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Headlines with a property</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Here I find documents with headlines that have thermodynamics in the property "categories".
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w <span style="color: #008000;">"property.label=categories property=thermodynamics"</span>
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: property.label=categories property=thermodynamics
# Removed stopwords:
# Number of hits: 10
# Search time: 0.000 seconds
# Run time: 0.009 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/02/01/Water-gas-shift-equilibria-via-the-NIST-Webbook.org "Water-gas-shift-equilibria-via-the-NIST-Webbook.org" 10789
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/03/01/Gibbs-energy-minimization-and-the-NIST-webbook.org "Gibbs-energy-minimization-and-the-NIST-webbook.org" 5441
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/03/01/Finding-equilibrium-composition-by-direct-minimization-of-Gibbs-free-energy-on-mole-numbers.org "Finding-equilibrium-composition-by-direct-minimization-of-Gibbs-free-energy-on-mole-numbers.org" 6155
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/02/27/Reading-parameter-database-text-files-in-python.org "Reading-parameter-database-text-files-in-python.org" 3947
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/02/18/The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition.org "The-Gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition.org" 8230
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/02/18/Calculating-a-bubble-point-pressure-of-a-mixture.org "Calculating-a-bubble-point-pressure-of-a-mixture.org" 3203
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/02/15/The-equal-area-method-for-the-van-der-Waals-equation.org "The-equal-area-method-for-the-van-der-Waals-equation.org" 5737
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/02/12/Using-constrained-optimization-to-find-the-amount-of-each-phase-present.org "Using-constrained-optimization-to-find-the-amount-of-each-phase-present.org" 5210
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/02/05/Constrained-minimization-to-find-equilibrium-compositions.org "Constrained-minimization-to-find-equilibrium-compositions.org" 5666
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2014/09/23/Generating-an-atomic-stoichiometric-matrix.org "Generating-an-atomic-stoichiometric-matrix.org" 3487
.
</pre>

<p>
That seems about right, according to <a href="http://kitchingroup.cheme.cmu.edu/categories.html">http://kitchingroup.cheme.cmu.edu/categories.html</a> there are 9 documents. I am not sure why they don't totally agree, but I can live with it.
</p>

<p>
Here are documents containing headlines with the property "TOTAL_ENERGY"
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w property.label=TOTAL_ENERGY
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: property.label=TOTAL_ENERGY
# Removed stopwords:
# Number of hits: 1
# Search time: 0.000 seconds
# Run time: 0.008 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2014/08/21/Using-org-entries-like-a-database.org "Using-org-entries-like-a-database.org" 53035
.
</pre>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Documents with a Python source block containing a word</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Find org files with diffusion in a python source block.
</p>
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w src-block.language=python -w src-block=diffusion
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: src-block.language=python src-block=diffusion
# Removed stopwords:
# Number of hits: 1
# Search time: 0.000 seconds
# Run time: 0.011 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2013/04/02/Transient-diffusion---partial-differential-equations.org "Transient-diffusion---partial-differential-equations.org" 3660
.
</pre>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> An org-file with a UUID</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w  <span style="color: #BA36A5;">property</span>=<span style="color: #008000;">"(38FCCF3D-7FC5-49BF-BB77-486BBAA17CD9)"</span>
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: property=(38FCCF3D-7FC5-49BF-BB77-486BBAA17CD9)
# Removed stopwords:
# Number of hits: 1
# Search time: 0.000 seconds
# Run time: 0.007 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/org/2014/11/23/Machine-gradable-quizzes-in-emacs+org-modex.org "Machine-gradable-quizzes-in-emacs+org-modex.org" 5743
.
</pre>

<p>
Interesting, again the parentheses are necessary to find a match. I think because of the dashes. The next example is similar, but finds an entry with that bibtex key in a CUSTOM_ID property.
</p>

<div class="org-src-container">

<pre class="src src-sh">swish-e -f index-org2xml.swish-e -w  <span style="color: #BA36A5;">property</span>=<span style="color: #008000;">"(mantina-2008-first-princ)"</span>
</pre>
</div>

<pre class="example">
# SWISH format: 2.4.7
# Search words: property=(mantina-2008-first-princ)
# Removed stopwords:
# Number of hits: 1
# Search time: 0.000 seconds
# Run time: 0.010 seconds
1000 /Users/jkitchin/blogofile-jkitchin.github.com/_site/media/2014-02-19-Extracting-bibtex-file-from-an-org-buffer/notes.org "notes.org" 195515
.
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Summary</h2>
<div class="outline-text-2" id="text-2">
<p>
This is pretty cool. There are still some bugs to work out in the indexing filter I think, but this demonstrates you can index org-files, and have pretty refined searches to find your files. There is still some thinking to do on how to schedule an incremental indexing, and whether we need more or better metanames. The indexing is not fast, but that is probably because I am running this through a FileFilter, rather than the -s prog option in swish-e. This is super promising to me though. Imagine building an agenda from files found with TODO headlines in them; a global todo list! Or, grabbing contacts from wherever they are.  No more losing files you have not used in a while. Find all documents containing a citation. With some extra work, you could index links, citations, <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/07/02/Pyparsing-meets-Emacs-to-find-chemical-formulas/">chemical formulas</a> , or other types of identifiable content.
</p>

<p>
The logical conclusion of this work might be an ox-swish-e-xml export engine to render the org-file into xml, rather than the script I used here. It would be really great to get some refined output, e.g. rather than just get matching documents, get location information so you could open the document to the matching element. That might be out of reach for swish-e, but could be in reach for other programs like Sphinx that are more integrated with a database. There is a very interesting project here: <a href="https://github.com/wvxvw/sphinx-mode">https://github.com/wvxvw/sphinx-mode</a> to integrate org-mode with the Sphinx search (<a href="http://sphinxsearch.com">http://sphinxsearch.com</a> ) engine.
</p>
</div>
</div>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/07/04/An-xml-representation-of-an-org-document-for-indexing-with-swish-e.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://jkitchin.github.io/blog/2015/07/04/An-xml-representation-of-an-org-document-for-indexing-with-swish-e";
</script>
<script type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/embed.js"></script>
<noscript><a href="http://kitchinresearchgroup.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
    <li><a href="http://enthought.com">Enthought Python</a></li>
    <li><a href="/pycse">Pycse</a></li>
    <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2016/02/15/An-org-mode-filter-for-blogofile/">An org-mode filter for blogofile</a></li>
      <li><a href="/blog/2016/02/09/Calling-remote-code-blocks-in-org-mode/">Calling remote code-blocks in org-mode</a></li>
      <li><a href="/blog/2016/02/08/Interactive-figures-in-blog-posts-with-mpld3/">Interactive figures in blog posts with mpld3</a></li>
      <li><a href="/blog/2016/02/07/Interactive-Bokeh-plots-in-HTML/">Interactive Bokeh plots in HTML</a></li>
      <li><a href="/blog/2016/02/06/Interactive-plots-in-HTML-with-Plotly/">Interactive plots in HTML with Plotly</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2016
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



