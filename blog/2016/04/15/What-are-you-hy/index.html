

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What are you hy?</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            






<article>
  <div class="blog_post">
    <header>
      <div id="What-are-you-hy"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/04/15/What-are-you-hy/" rel="bookmark" title="Permanent Link to What are you hy?">What are you hy?</a></h2>
      <p><small><span class="blog_post_date">Posted April 15, 2016 at 08:46 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/hylang/'>hylang</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/04/15/What-are-you-hy#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated April 15, 2016 at 09:49 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Hy lets us do things that either aren't possible, or definitely aren't easy in Python. You may have drank the Python Koolaid  and don't think those things are necessary, but we have Hy-C, and we took a sip of that just now, so let's see what we can do.
</p>


<div class="figure">
<p><img src="/media/2016-04-15-What-are-you-hy%3F/hyss.png">
</p>
</div>

<p>
We can have functions that are punctuation!
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">!</span> [arg] (<span style="color: #006FE0;">not</span> arg))

(<span style="color: #006FE0;">print</span> (! <span style="color: #D0372D;">True</span>))
(<span style="color: #006FE0;">print</span> (! <span style="color: #D0372D;">False</span>))
</pre>
</div>

<pre class="example">
False
True
</pre>

<p>
How about that function that just returns something truthy? Shouldn't those end in a question-mark? They can and sometimes do. Not a problem when you are hy.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">string?</span> [s]
 (isinstance s str))

(<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">string?</span> 4))
(<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">string?</span> <span style="color: #008000;">"4"</span>))        <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">haha. strings in hy like "4" are unicode, not a str.</span>
(<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">string?</span> (str <span style="color: #008000;">"4"</span>)))
</pre>
</div>

<pre class="example">
False
False
True
False
</pre>

<p>
Isn't that better than is_a_string?
</p>

<p>
Underscores. Pfffft&#x2026;. Dashes in names are awesome. Unless you hate your pinky and are shifty.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defn</span> <span style="color: #006699;">100-yard-</span> [x]
  <span style="color: #008000;">"Funniest function name ever. Don't do this at home."</span>
  (.format <span style="color: #008000;">"You ran that in {} seconds! New World Record!"</span> 9.42))

(<span style="color: #006FE0;">print</span> (100-yard- 2))
</pre>
</div>

<pre class="example">
You ran that in 9.42 seconds! New World Record!
</pre>

<p>
Why not build code with code? Here is a fun way to add up only the even numbers in a list. wHy? wHy?? Because we can, and it leads to other interesting opportunities!
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">import</span> <span style="color: #006699;">hy</span>)
(<span style="color: #0000FF;">let</span> [a [1 2 3 4 5 6]
      code '()]
  (<span style="color: #006FE0;">+=</span> code `(<span style="color: #006FE0;">+</span>))  <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">add an operator</span>
  (<span style="color: #0000FF;">for</span> [n a]
    (<span style="color: #0000FF;">when</span> (<span style="color: #006FE0;">even?</span> n)
      (<span style="color: #006FE0;">+=</span> code `(~(hy.models.integer.HyInteger n)))))
  (<span style="color: #006FE0;">print</span> code)

  (<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">eval</span> code)))
</pre>
</div>

<pre class="example">
(u'+' 2L 4L 6L)
12
</pre>

<p>
Ok, that isn't so beautiful, but it shows we can generate code and then execute it. We could also do that like we do in python where you build up the list of even numbers, and then sum them. It's the beginning of macros.
</p>

<p>
But I can't live without objects! How else can you encapsulate data? Let's see how and give you some closure to get on with programming. (yea, the puns get worse ;).
</p>

<p>
This next example illustrates a closure which we can use to encapsulate data. We use let to create a context with the variable i defined. i doesn't exist outside the context, but the lambda function created inside it retains access to the variable i.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #006FE0;">def</span> counter
  (<span style="color: #0000FF;">let</span> [i [0]]
    (<span style="color: #0000FF;">lambda</span> [] (<span style="color: #006FE0;">assoc</span> i 0 (<span style="color: #006FE0;">+</span> 1 (<span style="color: #006FE0;">get</span> i 0))) (<span style="color: #006FE0;">get</span> i 0))))

(<span style="color: #006FE0;">print</span> (counter))
(<span style="color: #006FE0;">print</span> (counter))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">i is not a global var!</span>
(<span style="color: #0000FF;">try</span>
 (<span style="color: #006FE0;">print</span> i)
 (<span style="color: #0000FF;">except</span> [e NameError] (<span style="color: #006FE0;">print</span> <span style="color: #008000;">"i is not defined here!"</span>)))
</pre>
</div>

<pre class="example">
1
2
i is not defined here!
</pre>

<p>
Yes, the use of a list to store the counter is wonky; it is because of namespaces in Python. We get around the issue with a list here, that stores the data. Thanks Paul Tagliamonte (the resident Hypster) for the tip. Apparently Python scoping doesn't work enough here, but the list approach does, as does creating class instances to store the counter. Hylarious.
</p>

<p>
Let's check out a macro. First, here is a code example. A common pattern is to save a value in a let statement temporarily, so we can reuse it in other expressions.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">let</span> [x (<span style="color: #006FE0;">&gt;</span> 2 0)]
  (<span style="color: #0000FF;">if</span> x
    (<span style="color: #006FE0;">print</span> (.format <span style="color: #008000;">"{}"</span> x))
   (<span style="color: #006FE0;">print</span> (.format <span style="color: #008000;">"{}"</span> x))))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">a one line version for comparison</span>
(<span style="color: #0000FF;">let</span> [x (<span style="color: #006FE0;">&lt;</span> 2 0)] (<span style="color: #0000FF;">if</span> x (<span style="color: #006FE0;">print</span> (.format <span style="color: #008000;">"{}"</span> x)) (<span style="color: #006FE0;">print</span> (.format <span style="color: #008000;">"{}"</span> x))))
</pre>
</div>

<pre class="example">
True
False
</pre>

<p>
That example has a lot of parentheses, and it might nice if there were fewer parentheses. There is a macro form to deal with this (it is actually defined in the hylang contrib directory, but it is short so we look at it here). This is called an anaphoric macro, because it captures a variable called "it" for reuse later in the macro. With the aif macro we can eliminate the use of the let statement in production code, eliminating a set of parentheses, and also the temporary variable.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">aif</span> [test-form then-form <span style="color: #6434A3;">&amp;optional</span> else-form]
  `(<span style="color: #0000FF;">let</span> [it ~test-form]
     (<span style="color: #0000FF;">if</span> it ~then-form ~else-form)))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">In this code, it is bound to the first form value.</span>
(<span style="color: #006FE0;">print</span> (aif (<span style="color: #006FE0;">&gt;</span> 2 0) (.format <span style="color: #008000;">"{}"</span> it) (.format <span style="color: #008000;">"{}"</span> it)))
(<span style="color: #006FE0;">print</span> (aif (<span style="color: #006FE0;">&lt;</span> 2 0) (.format <span style="color: #008000;">"{}"</span> it) (.format <span style="color: #008000;">"{}"</span> it)))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">How does it work? By expanding to code.</span>
(<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">macroexpand</span> '(aif (<span style="color: #006FE0;">&lt;</span> 2 0) (.format <span style="color: #008000;">"{}"</span> it) (.format <span style="color: #008000;">"{}"</span> it))))
</pre>
</div>

<pre class="example">
True
False
((u'fn' [] (u'setv' u'it' (u'&lt;' 2L 0L)) (u'if' u'it' (u'.format' u'{}' u'it') (u'.format' u'{}' u'it'))))
</pre>

<p>
Here is how you would do this in a regular program if you wanted to use the contrib library in hy.
</p>
<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">require</span> <span style="color: #006699;">hy.contrib.anaphoric</span>)

(<span style="color: #006FE0;">print</span> (ap-if (<span style="color: #006FE0;">&gt;</span> 2 0) (.format <span style="color: #008000;">"{}"</span> it) (.format <span style="color: #008000;">"{}"</span> it)))
</pre>
</div>

<pre class="example">
True
</pre>

<p>
Macros are useful for changing syntax and simplifying code. That works because the code in the macro is like data that can be manipulated and selectively evaluated. Here is an example of manipulating code like that. We start with an expression to add two numbers, and then modify it to be a multiplication.
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #006FE0;">setv</span> code '(<span style="color: #006FE0;">+</span> 5 6))
(<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">eval</span> code))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">change + to *</span>
(<span style="color: #006FE0;">assoc</span> code 0 '*)
(<span style="color: #006FE0;">print</span> code)
(<span style="color: #006FE0;">print</span> (<span style="color: #006FE0;">eval</span> code))
</pre>
</div>

<pre class="example">
11
(u'*' 5L 6L)
30
</pre>

<p>
That is an indication that we can do some very interesting things with Lisp! Let's be fair and show this can also be done in Python. We just have to parse out the AST, and then we can manipulate it and get back to code. It isn't pretty, but doable.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> ast

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">parse the statement</span>
<span style="color: #BA36A5;">p</span> = ast.parse(<span style="color: #008000;">"print 5 + 6"</span>)

<span style="color: #0000FF;">exec</span> <span style="color: #006FE0;">compile</span>(p, <span style="color: #008000;">"&lt;string&gt;"</span>, <span style="color: #008000;">"exec"</span>)
<span style="color: #0000FF;">print</span> ast.dump(p)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Change + to *</span>
p.body[0].values[0]<span style="color: #BA36A5;">.op</span> = ast.Mult()

<span style="color: #0000FF;">print</span>
<span style="color: #0000FF;">exec</span> <span style="color: #006FE0;">compile</span>(p, <span style="color: #008000;">"&lt;string&gt;"</span>, <span style="color: #008000;">"exec"</span>)
<span style="color: #0000FF;">print</span> ast.dump(p)
</pre>
</div>

<pre class="example">
11
Module(body=[Print(dest=None, values=[BinOp(left=Num(n=5), op=Add(), right=Num(n=6))], nl=True)])

30
Module(body=[Print(dest=None, values=[BinOp(left=Num(n=5), op=Mult(), right=Num(n=6))], nl=True)])
</pre>

<p>
That is not as clear as what we did in hy! Why? Because we had to transform the Python to AST, and manipulate it. In Lisp, the code is already in the abstract tree form, and we manipulate it more directly. It is easier to reason about.
</p>

<p>
I bet you didn't think we could use a hy program <i>for more than one thing</i>. Sure we may want to run it, but maybe we would like a different representation of the program than the code too.  Here we define two macros that both take a program as input. One simply evaluates the program, so we can use it. The other takes the program, and outputs a LaTeX representation of it. It only converts a division expression correctly (and only if all the arguments are numbers and not other expressions), but it illustrates that we can use a program as data, and do different things with it!
</p>

<div class="org-src-container">

<pre class="src src-hy">(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">run</span> [body] `(<span style="color: #006FE0;">eval</span> ~body))

(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">latex</span> [body]
  `(<span style="color: #0000FF;">cond</span>
   [(<span style="color: #006FE0;">=</span> (<span style="color: #006FE0;">car</span> ~body) '/)
    (.format <span style="color: #008000;">"\(\\frac{{{0}}} {{{1}}}\)"</span>
            (<span style="color: #006FE0;">get</span> ~body 1)
            (.join <span style="color: #008000;">" \\cdot "</span> (<span style="color: #006FE0;">list-comp</span> (str x) [x (<span style="color: #006FE0;">cut</span> ~body 2)])))]
   [<span style="color: #D0372D;">true</span> (<span style="color: #0000FF;">raise</span> (Exception <span style="color: #008000;">"Unsupported program"</span>))]))

(<span style="color: #006FE0;">setv</span> code '(<span style="color: #006FE0;">/</span> 1 2 4.0))

(<span style="color: #006FE0;">print</span> (run code))
(<span style="color: #006FE0;">print</span> (latex code))
</pre>
</div>

<pre class="example">
0.125
\(\frac{1} {2 \cdot 4.0}\)
</pre>

<p>
It is possible to do something kind of like this in Python. In <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/05/16/Python-data-structures-to-lisp/">this post</a> I put a lisp function onto the base classes of objects so you could transform Python objects to lisp representations.
</p>

<p>
Well, that is probably enough Hy-C for the day. I am still playing around to figure out what kinds of things can we do with Hy that aren't easy or feasible in Python. These are a few of my favorite examples! If you have other cool things you do, put them in a comment hyre!</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/04/15/What-are-you-hy?.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>


    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://jkitchin.github.io/blog/2016/04/15/What-are-you-hy";
</script>
<script type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/embed.js"></script>
<noscript><a href="http://kitchinresearchgroup.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/01/03/New-publication-in-Molecular-Simulation/">New publication in Molecular Simulation</a></li>
      <li><a href="/blog/2017/12/31/2017-in-a-nutshell-for-the-Kitchin-Research-group/">2017 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2017/11/29/Solving-an-eigenvalue-differential-equation-with-a-neural-network/">Solving an eigenvalue differential equation with a neural network</a></li>
      <li><a href="/blog/2017/11/28/Solving-ODEs-with-a-neural-network-and-autograd/">Solving ODEs with a neural network and autograd</a></li>
      <li><a href="/blog/2017/11/27/Solving-BVPs-with-a-neural-network-and-autograd/">Solving BVPs with a neural network and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



