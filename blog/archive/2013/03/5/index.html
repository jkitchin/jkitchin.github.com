

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Symbolic-math-in-python"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/01/Symbolic-math-in-python/" rel="bookmark" title="Permanent Link to Symbolic math in python">Symbolic math in python</a></h2>
      <p><small><span class="blog_post_date">Posted March 01, 2013 at 07:07 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a>, <a href='/blog/category/symbolic/'>symbolic</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated March 03, 2013 at 12:21 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
 <a href="http://matlab.cheme.cmu.edu/2011/08/10/symbolic-math-in-matlab/" >Matlab post</a>
Python has capability to do symbolic math through the sympy package. 
</p>
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Solve the quadratic equation</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> sympy <span style="color: #8b0000;">import</span> solve, symbols, pprint

a,b,c,x = symbols(<span style="color: #228b22;">'a,b,c,x'</span>)

f = a*x**2 + b*x + c

solution = solve(f, x)
<span style="color: #8b0000;">print</span> solution
pprint(solution)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [(-b + (-4*a*c + b**2)**(1/2))/(2*a), -(b + (-4*a*c + b**2)**(1/2))/(2*a)]
_____________   /       _____________\ 
        /           2    |      /           2 | 
 -b + \/  -4*a*c + b    -\b + \/  -4*a*c + b  / 
[---------------------, -----------------------]
          2*a                     2*a
</pre>

<p>
The solution you should recognize in the form of \(\frac{b \pm \sqrt{b^2 - 4 a c}}{2 a}\) although python does not print it this nicely!
</p>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> differentiation</h2>
<div class="outline-text-2" id="text-2">
<p>
you might find this helpful!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> sympy <span style="color: #8b0000;">import</span> diff

<span style="color: #8b0000;">print</span> diff(f, x)
<span style="color: #8b0000;">print</span> diff(f, x, 2)

<span style="color: #8b0000;">print</span> diff(f, a)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; 2*a*x + b
2*a
&gt;&gt;&gt; x**2
</pre>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> integration</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> sympy <span style="color: #8b0000;">import</span> integrate

<span style="color: #8b0000;">print</span> integrate(f, x)          <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">indefinite integral</span>
<span style="color: #8b0000;">print</span> integrate(f, (x, 0, 1))  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">definite integral from x=0..1</span>
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; a*x**3/3 + b*x**2/2 + c*x
a/3 + b/2 + c
</pre>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Analytically solve a simple ODE</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> sympy <span style="color: #8b0000;">import</span> Function, Symbol, dsolve
f = Function(<span style="color: #228b22;">'f'</span>)
x = Symbol(<span style="color: #228b22;">'x'</span>)
fprime = f(x).diff(x) - f(x) <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">f' = f(x)</span>

y = dsolve(fprime, f(x))

<span style="color: #8b0000;">print</span> y
<span style="color: #8b0000;">print</span> y.subs(x,4)
<span style="color: #8b0000;">print</span> [y.subs(x, X) <span style="color: #8b0000;">for</span> X <span style="color: #8b0000;">in</span> [0, 0.5, 1]] <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">multiple values</span>
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; f(x) == exp(C1 + x)
f(4) == exp(C1 + 4)
[f(0) == exp(C1), f(0.5) == exp(C1 + 0.5), f(1) == exp(C1 + 1)]
</pre>

<p>
It is not clear you can solve the initial value problem to get C1.
</p>

<p>
The symbolic math in sympy is pretty good. It is not up to the capability of Maple or Mathematica, (but neither is Matlab) but it continues to be developed, and could be helpful in some situations.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/01/Symbolic-math-in-python.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/03/01/Symbolic-math-in-python">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Method-of-continuity-for-solving-nonlinear-equations-Part-II"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/01/Method-of-continuity-for-solving-nonlinear-equations-Part-II/" rel="bookmark" title="Permanent Link to Method of continuity for solving nonlinear equations - Part II">Method of continuity for solving nonlinear equations - Part II</a></h2>
      <p><small><span class="blog_post_date">Posted March 01, 2013 at 06:17 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/nonlinear-algebra/'>nonlinear algebra</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated March 03, 2013 at 12:22 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/11/02/method-of-continuity-for-solving-nonlinear-equations-part-ii-2/" >Matlab post</a>
Yesterday in Post 1324 we looked at a way to solve nonlinear equations that takes away some of the burden of initial guess generation. The idea was to reformulate the equations with a new variable \(\lambda\), so that at \(\lambda=0\) we have a simpler problem we know how to solve, and at \(\lambda=1\) we have the original set of equations. Then, we derive a set of ODEs on how the solution changes with \(\lambda\), and solve them.
</p>

<p>
Today we look at a simpler example and explain a little more about what is going on. Consider the equation: \(f(x) = x^2 - 5x + 6 = 0\), which has two roots, \(x=2\) and \(x=3\). We will use the method of continuity to solve this equation to illustrate a few ideas. First, we introduce a new variable \(\lambda\) as: \(f(x; \lambda) = 0\). For example, we could write \(f(x;\lambda) = \lambda x^2 - 5x + 6 = 0\). Now, when \(\lambda=0\), we hve the simpler equation \(- 5x + 6 = 0\), with the solution \(x=6/5\). The question now is, how does \(x\) change as \(\lambda\) changes? We get that from the total derivative of how \(f(x,\lambda)\) changes with \(\lambda\). The total derivative is:
</p>

<p>
$$\frac{df}{d\lambda} = \frac{\partial f}{\partial \lambda} + \frac{\partial f}{\partial x}\frac{\partial x}{\partial \lambda}=0$$
</p>

<p>
We can calculate two of those quantities: \(\frac{\partial f}{\partial \lambda}\) and \(\frac{\partial f}{\partial x}\) analytically from our equation and solve for \(\frac{\partial x}{\partial \lambda}\) as
</p>

<p>
$$ \frac{\partial x}{\partial \lambda} = -\frac{\partial f}{\partial \lambda}/\frac{\partial f}{\partial x}$$
</p>

<p>
That defines an ordinary differential equation that we can solve by integrating from \(\lambda=0\) where we know the solution to \(\lambda=1\) which is the solution to the real problem. For this problem: \(\frac{\partial f}{\partial \lambda}=x^2\) and \(\frac{\partial f}{\partial x}=-5 + 2\lambda x\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">dxdL</span>(x, Lambda):
    <span style="color: #8b0000;">return</span> -x**2 / (-5.0 + 2 * Lambda * x)

x0 = 6.0/5.0
Lspan = np.linspace(0, 1)
x = odeint(dxdL, x0, Lspan)

plt.plot(Lspan, x)
plt.xlabel(<span style="color: #228b22;">'$\lambda$'</span>)
plt.ylabel(<span style="color: #228b22;">'x'</span>)
plt.savefig(<span style="color: #228b22;">'images/nonlin-contin-II-1.png'</span>)
</pre>
</div>

<p><img src="/img/./images/nonlin-contin-II-1.png"><p>

<p>
We found one solution at x=2. What about the other solution? To get that we have to introduce \(\lambda\) into the equations in another way. We could try: \(f(x;\lambda) = x^2 + \lambda(-5x + 6)\), but this leads to an ODE that is singular at the initial starting point. Another approach is \(f(x;\lambda) = x^2 + 6 + \lambda(-5x)\), but now the solution at \(\lambda=0\) is imaginary, and we do not have a way to integrate that! What we can do instead is add and subtract a number like this: \(f(x;\lambda) = x^2 - 4 + \lambda(-5x + 6 + 4)\). Now at \(\lambda=0\), we have a simple equation with roots at \(\pm 2\), and we already know that \(x=2\) is a solution. So, we create our ODE on \(dx/d\lambda\) with initial condition \(x(0) = -2\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">dxdL</span>(x, Lambda):
    <span style="color: #8b0000;">return</span> (5 * x - 10) / (2 * x - 5 * Lambda)

x0 = -2
Lspan = np.linspace(0, 1)
x = odeint(dxdL, x0, Lspan)

plt.plot(Lspan, x)
plt.xlabel(<span style="color: #228b22;">'$\lambda$'</span>)
plt.ylabel(<span style="color: #228b22;">'x'</span>)
plt.savefig(<span style="color: #228b22;">'images/nonlin-contin-II-2.png'</span>)
</pre>
</div>

<p><img src="/img/./images/nonlin-contin-II-2.png"><p>

<p>
Now we have the other solution. Note if you choose the other root, \(x=2\), you find that 2 is a root, and learn nothing new. You could choose other values to add, e.g., if you chose to add and subtract 16, then you would find that one starting point leads to one root, and the other starting point leads to the other root. This method does not solve all problems associated with nonlinear root solving, namely, how many roots are there, and which one is &ldquo;best&rdquo; or physically reasonable? But it does give a way to solve an equation where you have no idea what an initial guess should be. You can see, however, that just like you can get different answers from different initial guesses, here you can get different answers by setting up the equations differently.</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/01/Method-of-continuity-for-solving-nonlinear-equations---Part-II.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/03/01/Method-of-continuity-for-solving-nonlinear-equations-Part-II">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Determining-linear-independence-of-a-set-of-vectors"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/01/Determining-linear-independence-of-a-set-of-vectors/" rel="bookmark" title="Permanent Link to Determining linear independence of a set of vectors">Determining linear independence of a set of vectors</a></h2>
      <p><small><span class="blog_post_date">Posted March 01, 2013 at 04:44 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/linear-algebra/'>linear algebra</a></span> | tags: <a href='/blog/tag/reaction-engineering/'>reaction engineering</a>
      <p><small><span class="blog_post_date">Updated May 05, 2013 at 02:10 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
 <a href="http://matlab.cheme.cmu.edu/2011/08/02/determining-linear-independence-of-a-set-of-vectors/" >Matlab post</a>
Occasionally we have a set of vectors and we need to determine whether the vectors are linearly independent of each other. This may be necessary to determine if the vectors form a basis, or to determine how many independent equations there are, or to determine how many independent reactions there are.
</p>

<p>
Reference: Kreysig, Advanced Engineering Mathematics, sec. 7.4
</p>

<p>
Matlab provides a rank command which gives you the number of singular values greater than some tolerance. The numpy.rank function, unfortunately, does not do that. It returns the number of dimensions in the array. We will just compute the rank from singular value decomposition.
</p>

<p>
The default tolerance used in Matlab is max(size(A))*eps(norm(A)). Let us break that down. eps(norm(A)) is the positive distance from abs(X) to the next larger in magnitude floating point number of the same precision as X. Basically, the smallest significant number. We multiply that by the size of A, and take the largest number. We have to use some judgment in what the tolerance is, and what &ldquo;zero&rdquo; means.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
v1 = [6, 0, 3, 1, 4, 2];
v2 = [0, -1, 2, 7, 0, 5];
v3 = [12, 3, 0, -19, 8, -11];

A = np.row_stack([v1, v2, v3])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">matlab definition</span>
eps = np.finfo(np.linalg.norm(A).dtype).eps
TOLERANCE = <span style="color: #8b0000;">max</span>(eps * np.array(A.shape))

U, s, V = np.linalg.svd(A)
<span style="color: #8b0000;">print</span> s
<span style="color: #8b0000;">print</span> np.sum(s &gt; TOLERANCE)

TOLERANCE = 1e-14
<span style="color: #8b0000;">print</span> np.sum(s &gt; TOLERANCE)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [  2.75209239e+01   9.30584482e+00   1.42425400e-15]
3
&gt;&gt;&gt; &gt;&gt;&gt; 2
</pre>

<p>
You can see if you choose too small a TOLERANCE, nothing looks like zero. the result with TOLERANCE=1e-14 suggests the rows are not linearly independent. Let us show that one row can be expressed as a linear combination of the other rows. 
</p>

<p>
The number of rows is greater than the rank, so these vectors are not
independent. Let's demonstrate that one vector can be defined as a linear
combination of the other two vectors. Mathematically we represent this
as:
</p>

<p>
\(x_1 \mathit{v1} + x_2 \mathit{v2} = v3\)
</p>

<p>
or
</p>

<p>
\([x_1 x_2][v1; v2] = v3\)
</p>

<p>
This is not the usual linear algebra form of Ax = b. To get there, we
transpose each side of the equation to get:
</p>

<p>
[v1.T v2.T][x_1; x_2] = v3.T
</p>

<p>
which is the form Ax = b. We solve it in a least-squares sense.
</p>

<div class="org-src-container">

<pre class="src src-python">A = np.column_stack([v1, v2])
x = np.linalg.lstsq(A, v3)
<span style="color: #8b0000;">print</span> x[0]
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; [ 2. -3.]
</pre>

<p>
This shows that v3 = 2*v1 - 3*v2
</p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> another example</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">Problem set 7.4 #17</span>
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

v1 = [0.2, 1.2, 5.3, 2.8, 1.6]
v2 = [4.3, 3.4, 0.9, 2.0, -4.3]

A = np.row_stack([v1, v2])
U, s, V = np.linalg.svd(A)
<span style="color: #8b0000;">print</span> s
</pre>
</div>

<pre class="example">
[ 7.57773162  5.99149259]
</pre>

<p>
You can tell by inspection the rank is 2 because there are no near-zero singular values. 
</p>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Near deficient rank</h2>
<div class="outline-text-2" id="text-2">
<p>
the rank command roughly works in the following way: the matrix is converted to a reduced row echelon form, and then the number of rows that are not all equal to zero are counted. Matlab uses a tolerance to determine what is equal to zero. If there is uncertainty in the numbers, you may have to define what zero is, e.g. if the absolute value of a number is less than 1e-5, you may consider that close enough to be zero. The default tolerance is usually very small, of order 1e-15. If we believe that any number less than 1e-5 is practically equivalent to zero, we can use that information to compute the rank like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

A = [[1, 2, 3],
     [0, 2, 3],
     [0, 0, 1e-6]]

U, s, V = np.linalg.svd(A)
<span style="color: #8b0000;">print</span> s
<span style="color: #8b0000;">print</span> np.sum(np.abs(s) &gt; 1e-15)
<span style="color: #8b0000;">print</span> np.sum(np.abs(s) &gt; 1e-5)
</pre>
</div>

<pre class="example">
[  5.14874857e+00   7.00277208e-01   5.54700196e-07]
3
2
</pre>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Application to independent chemical reactions.</h2>
<div class="outline-text-2" id="text-3">
<p>
reference: Exercise 2.4 in Chemical Reactor Analysis and Design Fundamentals by Rawlings and Ekerdt.
</p>

<p>
The following reactions are proposed in the hydrogenation of bromine:
</p>

<p>
Let this be our species vector: v = [H2 H Br2 Br HBr].T
</p>

<p>
the reactions are then defined by M*v where M is a stoichometric matrix in which each row represents a reaction with negative stoichiometric coefficients for reactants, and positive stoichiometric coefficients for products. A stoichiometric coefficient of 0 is used for species not participating in the reaction.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #ff0000; font-weight: bold;">#    </span><span style="color: #ff0000; font-weight: bold;">[H2  H Br2 Br HBr]</span>
M = [[-1,  0, -1,  0,  2],  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">H2 + Br2 == 2HBR</span>
     [ 0,  0, -1,  2,  0],  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Br2 == 2Br</span>
     [-1,  1,  0, -1,  1],  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Br + H2 == HBr + H</span>
     [ 0, -1, -1,  1,  1],  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">H + Br2 == HBr + Br</span>
     [ 1, -1,  0,  1,  -1], <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">H + HBr == H2 + Br</span>
     [ 0,  0,  1, -2,  0]]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">2Br == Br2</span>

U, s, V = np.linalg.svd(M)
<span style="color: #8b0000;">print</span> s
<span style="color: #8b0000;">print</span> np.sum(np.abs(s) &gt; 1e-15)

<span style="color: #8b0000;">import</span> sympy 
M = sympy.Matrix(M)
reduced_form, inds = M.rref()

<span style="color: #8b0000;">print</span> reduced_form

labels = [<span style="color: #228b22;">'H2'</span>,  <span style="color: #228b22;">'H'</span>, <span style="color: #228b22;">'Br2'</span>, <span style="color: #228b22;">'Br'</span>, <span style="color: #228b22;">'HBr'</span>]
<span style="color: #8b0000;">for</span> row <span style="color: #8b0000;">in</span> reduced_form.tolist():
    s = <span style="color: #228b22;">'0 = '</span>
    <span style="color: #8b0000;">for</span> nu,species <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(row,labels):
        <span style="color: #8b0000;">if</span> nu != 0:
            
            s += <span style="color: #228b22;">' {0:+d}{1}'</span>.format(<span style="color: #8b0000;">int</span>(nu), species)
    <span style="color: #8b0000;">if</span> s != <span style="color: #228b22;">'0 = '</span>: <span style="color: #8b0000;">print</span> s
</pre>
</div>

<pre class="example">
[  3.84742803e+00   3.32555975e+00   1.46217301e+00   1.73313660e-16
   8.57422679e-17]
3
[1, 0, 0,  2, -2]
[0, 1, 0,  1, -1]
[0, 0, 1, -2,  0]
[0, 0, 0,  0,  0]
[0, 0, 0,  0,  0]
[0, 0, 0,  0,  0]
0 =  +1H2 +2Br -2HBr
0 =  +1H +1Br -1HBr
0 =  +1Br2 -2Br
</pre>

<p>
6 reactions are given, but the rank of the matrix is only 3. so there
are only three independent reactions. You can see that reaction 6 is just
the opposite of reaction 2, so it is clearly not independent. Also,
reactions 3 and 5 are just the reverse of each other, so one of them can
also be eliminated. finally, reaction 4 is equal to reaction 1 minus
reaction 3.
</p>

<p>
There are many possible independent reactions. In the code above, we use sympy to put the matrix into reduced row echelon form, which enables us to identify three independent reactions, and shows that three rows are all zero, i.e. they are not independent of the other three reactions. The choice of independent reactions is not unique.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/01/Determining-linear-independence-of-a-set-of-vectors.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/03/01/Determining-linear-independence-of-a-set-of-vectors">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Gibbs-energy-minimization-and-the-NIST-webbook"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/01/Gibbs-energy-minimization-and-the-NIST-webbook/" rel="bookmark" title="Permanent Link to Gibbs energy minimization and the NIST webbook">Gibbs energy minimization and the NIST webbook</a></h2>
      <p><small><span class="blog_post_date">Posted March 01, 2013 at 01:11 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a></span> | tags: <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 04:31 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/12/25/gibbs-energy-minimization-and-the-nist-webbook/" >Matlab post</a>
In Post 1536 we used the NIST webbook to compute a temperature dependent Gibbs energy of reaction, and then used a reaction extent variable to compute the equilibrium concentrations of each species for the water gas shift reaction.
</p>

<p>
Today, we look at the direct minimization of the Gibbs free energy of the species, with no assumptions about stoichiometry of reactions. We only apply the constraint of conservation of atoms. We use the NIST Webbook to provide the data for the Gibbs energy of each species.
</p>

<p>
As a reminder we consider equilibrium between the species \(CO\), \(H_2O\), \(CO_2\) and \(H_2\), at 1000K, and 10 atm total pressure with an initial equimolar molar flow rate of \(CO\) and \(H_2O\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

T = 1000  <span style="color: #ff0000; font-weight: bold;"># K</span>
R = 8.314e-3 <span style="color: #ff0000; font-weight: bold;"># kJ/mol/K</span>

P = 10.0 <span style="color: #ff0000; font-weight: bold;"># atm, this is the total pressure in the reactor</span>
Po = 1.0 <span style="color: #ff0000; font-weight: bold;"># atm, this is the standard state pressure</span>
</pre>
</div>

<p>
We are going to store all the data and calculations in vectors, so we need to assign each position in the vector to a species. Here are the definitions we use in this work.
</p>

<pre class="example">
1  CO
2  H2O
3  CO2
4  H2
</pre>

<div class="org-src-container">

<pre class="src src-python">species = [<span style="color: #228b22;">'CO'</span>, <span style="color: #228b22;">'H2O'</span>, <span style="color: #228b22;">'CO2'</span>, <span style="color: #228b22;">'H2'</span>]

<span style="color: #ff0000; font-weight: bold;"># Heats of formation at 298.15 K</span>

Hf298 = [
    -110.53,  <span style="color: #ff0000; font-weight: bold;"># CO</span>
    -241.826, <span style="color: #ff0000; font-weight: bold;"># H2O</span>
    -393.51,  <span style="color: #ff0000; font-weight: bold;"># CO2</span>
       0.0]   <span style="color: #ff0000; font-weight: bold;"># H2</span>

<span style="color: #ff0000; font-weight: bold;"># Shomate parameters for each species</span>
<span style="color: #ff0000; font-weight: bold;">#           A          B           C          D          E            F          G       H</span>
WB = [[25.56759,  6.096130,     4.054656,  -2.671301,  0.131021, -118.0089, 227.3665,   -110.5271],  <span style="color: #ff0000; font-weight: bold;"># CO</span>
      [30.09200,  6.832514,     6.793435,  -2.534480,  0.082139, -250.8810, 223.3967,   -241.8264],  <span style="color: #ff0000; font-weight: bold;"># H2O</span>
      [24.99735,  55.18696,   -33.69137,    7.948387, -0.136638, -403.6075, 228.2431,   -393.5224],  <span style="color: #ff0000; font-weight: bold;"># CO2</span>
      [33.066178, -11.363417,  11.432816,  -2.772874, -0.158558, -9.980797, 172.707974,    0.0]]     <span style="color: #ff0000; font-weight: bold;"># H2</span>

WB = np.array(WB)

<span style="color: #ff0000; font-weight: bold;"># Shomate equations</span>
t = T/1000
T_H = np.array([t,  t**2 / 2.0, t**3 / 3.0, t**4 / 4.0, -1.0 / t, 1.0, 0.0, -1.0])
T_S = np.array([np.log(t), t,  t**2 / 2.0,  t**3 / 3.0, -1.0 / (2.0 * t**2), 0.0, 1.0, 0.0])

H = np.dot(WB, T_H)        <span style="color: #ff0000; font-weight: bold;"># (H - H_298.15) kJ/mol</span>
S = np.dot(WB, T_S/1000.0) <span style="color: #ff0000; font-weight: bold;"># absolute entropy kJ/mol/K</span>

Gjo = Hf298 + H - T*S      <span style="color: #ff0000; font-weight: bold;"># Gibbs energy of each component at 1000 K</span>
</pre>
</div>

<p>
Now, construct the Gibbs free energy function, accounting for the change in activity due to concentration changes (ideal mixing).
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(nj):
    nj = np.array(nj)
    Enj = np.sum(nj);
    Gj =  Gjo / (R * T) + np.log(nj / Enj * P / Po)
    <span style="color: #8b0000;">return</span> np.dot(nj, Gj)
</pre>
</div>

<p>
We impose the constraint that all atoms are conserved from the initial conditions to the equilibrium distribution of species. These constraints are in the form of \(A_{eq} n = b_{eq}\), where \(n\) is the vector of mole numbers for each species.
</p>

<div class="org-src-container">

<pre class="src src-python">Aeq = np.array([[ 1,    0,    1,    0],  <span style="color: #ff0000; font-weight: bold;"># C balance</span>
                [ 1,    1,    2,    0],  <span style="color: #ff0000; font-weight: bold;"># O balance</span>
                [ 0,    2,    0,    2]]) <span style="color: #ff0000; font-weight: bold;"># H balance</span>

<span style="color: #ff0000; font-weight: bold;"># equimolar feed of 1 mol H2O and 1 mol CO</span>
beq = np.array([1,  <span style="color: #ff0000; font-weight: bold;"># mol C fed</span>
                2,  <span style="color: #ff0000; font-weight: bold;"># mol O fed</span>
                2]) <span style="color: #ff0000; font-weight: bold;"># mol H fed</span>

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ec1</span>(nj):
    <span style="color: #228b22;">'conservation of atoms constraint'</span>
    <span style="color: #8b0000;">return</span> np.dot(Aeq, nj) - beq
</pre>
</div>

<p>
Now we are ready to solve the problem. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fmin_slsqp

n0 = [0.5, 0.5, 0.5, 0.5]  <span style="color: #ff0000; font-weight: bold;"># initial guesses</span>
N = fmin_slsqp(func, n0, f_eqcons=ec1)
<span style="color: #8b0000;">print</span> N
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; Optimization terminated successfully.    (Exit mode 0)
            Current function value: -91.204832308
            Iterations: 2
            Function evaluations: 13
            Gradient evaluations: 2
[ 0.45502309  0.45502309  0.54497691  0.54497691]
</pre>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Compute mole fractions and partial pressures</h2>
<div class="outline-text-2" id="text-1">
<p>
The pressures here are in good agreement with the pressures found by other methods. The minor disagreement (in the third or fourth decimal place) is likely due to convergence tolerances in the different algorithms used.
</p>

<div class="org-src-container">

<pre class="src src-python">yj = N / np.sum(N)
Pj = yj * P

<span style="color: #8b0000;">for</span> s, y, p <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(species, yj, Pj):
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0:10s}: {1:1.2f} {2:1.2f}'</span>.format(s, y, p)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; ... ... CO        : 0.23 2.28
H2O       : 0.23 2.28
CO2       : 0.27 2.72
H2        : 0.27 2.72
</pre>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Computing equilibrium constants</h2>
<div class="outline-text-2" id="text-2">
<p>
We can compute the equilibrium constant for the reaction \(CO + H_2O \rightleftharpoons CO_2 + H_2\). Compared to the value of K = 1.44 we found at the end of Post 1536 , the agreement is excellent. Note, that to define an equilibrium constant it is necessary to specify a reaction, even though it is not necessary to even consider a reaction to obtain the equilibrium distribution of species!
</p>

<div class="org-src-container">

<pre class="src src-python">nuj = np.array([-1, -1, 1, 1])  <span style="color: #ff0000; font-weight: bold;"># stoichiometric coefficients of the reaction</span>
K = np.prod(yj**nuj)
<span style="color: #8b0000;">print</span> K
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; 1.43446295961
</pre>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/01/Gibbs-energy-minimization-and-the-NIST-webbook.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/03/01/Gibbs-energy-minimization-and-the-NIST-webbook">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Finding-equilibrium-composition-by-direct-minimization-of-Gibbs-free-energy-on-mole-numbers"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/03/01/Finding-equilibrium-composition-by-direct-minimization-of-Gibbs-free-energy-on-mole-numbers/" rel="bookmark" title="Permanent Link to Finding equilibrium composition by direct minimization of Gibbs free energy on mole numbers">Finding equilibrium composition by direct minimization of Gibbs free energy on mole numbers</a></h2>
      <p><small><span class="blog_post_date">Posted March 01, 2013 at 12:27 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a></span> | tags: <a href='/blog/tag/thermodynamics/'>thermodynamics</a>
      <p><small><span class="blog_post_date">Updated September 10, 2014 at 01:15 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. The Gibbs energy of a mixture</a></li>
<li><a href="#sec-2">2. Linear equality constraints for atomic mass conservation</a></li>
<li><a href="#sec-3">3. Equilibrium constant based on mole numbers</a></li>
<li><a href="#sec-4">4. Summary</a></li>
</ul>
</div>
</div>
<p>
<a href="http://matlab.cheme.cmu.edu/2011/12/25/finding-equilibrium-composition-by-direct-minimization-of-gibbs-free-energy-on-mole-numbers/">Matlab post</a> 
Adapted from problem 4.5 in Cutlip and Shacham
Ethane and steam are fed to a steam cracker at a total pressure of 1 atm and at 1000K at a ratio of 4 mol H2O to 1 mol ethane. Estimate the equilibrium distribution of products (CH4, C2H4, C2H2, CO2, CO, O2, H2, H2O, and C2H6).
</p>

<p>
Solution method: We will construct a Gibbs energy function for the mixture, and obtain the equilibrium composition by minimization of the function subject to elemental mass balance constraints.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">R</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">00198588</span> <span style="color: #ff0000; font-weight: bold;"># kcal/mol/K</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">T</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1000</span> <span style="color: #ff0000; font-weight: bold;"># K</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">species</span> = [<span style="color: #228b22;">'CH4'</span>, <span style="color: #228b22;">'C2H4'</span>, <span style="color: #228b22;">'C2H2'</span>, <span style="color: #228b22;">'CO2'</span>, <span style="color: #228b22;">'CO'</span>, <span style="color: #228b22;">'O2'</span>, <span style="color: #228b22;">'H2'</span>, <span style="color: #228b22;">'H2O'</span>, <span style="color: #228b22;">'C2H6'</span>]

# <span style="color: #ff0000; font-weight: bold;">$G_^\circ for each species. These are the heats of formation for each</span>
# <span style="color: #ff0000; font-weight: bold;">species.</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">Gjo</span> = np.array([<span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">61</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">28</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">249</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">40</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">604</span>, -<span style="color: #000000; background-color: #cccccc; font-weight: bold;">94</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">61</span>, -<span style="color: #000000; background-color: #cccccc; font-weight: bold;">47</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">942</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, -<span style="color: #000000; background-color: #cccccc; font-weight: bold;">46</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">03</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">26</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">13</span>]) <span style="color: #ff0000; font-weight: bold;"># kcal/mol</span>
</pre>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> The Gibbs energy of a mixture</h2>
<div class="outline-text-2" id="text-1">
<p>
We start with \(G=\sum\limits_j n_j \mu_j\). Recalling that we define \(\mu_j = G_j^\circ + RT \ln a_j\), and in the ideal gas limit, \(a_j = y_j P/P^\circ\), and that \(y_j = \frac{n_j}{\sum n_j}\). Since in this problem, P = 1 atm, this leads to the function \(\frac{G}{RT} = \sum\limits_{j=1}^n n_j\left(\frac{G_j^\circ}{RT} + \ln \frac{n_j}{\sum n_j}\right)\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(nj):
    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">nj</span> = np.array(nj)
    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">Enj</span> = np.sum(nj);
    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">G</span> = np.sum(nj * (Gjo / R / T + np.log(nj / Enj)))
    <span style="color: #8b0000;">return</span> G
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Linear equality constraints for atomic mass conservation</h2>
<div class="outline-text-2" id="text-2">
<p>
The total number of each type of atom must be the same as what entered the reactor. These form equality constraints on the equilibrium composition. We express these constraints as: \(A_{eq} n = b\) where \(n\) is a vector of the moles of each species present in the mixture. CH4 C2H4 C2H2 CO2 CO O2 H2 H2O C2H6
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #000000; background-color: #cccccc; font-weight: bold;">Aeq</span> = np.array([[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>],      <span style="color: #ff0000; font-weight: bold;"># oxygen balance</span>
                [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>,    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>],      <span style="color: #ff0000; font-weight: bold;"># hydrogen balance</span>
                [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,    <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,  <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>,   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>]])     <span style="color: #ff0000; font-weight: bold;"># carbon balance</span>

# <span style="color: #ff0000; font-weight: bold;">the incoming feed was 4 mol H2O and 1 mol ethane</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">beq</span> = np.array([<span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>,  <span style="color: #ff0000; font-weight: bold;"># moles of oxygen atoms coming in</span>
                <span style="color: #000000; background-color: #cccccc; font-weight: bold;">14</span>, <span style="color: #ff0000; font-weight: bold;"># moles of hydrogen atoms coming in</span>
                <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>]) <span style="color: #ff0000; font-weight: bold;"># moles of carbon atoms coming in</span>

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ec1</span>(n):
    <span style="color: #228b22;">'equality constraint'</span>
    <span style="color: #8b0000;">return</span> np.dot(Aeq, n) - beq

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ic1</span>(n):
    <span style="color: #228b22;">'''inequality constraint</span>
<span style="color: #228b22;">       all n&gt;=0</span>
<span style="color: #228b22;">    '''</span>   
    <span style="color: #8b0000;">return</span> n
</pre>
</div>

<p>
Now we solve the problem.
</p>

<div class="org-src-container">

<pre class="src src-python"># <span style="color: #ff0000; font-weight: bold;">initial guess suggested in the example</span>
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">n0</span> = [1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>, 1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>, 1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">993</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, 1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">992</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, 1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>] 

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">n0</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">066</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">8</span>.7e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">08</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>.1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">14</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">545</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">39</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>.7e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">14</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">346</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">521</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>.58e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">7</span>]

<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fmin_slsqp

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">X</span> = fmin_slsqp(func, n0, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">f_eqcons</span>=ec1,<span style="color: #000000; background-color: #cccccc; font-weight: bold;">f_ieqcons</span>=ic1,<span style="color: #cd0000;"> iter</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">300</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">acc</span>=1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">12</span>)

<span style="color: #8b0000;">for</span> s,x <span style="color: #8b0000;">in</span><span style="color: #cd0000;"> zip</span>(species, X):
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0:10s} {1:1.4g}'</span>.format(s, x)

# <span style="color: #ff0000; font-weight: bold;">check that constraints were met</span>
<span style="color: #8b0000;">print</span> np.dot(Aeq, X) - beq
<span style="color: #8b0000;">print</span> np.all( np.abs( np.dot(Aeq, X) - beq) &lt; 1e-<span style="color: #000000; background-color: #cccccc; font-weight: bold;">12</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; Optimization terminated successfully.    (Exit mode 0)
            Current function value: -104.403951524
            Iterations: 16
            Function evaluations: 193
            Gradient evaluations: 15
&gt;&gt;&gt; ... ... CH4        0.06644
C2H4       9.48e-08
C2H2       1.487e-13
CO2        0.545
CO         1.389
O2         3.096e-13
H2         5.346
H2O        1.521
C2H6       1.581e-07
... [  0.00000000e+00   0.00000000e+00   4.44089210e-16]
True
</pre>

<p>
I found it necessary to tighten the accuracy parameter to get pretty good matches to the solutions found in Matlab. It was also necessary to increase the number of iterations. Even still, not all of the numbers match well, especially the very small numbers. You can, however, see that the constraints were satisfied pretty well.
</p>


<p>
Interestingly there is a distribution of products! That is interesting because only steam and ethane enter the reactor, but a small fraction of methane is formed! The main product is hydrogen. The stoichiometry of steam reforming is ideally \(C_2H_6 + 4H_2O \rightarrow 2CO_2 + 7 H2\). Even though nearly all the ethane is consumed, we do not get the full yield of hydrogen. It appears that another equilibrium, one between CO, CO2, H2O and H2, may be limiting that, since the rest of the hydrogen is largely in the water. It is also of great importance that we have not said anything about reactions, i.e. how these products were formed. 
</p>

<p>
The water gas shift reaction is: \(CO + H_2O \rightleftharpoons CO_2 + H_2\). We can compute the Gibbs free energy of the reaction from the heats of formation of each species. Assuming these are the formation energies at 1000K, this is the reaction free energy at 1000K.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #000000; background-color: #cccccc; font-weight: bold;">G_wgs</span> = Gjo[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>] + Gjo[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>] - Gjo[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>] - Gjo[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">7</span>]
<span style="color: #8b0000;">print</span> G_wgs

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">K</span> = np.exp(-G_wgs / (R*T))
<span style="color: #8b0000;">print</span> K
</pre>
</div>

<pre class="example">
-0.638
&gt;&gt;&gt; &gt;&gt;&gt; 1.37887528109
</pre>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Equilibrium constant based on mole numbers</h2>
<div class="outline-text-2" id="text-3">
<p>
One normally uses activities to define the equilibrium constant. Since there are the same number of moles on each side of the reaction all factors that convert mole numbers to activity, concentration or pressure cancel, so we simply consider the ratio of mole numbers here.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> (X[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>] * X[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span>]) / (X[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">4</span>] * X[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">7</span>])
</pre>
</div>

<pre class="example">
1.37887525547
</pre>

<p>
This is very close to the equilibrium constant computed above. 
</p>

<p>
Clearly, there is an equilibrium between these species that prevents the complete reaction of steam reforming.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Summary</h2>
<div class="outline-text-2" id="text-4">
<p>
This is an appealing way to minimize the Gibbs energy of a mixture. No assumptions about reactions are necessary, and the constraints are easy to identify. The Gibbs energy function is especially easy to code.</p>
</div>
</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/03/01/Finding-equilibrium-composition-by-direct-minimization-of-Gibbs-free-energy-on-mole-numbers.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/03/01/Finding-equilibrium-composition-by-direct-minimization-of-Gibbs-free-energy-on-mole-numbers">Discuss on Twitter</a>

  <hr class="interblog" />
 <a href="../4">« Previous Page</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2024/06/08/New-publication-Pourbaix-Machine-Learning-Framework-Identifies-Acidic-Water-Oxidation-Catalysts-Exhibiting-Suppressed-Ruthenium-Dissolution/">New publication - Pourbaix Machine Learning Framework Identifies Acidic Water Oxidation Catalysts Exhibiting Suppressed Ruthenium Dissolution</a></li>
      <li><a href="/blog/2024/06/06/New-publication-Surface-Segregation-Studies-in-Ternary-Noble-Metal-Alloys-Comparing-DFT-and-Machine-Learning-with-Experimental-Data/">New publication - Surface Segregation Studies in Ternary Noble Metal Alloys Comparing DFT and Machine Learning with Experimental Data</a></li>
      <li><a href="/blog/2024/05/23/New-publication-Cyclic-Steady-State-Simulation-and-Waveform-Design-for-Dynamic-Programmable-Catalysis/">New publication - Cyclic Steady-State Simulation and Waveform Design for Dynamic Programmable Catalysis</a></li>
      <li><a href="/blog/2024/05/05/Kolmogorov-Arnold-Networks-KANs-and-Lennard-Jones/">Kolmogorov-Arnold Networks (KANs) and Lennard Jones</a></li>
      <li><a href="/blog/2024/04/20/Generalization-of-Graph-Based-Active-Learning-Relaxation-Strategies-Across-Materials/">Generalization of Graph-Based Active Learning Relaxation Strategies Across Materials</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2024
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
 
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PH8NF4F0RE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PH8NF4F0RE');
</script>


  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



