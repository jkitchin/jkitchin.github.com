

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Creating-arrays-in-python"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/26/Creating-arrays-in-python/" rel="bookmark" title="Permanent Link to Creating arrays in python">Creating arrays in python</a></h2>
      <p><small><span class="blog_post_date">Posted February 26, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/26/Creating-arrays-in-python#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 06, 2013 at 07:39 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Often, we will have a set of 1-D arrays, and we would like to construct a 2D array with those vectors as either the rows or columns of the array. This may happen because we have data from different sources we want to combine, or because we organize the code with variables that are easy to read, and then want to combine the variables. Here are examples of doing that to get the vectors as the columns.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

a = np.array([1, 2, 3])
b = np.array([4, 5, 6])

<span style="color: #8b0000;">print</span> np.column_stack([a, b])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">this means stack the arrays vertically, e.g. on top of each other</span>
<span style="color: #8b0000;">print</span> np.vstack([a, b]).T
</pre>
</div>

<pre class="example">
[[1 4]
 [2 5]
 [3 6]]
[[1 4]
 [2 5]
 [3 6]]
</pre>

<p>
Or rows:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

a = np.array([1, 2, 3])
b = np.array([4, 5, 6])

<span style="color: #8b0000;">print</span> np.row_stack([a, b])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">this means stack the arrays vertically, e.g. on top of each other</span>
<span style="color: #8b0000;">print</span> np.vstack([a, b])
</pre>
</div>

<pre class="example">
[[1 2 3]
 [4 5 6]]
[[1 2 3]
 [4 5 6]]
</pre>

<p>
The opposite operation is to extract the rows or columns of a 2D array into smaller arrays. We might want to do that to extract a row or column from a calculation for further analysis, or plotting for example. There are splitting functions in numpy. They are somewhat confusing, so we examine some examples. The numpy.hsplit command splits an array &ldquo;horizontally&rdquo;. The best way to think about it is that the &ldquo;splits&rdquo; move horizontally across the array. In other words, you draw a vertical split, move over horizontally, draw another vertical split, etc&hellip; You must specify the number of splits that you want, and the array must be evenly divisible by the number of splits.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

A = np.array([[1, 2, 3, 5], 
              [4, 5, 6, 9]])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">split into two parts</span>
p1, p2 = np.hsplit(A, 2)
<span style="color: #8b0000;">print</span> p1
<span style="color: #8b0000;">print</span> p2

<span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">split into 4 parts</span>
p1, p2, p3, p4 = np.hsplit(A, 4)
<span style="color: #8b0000;">print</span> p1
<span style="color: #8b0000;">print</span> p2
<span style="color: #8b0000;">print</span> p3
<span style="color: #8b0000;">print</span> p4
</pre>
</div>

<pre class="example">
[[1 2]
 [4 5]]
[[3 5]
 [6 9]]
[[1]
 [4]]
[[2]
 [5]]
[[3]
 [6]]
[[5]
 [9]]
</pre>

<p>
In the numpy.vsplit command the &ldquo;splits&rdquo; go &ldquo;vertically&rdquo; down the array. Note that the split commands return 2D arrays.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

A = np.array([[1, 2, 3, 5], 
              [4, 5, 6, 9]])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">split into two parts</span>
p1, p2 = np.vsplit(A, 2)
<span style="color: #8b0000;">print</span> p1
<span style="color: #8b0000;">print</span> p2
<span style="color: #8b0000;">print</span> p2.shape
</pre>
</div>

<pre class="example">
[[1 2 3 5]]
[[4 5 6 9]]
(1, 4)
</pre>

<p>
An alternative approach is array unpacking. In this example, we unpack the array into two variables. The array unpacks by row.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

A = np.array([[1, 2, 3, 5], 
              [4, 5, 6, 9]])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">split into two parts</span>
p1, p2 = A
<span style="color: #8b0000;">print</span> p1
<span style="color: #8b0000;">print</span> p2
</pre>
</div>

<pre class="example">
[1 2 3 5]
[4 5 6 9]
</pre>

<p>
To get the columns, just transpose the array.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

A = np.array([[1, 2, 3, 5], 
              [4, 5, 6, 9]])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">split into two parts</span>
p1, p2, p3, p4 = A.T
<span style="color: #8b0000;">print</span> p1
<span style="color: #8b0000;">print</span> p2
<span style="color: #8b0000;">print</span> p3
<span style="color: #8b0000;">print</span> p4
<span style="color: #8b0000;">print</span> p4.shape
</pre>
</div>

<pre class="example">
[1 4]
[2 5]
[3 6]
[5 9]
(2,)
</pre>

<p>
Note that now, we have 1D arrays.
</p>

<p>
You can also access rows and columns by indexing. We index an array by [row, column]. To get a row, we specify the row number, and all the columns in that row like this [row, :]. Similarly, to get a column, we specify that we want all rows in that column like this: [:, column]. This approach is useful when you only want a few columns or rows.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

A = np.array([[1, 2, 3, 5], 
              [4, 5, 6, 9]])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">get row 1</span>
<span style="color: #8b0000;">print</span> A[1]
<span style="color: #8b0000;">print</span> A[1, :]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">row 1, all columns</span>

<span style="color: #8b0000;">print</span> A[:, 2]  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">get third column </span>
<span style="color: #8b0000;">print</span> A[:, 2].shape
</pre>
</div>

<pre class="example">
[4 5 6 9]
[4 5 6 9]
[3 6]
(2,)
</pre>

<p>
Note that even when we specify a column, it is returned as a 1D array.</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/26/Creating-arrays-in-python.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/26/Creating-arrays-in-python#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Derivatives-by-FFT"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/26/Derivatives-by-FFT/" rel="bookmark" title="Permanent Link to Derivatives by FFT">Derivatives by FFT</a></h2>
      <p><small><span class="blog_post_date">Posted February 26, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/differentiation/'>differentiation</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/26/Derivatives-by-FFT#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:51 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>

</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

N = 101 <span style="color: #ff0000; font-weight: bold;">#number of points</span>
L = 2 * np.pi <span style="color: #ff0000; font-weight: bold;">#interval of data</span>

x = np.arange(0.0, L, L/<span style="color: #8b0000;">float</span>(N)) <span style="color: #ff0000; font-weight: bold;">#this does not include the endpoint</span>

<span style="color: #ff0000; font-weight: bold;">#add some random noise</span>
y = np.sin(x) + 0.05 * np.random.random(size=x.shape)
dy_analytical = np.cos(x)

<span style="color: #228b22;">'''</span>
<span style="color: #228b22;">http://sci.tech-archive.net/Archive/sci.math/2008-05/msg00401.html</span>

<span style="color: #228b22;">you can use fft to calculate derivatives!</span>
<span style="color: #228b22;">'''</span>

<span style="color: #8b0000;">if</span> N % 2 == 0:
    k = np.asarray(<span style="color: #8b0000;">range</span>(0, N / 2) + [0] + <span style="color: #8b0000;">range</span>(-N / 2 + 1,0))
<span style="color: #8b0000;">else:</span>
    k = np.asarray(<span style="color: #8b0000;">range</span>(0,(N - 1) / 2) + [0] + <span style="color: #8b0000;">range</span>(-(N - 1) / 2, 0))

k *= 2 * np.pi / L

fd = np.real(np.fft.ifft(1.0j * k * np.fft.fft(y)))

plt.plot(x, y, label=<span style="color: #228b22;">'function'</span>)
plt.plot(x,dy_analytical,label=<span style="color: #228b22;">'analytical der'</span>)
plt.plot(x,fd,label=<span style="color: #228b22;">'fft der'</span>)
plt.legend(loc=<span style="color: #228b22;">'lower left'</span>)

plt.savefig(<span style="color: #228b22;">'images/fft-der.png'</span>)
plt.show()
</pre>
</div>

<p><img src="/img/./images/fft-der.png"><p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/26/Derivatives-by-FFT.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/26/Derivatives-by-FFT#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Sums-products-and-linear-algebra-notation-avoiding-loops-where-possible"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/26/Sums-products-and-linear-algebra-notation-avoiding-loops-where-possible/" rel="bookmark" title="Permanent Link to Sums products and linear algebra notation - avoiding loops where possible">Sums products and linear algebra notation - avoiding loops where possible</a></h2>
      <p><small><span class="blog_post_date">Posted February 26, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/linear-algebra/'>linear algebra</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/26/Sums-products-and-linear-algebra-notation-avoiding-loops-where-possible#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 01:12 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
<a href="http://matlab.cheme.cmu.edu/2012/01/03/sums-products-and-linear-algebra-notation-avoiding-loops-where-possible/" >Matlab comparison</a>
</p>

<p>
Today we examine some methods of linear algebra that allow us to
avoid writing explicit loops in Matlab for some kinds of
mathematical operations. 
</p>


<p>
Consider the operation on two vectors \(\bf{a}\)
and \(\bf{b}\).
</p>


<p>
$$y=\sum\limits_{i=1}^n a_ib_i$$
</p>

<p>
a = [1 2 3 4 5]
</p>

<p>
b = [3 6 8 9 10]
</p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Old-fashioned way with a loop</h2>
<div class="outline-text-2" id="text-1">
<p>
We can compute this with a loop, where you initialize y, and then
 add the product of the ith elements of a and b to y in each
iteration of the loop. This is known to be slow for large vectors
</p>

<div class="org-src-container">

<pre class="src src-python">a = [1, 2, 3, 4, 5]
b = [3, 6, 8, 9, 10]

<span style="color: #8b0000;">sum</span> = 0
<span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(len(a)):
    <span style="color: #8b0000;">sum</span> = <span style="color: #8b0000;">sum</span> + a[i] * b[i]
<span style="color: #8b0000;">print</span> sum
</pre>
</div>

<pre class="example">
125
</pre>

<p>
This is an old fashioned style of coding. A more modern, pythonic approach is:
</p>
<div class="org-src-container">

<pre class="src src-python">a = [1, 2, 3, 4, 5]
b = [3, 6, 8, 9, 10]

<span style="color: #8b0000;">sum</span> = 0
<span style="color: #8b0000;">for</span> x,y <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(a,b):
    <span style="color: #8b0000;">sum</span> += x * y
<span style="color: #8b0000;">print</span> sum
</pre>
</div>

<pre class="example">
125
</pre>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> The numpy approach</h2>
<div class="outline-text-2" id="text-2">
<p>
The most compact method is to use the  methods in numpy.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

a = np.array([1, 2, 3, 4, 5])
b = np.array([3, 6, 8, 9, 10])

<span style="color: #8b0000;">print</span> np.sum(a * b)
</pre>
</div>

<pre class="example">
125
</pre>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Matrix algebra approach.</h2>
<div class="outline-text-2" id="text-3">
<p>
The operation defined above is actually a dot product. We an directly compute the dot product in numpy. Note that with 1d arrays, python knows what to do and does not require any transpose operations.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

a = np.array([1, 2, 3, 4, 5])
b = np.array([3, 6, 8, 9, 10])

<span style="color: #8b0000;">print</span> np.dot(a, b)
</pre>
</div>

<pre class="example">
125
</pre>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Another example</h2>
<div class="outline-text-2" id="text-4">
<p>
Consider \(y = \sum\limits_{i=1}^n w_i x_i^2\). This operation is like a weighted sum of squares.
The old-fashioned way to do this is with a loop.
</p>

<div class="org-src-container">

<pre class="src src-python">w = [0.1, 0.25, 0.12, 0.45, 0.98];
x = [9, 7, 11, 12, 8];
y = 0
<span style="color: #8b0000;">for</span> wi, xi <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">zip</span>(w,x):
   y += wi * xi**2
<span style="color: #8b0000;">print</span> y
</pre>
</div>

<pre class="example">
162.39
</pre>

<p>
Compare this to the more modern numpy approach.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
w = np.array([0.1, 0.25, 0.12, 0.45, 0.98])
x = np.array([9, 7, 11, 12, 8])
y = np.sum(w * x**2)
<span style="color: #8b0000;">print</span> y
</pre>
</div>

<pre class="example">
162.39
</pre>

<p>
We can also express this in matrix algebra form. The operation is equivalent to \(y = \vec{x} \cdot D_w \cdot \vec{x}^T\) where \(D_w\) is a diagonal matrix with the weights on the diagonal.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
w = np.array([0.1, 0.25, 0.12, 0.45, 0.98])
x = np.array([9, 7, 11, 12, 8])
y = np.dot(x, np.dot(np.diag(w), x))
<span style="color: #8b0000;">print</span> y
</pre>
</div>

<pre class="example">
162.39
</pre>

<p>
This last form avoids explicit loops and sums, and relies on fast linear algebra routines.
</p>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Last example</h2>
<div class="outline-text-2" id="text-5">
<p>
Consider the sum of the product of three vectors. Let \(y = \sum\limits_{i=1}^n w_i x_i y_i\). This is like a weighted sum of products. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

w = np.array([0.1, 0.25, 0.12, 0.45, 0.98])
x = np.array([9, 7, 11, 12, 8])
y = np.array([2, 5, 3, 8, 0])

<span style="color: #8b0000;">print</span> np.sum(w * x * y)
<span style="color: #8b0000;">print</span> np.dot(w, np.dot(np.diag(x), y))
</pre>
</div>

<pre class="example">
57.71
57.71
</pre>
</div>
</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Summary</h2>
<div class="outline-text-2" id="text-6">
<p>
We showed examples of the following equalities between traditional
sum notations and linear algebra
</p>


<p>
$$\bf{a}\bf{b}=\sum\limits_{i=1}^n a_ib_i$$
</p>

<p>
$$\bf{x}\bf{D_w}\bf{x^T}=\sum\limits_{i=1}^n w_ix_i^2$$
</p>


<p>
$$\bf{x}\bf{D_w}\bf{y^T}=\sum\limits_{i=1}^n w_i x_i y_i$$
</p>

<p>
These relationships enable one to write the sums as a single line of
python code, which utilizes fast linear algebra subroutines, avoids
the construction of slow loops, and reduces the opportunity for
errors in the code. Admittedly, it introduces the opportunity for
new types of errors, like using the wrong relationship, or linear
algebra errors due to matrix size mismatches.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/26/Sums-products-and-linear-algebra-notation---avoiding-loops-where-possible.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/26/Sums-products-and-linear-algebra-notation-avoiding-loops-where-possible#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="The-trapezoidal-method-of-integration"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/23/The-trapezoidal-method-of-integration/" rel="bookmark" title="Permanent Link to The trapezoidal method of integration">The trapezoidal method of integration</a></h2>
      <p><small><span class="blog_post_date">Posted February 23, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a>, <a href='/blog/category/integration/'>integration</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/23/The-trapezoidal-method-of-integration#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:54 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/10/14/the-trapezoidal-method-of-integration/" >Matlab post</a>

See <a href="http://en.wikipedia.org/wiki/Trapezoidal_rule" >http://en.wikipedia.org/wiki/Trapezoidal_rule</a>
</p>

<p>
$$\int_a^b f(x) dx \approx \frac{1}{2}\displaystyle\sum\limits_{k=1}^N(x_{k+1}-x_k)(f(x_{k+1}) + f(x_k))$$
</p>

<p>
Let us compute the integral of sin(x) from x=0 to \(\pi\). To approximate the integral, we need to divide the interval from \(a\) to \(b\) into \(N\) intervals. The analytical answer is 2.0.
</p>

<p>
We will use this example to illustrate the difference in performance between loops and vectorized operations in python.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> time

a = 0.0; b = np.pi;
N = 1000; <span style="color: #ff0000; font-weight: bold;"># this is the number of intervals</span>

h = (b - a)/N; <span style="color: #ff0000; font-weight: bold;"># this is the width of each interval</span>
x = np.linspace(a, b, N) 
y = np.sin(x); <span style="color: #ff0000; font-weight: bold;"># the sin function is already vectorized</span>

t0 = time.time()
f = 0.0
<span style="color: #8b0000;">for</span> k <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(len(x) - 1):
    f += 0.5 * ((x[k+1] - x[k]) * (y[k+1] + y[k]))

tf = time.time() - t0
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'time elapsed = {0} sec'</span>.format(tf)

<span style="color: #8b0000;">print</span> f
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... ... &gt;&gt;&gt; &gt;&gt;&gt; time elapsed = 0.0780000686646 sec
&gt;&gt;&gt; 1.99999835177
</pre>

<div class="org-src-container">

<pre class="src src-python">t0 = time.time()
Xk = x[1:-1] - x[0:-2] <span style="color: #ff0000; font-weight: bold;"># vectorized version of (x[k+1] - x[k])</span>
Yk = y[1:-1] + y[0:-2] <span style="color: #ff0000; font-weight: bold;"># vectorized version of (y[k+1] + y[k])</span>

f = 0.5 * np.sum(Xk * Yk) <span style="color: #ff0000; font-weight: bold;"># vectorized version of the loop above</span>
tf = time.time() - t0
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'time elapsed = {0} sec'</span>.format(tf)

<span style="color: #8b0000;">print</span> f
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; time elapsed = 0.077999830246 sec
&gt;&gt;&gt; 1.99999340709
</pre>

<p>
In the last example, there may be loop buried in the sum command. Let us do one final method, using linear algebra, in a single line. The key to understanding this is to recognize the sum is just the result of a dot product of the x differences and y sums. 
</p>

<div class="org-src-container">

<pre class="src src-python">t0 = time.time()
f = 0.5 * np.dot(Xk, Yk)
tf = time.time() - t0
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'time elapsed = {0} sec'</span>.format(tf)

<span style="color: #8b0000;">print</span> f
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; time elapsed = 0.0310001373291 sec
&gt;&gt;&gt; 1.99999340709
</pre>

<p>
The loop method is straightforward to code, and looks alot like the formula that defines the trapezoid method. the vectorized methods are not as easy to read, and take fewer lines of code to write. However, the vectorized methods are much faster than the loop, so the loss of readability could be worth it for very large problems.
</p>

<p>
The times here are considerably slower than in Matlab. I am not sure if that is a totally fair comparison. Here I am running python through emacs, which may result in slower performance. I also used a very crude way of timing the performance which lumps some system performance in too.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/23/The-trapezoidal-method-of-integration.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/23/The-trapezoidal-method-of-integration#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Vectorized-piecewise-functions"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/02/23/Vectorized-piecewise-functions/" rel="bookmark" title="Permanent Link to Vectorized piecewise functions">Vectorized piecewise functions</a></h2>
      <p><small><span class="blog_post_date">Posted February 23, 2013 at 09:00 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/math/'>math</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/02/23/Vectorized-piecewise-functions#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 27, 2013 at 02:51 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://matlab.cheme.cmu.edu/2011/11/05/vectorized-piecewise-functions/" >Matlab post</a>
Occasionally we need to define piecewise functions, e.g.
</p>

\begin{eqnarray}
f(x) &=&  0, x < 0 \\ 
     &=&  x, 0 <= x < 1\\ 
     &=&  2 - x, 1 < x <= 2\\ 
     &=&  0, x > 2 
\end{eqnarray} 

<p>
Today we examine a few ways to define a function like this. A simple way is to use conditional statements.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f1</span>(x):
    <span style="color: #8b0000;">if</span> x &lt; 0:
        <span style="color: #8b0000;">return</span> 0
    <span style="color: #8b0000;">elif</span> (x &gt;= 0) &amp; (x &lt; 1):
        <span style="color: #8b0000;">return</span> x
    <span style="color: #8b0000;">elif</span> (x &gt;= 1) &amp; (x &lt; 2):
        <span style="color: #8b0000;">return</span> 2.0 - x
    <span style="color: #8b0000;">else:</span>
        <span style="color: #8b0000;">return</span> 0

<span style="color: #8b0000;">print</span> f1(-1)
<span style="color: #8b0000;">print</span> f1([0, 1, 2, 3])  <span style="color: #ff0000; font-weight: bold;"># does not work!</span>
</pre>
</div>

<pre class="example">
... ... ... ... ... ... ... ... &gt;&gt;&gt; 0
0
</pre>

<p>
This works, but the function is not vectorized, i.e. f([-1 0 2 3]) does not evaluate properly (it should give a list or array). You can get vectorized behavior by using list comprehension, or by writing your own loop. This does not fix all limitations, for example you cannot use the f1 function in the quad function to integrate it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

x = np.linspace(-1, 3)
y = [f1(xx) <span style="color: #8b0000;">for</span> xx <span style="color: #8b0000;">in</span> x]

plt.plot(x, y)
plt.savefig(<span style="color: #228b22;">'images/vector-piecewise.png'</span>)
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x048D6790&gt;]
</pre>

<p><img src="/img/./images/vector-piecewise.png"><p>

<p>
Neither of those methods is convenient. It would be nicer if the function was vectorized, which would allow the direct notation f1([0, 1, 2, 3, 4]). A simple way to achieve this is through the use of logical arrays. We create logical arrays from comparison statements.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f2</span>(x):
    <span style="color: #228b22;">'fully vectorized version'</span>
    x = np.asarray(x)
    y = np.zeros(x.shape)
    y += ((x &gt;= 0) &amp; (x &lt; 1)) * x
    y += ((x &gt;= 1) &amp; (x &lt; 2)) * (2 - x)
    <span style="color: #8b0000;">return</span> y

<span style="color: #8b0000;">print</span> f2([-1, 0, 1, 2, 3, 4])
x = np.linspace(-1,3);
plt.plot(x,f2(x))
plt.savefig(<span style="color: #228b22;">'images/vector-piecewise-2.png'</span>)
</pre>
</div>

<pre class="example">
... ... ... ... ... ... &gt;&gt;&gt; [ 0.  0.  1.  0.  0.  0.]
&gt;&gt;&gt; [&lt;matplotlib.lines.Line2D object at 0x043A4910&gt;]
</pre>

<p><img src="/img/./images/vector-piecewise-2.png"><p>

<p>
A third approach is to use Heaviside functions. The Heaviside function is defined to be zero for x less than some value, and 0.5 for x=0, and 1 for x &gt;= 0. If you can live with y=0.5 for x=0, you can define a vectorized function in terms of Heaviside functions like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">heaviside</span>(x):
    x = np.array(x)
    <span style="color: #8b0000;">if</span> x.shape != ():
        y = np.zeros(x.shape)
        y[x &gt; 0.0] = 1
        y[x == 0.0] = 0.5
    <span style="color: #8b0000;">else:</span> <span style="color: #ff0000; font-weight: bold;"># special case for 0d array (a number)</span>
        <span style="color: #8b0000;">if</span> x &gt; 0: y = 1
        <span style="color: #8b0000;">elif</span> x == 0: y = 0.5
        <span style="color: #8b0000;">else:</span> y = 0
    <span style="color: #8b0000;">return</span> y

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">f3</span>(x):
    x = np.array(x)
    y1 = (heaviside(x) - heaviside(x - 1)) * x <span style="color: #ff0000; font-weight: bold;"># first interval</span>
    y2 = (heaviside(x - 1) - heaviside(x - 2)) * (2 - x) <span style="color: #ff0000; font-weight: bold;"># second interval</span>
    <span style="color: #8b0000;">return</span> y1 + y2

<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad
<span style="color: #8b0000;">print</span> quad(f3, -1, 3)
</pre>
</div>

<pre class="example">
... ... ... ... ... ... ... ... ... ... &gt;&gt;&gt; ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; (1.0, 1.1102230246251565e-14)
</pre>

<div class="org-src-container">

<pre class="src src-python">plt.plot(x, f3(x))
plt.savefig(<span style="color: #228b22;">'images/vector-piecewise-3.png'</span>)
</pre>
</div>

<pre class="example">
[&lt;matplotlib.lines.Line2D object at 0x048F96F0&gt;]
</pre>

<p><img src="/img/./images/vector-piecewise-3.png"><p>

<p>
There are many ways to define piecewise functions, and vectorization is not always necessary. The advantages of vectorization are usually notational simplicity and speed; loops in python are usually very slow compared to vectorized functions.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/02/23/Vectorized-piecewise-functions.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/02/23/Vectorized-piecewise-functions#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../7">« Previous Page</a>
  --  
 <a href="../9">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2017/11/22/More-auto-differentiation-goodness-for-science-and-engineering/">More auto-differentiation goodness for science and engineering</a></li>
      <li><a href="/blog/2017/11/20/Timing-Lennard-Jones-implementations-ASE-vs-autograd/">Timing Lennard-Jones implementations - ASE vs autograd</a></li>
      <li><a href="/blog/2017/11/19/Training-the-ASE-Lennard-Jones-potential-to-DFT-calculations/">Training the ASE Lennard-Jones potential to DFT calculations</a></li>
      <li><a href="/blog/2017/11/18/Neural-networks-for-regression-with-autograd/">Neural networks for regression with autograd</a></li>
      <li><a href="/blog/2017/11/17/Using-autograd-in-nonlinear-regression/">Using autograd in nonlinear regression</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2017
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



