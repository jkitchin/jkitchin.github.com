

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Making-org-mode-links-to-files-in-Emacs-packages"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/19/Making-org-mode-links-to-files-in-Emacs-packages/" rel="bookmark" title="Permanent Link to Making org-mode links to files in Emacs packages">Making org-mode links to files in Emacs packages</a></h2>
      <p><small><span class="blog_post_date">Posted January 19, 2014 at 12:42 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/org-mode/'>org-mode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/19/Making-org-mode-links-to-files-in-Emacs-packages#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated January 19, 2014 at 03:27 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Today I will make a new org-mode link that lets me make links to files inside of Emacs packages. These files may be installed in different places on different systems (e.g. in the system directory, in ELPA directories, or in custom directories), so we need a way to construct paths to them. The application of this is eventually I hope to have some emacs packages of documentation, and I would like to have links between the packages that work no matter how they are installed.
</p>

<p>
I want a syntax that looks like pkg:rainbow-mode==rainbow-mode-pkg.el. We will have a function that parses that to get the package, and the path to the file in the package. Emacs has a function to find the path to the file that defines a library. I chose == because it seems unlikely that would be a string in a package or path. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(locate-library <span style="color: #228b22;">"rainbow-mode"</span>)
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa/rainbow-mode-0.9/rainbow-mode.elc
</pre>

<p>
We can use that to construct the path to where we want. Say we want the file named "rainbow-mode-pkg.el"
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(expand-file-name
 <span style="color: #228b22;">"rainbow-mode-pkg.el"</span>
 (file-name-directory (locate-library <span style="color: #228b22;">"rainbow-mode"</span>)))
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa/rainbow-mode-0.9/rainbow-mode-pkg.el
</pre>

<p>
In org-mode links, the link path gets passed to a function. We can split the string like this to get the package and relative path we are referring to.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(split-string <span style="color: #228b22;">"rainbow-mode==rainbow-mode-pkg.el"</span> <span style="color: #228b22;">"=="</span>)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">rainbow-mode</td>
<td class="left">rainbow-mode-pkg.el</td>
</tr>
</tbody>
</table>

<p>
That is all of the pieces we need to construct the link function. Here it is.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-add-link-type 
 <span style="color: #228b22;">"pkg"</span>
 (<span style="color: #8b0000;">lambda</span> (path)
   (<span style="color: #8b0000;">let</span> ((pkg) (relpath)
         (splitpath (split-string path <span style="color: #228b22;">"=="</span>)))
     (setq pkg (car splitpath))
     (setq relpath (nth 1 splitpath))
     (find-file (expand-file-name 
                 relpath 
                 (file-name-directory (locate-library pkg)))))))
</pre>
</div>

<p>
pkg:rainbow-mode==rainbow-mode-pkg.el  
</p>

<p>
This works too, but you have to use auctex-pkg as the package name. 
</p>

<p>
pkg:auctex-pkg==doc/intro.texi 
</p>

<p>
I think that is because locate-library looks for the <i>file</i> a library is defined in. That is not quite the same as the root directory of a package. It turns out to be a little more complicated to find that. Below is some code I hacked up looking at the package.el code. First let us examine some pieces.
</p>

<p>
This gives us information about an installed package. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(assq 'auctex package-alist)
</pre>
</div>

<pre class="example">
(auctex . [(11 87 2) nil Integrated environment for *TeX*])
</pre>

<p>
We can get the version of the package like this
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(package-version-join (package-desc-vers (cdr (assq 'auctex package-alist))))
</pre>
</div>

<pre class="example">
11.87.2
</pre>

<p>
Ok, finally, we get the directory where it is installed like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(package--dir <span style="color: #228b22;">"auctex"</span> <span style="color: #228b22;">"11.87.2"</span>)
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa/auctex-11.87.2
</pre>

<p>
Note that in some places we use a package symbol, and in other places a string name.Putting that together, we have this block to get the install-dir of a package. If we have a package symbol we can get the path like this.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((pkg 'auctex)
       (pkg-name (symbol-name pkg)) <span style="color: #ff0000; font-weight: bold;">; </span><span style="color: #ff0000; font-weight: bold;">convert symbol to string</span>
       (desc (cdr (assq pkg package-alist)))
       (version (package-version-join (package-desc-vers desc)))
       (pkg-dir (package--dir pkg-name version)))
  pkg-dir)
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa/auctex-11.87.2
</pre>

<p>
Usually, we will have a string though. We just have to make it a symbol with the <code>intern</code> function. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq pkg-name <span style="color: #228b22;">"auctex"</span>)
(setq pkg (intern pkg-name))
(setq desc (cdr (assq pkg package-alist)))
</pre>
</div>

<pre class="example">
[(11 87 2) nil "Integrated environment for *TeX*"]
</pre>

<p>
Now, we have all the pieces to get the path from a package name in a string:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let*</span> ((pkg-name <span style="color: #228b22;">"auctex"</span>)
       (pkg (intern pkg-name))
       (desc (cdr (assq pkg package-alist)))
       (version (package-version-join (package-desc-vers desc)))
       (pkg-dir (package--dir pkg-name version)))
  pkg-dir)
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa/auctex-11.87.2
</pre>

<p>
Let us use that to rewrite the link, and address a few other limitations. We will  use <code>org-open-link-from-string</code> so we can use org-link syntax in the path part of the link, e.g. to open a file at a line, or headline. Here is our new link.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-add-link-type 
 <span style="color: #228b22;">"pkg2"</span>
 (<span style="color: #8b0000;">lambda</span> (path)
   (<span style="color: #8b0000;">let</span> ((pkg) (relpath) (pkg-dir) (link-string)
         (splitpath (split-string path <span style="color: #228b22;">"=="</span>)))
     (setq pkg-name (car splitpath))
     (setq relpath (nth 1 splitpath))
     (setq pkg-dir (<span style="color: #8b0000;">let*</span> ((pkg-symbol (intern pkg-name)) <span style="color: #ff0000; font-weight: bold;">;</span><span style="color: #ff0000; font-weight: bold;">convert string to pkg                   </span>
                          (desc (cdr (assq pkg-symbol package-alist)))
                          (version (package-version-join (package-desc-vers desc)))
                          (pkg-dir (package--dir pkg-name version)))
                     pkg-dir))
     (setq link-string (format <span style="color: #228b22;">"[[file:%s/%s]]"</span> pkg-dir relpath))
     (message <span style="color: #228b22;">"link: %s"</span> link-string)
     (org-open-link-from-string link-string))))
</pre>
</div>

<p>
Now, we can do all of these: 
pkg2:auctex==doc/faq.texi   
pkg2:auctex==doc/faq.texi::should 
pkg2:auctex==doc/faq.texi::10 
<pre>pkg2:auctex==doc/faq.texi::first place</pre> 
</p>

<p>
Awesome!
</p>

<p>
Just for fun, I made a toy package called <code>package1</code> in my elpa directory. That package has an org file in it. Now, I can test out the following links:
</p>

<p>
pkg2:package1==intro.org 
</p>

<p>
pkg2:package1==intro.org::*Miscellaneous
</p>

<p>
<pre>pkg2:package1==intro.org::*subheading with words</pre> 
</p>

<p>
pkg2:package1==intro.org::#install-section
</p>

<p>
pkg2:package1==intro.org::intro-target
</p>

<p>
They all work! That works for packages installed via the package manager. However, when I try this with my custom installed org-mode, it does not work. If I run (describe-package 'org) I see that org is a build in package, and that there is an alternate version available. It does not point to my org-installation.
</p>

<p>
pkg2:org==doc/library-of-babel.org 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(princ (locate-library <span style="color: #228b22;">"org"</span>))
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/org-mode/lisp/org.elc
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(princ (package-installed-p <span style="color: #228b22;">"org"</span>))
</pre>
</div>

<pre class="example">
nil
</pre>

<p>
Obviously, we need to check if the package is installed via package.el, or if we should look somewhere else. Let us take a final stab at this. Let us review the challenge. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(print (locate-library <span style="color: #228b22;">"auctex"</span>))
(print (locate-library <span style="color: #228b22;">"auctex-autoloads"</span>))
</pre>
</div>

<pre class="example">
nil

"c:/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa/auctex-11.87.2/auctex-autoloads.el"
</pre>

<p>
We may have to check for a package-autoloads. Ww can wrap that in an <code>or</code> macro, which will return the first non-nil result.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((pkg-name <span style="color: #228b22;">"auctex"</span>))
   (file-name-directory 
    (or (locate-library pkg-name)
        (locate-library (format <span style="color: #228b22;">"%s-autoloads"</span> pkg-name)))))
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/elpa/auctex-11.87.2/
</pre>

<p>
Doing this on the org package shows that this points to a lisp directory. 
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((pkg-name <span style="color: #228b22;">"org"</span>))
   (file-name-directory 
    (or (locate-library pkg-name)
        (locate-library (format <span style="color: #228b22;">"%s-autoloads"</span> pkg-name)))))
</pre>
</div>

<pre class="example">
c:/Users/jkitchin/Dropbox/kitchingroup/jmax/org-mode/lisp/
</pre>

<p>
So, let's try a final link function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-add-link-type 
 <span style="color: #228b22;">"pkg3"</span>
 (<span style="color: #8b0000;">lambda</span> (path)
   (<span style="color: #8b0000;">let</span> ((pkg-name) (relpath)(pkg-dir) (link-string)
         (splitpath (split-string path <span style="color: #228b22;">"=="</span>)))
     (setq pkg-name (car splitpath))
     (setq relpath (nth 1 splitpath))
     (setq pkg-dir (file-name-directory 
                    (or (locate-library pkg-name)
                        (locate-library (format <span style="color: #228b22;">"%s-autoloads"</span> pkg-name)))))
(setq link-string (format <span style="color: #228b22;">"[[file:%s/%s]]"</span> pkg-dir relpath))
     (message <span style="color: #228b22;">"link: %s"</span> link-string)
     (org-open-link-from-string link-string))))
</pre>
</div>

<p>
Now, we just have to make sure to use the right relative path. This link opens up an org-file in my installed version of org-mode: <pre>pkg3:org==../doc/library-of-babel.org</pre> 
</p>

<p>
I don't know if there is a more clever way to create these links. There are two parts to them: 1) the package, and 2) the relative path. The link syntax isn't that rich to do it without parsing the linkpath.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/19/Making-org-mode-links-to-files-in-Emacs-packages.org">org-mode source</a><p><p>Org-mode version = 8.2.5f</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/19/Making-org-mode-links-to-files-in-Emacs-packages#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Send-email-to-a-list-of-users"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/13/Send-email-to-a-list-of-users/" rel="bookmark" title="Permanent Link to Send email to a list of users">Send email to a list of users</a></h2>
      <p><small><span class="blog_post_date">Posted January 13, 2014 at 06:41 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs-lisp/'>emacs-lisp</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/13/Send-email-to-a-list-of-users#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated January 13, 2014 at 06:42 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I have a need to send a lot of emails to users in my class. I have to send each student an email containing there userid and a password assigned to them. I have a list of these, so the strategy is to create a function that will email that information to one user, and then use mapcar to apply the function to each pair in a list.  First, we work out a function that will send one email to one user.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">send-mail</span> (userid password)
  <span style="color: #228b22;">"send email to userid@andrew.cmu.edu containing their password"</span>
  (interactive)
  (mail)
  (mail-to)
  (insert (format <span style="color: #228b22;">"%s@andrew.cmu.edu"</span> userid))
  (mail-subject)
  (insert <span style="color: #228b22;">"[06-640] account information"</span>)
  (mail-text)
  (insert (format <span style="color: #228b22;">"</span>
<span style="color: #228b22;">An account has been created on gilgamesh.cheme.cmu.edu</span>
<span style="color: #228b22;">userid: %s</span>
<span style="color: #228b22;">password: %s"</span> userid password))
  (mail-send-and-exit))

(send-mail <span style="color: #228b22;">"jkitchin"</span> <span style="color: #228b22;">"trustme99"</span>)
</pre>
</div>

<p>
That worked well. I ran the block and got the email. 
</p>

<p>
Now, suppose I have this data:
</p>
<table id="users" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">userid</th>
<th scope="col" class="left">password</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">user1</td>
<td class="left">trustme99</td>
</tr>

<tr>
<td class="left">user2</td>
<td class="left">foolme99</td>
</tr>

<tr>
<td class="left">user3</td>
<td class="left">blameme99</td>
</tr>
</tbody>
</table>

<p>
We can pass that to a source block as a list of lists that will look like this:
</p>
<pre class="example">
 ((user1 trustme99) (user2 foolme99) (user3 blameme99))
</pre>

<p>
Then, we can use a mapcar to process each element. Here I use a dummy function with two arguments. If I substitute the function above, each of these users would get an email.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">fun</span> (a b)
  (princ (format <span style="color: #228b22;">"user: %s\npassword: %s\n"</span> a b)))

(mapcar (<span style="color: #8b0000;">lambda</span> (x) (fun (car x) (cadr x))) data)
</pre>
</div>

<pre class="example">
user: user1
password: trustme99
user: user2
password: foolme99
user: user3
password: blameme99
</pre>

<p>
I am not sure that is the best way to get the first and second elements in the list element. It looks funny to me, but it works fine. the alternative is not much prettier:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">fun</span> (a b)
  (princ (format <span style="color: #228b22;">"user: %s\npassword: %s\n"</span> a b)))

(mapcar (<span style="color: #8b0000;">lambda</span> (x) (fun (nth 0 x) (nth 1 x))) data)
</pre>
</div>

<pre class="example">
user: user1
password: trustme99
user: user2
password: foolme99
user: user3
password: blameme99
</pre>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/13/Send-email-to-a-list-of-users.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/13/Send-email-to-a-list-of-users#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Finding-bibtex-entries-with-no-downloaded-pdf"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/08/Finding-bibtex-entries-with-no-downloaded-pdf/" rel="bookmark" title="Permanent Link to Finding bibtex entries with no downloaded pdf">Finding bibtex entries with no downloaded pdf</a></h2>
      <p><small><span class="blog_post_date">Posted January 08, 2014 at 10:27 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bibtex/'>bibtex</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/08/Finding-bibtex-entries-with-no-downloaded-pdf#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated January 08, 2014 at 10:41 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
We use bibtex for bibiliography management in our group. Almost every journal provides a utility to download bibtex entries, and you can pretty easily download bibtex entries from citeulike. It doesn't take too long though before you have a few hundred entries. You need some tools to interact with that database.
</p>

<p>
Bibtex-mode in Emacs provides some tools for working with your bibtex files. For example, you can (bibtex-validate) to check if entries are correct, and (bibtex-sort-buffer) to sort them by key. 
</p>

<p>
I have a specific workflow to entering new entries. This is what I prefer to do:
</p>

<ol class="org-ol">
<li>Go to journal, get bibtex entry, paste into bibtex file.
</li>
<li>delete the key that is used, if any
</li>
<li>type C-c C-c to autogenerate a key of my style
</li>
<li>Copy the key, download the pdf, and save the pdf as (format "%s.pdf" key) in my pdfs directory.
</li>
<li>Make an entry in a notes file for that reference. These entries are initially tagged as TODO to remind me to organize them.
</li>
</ol>

<p>
Doing this has some payoffs; my org-mode cite links can open either the bibtex entry, or the pdf file directly from the org-file! The notes file is also an org-file, which I can organize as I see fit. 
</p>

<p>
Sometimes I am lazy, and do not get all these steps done, especially the pdf download step. I like to have local copies of the pdf files so I can read them even if I am offline, and because I often annotate them using a tablet PC. It also makes it easy to send them to my students if I need to. Periodically, I like to go through my bibtex database to do some maintenance, download missing files, and notes entries etc&#x2026; The problem is how do I know which entries have downloaded pdfs or note entries? It is not that difficult with a bit of elisp. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(find-file <span style="color: #228b22;">"~/Dropbox/bibliography/references.bib"</span>)
(bibtex-map-entries (<span style="color: #8b0000;">lambda</span> (bibtex-key start end) 
                      (<span style="color: #8b0000;">let</span> ((type  (cdr (car (bibtex-parse-entry)))))                        
                        (<span style="color: #8b0000;">unless</span> (file-exists-p 
                                 (format <span style="color: #228b22;">"~/Dropbox/bibliography/bibtex-pdfs/%s.pdf"</span> bibtex-key))
                          (princ (format <span style="color: #228b22;">"%10s:  cite:%s has no pdf\n"</span> type bibtex-key))))))
</pre>
</div>

<pre class="example">
      Book:  cite:ambrose-2010-how-learn-works has no pdf
   article:  cite:gerken-2010-fluor-modul has no pdf
      Book:  cite:gray-1973-chemic-bonds has no pdf
   ARTICLE:  cite:kitchin-2003-tio2 has no pdf
   ARTICLE:  cite:kitchin-2012-prefac has no pdf
      Book:  cite:kittel-2005-introd-solid has no pdf
   ARTICLE:  cite:mccormick-2003-tio2-pd has no pdf
   ARTICLE:  cite:mhadeshwar-2004-nh3-ru has no pdf
      Misc:  cite:ni-website has no pdf
   ARTICLE:  cite:norskov-2006-respon has no pdf
      Book:  cite:reif-1965-fundam-statis has no pdf
   article:  cite:risch-2012-water-oxidat has no pdf
   ARTICLE:  cite:shultz-1995-prepar-and has no pdf
   ARTICLE:  cite:shultz-1997-prepar has no pdf
   ARTICLE:  cite:song-2002-h3pw1 has no pdf
</pre>

<p>
Using that list, I can click on those links, which takes me to the entry in file. That entry probably has a url or doi that makes it easy to navigate to the journal page where I can download the pdf file. You could improve on the code above by filtering out only articles, for example.  
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/08/Finding-bibtex-entries-with-no-downloaded-pdf.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/08/Finding-bibtex-entries-with-no-downloaded-pdf#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Finding-bibtex-entries-with-non-ascii-characters"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/08/Finding-bibtex-entries-with-non-ascii-characters/" rel="bookmark" title="Permanent Link to Finding bibtex entries with non-ascii characters">Finding bibtex entries with non-ascii characters</a></h2>
      <p><small><span class="blog_post_date">Posted January 08, 2014 at 09:49 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/bibtex/'>bibtex</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/08/Finding-bibtex-entries-with-non-ascii-characters#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I have found that some journals cannot handle bibtex entries with non-ascii characters in them. Unfortunately, when you paste bibtex entries into your reference file from the web, there are often non-ascii characters in them. Emacs usually shows those characters just fine, so it is difficult to find them. Here is a little recipe to go through each entry to find entries with non-ascii characters. These range from accented characters, greek letters, degree symbols, dashes, fancy quotes, etc&#x2026; Since they are hard to see by eye, we can let Emacs find them for us, and then replace them with the corresponding ascii LaTeX commands. 
</p>

<p>
I found a function to find non-ascii characters here: <a href="http://www.emacswiki.org/emacs/FindingNonAsciiCharacters">http://www.emacswiki.org/emacs/FindingNonAsciiCharacters</a> . Now, we use a modified version of this on each entry in a bibtex file. If we find a character, we will print an org-mode link to make it easy to get right to the entry.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">contains-non-ascii-char-p</span> ()
  <span style="color: #228b22;">"tests if buffer contains non-ascii character"</span>
  (interactive)
  (<span style="color: #8b0000;">let</span> (point)
    (<span style="color: #8b0000;">save-excursion</span>
      (setq point
            (<span style="color: #8b0000;">catch</span> '<span style="color: #cd0000;">non-ascii</span>
              (<span style="color: #8b0000;">while</span> (not (eobp))
                (or (eq (char-charset (following-char))
                        'ascii)
                    (<span style="color: #8b0000;">throw</span> '<span style="color: #cd0000;">non-ascii</span> (point)))
                (forward-char 1)))))
    (<span style="color: #8b0000;">if</span> point
        (goto-char point)
      nil)))


(find-file <span style="color: #228b22;">"~/Dropbox/bibliography/references.bib"</span>)
(bibtex-map-entries (<span style="color: #8b0000;">lambda</span> (bibtex-key start end)                        
                      (<span style="color: #8b0000;">save-restriction</span>
                        <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">narrow so we only look at this entry. save-restriction will rewiden</span>
                        (bibtex-narrow-to-entry)
                        (<span style="color: #8b0000;">when</span> (contains-non-ascii-char-p) (princ (format <span style="color: #228b22;">"cite:%s"</span> bibtex-key)))))))
</pre>
</div>

<pre class="example">
cite:suntivich-2011-perov-oxide
</pre>

<p>
You can see I only had one reference in that file with a non-ascii character. I think it is best practice to replace these with pure LaTeX commands. See <a href="http://en.wikibooks.org/wiki/LaTeX/Special_Characters">http://en.wikibooks.org/wiki/LaTeX/Special_Characters</a> for a good reference on what commands are used for the accented characters.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/08/Finding-bibtex-entries-with-non-ascii-characters.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/08/Finding-bibtex-entries-with-non-ascii-characters#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="A-function-to-save-an-org-file-for-submitting-assignments-in-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/01/A-function-to-save-an-org-file-for-submitting-assignments-in-org-mode/" rel="bookmark" title="Permanent Link to A function to save an org-file for submitting assignments in org-mode">A function to save an org-file for submitting assignments in org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted January 01, 2014 at 02:55 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/org-mode/'>org-mode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/01/A-function-to-save-an-org-file-for-submitting-assignments-in-org-mode#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
I am going to be assigning homeworks and quizzes in org-mode next semester, and it would be nice if there was a function that would save the file with the right name in the right place. The file will have some keywords at the top to identify the student, course and assignment. Those look like:
</p>
<pre class="example">
#+NAME: John Kitchin
#+ANDREWID: jkitchin
#+COURSE: 06-640
#+ASSIGNMENT: quiz1
</pre>

<p>
I would like a function that saves the current buffer to a file like /some-path/ANDREWID-COURSE-ASSIGNMENT.org. That will be "turning the assignment in" so I can do some analysis of the files. I previously wrote about getting keywords from org-files <a href="http://kitchingroup.cheme.cmu.edu/blog/2013/05/05/Getting-keyword-options-in-org-files/">here</a> . We will build on that to accomplish this goal. Here is the function that seems to do what I want. For now it saves the file in the same directory, with the correct name.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">submit-assignment</span> ()
  <span style="color: #228b22;">"Save current buffer to assignment. You must set #+ANDREWID, #+COURSE and #+ASSIGNMENT. There is no checking for this."</span>
  (interactive)
  (save-buffer)
  (<span style="color: #8b0000;">let</span> ((org-keywords (org-element-map (org-element-parse-buffer 'element) 'keyword
                        (<span style="color: #8b0000;">lambda</span> (keyword) (cons (org-element-property <span style="color: #cd0000;">:key</span> keyword)
                                                (org-element-property <span style="color: #cd0000;">:value</span> keyword)))))
        (assignment-content (buffer-string)) <span style="color: #ff0000; font-weight: bold;">; </span><span style="color: #ff0000; font-weight: bold;">store contents to write to file later</span>
        (assignment-filename))
    <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">create the filename we will save the buffer in</span>
    (setq assignment-filename (concat (cdr (assoc <span style="color: #228b22;">"ANDREWID"</span> org-keywords))
                                      <span style="color: #228b22;">"-"</span>
                                      (cdr (assoc <span style="color: #228b22;">"COURSE"</span> org-keywords))
                                      <span style="color: #228b22;">"-"</span>
                                      (cdr (assoc <span style="color: #228b22;">"ASSIGNMENT"</span> org-keywords))
                                      <span style="color: #228b22;">".org"</span>))
    <span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">now write out contents to filename</span>
    (<span style="color: #8b0000;">with-temp-file</span> assignment-filename
      (insert assignment-content))
    (message <span style="color: #228b22;">"%s was submitted"</span> assignment-filename)))

(submit-assignment)
</pre>
</div>

<pre class="example">
jkitchin-06-640-quiz1.org was submitted
</pre>

<p>
Now, we have a nice function that can be put as a link in the org-file: <pre>elisp:submit-assignment</pre> , or <pre>elisp:submit-assignment</pre> . The assignment will be copied to a location specified, and I can grade it, assess it, etc&#x2026; from there. That function will have to be loaded by students, but since I provide them with lisp files that are loaded at startup that should not be an issue. 
</p>

<p>
This solution lacks some features I have to think about. For example, if the path where everyone submits to is common, everyone will be able to read the file, which is not desirable. It is also not feasible to make the submitted files read-only to the students this way (so they cannot modify the files after they turn them in). I could have the submit function do something like submit to box.com by email.
</p>

<p>
I am not sure how grading of these files would go. In the past, I have preferred PDF files (which you can export org to) because I could grade them using a tablet without modifying the actual content in the files. However it would not be simple at all to export an org-file to PDF with that data in a machine readable way. One point of having them in org-mode is that I could collect statistics from the headings of many files pretty easily. I have written code to annotate org-files in the past, which I might have to dig out. 
</p>

<p>
There is a limitation of the submit function, and that is if the org-file references images or other files (I would expect many of my assignments would have plots in them). Those would not be copied to the right place. I handle those when I publish the blog, so it could be done. But, it would require creating a new directory, and writing all the files to it (including making sure the relative paths are handled correctly), or creating some kind of zip-archive that contains everything. That sounds like a project for another day!
</p>

<div class="inlinetask">
<b><span class="todo TODO">TODO</span> rewrite the submit-assignment function to copy any images or files it links to into the submission directory</b><br  />
nil</div>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/01/A-function-to-save-an-org-file-for-submitting-assignments-in-org-mode.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/01/A-function-to-save-an-org-file-for-submitting-assignments-in-org-mode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../1">« Previous Page</a>
  --  
 <a href="../3">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/01/27/New-publication-in-Topics-in-Catalysis/">New publication in Topics in Catalysis</a></li>
      <li><a href="/blog/2018/01/03/New-publication-in-Molecular-Simulation/">New publication in Molecular Simulation</a></li>
      <li><a href="/blog/2017/12/31/2017-in-a-nutshell-for-the-Kitchin-Research-group/">2017 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2017/11/29/Solving-an-eigenvalue-differential-equation-with-a-neural-network/">Solving an eigenvalue differential equation with a neural network</a></li>
      <li><a href="/blog/2017/11/28/Solving-ODEs-with-a-neural-network-and-autograd/">Solving ODEs with a neural network and autograd</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



