

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Writing-lisp-code-from-Python"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/05/30/Writing-lisp-code-from-Python/" rel="bookmark" title="Permanent Link to Writing lisp code from Python">Writing lisp code from Python</a></h2>
      <p><small><span class="blog_post_date">Posted May 30, 2016 at 09:26 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a>, <a href='/blog/category/lisp/'>lisp</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated May 30, 2016 at 12:38 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Some time ago I <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/05/16/Python-data-structures-to-lisp/">wrote about converting python data structures to lisp</a> . I have expanded on that idea to writing lisp programs from Python! The newly expanded code that makes this possible can be found at <a href="https://github.com/jkitchin/pycse/blob/master/pycse/lisp.py">https://github.com/jkitchin/pycse/blob/master/pycse/lisp.py</a> .
</p>

<p>
Here are the simple data types known to pycse.lisp:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">"a string"</span>.lisp)
<span style="color: #BA36A5;">a</span> = 5
<span style="color: #BA36A5;">b</span> = 5.0
<span style="color: #0000FF;">print</span>(a.lisp)
<span style="color: #0000FF;">print</span>(b.lisp)
<span style="color: #0000FF;">print</span>([1, 2, 3].lisp)
<span style="color: #0000FF;">print</span>((1, 2, 3).lisp)
<span style="color: #0000FF;">print</span>({<span style="color: #008000;">'a'</span>: 4}.lisp)
<span style="color: #0000FF;">print</span>(np.array([1, 2, 3]).lisp)
<span style="color: #0000FF;">print</span>(np.array([1.0, 2.0, 3.0]).lisp)
</pre>
</div>

<pre class="example">
"a string"
5
5.0
(1 2 3)
(1 2 3)
(:a 4)
(1 2 3)
(1.0 2.0 3.0)
</pre>

<p>
There are also some more complex types.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl

<span style="color: #0000FF;">print</span>(pl.Symbol(<span style="color: #008000;">'lambda'</span>))
<span style="color: #0000FF;">print</span>(pl.Quote(<span style="color: #008000;">'lambda'</span>))
<span style="color: #0000FF;">print</span>(pl.SharpQuote(<span style="color: #008000;">'lambda'</span>))
<span style="color: #0000FF;">print</span>(pl.Cons(<span style="color: #008000;">"a"</span>, 5))
<span style="color: #0000FF;">print</span>(pl.Alist([<span style="color: #008000;">"a"</span>, 2, <span style="color: #008000;">"b"</span>, 5]))
<span style="color: #0000FF;">print</span>(pl.Vector([1, 2, 3]))

<span style="color: #0000FF;">print</span>(pl.Backquote([]))
<span style="color: #0000FF;">print</span>(pl.Comma([1, 2, 3]))
<span style="color: #0000FF;">print</span>(pl.Splice([1, 2, 3]))
</pre>
</div>

<pre class="example">
lambda
'lambda
#'lambda
("a" . 5)
(("a" . 2) ("b" . 5))
[1 2 3]
`()
,(1 2 3)
,@(1 2 3)
</pre>

<p>
You can nest these too.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl
<span style="color: #0000FF;">print</span>(pl.Quote(pl.Alist([<span style="color: #008000;">"a"</span>, 2, <span style="color: #008000;">"b"</span>, 5])))
<span style="color: #0000FF;">print</span>(pl.Backquote([pl.Symbol(<span style="color: #008000;">'+'</span>), pl.Comma(pl.Symbol(<span style="color: #008000;">'b'</span>)), 5]))
</pre>
</div>

<pre class="example">
'(("a" . 2) ("b" . 5))
`(+ ,b 5)
</pre>

<p>
All that means we can use Python <i>code</i> to generate lisp programs. Here is an example where we make two sub-programs, and combine them into an overall program, then add one more subprogram to it. We wrap the results in an emacs-lisp block, then actually run the block!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl

<span style="color: #BA36A5;">p1</span> = [pl.Symbol(<span style="color: #008000;">'mapcar'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [pl.Symbol(<span style="color: #008000;">'lambda'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [pl.Symbol(<span style="color: #008000;">'x'</span>)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [pl.Symbol(<span style="color: #008000;">'*'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pl.Symbol(<span style="color: #008000;">'x'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pl.Symbol(<span style="color: #008000;">'x'</span>)]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> pl.Quote([1, 2, 3, 4])]

<span style="color: #BA36A5;">p2</span> = [pl.Symbol(<span style="color: #008000;">'princ'</span>), <span style="color: #008000;">"Hello world"</span>]

<span style="color: #BA36A5;">p</span> = [pl.Symbol(<span style="color: #008000;">'list'</span>), p1, p2]
p.append([pl.Symbol(<span style="color: #008000;">'+'</span>), 5, 5])

<span style="color: #0000FF;">print</span>(p.lisp)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(list (mapcar (<span style="color: #0000FF;">lambda</span> (x) (* x x)) '(1 2 3 4)) (princ <span style="color: #008000;">"Hello world"</span>) (+ 5 5))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">(1 4 9 16)</td>
<td class="left">Hello world</td>
<td class="right">10</td>
</tr>
</tbody>
</table>

<p>
Wow, it worked! Here is another example of setting up a macro and then running it.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.lisp <span style="color: #0000FF;">as</span> pl
<span style="color: #BA36A5;">s</span> = pl.Symbol
<span style="color: #BA36A5;">bq</span> = pl.Backquote
<span style="color: #BA36A5;">c</span> = pl.Comma

<span style="color: #BA36A5;">p1</span> = [s(<span style="color: #008000;">'defmacro'</span>), s(<span style="color: #008000;">'f'</span>), [s(<span style="color: #008000;">'x'</span>)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">"A docstring"</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> bq([s(<span style="color: #008000;">'*'</span>), c(s(<span style="color: #008000;">'x'</span>)), 5])]


<span style="color: #BA36A5;">p2</span> = [s(<span style="color: #008000;">'f'</span>), 5]

<span style="color: #0000FF;">print</span>(p1.lisp)

<span style="color: #0000FF;">print</span>(p2.lisp)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">f</span> (x) <span style="color: #036A07;">"A docstring"</span> `(* ,x 5))
(<span style="color: #0000FF;">f</span> 5)
</pre>
</div>

<pre class="example">
25
</pre>

<p>
I am not too sure where this will be super useful, but it is an interesting proof of concept. I haven't tested this much beyond the original post and this one. Let me know if you find issues with it.</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/30/Writing-lisp-code-from-Python.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2016/05/30/Writing-lisp-code-from-Python">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Expanding-orgmode-py-to-get-better-org-python-integration"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/05/29/Expanding-orgmode-py-to-get-better-org-python-integration/" rel="bookmark" title="Permanent Link to Expanding orgmode.py to get better org-python integration">Expanding orgmode.py to get better org-python integration</a></h2>
      <p><small><span class="blog_post_date">Posted May 29, 2016 at 02:03 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a>, <a href='/blog/category/orgmode/'>orgmode</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated May 29, 2016 at 03:51 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. A Figure from Python</a></li>
<li><a href="#sec-2">2. An example table.</a></li>
<li><a href="#sec-3">3. Miscellaneous outputs</a></li>
<li><a href="#sec-4">4. Summary</a></li>
</ul>
</div>
</div>

<p>
I have only ever been about 80% satisfied with Python/org-mode integration. I have developed a particular workflow that I like a lot, and works well for solving scientific and engineering problems. I typically use stand-alone Python blocks, i.e. not sessions. I tend to use print statements to create output that I want to see, e.g. the value of a calculation. I also tend to create multiple figures in a single block, which I want to display in the buffer. This workflow is represented extensively in <a href="http://kitchingroup.cheme.cmu.edu/pycse/">PYCSE</a> and <a href="https://github.com/jkitchin/dft-book">dft-book</a> which collectively have 700+ src blocks! So I use it alot ;)
</p>

<p>
There are some deficiencies though. For one, I have had to hand build any figures/tables that are generated from the code blocks. That means duplicating filenames, adding the captions, etc&#x2026; It is not that easy to update captions from the code blocks, and there has been limited ability to use markup in the output.
</p>

<p>
Well finally I had some ideas to change this. The ideas are:
</p>

<ol class="org-ol">
<li>Patch matplotlib so that savefig actually returns a figure link that can be printed to the output. savefig works the same otherwise.
</li>

<li>Patch matplotlib.pyplot.show to save the figure, and print a figure link in thhe output.
</li>

<li>Create special functions to generate org tables and figures.
</li>

<li>Create some other functions to generate some blocks and elements.
</li>
</ol>

<p>
Then we could just import the library in our Python scripts (or add it as a prologue) and get this nice functionality. You can find the code for this here:
</p>

<p>
<a href="https://github.com/jkitchin/pycse/blob/master/pycse/orgmode.py">https://github.com/jkitchin/pycse/blob/master/pycse/orgmode.py</a> 
</p>

<p>
Finally, it seems like a good idea to specify that we want our results to be an org drawer. This makes the figures/tables export, and allows us to generate math and other markup in our programs. That has the downside of making exported results not be in the "verbatim" markup I am used to, but that may be solvable in other ways. We can make the org drawer output the default like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> org-babel-default-header-args:python
      (cons '(<span style="color: #006FE0;">:results</span> . <span style="color: #008000;">"output org drawer replace"</span>)
            (assq-delete-all <span style="color: #006FE0;">:results</span> org-babel-default-header-args)))
</pre>
</div>

<p>
With these, using Python blocks in org-mode gets quite a bit better!
</p>

<p>
Here is the first example, with savefig. I have the savefig function return the link, so we have to print it. We use this feature later. The figure is automatically inserted to the buffer. Like magic!
</p>

<p>
Here is a fun figure from <a href="http://matplotlib.org/xkcd/examples/pie_and_polar_charts/polar_scatter_demo.html">http://matplotlib.org/xkcd/examples/pie_and_polar_charts/polar_scatter_demo.html</a> 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode

<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.xkcd()

<span style="color: #BA36A5;">N</span> = 150
<span style="color: #BA36A5;">r</span> = 2 * np.random.rand(N)
<span style="color: #BA36A5;">theta</span> = 2 * np.pi * np.random.rand(N)
<span style="color: #BA36A5;">area</span> = 200 * r**2 * np.random.rand(N)
<span style="color: #BA36A5;">colors</span> = theta

<span style="color: #BA36A5;">ax</span> = plt.subplot(111, polar=<span style="color: #D0372D;">True</span>)
<span style="color: #BA36A5;">c</span> = plt.scatter(theta, r, c=colors, s=area, cmap=plt.cm.hsv)
c.set_alpha(0.75)

<span style="color: #0000FF;">print</span>(plt.savefig(<span style="color: #008000;">'test.png'</span>))
</pre>
</div>


<div class="figure">
<p><img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/test.png"> 
</p>
</div>

<p>
How about another example with show. This just prints the link directly. It seems to make sense to do it that way. This is from <a href="http://matplotlib.org/xkcd/examples/showcase/xkcd.html">http://matplotlib.org/xkcd/examples/showcase/xkcd.html</a> .
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org

<span style="color: #0000FF;">from</span> matplotlib <span style="color: #0000FF;">import</span> pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

plt.xkcd()

<span style="color: #BA36A5;">fig</span> = plt.figure()
<span style="color: #BA36A5;">ax</span> = fig.add_subplot(1, 1, 1)
ax.spines[<span style="color: #008000;">'right'</span>].set_color(<span style="color: #008000;">'none'</span>)
ax.spines[<span style="color: #008000;">'top'</span>].set_color(<span style="color: #008000;">'none'</span>)
plt.xticks([])
plt.yticks([])
ax.set_ylim([-30, 10])

<span style="color: #BA36A5;">data</span> = np.ones(100)
<span style="color: #BA36A5;">data</span>[70:] -= np.arange(30)

plt.annotate(
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'THE DAY I REALIZED\nI COULD COOK BACON\nWHENEVER I WANTED'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xy=(70, 1), arrowprops=<span style="color: #006FE0;">dict</span>(arrowstyle=<span style="color: #008000;">'-&gt;'</span>), xytext=(15, -10))

plt.plot(data)

plt.xlabel(<span style="color: #008000;">'time'</span>)
plt.ylabel(<span style="color: #008000;">'my overall health'</span>)
plt.show()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">An intermediate result</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Some intermediate result for x - 4 = 6:'</span>)
<span style="color: #BA36A5;">x</span> = 6 + 4
org.fixed_width(<span style="color: #008000;">'x = {}'</span>.<span style="color: #006FE0;">format</span>(x))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">And another figure</span>
<span style="color: #BA36A5;">fig</span> = plt.figure()
<span style="color: #BA36A5;">ax</span> = fig.add_subplot(1, 1, 1)
ax.bar([-0.125, 1.0-0.125], [0, 100], 0.25)
ax.spines[<span style="color: #008000;">'right'</span>].set_color(<span style="color: #008000;">'none'</span>)
ax.spines[<span style="color: #008000;">'top'</span>].set_color(<span style="color: #008000;">'none'</span>)
ax.xaxis.set_ticks_position(<span style="color: #008000;">'bottom'</span>)
ax.set_xticks([0, 1])
ax.set_xlim([-0.5, 1.5])
ax.set_ylim([0, 110])
ax.set_xticklabels([<span style="color: #008000;">'CONFIRMED BY\nEXPERIMENT'</span>, <span style="color: #008000;">'REFUTED BY\nEXPERIMENT'</span>])
plt.yticks([])

plt.title(<span style="color: #008000;">"CLAIMS OF SUPERNATURAL POWERS"</span>)

plt.show()
</pre>
</div>

<p>
<img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/56bc77cfebd90f8a1cb22421c1c4f2c4a05fedeb.png"> 
Some intermediate result for x - 4 = 6:
</p>
<pre class="example">
x = 10
</pre>

<div class="figure">
<p><img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/2daee706d3b906a25914a6ca975906047af7fa35.png"> 
</p>
</div>

<p>
See, the figures show where they belong, with intermediate results that have some formatting, and they export correctly. Nice.
</p>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> A Figure from Python</h2>
<div class="outline-text-2" id="text-1">
<p>
It has been a long desire of mine to generate full figures with captions from code blocks, and to get them where I want like this one:
</p>


<div id="fig:1" class="figure">
<p><img src="/media/2016-05-29-Expanding-orgmode.py-to-get-better-org-python-integration/smarts.png"> 
</p>
<p><span class="figure-number">Figure 3:</span> An italicized <i>histogram</i> of 10000 points</p>
</div>

<p>
Here is the code to generate the full figure. Note we use the output of savefig as the filename. That lets us save some intermediate variable construction. That seems nice.
</p>

<div class="org-src-container">

<pre class="src src-python" id="fig-1"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.xkcd()

<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.mlab <span style="color: #0000FF;">as</span> mlab
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">example data</span>
<span style="color: #BA36A5;">mu</span> = 100 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">mean of distribution</span>
<span style="color: #BA36A5;">sigma</span> = 15 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">standard deviation of distribution</span>
<span style="color: #BA36A5;">x</span> = mu + sigma * np.random.randn(10000)

<span style="color: #BA36A5;">num_bins</span> = 50
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the histogram of the data</span>
<span style="color: #BA36A5;">n</span>, <span style="color: #BA36A5;">bins</span>, <span style="color: #BA36A5;">patches</span> = plt.hist(x, num_bins, normed=1, facecolor=<span style="color: #008000;">'green'</span>, alpha=0.5)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">add a 'best fit' line</span>
<span style="color: #BA36A5;">y</span> = mlab.normpdf(bins, mu, sigma)
plt.plot(bins, y, <span style="color: #008000;">'r--'</span>)
plt.xlabel(<span style="color: #008000;">'Smarts'</span>)
plt.ylabel(<span style="color: #008000;">'Probability'</span>)
plt.title(r<span style="color: #008000;">'Histogram of IQ: $\mu=100$, $\sigma=15$'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Tweak spacing to prevent clipping of ylabel</span>
plt.subplots_adjust(left=0.15)

org.figure(plt.savefig(<span style="color: #008000;">'smarts.png'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  label=<span style="color: #008000;">'fig:1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  caption=<span style="color: #008000;">'An italicized /histogram/ of {} points'</span>.<span style="color: #006FE0;">format</span>(<span style="color: #006FE0;">len</span>(x)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  attributes=[(<span style="color: #008000;">'LATEX'</span>, <span style="color: #008000;">':width 3in'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (<span style="color: #008000;">'HTML'</span>, <span style="color: #008000;">':width 300'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (<span style="color: #008000;">'ORG'</span>, <span style="color: #008000;">':width 300'</span>)])
</pre>
</div>

<p>
That is pretty awesome. You cannot put figures in more than one place like this, and you might not want to mix results with this, but it is still pretty awesome!
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> An example table.</h2>
<div class="outline-text-2" id="text-2">
<p>
Finally, I have wanted the same thing for tables. Here is the resulting table.
</p>

<table id="table-1" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Dependence of the energy on the encut value.</caption>

<colgroup>
<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="right">ENCUT</th>
<th scope="col" class="right">Energy (eV)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="right">100</td>
<td class="right">11.233</td>
</tr>

<tr>
<td class="right">200</td>
<td class="right">21.233</td>
</tr>

<tr>
<td class="right">300</td>
<td class="right">31.233</td>
</tr>

<tr>
<td class="right">400</td>
<td class="right">41.233</td>
</tr>

<tr>
<td class="right">500</td>
<td class="right">51.233</td>
</tr>
</tbody>
</table>

<p>
Here is the code block that generated it.
</p>

<div class="org-src-container">

<pre class="src src-python" id="table-1"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org

<span style="color: #BA36A5;">data</span> = [[<span style="color: #008000;">'&lt;5&gt;'</span>, <span style="color: #008000;">'&lt;11&gt;'</span>],  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Column aligners</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [<span style="color: #008000;">'ENCUT'</span>, <span style="color: #008000;">'Energy (eV)'</span>],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #D0372D;">None</span>]

<span style="color: #0000FF;">for</span> encut <span style="color: #0000FF;">in</span> [100, 200, 300, 400, 500]:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">data</span> += [[encut, 1.233 + 0.1 * encut]]

org.table(data,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> name=<span style="color: #008000;">'table-1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> caption=<span style="color: #008000;">'Dependence of the energy on the encut value.'</span>)
</pre>
</div>


<p>
The only obvious improvement on this is similar to getting images to redisplay after running a code block, it might be nice to reformat tables to make sure they are pretty looking. Otherwise this is good.
</p>


<p>
Let's go ahead and try that. Here we narrow down to the results, and align the tables in that region.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-align-visible-tables</span> ()
  <span style="color: #036A07;">"Align all the tables in the results."</span>
  (<span style="color: #0000FF;">let</span> ((location (org-babel-where-is-src-block-result)) start)
    (<span style="color: #0000FF;">when</span> location
      (<span style="color: #0000FF;">setq</span> start (- location 1))
      (<span style="color: #0000FF;">save-restriction</span>
        (<span style="color: #0000FF;">save-excursion</span>
          (goto-char location) (forward-line 1)
          (narrow-to-region start (org-babel-result-end))
          (goto-char (point-min))
          (<span style="color: #0000FF;">while</span> (re-search-forward org-table-any-line-regexp nil t)
            (<span style="color: #0000FF;">save-excursion</span> (org-table-align))
            (<span style="color: #0000FF;">or</span> (looking-at org-table-line-regexp)
                (forward-char 1)))
          (re-search-forward org-table-any-border-regexp nil 1))))))

(add-hook 'org-babel-after-execute-hook
          (<span style="color: #0000FF;">lambda</span> () (org-align-visible-tables)))
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">lambda</td>
<td class="left">nil</td>
<td class="left">(org-align-visible-tables)</td>
</tr>

<tr>
<td class="left">lambda</td>
<td class="left">nil</td>
<td class="left">(org-refresh-images)</td>
</tr>
</tbody>
</table>

<p>
And that seems to solve that problem now too!
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Miscellaneous outputs</h2>
<div class="outline-text-2" id="text-3">
<p>
Here are some examples of getting org-output from the pycse.orgmode module.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org

org.verbatim(<span style="color: #008000;">'One liner verbatim'</span>)

org.verbatim(<span style="color: #008000;">'''multiline</span>
<span style="color: #008000;">output</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">  with indentation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">  at a few levels</span>
<span style="color: #008000;">that is verbatim.'''</span>)

org.fixed_width(<span style="color: #008000;">'your basic result'</span>)

org.fixed_width(<span style="color: #008000;">'''your</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;"> basic</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   result</span>
<span style="color: #008000;">on a few lines.'''</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">A latex block</span>
org.latex(<span style="color: #008000;">'\(e^{i\pi} - 1 = 0\)'</span>)

org.org(r<span style="color: #008000;">'The equation is \(E = h \nu\).'</span>)
</pre>
</div>
<p>
<code>One liner</code>
</p>

<pre class="example">
multiline
output
   with indentation
       at a few levels
that is verbatim.
</pre>

<pre class="example">
your basic result
your
  basic
    result
on a few lines.
</pre>

<p>
The equation is \(E = h \nu\).
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Summary</h2>
<div class="outline-text-2" id="text-4">
<p>
This looks promising to me. There are a few things to get used to, like always having org output, and some minor differences in making figures. On the whole this looks like a big improvement though! I look forward to working with it more.</p>
</div>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/29/Expanding-orgmode.py-to-get-better-org-python-integration.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2016/05/29/Expanding-orgmode-py-to-get-better-org-python-integration">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="When-in-python-do-as-Pythonistas-unless"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/05/06/When-in-python-do-as-Pythonistas-unless/" rel="bookmark" title="Permanent Link to When in python do as Pythonistas unless...">When in python do as Pythonistas unless...</a></h2>
      <p><small><span class="blog_post_date">Posted May 06, 2016 at 07:46 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Many lisps have a when/unless conditional syntax that works like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">when</span> t (print <span style="color: #008000;">"when evaluated"</span>))

(<span style="color: #0000FF;">unless</span> nil (print <span style="color: #008000;">"unless evaluated"</span>))
</pre>
</div>

<pre class="example">
"when evaluated"

"unless evaluated"
</pre>

<p>
Those are actually just macros that expand to the more verbose if function:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(macroexpand '(unless nil (print <span style="color: #008000;">"unless evaluated"</span>)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">if</span> nil nil
  (print <span style="color: #008000;">"unless evaluated"</span>))
</pre>
</div>

<p>
In Python, we only have this syntax for this kind of construct:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">if</span> <span style="color: #D0372D;">True</span>: <span style="color: #0000FF;">print</span> <span style="color: #008000;">"when equivalent"</span>

<span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">False</span>: <span style="color: #0000FF;">print</span> <span style="color: #008000;">"unless equivalent"</span>
</pre>
</div>

<pre class="example">
when equivalent
unless equivalent
</pre>

<p>
I thought is would be fun to get as close as possible to the lisp syntax in Python. It is not that easy though. The benefit of a macro is we do not evaluate the arguments until they need to be evaluated. In Python, all arguments of functions are immediately evaluated.
</p>

<p>
One way to avoid this is to put code inside a function. Then it will not be executed until the function is called. So, here is an example of how to get an unless function in Python that conditionally evaluates a function.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">unless</span>(condition, f):
    <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> condition:
        <span style="color: #0000FF;">return</span> f()

<span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>():
    <span style="color: #0000FF;">return</span> <span style="color: #008000;">"executed. Condition was not true."</span>


<span style="color: #0000FF;">print</span> unless(1 &gt; 0, func)

<span style="color: #0000FF;">print</span> unless(1 &lt; 0, func)
</pre>
</div>

<pre class="example">
None
executed. Condition was not true.
</pre>

<p>
That is close, but requires us to wrap our code in a function. There does not seem to be any alternative though. It thought maybe a context manager could be used, but there does not seem to be a way to bypass the execution of the code (<a href="https://www.python.org/dev/peps/pep-0377/">https://www.python.org/dev/peps/pep-0377/</a> ). Still, it might be a useful way to change how to think about doing some things differently in Python.
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/06/When-in-python-do-as-Pythonistas-unless....org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2016/05/06/When-in-python-do-as-Pythonistas-unless">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Automatic-decorating-of-class-methods-to-run-them-in-a-context"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/05/01/Automatic-decorating-of-class-methods-to-run-them-in-a-context/" rel="bookmark" title="Permanent Link to Automatic decorating of class methods to run them in a context">Automatic decorating of class methods to run them in a context</a></h2>
      <p><small><span class="blog_post_date">Posted May 01, 2016 at 09:16 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
We <a href="http://kitchingroup.cheme.cmu.edu/blog/2016/04/28/Managing-contexts-Python-vs-hy/">previously examined</a> approaches to running code in a context. With hy, we even managed to remove the need for a with statement through the use of a macro that expanded behind the scenes to manage the context. In our jasp code, we frequently need a context manager that temporarily changes the working directory to run some code, then changes back. The use of the context manager was a design decision to avoid decorating every single function. Why? There are a lot of functions that need decorating, and they are spread over a lot of files. Not all of the entries from the next block are methods, but most of them are.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> jasp <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">c</span> = Vasp()
<span style="color: #0000FF;">print</span>(<span style="color: #006FE0;">dir</span>(c))
</pre>
</div>

<pre class="example">
['__doc__', '__init__', '__module__', '__repr__', '__str__', 'add_to_db', 'archive', 'atoms', 'bader', 'bool_params', 'calculate', 'calculation_required', 'check_state', 'chgsum', 'clean', 'clone', 'create_metadata', 'dict', 'dict_params', 'exp_params', 'float_params', 'get_atoms', 'get_beefens', 'get_bz_k_points', 'get_charge_density', 'get_default_number_of_electrons', 'get_dipole_moment', 'get_eigenvalues', 'get_elapsed_time', 'get_electronic_temperature', 'get_elf', 'get_energy_components', 'get_fermi_level', 'get_forces', 'get_ibz_k_points', 'get_ibz_kpoints', 'get_infrared_intensities', 'get_k_point_weights', 'get_local_potential', 'get_magnetic_moment', 'get_magnetic_moments', 'get_name', 'get_nearest_neighbor_table', 'get_neb', 'get_nonselfconsistent_energies', 'get_number_of_bands', 'get_number_of_electrons', 'get_number_of_grid_points', 'get_number_of_ionic_steps', 'get_number_of_iterations', 'get_number_of_spins', 'get_occupation_numbers', 'get_orbital_occupations', 'get_potential_energy', 'get_property', 'get_pseudo_density', 'get_pseudo_wavefunction', 'get_pseudopotentials', 'get_required_memory', 'get_spin_polarized', 'get_stress', 'get_valence_electrons', 'get_version', 'get_vibrational_frequencies', 'get_vibrational_modes', 'get_xc_functional', 'initialize', 'input_params', 'int_params', 'is_neb', 'job_in_queue', 'json', 'list_params', 'name', 'nbands', 'org', 'output_template', 'plot_neb', 'positions', 'post_run_hooks', 'prepare_input_files', 'pretty_json', 'python', 'read', 'read_convergence', 'read_default_number_of_electrons', 'read_dipole', 'read_eigenvalues', 'read_electronic_temperature', 'read_energy', 'read_fermi', 'read_forces', 'read_ibz_kpoints', 'read_incar', 'read_k_point_weights', 'read_kpoints', 'read_ldau', 'read_magnetic_moment', 'read_magnetic_moments', 'read_metadata', 'read_nbands', 'read_number_of_electrons', 'read_number_of_iterations', 'read_occupation_numbers', 'read_outcar', 'read_potcar', 'read_relaxed', 'read_stress', 'read_version', 'read_vib_freq', 'register_post_run_hook', 'register_pre_run_hook', 'restart', 'restart_load', 'results', 'run', 'run_counts', 'set', 'set_atoms', 'set_nbands', 'set_results', 'special_params', 'string_params', 'strip', 'strip_warnings', 'todict', 'track_output', 'update', 'write_incar', 'write_kpoints', 'write_metadata', 'write_potcar', 'write_sort_file', 'xml']
</pre>

<p>
The use of a context manager is really useful for a single calculation, and it saves us a lot of boilerplate code to manage changing directories. It limits us though for looping through calculations. We are stuck with traditional for loops that have the with statement embedded in them. We also cannot get too functional, e.g. with list comprehension.
</p>

<p>
In other words, this is ok:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">E</span> = []
<span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> np.linspace(1, 1.5):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms(...,d)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">with</span> jasp(<span style="color: #008000;">'calculated-name-{}'</span>.<span style="color: #006FE0;">format</span>(d),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ...,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms) <span style="color: #0000FF;">as</span> calc:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   E.append(atoms.get_potential_energy())
</pre>
</div>

<p>
But this code is not possible:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">bond_lengths</span> = np.linspace(1, 1.5)

<span style="color: #BA36A5;">A</span> = [Atoms(...,d) <span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths]

<span style="color: #BA36A5;">calcs</span> = [JASP(<span style="color: #008000;">'calculated-name-{}'</span>.<span style="color: #006FE0;">format</span>(d),...,atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> d, atoms <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(bond-lengths, A)]

<span style="color: #BA36A5;">E</span> = [atoms.get_potential_energy() <span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> A]
</pre>
</div>

<p>
It is not legal syntax to embed a with statement inside a list comprehension. The code will not work because to get the potential energy we have to switch into the calculation directory and read it from a file there, then switch back.
</p>

<p>
To make that possible, we need to decorate the class functions so that the right thing happens when needed. I still do not want to decorate each function manually. Although there is a case to make for it, as I mentioned earlier, the functions are all over the place, and numerous. Now is not the time to fix it.
</p>

<p>
Instead, we consider a solution that will automatically decorate class functions for us! Enter the Metaclass. This is a class that modifies how classes are created. The net effect of the code below is our Calculator class now has all functions automatically decorated with a function that changes to the working directory, runs the function, and then ensures we change back even in the event of an exception. This approach is adapted from <a href="http://stackoverflow.com/questions/3467526/attaching-a-decorator-to-all-functions-within-a-class">http://stackoverflow.com/questions/3467526/attaching-a-decorator-to-all-functions-within-a-class</a> .
</p>

<p>
I am pretty sure this is the right way to do this. We cannot simply decorate the functions of ase.calculators.vasp.Vasp because our decorator needs access to the directory defined in a <i>class instance</i>. That is what the <span class="underline"><span class="underline">init</span></span> method of the metaclass enables.
</p>

<p>
We will put this code into a library called meta_calculator.py for reuse in later examples.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> os
<span style="color: #0000FF;">import</span> types

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">WithCurrentDirectory</span>(<span style="color: #006FE0;">type</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #036A07;">"""Metaclass that decorates all of its methods except __init__."""</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__new__</span>(cls, name, bases, attrs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">super</span>(WithCurrentDirectory, cls).__new__(cls, name, bases, attrs)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(cls, name, bases, attrs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #036A07;">"""Decorate all the methods of the class instance with the classmethod cd.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> We skip __init__ because that is where the attributes are actually set.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> It is an error to access them before they are set.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">for</span> attr_name, attr_value <span style="color: #0000FF;">in</span> attrs.iteritems():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">if</span> attr_name != <span style="color: #008000;">'__init__'</span> <span style="color: #0000FF;">and</span> <span style="color: #006FE0;">isinstance</span>(attr_value, types.FunctionType):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #006FE0;">setattr</span>(cls, attr_name, cls.cd(attr_value))


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #6434A3;">@classmethod</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">cd</span>(cls, func):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #036A07;">"""Decorator to temporarily run cls.func in the directory stored in cls.wd.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> The working directory is restored to the original directory afterwards.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;"> """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">def</span> <span style="color: #006699;">wrapper</span>(<span style="color: #0000FF;">self</span>, *args, **kwargs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'\nRunning {}'</span>.<span style="color: #006FE0;">format</span>(func.<span style="color: #006FE0;">__name__</span>))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">"Started in {}"</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>os.chdir(<span style="color: #0000FF;">self</span>.wd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">"  Entered {}"</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">try</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">result</span> = func(<span style="color: #0000FF;">self</span>, *args, **kwargs)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  {}'</span>.<span style="color: #006FE0;">format</span>(result))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> result
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">except</span> <span style="color: #6434A3;">Exception</span>, e:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is where you would use an exception handling function</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  Caught {}'</span>.<span style="color: #006FE0;">format</span>(e))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">pass</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">finally</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(<span style="color: #0000FF;">self</span>.owd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">self</span>.verbose:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">print</span>(<span style="color: #008000;">"  Exited to {}\n"</span>.<span style="color: #006FE0;">format</span>(os.getcwd()))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> wrapper.<span style="color: #006FE0;">__name__</span> = func.<span style="color: #006FE0;">__name__</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> wrapper.<span style="color: #006FE0;">__doc__</span> = func.<span style="color: #006FE0;">__doc__</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">return</span> wrapper


<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Calculator</span>(<span style="color: #006FE0;">object</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #036A07;">"""Class we use for a calculator.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">  Every method is decorated by the metaclass so it runs in the working</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">  directory defined by the class instance.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">  """</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #BA36A5;">__metaclass__</span> = WithCurrentDirectory

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(<span style="color: #0000FF;">self</span>, wd, verbose=<span style="color: #D0372D;">False</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">self</span>.owd = os.getcwd()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">self</span>.wd = wd
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">self</span>.verbose = verbose
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> os.path.isdir(wd):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>os.makedirs(wd)


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">create_input</span>(<span style="color: #0000FF;">self</span>, **kwargs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">with</span> <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'INCAR'</span>, <span style="color: #008000;">'w'</span>) <span style="color: #0000FF;">as</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> key, val <span style="color: #0000FF;">in</span> kwargs.iteritems():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f.write(<span style="color: #008000;">'{} = {}\n'</span>.<span style="color: #006FE0;">format</span>(key, val))


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">exc</span>(<span style="color: #0000FF;">self</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #036A07;">"This raises an exception to see what happens"</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> 1 / 0

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">read_input</span>(<span style="color: #0000FF;">self</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">with</span> <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'INCAR'</span>, <span style="color: #008000;">'r'</span>) <span style="color: #0000FF;">as</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">return</span> f.read()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">def</span> <span style="color: #006699;">__str__</span>(<span style="color: #0000FF;">self</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">return</span> <span style="color: #008000;">'In {}. Contains: {}'</span>.<span style="color: #006FE0;">format</span>(os.getcwd(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> os.listdir(<span style="color: #008000;">'.'</span>))
</pre>
</div>

<p>
Here is how we might use it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> meta_calculator <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">c</span> = Calculator(<span style="color: #008000;">'/tmp/calc-1'</span>, verbose=<span style="color: #D0372D;">True</span>)
<span style="color: #0000FF;">print</span> c.create_input(xc=<span style="color: #008000;">'PBE'</span>, encut=450)
<span style="color: #0000FF;">print</span> c.read_input()
<span style="color: #0000FF;">print</span> c.exc()
<span style="color: #0000FF;">print</span> c
</pre>
</div>
<pre class="example">
Running create_input
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  None
  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

None

Running read_input
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  xc = PBE
encut = 450

  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

xc = PBE
encut = 450


Running exc
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  Caught integer division or modulo by zero
  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

None

Running __str__
Started in /Users/jkitchin/blogofile-jkitchin.github.com/_blog
  Entered /private/tmp/calc-1
  In /private/tmp/calc-1. Contains: ['INCAR']
  Exited to /Users/jkitchin/blogofile-jkitchin.github.com/_blog

In /private/tmp/calc-1. Contains: ['INCAR']
</pre>

<p>
As we can see, in each function call, we evidently do change into the path that /tmp/calc-1 points to (it is apparently /private/tmp on Mac OSX), runs the method, and then changes back out, even when exceptions occur.
</p>

<p>
Here is a functional approach to using our new calculator.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> meta_calculator <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">encuts</span> = [100, 200, 300, 400]
<span style="color: #BA36A5;">calcs</span> = [Calculator(<span style="color: #008000;">'encut-{}'</span>.<span style="color: #006FE0;">format</span>(encut)) <span style="color: #0000FF;">for</span> encut <span style="color: #0000FF;">in</span> encuts]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">list-comprehension for the side-effect</span>
[calc.create_input(encut=encut) <span style="color: #0000FF;">for</span> calc,encut <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(calcs, encuts)]

<span style="color: #BA36A5;">inputs</span> = [calc.read_input() <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs]

<span style="color: #0000FF;">print</span>(inputs)
<span style="color: #0000FF;">print</span>([calc.wd <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs])
</pre>
</div>
<pre class="example">
['encut = 100\n', 'encut = 200\n', 'encut = 300\n', 'encut = 400\n']
['encut-100', 'encut-200', 'encut-300', 'encut-400']
</pre>

<p>
Sweet. And here is our evidence that the directories got created and have the files in them.
</p>

<div class="org-src-container">

<pre class="src src-sh">find . -type f -print | grep <span style="color: #008000;">"encut-[1-4]00"</span> | xargs -n 1 -I {} -i bash -c <span style="color: #008000;">'echo {}; cat {}; echo'</span>
</pre>
</div>
<pre class="example">
./encut-100/INCAR
encut = 100

./encut-200/INCAR
encut = 200

./encut-300/INCAR
encut = 300

./encut-400/INCAR
encut = 400
</pre>

<p>
This looks like another winner that will be making its way into <a href="https://github.com/jkitchin/jasp">jasp</a> soon. I guess it will require at least some minor surgery on a class in ase.calculators.vasp. It might be time to move a copy of it all the way into jasp.</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/05/01/Automatic-decorating-of-class-methods-to-run-them-in-a-context.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2016/05/01/Automatic-decorating-of-class-methods-to-run-them-in-a-context">Discuss on Twitter</a>

  <hr class="interblog" />

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2023/09/20/Supervising-Python-functions/">Supervising Python functions</a></li>
      <li><a href="/blog/2023/09/19/New-publication-Sequential-Sampling-Methods-for-Finding-Classification-Boundaries-in-Engineering-Applications/">New publication - Sequential Sampling Methods for Finding Classification Boundaries in Engineering Applications</a></li>
      <li><a href="/blog/2023/09/19/Using-Custodian-to-help-converge-an-optimization-problem/">Using Custodian to help converge an optimization problem</a></li>
      <li><a href="/blog/2023/04/25/New-Publication-An-Inverse-Mapping-Approach-for-Process-Systems-Engineering-Using-Automatic-Differentiation-and-the-Implicit-Function-Theorem/">New Publication - An Inverse Mapping Approach for Process Systems Engineering Using Automatic Differentiation and the Implicit Function Theorem</a></li>
      <li><a href="/blog/2023/04/16/New-publication-WhereWulff-A-Semiautonomous-Workflow-for-Systematic-Catalyst-Surface-Reactivity-under-Reaction-Conditions/">New publication - WhereWulff A Semiautonomous Workflow for Systematic Catalyst Surface Reactivity under Reaction Conditions</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2023
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



