

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: emacs</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications/index.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Better-equation-numbering-in-LaTeX-fragments-in-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/11/07/Better-equation-numbering-in-LaTeX-fragments-in-org-mode/" rel="bookmark" title="Permanent Link to Better equation numbering in LaTeX fragments in org-mode">Better equation numbering in LaTeX fragments in org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted November 07, 2016 at 07:02 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/latex/'>latex</a>, <a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/11/07/Better-equation-numbering-in-LaTeX-fragments-in-org-mode#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
In org-mode we can use LaTeX equations, and toggle an overlay that shows what the rendered equation will look like. One thing that has always bothered me though, is that each fragment is created in isolation. That means numbering is almost always wrong, and typically with each numbered equation starting with (1). Here we look at a way to fix that. Fixing it means we have to find a way to not create each fragment image in isolation; each one needs a context that enables the numbering to be correct. The idea we try here is simple: we just figure out in advance what the numbering for each equation should be, and then figure out how to get that information to the image generation.
</p>

<p>
See this video of the post in action:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pcMuJlUvKCw" frameborder="0" allowfullscreen></iframe>

<p>
Here are some example equations to see how it works.
</p>

<p>
This should be numbered (1)
</p>
\begin{equation}
\int x^2 dx
\end{equation}

<p>
This is a numbered equation with a custom number. This should have (E1) as the number.
</p>
\begin{equation}\tag{E1}
\int x^2 dx
\end{equation}

<p>
But equation* is not numbered
</p>
\begin{equation*}
\int x^2 dx
\end{equation*}

<p>
LaTeX align environments are numbered. The first line is (2), the second line is not numbered (because we put <code>\nonumber</code> in the line), and the third line is (3).
</p>
\begin{align}
a = 5 \\
b=6 \nonumber \\
c = 8
\end{align}

<p>
But align* environments are not numbered.
</p>
\begin{align*}
a = 5 \\
b=6
\end{align*}

<p>
This should be numbered (4).
</p>

\begin{equation}
\int x^3 dx
\end{equation}

<p>
These should be numbered (5), (6) and (7).
</p>
\begin{align}
a = 5 \\
b=6  \\
c = 8
\end{align}

<p>
This should be numbered with (E2).
</p>
\begin{equation}\tag{E2}
\int x^2 dx 
\end{equation}

<p>
And this should be numbered (8).
</p>
\begin{equation}
\int x^2 dx 
\end{equation}

<p>
Note: This will be numbered (1) because it is exactly the same equation as a previous one! 
</p>
\begin{equation}
\int x^2 dx
\end{equation}


<p>
We can change the numbering of an equation with code like this. After this code, the next equation will be numbered (5).
</p>

<p>
The only fragments that should be numbered are equation environments, and align environments (these are the main ones that we consider here). The align environment is tricky since there is potentially more than one number in the environment. 
</p>

<p>
So, we get all the fragments, and generate a list of which ones should be numbered, and if they should what the number should be. That means we will need to count the number of numbered equations in an align environment. We will do that by getting the number of line breaks, and subtracting the number of nonumbers.
</p>

<p>
Here is the code block that does that, using advice again. A downside of this approach is that we generate the list for every fragment, which is not efficient, since it should not change in a synchronous approach to generating them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-renumber-environment</span> (orig-func <span style="color: #6434A3;">&amp;rest</span> args)
  (<span style="color: #0000FF;">let</span> ((results '()) 
        (counter -1)
        (numberp))

    (<span style="color: #0000FF;">setq</span> results (<span style="color: #0000FF;">loop</span> for (begin .  env) in 
                        (org-element-map (org-element-parse-buffer) 'latex-environment
                          (<span style="color: #0000FF;">lambda</span> (env)
                            (cons
                             (org-element-property <span style="color: #006FE0;">:begin</span> env)
                             (org-element-property <span style="color: #006FE0;">:value</span> env))))
                        collect
                        (<span style="color: #0000FF;">cond</span>
                         ((<span style="color: #0000FF;">and</span> (string-match <span style="color: #008000;">"\\\\begin{equation}"</span> env)
                               (not (string-match <span style="color: #008000;">"\\\\tag{"</span> env)))
                          (<span style="color: #0000FF;">incf</span> counter)
                          (cons begin counter))
                         ((string-match <span style="color: #008000;">"\\\\begin{align}"</span> env)
                          (<span style="color: #0000FF;">prog2</span>
                              (<span style="color: #0000FF;">incf</span> counter)
                              (cons begin counter)                          
                            (<span style="color: #0000FF;">with-temp-buffer</span>
                              (insert env)
                              (goto-char (point-min))
                              <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">\\ is used for a new line. Each one leads to a number</span>
                              (<span style="color: #0000FF;">incf</span> counter (count-matches <span style="color: #008000;">"\\\\$"</span>))
                              <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">unless there are nonumbers.</span>
                              (goto-char (point-min))
                              (<span style="color: #0000FF;">decf</span> counter (count-matches <span style="color: #008000;">"\\nonumber"</span>)))))
                         (t
                          (cons begin nil)))))

    (<span style="color: #0000FF;">when</span> (<span style="color: #0000FF;">setq</span> numberp (cdr (assoc (point) results)))
      (<span style="color: #0000FF;">setf</span> (car args)
            (concat
             (format <span style="color: #008000;">"\\setcounter{equation}{%s}\n"</span> numberp)
             (car args)))))
  
  (apply orig-func args))

(advice-add 'org-create-formula-image <span style="color: #006FE0;">:around</span> #'org-renumber-environment)
</pre>
</div>

<p>
You can remove the advice like this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-remove 'org-create-formula-image #'org-renumber-environment)
</pre>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/11/07/Better-equation-numbering-in-LaTeX-fragments-in-org-mode.org">org-mode source</a></p>
<p>Org-mode version = 9.0</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/11/07/Better-equation-numbering-in-LaTeX-fragments-in-org-mode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Justifying-LaTeX-preview-fragments-in-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/11/06/Justifying-LaTeX-preview-fragments-in-org-mode/" rel="bookmark" title="Permanent Link to Justifying LaTeX preview fragments in org-mode">Justifying LaTeX preview fragments in org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted November 06, 2016 at 08:44 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/latex/'>latex</a>, <a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/11/06/Justifying-LaTeX-preview-fragments-in-org-mode#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
A colleague asked if I knew how to center the preview images of LaTeX equations in an org-buffer. This might make org-mode notes look nicer when lecturing, for example. We thought it might be possible to just offset the overlay with a before-string made up of the right number of spaces. I worked out a full solution that lets you "justify" the preview images. You have to add a :justify option to org-format-latex-options, and the option is either 'center or 'right (anything else means left-justified as the default). This will only justify equations that start at the beginning of a line to avoid modifying fragments that are in text. You should see the video to see this in action:
</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/nA9YzooqpWY" frameborder="0" allowfullscreen></iframe>

<p>
Equation 1:
\(e^{i\pi} + 1 = 0\)
</p>

<p>
An \(x^2 = -1\) equation in the text is not affected.
</p>

<p>
A display equation with some space after the equation:
\[e^{i \cdot \pi} + 1 = 0\]     
</p>

<p>
This is a numbered equation.
</p>

\begin{equation}
\int x^2 dx
\end{equation}

<p>
The idea is pretty simple, we get the width of the window, and the width of the image, and compute the offset that approximately centers or right justifies the overlay, and then add the before-string property to the overlay. While we are at it, I will add a tooltip to the image so you can see the LaTeX code that created it, and make it clickable so you can toggle it back to the code. 
I apply the functions as after advice to the function that creates the overlay, so we do not have to adapt the org code at all. Here is the code that does it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">specify the justification you want</span>
(plist-put org-format-latex-options <span style="color: #006FE0;">:justify</span> 'center)

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-justify-fragment-overlay</span> (beg end image imagetype)
  <span style="color: #036A07;">"Adjust the justification of a LaTeX fragment.</span>
<span style="color: #036A07;">The justification is set by :justify in</span>
<span style="color: #036A07;">`</span><span style="color: #D0372D;">org-format-latex-options</span><span style="color: #036A07;">'. Only equations at the beginning of a</span>
<span style="color: #036A07;">line are justified."</span>
  (<span style="color: #0000FF;">cond</span>
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Centered justification</span>
   ((<span style="color: #0000FF;">and</span> (eq 'center (plist-get org-format-latex-options <span style="color: #006FE0;">:justify</span>)) 
         (= beg (line-beginning-position)))
    (<span style="color: #0000FF;">let*</span> ((img (create-image image 'imagemagick t))
           (width (car (image-size img)))
           (offset (floor (- (/ (window-text-width) 2) (/ width 2)))))
      (overlay-put (ov-at) 'before-string (make-string offset ? ))))
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Right justification</span>
   ((<span style="color: #0000FF;">and</span> (eq 'right (plist-get org-format-latex-options <span style="color: #006FE0;">:justify</span>)) 
         (= beg (line-beginning-position)))
    (<span style="color: #0000FF;">let*</span> ((img (create-image image 'imagemagick t))
           (width (car (image-display-size (overlay-get (ov-at) 'display))))
           (offset (floor (- (window-text-width) width (- (line-end-position) end)))))
      (overlay-put (ov-at) 'before-string (make-string offset ? ))))))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-latex-fragment-tooltip</span> (beg end image imagetype)
  <span style="color: #036A07;">"Add the fragment tooltip to the overlay and set click function to toggle it."</span>
  (overlay-put (ov-at) 'help-echo
               (concat (buffer-substring beg end)
                       <span style="color: #008000;">"mouse-1 to toggle."</span>))
  (overlay-put (ov-at) 'local-map (<span style="color: #0000FF;">let</span> ((map (make-sparse-keymap)))
                                    (define-key map [mouse-1]
                                      `(<span style="color: #0000FF;">lambda</span> ()
                                         (<span style="color: #0000FF;">interactive</span>)
                                         (org-remove-latex-fragment-image-overlays ,beg ,end)))
                                    map)))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">advise the function to a</span>
(advice-add 'org--format-latex-make-overlay <span style="color: #006FE0;">:after</span> 'org-justify-fragment-overlay)
(advice-add 'org--format-latex-make-overlay <span style="color: #006FE0;">:after</span> 'org-latex-fragment-tooltip)
</pre>
</div>

<p>
That is it. If you get tired of the advice, remove it like this:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-remove 'org--format-latex-make-overlay 'org-justify-fragment-overlay)
(advice-remove 'org--format-latex-make-overlay 'org-latex-fragment-tooltip)
</pre>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/11/06/Justifying-LaTeX-preview-fragments-in-org-mode.org">org-mode source</a></p>
<p>Org-mode version = 9.0</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/11/06/Justifying-LaTeX-preview-fragments-in-org-mode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Copy-formatted-org-mode-text-from-Emacs-to-other-applications"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/06/16/Copy-formatted-org-mode-text-from-Emacs-to-other-applications/" rel="bookmark" title="Permanent Link to Copy formatted org-mode text from Emacs to other applications">Copy formatted org-mode text from Emacs to other applications</a></h2>
      <p><small><span class="blog_post_date">Posted June 16, 2016 at 11:46 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/rtf/'>rtf</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/06/16/Copy-formatted-org-mode-text-from-Emacs-to-other-applications#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I do a lot of writing in org-mode and I thought it would be great if I could copy text from an org-file and paste it <i>with formatting</i> into other applications, e.g. Word, Gmail, etc&#x2026;.  Curiosity got the better of me and I wondered how this is done in other applications. It works by creating a <a href="https://www.safaribooksonline.com/library/view/rtf-pocket-guide/9781449302047/ch01.html">Rich Text Format</a> version of what you want to copy and then putting that on the clipboard. It isn't quite enough to just copy it, it needs to go in the clipboard as an RTF datatype. On Mac OSX I used <a href="http://osxdaily.com/2007/03/05/manipulating-the-clipboard-from-the-command-line/">pbcopy</a> to make that happen. 
</p>

<p>
Check out this video of this post in action: <a href="https://www.youtube.com/watch?v=irkmQnggVpE">https://www.youtube.com/watch?v=irkmQnggVpE</a> 
</p>

<p>
One simple strategy to do this from org-mode is to generate HTML by export, and then convert it to RTF with a utility, e.g. textutil. For example like this. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">formatted-copy</span> ()
  <span style="color: #036A07;">"Export region to HTML, and copy it to the clipboard."</span>
  (<span style="color: #0000FF;">interactive</span>)
  (<span style="color: #0000FF;">save-window-excursion</span>
    (<span style="color: #0000FF;">let*</span> ((buf (org-export-to-buffer 'html <span style="color: #008000;">"*Formatted Copy*"</span> nil nil t t))
           (html (<span style="color: #0000FF;">with-current-buffer</span> buf (buffer-string))))
      (<span style="color: #0000FF;">with-current-buffer</span> buf
        (shell-command-on-region
         (point-min)
         (point-max)
         <span style="color: #008000;">"textutil -stdin -format html -convert rtf -stdout | pbcopy"</span>)) 
      (kill-buffer buf))))

(global-set-key (kbd <span style="color: #008000;">"H-w"</span>) 'formatted-copy)
</pre>
</div>

<p>
This works well for everything but equations and images. Citations leave a bit to be desired, but improving this is still a challenge. 
</p>

<p>
Let us try this on some text. Some <b>bold</b>, <i>italic</i>, <span class="underline">underline</span>, <del>struck</del> and <code>verbatim</code> text to copy. Here are some example Formulas: H<sub>2</sub>O ionizes to form H<sup>+</sup>. We simply must have an equation: \(e^{i\pi} + 1 = 0\) <sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>. We should also have a citation <a class='org-ref-reference' href="#kitchin-2015-examp">kitchin-2015-examp</a> and multiple citations <a class='org-ref-reference' href="#kitchin-2016-autom-data">kitchin-2016-autom-data</a>,<a class='org-ref-reference' href="#kitchin-2015-data-surfac-scien">kitchin-2015-data-surfac-scien</a> <sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>.
</p>

<p>
A code block:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> pycse.orgmode <span style="color: #0000FF;">as</span> org
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">x</span> = np.linspace(0, 60, 500)
plt.figure(figsize=(4, 2))
plt.plot(np.exp(-0.1 * x) * np.cos(x),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>np.exp(-0.1 * x) * np.sin(x))
org.figure(plt.savefig(<span style="color: #008000;">'spiral.png'</span>),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  caption=<span style="color: #008000;">'A spiral.'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  attributes=[[<span style="color: #008000;">'org'</span>, <span style="color: #008000;">':width 100'</span>]])
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)
org.table([[<span style="color: #008000;">'H1'</span>, <span style="color: #008000;">'H2'</span>], <span style="color: #D0372D;">None</span>, [1, 2], [2, 4]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> caption=<span style="color: #008000;">'A simple table'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)
org.result(6 * 7)
</pre>
</div>


<div class="figure">
<p><img src="/media/2016-06-16-Copy-formatted-org-mode-text-from-Emacs-to-other-applications/spiral.png"> 
</p>
<p><span class="figure-number">Figure 1:</span> A spiral.</p>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> A simple table</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">H1</th>
<th scope="col" class="org-right">H2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>

<pre class="example">
42
</pre>

<p>
In summary, this simple approach to generating RTF from exported HTML works really well for the simplest markups. To improve on getting figures in, getting cross-references, captions, proper references, etc&#x2026; will require a more sophisticated export approach, and probably one that exports RTF directly. That is a big challenge for another day!
</p>

<p>
<h1 class='org-ref-bib-h1'>Bibliography</h1>
<ul class='org-ref-bib'><li><a id="kitchin-2015-examp">[kitchin-2015-examp] Kitchin, Examples of Effective Data Sharing in Scientific Publishing, <i>ACS Catalysis</i>, <b>5(6)</b>, 3894-3899 (2015). http://dx.doi.org/10.1021/acscatal.5b00538</a></li>
<li><a id="kitchin-2016-autom-data">[kitchin-2016-autom-data] "Kitchin, Van Gulick & Zilinski, Automating Data Sharing Through Authoring Tools, <i>"International Journal on Digital Libraries"</i>, <b></b>, 1-6 (2016). http://dx.doi.org/10.1007/s00799-016-0173-7</a></li>
<li><a id="kitchin-2015-data-surfac-scien">[kitchin-2015-data-surfac-scien] "John Kitchin", Data Sharing in Surface Science, <i>"Surface Science "</i>, <b>N/A</b>, in press (2015). http://dx.doi.org/10.1016/j.susc.2015.05.007</a></li>
</ul>
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
There are probably some ways to get better images for equations. To get equation numbers and references to them will probably require a two pass build process.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
This is another place where configuration will be required for bibliography style. Also, some checks to join neighboring footnotes.
</p></div></div>


</div>
</div><p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/06/16/Copy-formatted-org-mode-text-from-Emacs-to-other-applications.org">org-mode source</a></p>
<p>Org-mode version = 8.3.4</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/06/16/Copy-formatted-org-mode-text-from-Emacs-to-other-applications#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Using-prefix-args-in-ivy-actions"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/06/14/Using-prefix-args-in-ivy-actions/" rel="bookmark" title="Permanent Link to Using prefix args in ivy actions">Using prefix args in ivy actions</a></h2>
      <p><small><span class="blog_post_date">Posted June 14, 2016 at 11:03 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/ivy/'>ivy</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/06/14/Using-prefix-args-in-ivy-actions#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. Bare bones setup</a></li>
</ul>
</div>
</div>
<p>
There is a <a href="https://github.com/abo-abo/swiper/commit/e54aa1850077d22e8007edef86d4bb751c3b7794">brand new feature</a> in ivy which allows you to pass prefix args to the action functions. This change has made it into MELPA by now, so you can try it out. Check out this <a href="#orgheadline1">1</a> for an emacs -Q setup that I used for this post. This installs ivy and org-ref with some minimal setup.
</p>

<p>
The video for this post can be found here: <a href="https://www.youtube.com/watch?v=Y8HHLAE_-yA">https://www.youtube.com/watch?v=Y8HHLAE_-yA</a> 
</p>

<p>
In this post I will show how to use this new feature to create an ivy selection function that inserts a citation from a bibtex file, and with a prefix arg lets you choose the type of citation to insert.
</p>

<p>
<a href="https://melpa.org/#/org-ref">org-ref</a> provides a function that generates candidates for selection. Each candidate is a list where the car of the list is a display string, and the cdr is an a-list of properties. I have a lot of entries in here, so it is important to have a convenient selection tool.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> org-ref-bibtex-files '(<span style="color: #008000;">"references.bib"</span>))
(length (orhc-bibtex-candidates))
</pre>
</div>

<p>
Here is an example of the first entry in my bibliography. We will need to extract the key from that. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(elt (orhc-bibtex-candidates) 0)
</pre>
</div>



<p>
Here is the key from that entry.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(cdr (assoc <span style="color: #008000;">"=key="</span> (elt (orhc-bibtex-candidates) 0)))
</pre>
</div>


<p>
By default we will insert that as <a class='org-ref-reference' href="#kitchin-2015-examp">kitchin-2015-examp</a> but there are other types of citations we might use too like <a class='org-ref-reference' href="#kitchin-2015-examp">kitchin-2015-examp</a>. org-ref provides a list of citation types we could insert. Here they are. This somewhat complicated code just wraps the string so it fits in the blog post nicely.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">with-temp-buffer</span> 
  (insert (format <span style="color: #008000;">"%s"</span> org-ref-cite-types))
  (fill-region (point-min) (point-max))
  (buffer-string))
</pre>
</div>

<p>
So, we are now prepared to make a simple ivy function to query our bibliography that has a default action to insert a standard citation, but we can use a prefix to change the citation type. The prefix arg is stored in the global variable ivy-current-prefix-arg which can be checked inside the action function. We can check for it in the action function and do something different if a prefix arg is used. Here is the function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">cite</span> ()
  (<span style="color: #0000FF;">interactive</span>)
  (ivy-read <span style="color: #008000;">"select: "</span> (orhc-bibtex-candidates)
            <span style="color: #006FE0;">:action</span> (<span style="color: #0000FF;">lambda</span> (entry) 
                      (<span style="color: #0000FF;">let</span> ((key (cdr (assoc <span style="color: #008000;">"=key="</span> entry)))
                            (type (<span style="color: #0000FF;">if</span> ivy-current-prefix-arg
                                      (ivy-read <span style="color: #008000;">"type: "</span> org-ref-cite-types)
                                    <span style="color: #008000;">"cite"</span>)))
                        (<span style="color: #0000FF;">with-ivy-window</span>
                          (insert (format <span style="color: #008000;">"%s:%s"</span> type key)))))))
</pre>
</div>

<p>
To get the default action, we run M-x cite, enter our query, select an entry and press return. To get an alternate cite type, we run M-x cite, enter the query, select an entry, then type  C-u return, which will prompt you for an alternate citation type, then insert your choice and the citation. Here are some examples.
<a class='org-ref-reference' href="#kitchin-2015-examp">kitchin-2015-examp</a>  <a class='org-ref-reference' href="#kitchin-2015-examp">kitchin-2015-examp</a> <a class='org-ref-reference' href="#kitchin-2015-examp">kitchin-2015-examp</a>
</p>



<p>
In summary, these aren't functions you would want to use; they don't handle a lot of the nuances of multiple citations. They are just to illustrate in a pretty simple way how easy it is to use a prefix arg in an ivy action function now! 
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Bare bones setup</h2>
<div class="outline-text-2" id="text-1">
<p>
This will setup the bare bones emacs that I used for this post.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> package-user-dir (expand-file-name <span style="color: #008000;">"sandbox"</span>))

(<span style="color: #0000FF;">setq</span> package-archives
      '((<span style="color: #008000;">"melpa"</span> . <span style="color: #008000;">"http://melpa.org/packages/"</span>)))

(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">package</span>)

<span style="color: #8D8D84;">;;; </span><span style="color: #8D8D84; font-style: italic;">Code:</span>

(package-initialize)

(<span style="color: #0000FF;">unless</span> (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

(<span style="color: #0000FF;">eval-when-compile</span>
  (<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">use-package</span>))

(<span style="color: #0000FF;">setq</span> use-package-always-ensure t)

(<span style="color: #0000FF;">use-package</span> <span style="color: #D0372D;">ivy</span>)

(<span style="color: #0000FF;">use-package</span> <span style="color: #D0372D;">org-ref</span>
 <span style="color: #006FE0;">:init</span> 
 (<span style="color: #0000FF;">setq</span> org-ref-default-bibliography '(<span style="color: #008000;">"~/Dropbox/bibliography/references.bib"</span>))
 <span style="color: #006FE0;">:config</span> (<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">org-ref-helm-cite</span>))

(global-visual-line-mode 1)
(<span style="color: #0000FF;">setq</span> org-confirm-babel-evaluate nil)
(load-theme 'leuven)
</pre>
</div>
</div>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/06/14/Using-prefix-args-in-ivy-actions.org">org-mode source</a></p>
<p>Org-mode version = 8.3.4</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/06/14/Using-prefix-args-in-ivy-actions#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Dynamic-sorting-with-ivy"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/06/13/Dynamic-sorting-with-ivy/" rel="bookmark" title="Permanent Link to Dynamic sorting with ivy">Dynamic sorting with ivy</a></h2>
      <p><small><span class="blog_post_date">Posted June 13, 2016 at 03:51 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/ivy/'>ivy</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/06/13/Dynamic-sorting-with-ivy#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I have been exploring ivy a lot these days as a general purpose completion backend. One need I have is dynamic resorting of candidates. I illustrate how to achieve that here. A big thanks to Oleh Krehel (author of ivy) for a lot help today getting this working!
</p>

<p>
You may want to check out the video: <a href="https://www.youtube.com/watch?v=nFKfM3MOAd0">https://www.youtube.com/watch?v=nFKfM3MOAd0</a> 
</p>

<p>
First, a typical ivy-read example. Below I have a set of contact data for some people, and have setup an ivy-read command that inserts the email in the current buffer by default, and a second action for the phone. What is missing that I would like to do is dynamically reorder the candidates, including sorting all the candidates, swapping candidates up and down to fine tune the order, and then finally applying an action to all the candidates.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ct</span> ()
  (<span style="color: #0000FF;">interactive</span>)
  (ivy-read <span style="color: #008000;">"contact: "</span> '((<span style="color: #008000;">"Kno Body"</span> <span style="color: #008000;">"kb@true.you"</span> <span style="color: #008000;">"555-1212"</span>)
                          (<span style="color: #008000;">"A. Person"</span> <span style="color: #008000;">"ap@some.come"</span> <span style="color: #008000;">"867-5304"</span>)
                          (<span style="color: #008000;">"G. Willikers"</span> <span style="color: #008000;">"gw@not.me"</span> <span style="color: #008000;">"555-5555"</span>))
            <span style="color: #006FE0;">:action</span> '(1
                      (<span style="color: #008000;">"o"</span> (<span style="color: #0000FF;">lambda</span> (x)
                             (<span style="color: #0000FF;">with-ivy-window</span>
                               (insert
                                (<span style="color: #0000FF;">if</span> (not (looking-back <span style="color: #008000;">" "</span>)) <span style="color: #008000;">", "</span> <span style="color: #008000;">""</span>)
                                (elt x 0))))
                       <span style="color: #008000;">"insert email"</span>)
                      (<span style="color: #008000;">"p"</span> (<span style="color: #0000FF;">lambda</span> (x)
                             (<span style="color: #0000FF;">with-ivy-window</span>
                               (insert
                                (<span style="color: #0000FF;">if</span> (not (looking-back <span style="color: #008000;">" "</span>)) <span style="color: #008000;">", "</span> <span style="color: #008000;">""</span>)
                                (elt x 1))))
                       <span style="color: #008000;">"insert phone"</span>))))
</pre>
</div>

<p>
So, first a set of functions to manipulate the candidates. We create a swap function, two functions to move candidates up and down, and two functions that sort the whole list of candidates in ascending and descending order. In each case, we just update the ivy collection with the new modified collection, we save the currently selected candidate, and then reset the state to update the candidates.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">swap</span> (i j lst)
  <span style="color: #036A07;">"Swap index I and J in the list LST."</span> 
  (<span style="color: #0000FF;">let</span> ((tempi (nth i lst)))
    (<span style="color: #0000FF;">setf</span> (nth i lst) (nth j lst))
    (<span style="color: #0000FF;">setf</span> (nth j lst) tempi))
  lst)

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ivy-move-up</span> ()
  <span style="color: #036A07;">"Move ivy candidate up."</span>
  (<span style="color: #0000FF;">interactive</span>)
  (<span style="color: #0000FF;">setf</span> (ivy-state-collection ivy-last)
        (swap ivy--index (1- ivy--index) (ivy-state-collection ivy-last)))
  (<span style="color: #0000FF;">setf</span> (ivy-state-preselect ivy-last) ivy--current)
  (ivy--reset-state ivy-last))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ivy-move-down</span> ()
  <span style="color: #036A07;">"Move ivy candidate down."</span>
  (<span style="color: #0000FF;">interactive</span>)
  (<span style="color: #0000FF;">setf</span> (ivy-state-collection ivy-last)
        (swap ivy--index (1+ ivy--index) (ivy-state-collection ivy-last)))
  (<span style="color: #0000FF;">setf</span> (ivy-state-preselect ivy-last) ivy--current)
  (ivy--reset-state ivy-last))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ivy-a-z</span> ()
  <span style="color: #036A07;">"Sort ivy candidates from a-z."</span>
  (<span style="color: #0000FF;">interactive</span>)
  (<span style="color: #0000FF;">setf</span> (ivy-state-collection ivy-last)
        (cl-sort (ivy-state-collection ivy-last)
                 (<span style="color: #0000FF;">if</span> (listp (car (ivy-state-collection ivy-last)))
                     (<span style="color: #0000FF;">lambda</span> (a b)
                       (string-lessp (car a) (car b)))
                   (<span style="color: #0000FF;">lambda</span> (a b)
                     (string-lessp a b)))))
  (<span style="color: #0000FF;">setf</span> (ivy-state-preselect ivy-last) ivy--current)
  (ivy--reset-state ivy-last))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ivy-z-a</span> ()
  <span style="color: #036A07;">"Sort ivy candidates from z-a."</span>
  (<span style="color: #0000FF;">interactive</span>)
  (<span style="color: #0000FF;">setf</span> (ivy-state-collection ivy-last)
        (cl-sort (ivy-state-collection ivy-last)
                 (<span style="color: #0000FF;">if</span> (listp (car (ivy-state-collection ivy-last)))
                     (<span style="color: #0000FF;">lambda</span> (a b)
                       (string-greaterp (car a) (car b)))
                   (<span style="color: #0000FF;">lambda</span> (a b)
                     (string-greaterp a b)))))
  (<span style="color: #0000FF;">setf</span> (ivy-state-preselect ivy-last) ivy--current)
  (ivy--reset-state ivy-last))
</pre>
</div>


<p>
Now, we make a keymap to bind these commands so they are convenient to use. I will use C-arrows for swapping, and M-arrows for sorting the whole list. I also add M-&lt;return&gt; which allows me to use a numeric prefix to apply an action to all the candidates. M-&lt;return&gt; applies the default action. M-1 M-&lt;return&gt; applies the first action, M-2 M-&lt;return&gt; the second action, etc&#x2026;
</p>

<p>
This specific implementation assumes your candidates have a cdr.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> ivy-sort-keymap
      (<span style="color: #0000FF;">let</span> ((map (make-sparse-keymap)))
        (define-key map (kbd <span style="color: #008000;">"C-&lt;up&gt;"</span>) 'ivy-move-up)
        (define-key map (kbd <span style="color: #008000;">"C-&lt;down&gt;"</span>) 'ivy-move-down)

        <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">sort all keys</span>
        (define-key map (kbd <span style="color: #008000;">"M-&lt;up&gt;"</span>) 'ivy-a-z)
        (define-key map (kbd <span style="color: #008000;">"M-&lt;down&gt;"</span>) 'ivy-z-a)

        <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">map over all all entries with nth action</span>
        (define-key map (kbd <span style="color: #008000;">"M-&lt;return&gt;"</span>)
          (<span style="color: #0000FF;">lambda</span> (arg)
            <span style="color: #036A07;">"Apply the numeric prefix ARGth action to every candidate."</span>
            (<span style="color: #0000FF;">interactive</span> <span style="color: #008000;">"P"</span>)
            <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">with no arg use default action</span>
            (<span style="color: #0000FF;">unless</span> arg (<span style="color: #0000FF;">setq</span> arg (car (ivy-state-action ivy-last))))
            (ivy-beginning-of-buffer)
            (<span style="color: #0000FF;">let</span> ((func (elt (elt (ivy-state-action ivy-last) arg) 1)))
              (<span style="color: #0000FF;">loop</span> for i from 0 to (- ivy--length 1)
                    do 
                    (funcall func
                             (<span style="color: #0000FF;">let</span> ((cand (elt
                                          (ivy-state-collection ivy-last)
                                          ivy--index)))
                               (<span style="color: #0000FF;">if</span> (listp cand)
                                   (cdr cand)
                                 cand)))
                    (ivy-next-line)))
            (ivy-exit-with-action
             (<span style="color: #0000FF;">lambda</span> (x) nil))))
        map))
</pre>
</div>

<p>
Ok, now we modify our ivy-read function to use the keymap.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ctn</span> ()
  (<span style="color: #0000FF;">interactive</span>)
  (ivy-read <span style="color: #008000;">"contact: "</span> '((<span style="color: #008000;">"Kno Body"</span> <span style="color: #008000;">"kb@true.you"</span> <span style="color: #008000;">"555-1212"</span>)
                          (<span style="color: #008000;">"A. Person"</span> <span style="color: #008000;">"ap@some.come"</span> <span style="color: #008000;">"867-5304"</span>)
                          (<span style="color: #008000;">"G. Willikers"</span> <span style="color: #008000;">"gw@not.me"</span> <span style="color: #008000;">"555-5555"</span>))
            <span style="color: #006FE0;">:keymap</span> ivy-sort-keymap
            <span style="color: #006FE0;">:action</span> '(1
                      (<span style="color: #008000;">"o"</span> (<span style="color: #0000FF;">lambda</span> (x)
                             (<span style="color: #0000FF;">with-ivy-window</span>
                               (insert
                                (<span style="color: #0000FF;">if</span> (not (looking-back <span style="color: #008000;">" "</span>)) <span style="color: #008000;">", "</span> <span style="color: #008000;">""</span>)
                                (elt x 0))))
                       <span style="color: #008000;">"insert email"</span>)
                      (<span style="color: #008000;">"p"</span> (<span style="color: #0000FF;">lambda</span> (x)
                             (<span style="color: #0000FF;">with-ivy-window</span>
                               (insert
                                (<span style="color: #0000FF;">if</span> (not (looking-back <span style="color: #008000;">" "</span>)) <span style="color: #008000;">", "</span> <span style="color: #008000;">""</span>)
                                (elt x 1))))
                       <span style="color: #008000;">"insert phone"</span>))))
</pre>
</div>

<p>
kb@true.you, gw@not.me, ap@some.come, 555-1212, 555-5555, 867-5304
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/06/13/Dynamic-sorting-with-ivy.org">org-mode source</a></p>
<p>Org-mode version = 8.3.4</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/06/13/Dynamic-sorting-with-ivy#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/category/emacs/1">« Previous Page</a>
  --  
 <a href="/blog/category/emacs/3">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2017/01/03/Find-stuff-in-org-mode-anywhere/">Find stuff in org-mode anywhere</a></li>
      <li><a href="/blog/2017/01/01/2016-in-a-nutshell-for-the-Kitchin-Research-group/">2016 in a nutshell for the Kitchin Research group</a></li>
      <li><a href="/blog/2016/12/22/Context-specific-org-mode-speed-keys/">Context-specific org-mode speed keys</a></li>
      <li><a href="/blog/2016/11/10/Persistent-highlighting-in-Emacs/">Persistent highlighting in Emacs</a></li>
      <li><a href="/blog/2016/11/09/New-and-improved-asynchronous-org-babel-python-blocks/">New and improved asynchronous org-babel python blocks</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2017
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



