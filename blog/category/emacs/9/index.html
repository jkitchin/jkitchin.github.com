

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: emacs</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Displaying-image-overlays-on-image-filenames-in-Emacs"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/03/21/Displaying-image-overlays-on-image-filenames-in-Emacs/" rel="bookmark" title="Permanent Link to Displaying image overlays on image filenames in Emacs">Displaying image overlays on image filenames in Emacs</a></h2>
      <p><small><span class="blog_post_date">Posted March 21, 2016 at 11:21 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/orgmode/'>orgmode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/03/21/Displaying-image-overlays-on-image-filenames-in-Emacs#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Tooltip approach</a></li>
<li><a href="#sec-2">2. The overlay approach</a></li>
</ul>
</div>
</div>
<p>
It has always bothered me a little that I have to add a file image after code blocks in org-mode to see the results. That extra work&#x2026; I also don't like having to explicitly print the figure in the code, since that is the extra work, just in a different place. Today I look into two approaches to this. First, we consider something like tooltips, and second just putting overlays of image files right on the file name. The plus side of this is no extra work. The downside is they won't export; that will still take the extra work, but you needed that for the caption anyway for now.
</p>

<p>
Here is a video illustrating the code in this post: <a href="https://www.youtube.com/watch?v=VuAnwCERM0U">https://www.youtube.com/watch?v=VuAnwCERM0U</a> 
</p>

<p>
Here is a test.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot([0, 1, 2, 4, 16])
plt.savefig(<span style="color: #008000;">"test-fig.png"</span>)
</pre>
</div>


<div class="figure">
<p><img src="/media/2016-03-21-Displaying-image-overlays-on-image-filenames-in-Emacs/test-fig.png"> 
</p>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Tooltip approach</h2>
<div class="outline-text-2" id="text-1">
<p>
Building on our <a href="http://kitchingroup.cheme.cmu.edu/blog/2016/03/16/Getting-graphical-feedback-as-tooltips-in-Emacs/">previous approach</a> of graphical tooltips, we try that here to show the images. I have solved the issue of why the images didn't show in the tooltips before; it was related to how Emacs was built. I used to build it with "cocoa" support so it integrates well in OSX. Here, I have build it with gtk3, and the tooltips work with images.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">image-tooltip-re</span> (concat  <span style="color: #008000;">"</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(?3:</span><span style="color: #008000;">'</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">\"</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(?1:</span><span style="color: #008000;">.*\\."</span>
                                  (regexp-opt '(<span style="color: #008000;">"png"</span> <span style="color: #008000;">"PNG"</span> <span style="color: #008000;">"JPG"</span> <span style="color: #008000;">"jpeg"</span>
                                                <span style="color: #008000;">"jpg"</span> <span style="color: #008000;">"JPEG"</span> <span style="color: #008000;">"eps"</span> <span style="color: #008000;">"EPS"</span>))
                                  <span style="color: #008000;">"</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(?:</span><span style="color: #008000;">\\3</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">"</span>)
  <span style="color: #036A07;">"Regexp to match image filenames in quotes"</span>)

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">image-tooltip</span> (window object position)
  (<span style="color: #0000FF;">save-excursion</span>
    (goto-char position)
    (<span style="color: #0000FF;">let</span> (beg end imgfile img s)
      (<span style="color: #0000FF;">while</span> (not (looking-at image-tooltip-re))
        (forward-char -1))
      (<span style="color: #0000FF;">setq</span> imgfile (match-string-no-properties 1))
      (<span style="color: #0000FF;">when</span> (file-exists-p imgfile)
        (<span style="color: #0000FF;">setq</span> img (create-image (expand-file-name imgfile)
                                'imagemagick nil <span style="color: #006FE0;">:width</span> 200))
        (propertize <span style="color: #008000;">"Look in the minibuffer"</span>
                    'display img)))))

(font-lock-add-keywords
 nil
 `((,image-tooltip-re
    0 '(face font-lock-keyword-face
             help-echo image-tooltip))))

(font-lock-fontify-buffer)
</pre>
</div>

<p>
Now these both have tooltips on them: "test-fig.png"  and  'test-fig.png'.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> The overlay approach</h2>
<div class="outline-text-2" id="text-2">
<p>
We might alternatively prefer to put overlays in the buffer. Here we make that happen.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">next-image-overlay</span> (<span style="color: #6434A3;">&amp;optional</span> limit)
  (<span style="color: #0000FF;">when</span> (re-search-forward image-tooltip-re limit t)
    (<span style="color: #0000FF;">setq</span> beg (match-beginning 0)
          end (match-end 0)
          imgfile (match-string 1))
    (<span style="color: #0000FF;">when</span> (file-exists-p imgfile)
      (<span style="color: #0000FF;">setq</span> img (create-image (expand-file-name imgfile)
                              'imagemagick nil <span style="color: #006FE0;">:width</span> 300))
      (<span style="color: #0000FF;">setq</span> ov (make-overlay beg end))
      (overlay-put ov 'display img)
      (overlay-put ov 'face 'default)
      (overlay-put ov 'org-image-overlay t)
      (overlay-put ov 'modification-hooks
                   (list 'org-display-inline-remove-overlay)))))

(font-lock-add-keywords
 nil
 '((next-image-overlay (0  'font-lock-keyword-face t)))
 t)
</pre>
</div>


<p>
Here is the example we looked at before.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot([-0, 1, 2, 4, 16])
plt.savefig(<span style="color: #008000;">"test-fig.png"</span>)
</pre>
</div>

<p>
You may want to remove those overlays. Here is one way. Note they come back if you don't disable the font-lock keywords though.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(ov-clear 'org-image-overlay)
</pre>
</div>
<p>
I know you want to do that so here is:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(font-lock-remove-keywords
 nil
 '((next-image-overlay (0  'font-lock-keyword-face t))))

(ov-clear 'org-image-overlay)
</pre>
</div>


<p>
Note you still have to clear the overlays. Font lock doesn't seem to do that for you I think.
</p>
</div>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/03/21/Displaying-image-overlays-on-image-filenames-in-Emacs.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/03/21/Displaying-image-overlays-on-image-filenames-in-Emacs#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Org-teleport-headlines"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/03/18/Org-teleport-headlines/" rel="bookmark" title="Permanent Link to Org teleport headlines">Org teleport headlines</a></h2>
      <p><small><span class="blog_post_date">Posted March 18, 2016 at 08:47 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/orgmode/'>orgmode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/03/18/Org-teleport-headlines#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 18, 2016 at 08:48 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I often want to rearrange org headlines.  There are super convenient shortcuts for some things, like Alt-up/down to move up and down, and Alt-left/right to change levels, and shift variants of that when there are nested headlines. There is also refile for some use cases. The case these don't handle for me is when I have a headline at the bottom and I want to move it a distance. To cut down on key strokes, I usually kill the headline, jump to where I want, and paste it.
</p>

<p>
In lispy, there is a teleport command for this! I am going to adapt this here for reorganizing org-headlines. This version allows you to move headlines around on the visible area. You need another strategy for the candidates to jump to if you want to move a headline off the screen. Note though that ivy is really smart, you can have one file in a split view and it will jump to any headline in any window! I use ivy for the navigation here, but you could also use helm to select headlines, for example. This function puts your headline after the selected headline, unless you use a prefix arg, and then it goes before.
</p>

<p>
Check out the video to see this in action: <a href="https://www.youtube.com/watch?v=Vv-2888rpyc">https://www.youtube.com/watch?v=Vv-2888rpyc</a> 
</p>

<p>
Note: this code is a little more advanced than what is in the video; I added a numeric prefix to change the headline level.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-teleport</span> (<span style="color: #6434A3;">&amp;optional</span> arg)
  <span style="color: #036A07;">"Teleport the current heading to after a headline selected with avy.</span>
<span style="color: #036A07;">With a prefix ARG move the headline to before the selected</span>
<span style="color: #036A07;">headline. With a numeric prefix, set the headline level. If ARG</span>
<span style="color: #036A07;">is positive, move after, and if negative, move before."</span>
  (<span style="color: #0000FF;">interactive</span> <span style="color: #008000;">"P"</span>)
  <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Kill current headline</span>
  (org-mark-subtree)
  (kill-region (region-beginning) (region-end))
  <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Jump to a visible headline</span>
  (<span style="color: #0000FF;">avy-with</span> avy-goto-line (avy--generic-jump <span style="color: #008000;">"^\\*+"</span> nil avy-style))
  (<span style="color: #0000FF;">cond</span>
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Move before  and change headline level</span>
   ((<span style="color: #0000FF;">and</span> (numberp arg) (&gt; 0 arg))
    (<span style="color: #0000FF;">save-excursion</span>
      (yank))
    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">arg is what we want, second is what we have</span>
    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">if n is positive, we need to demote (increase level)</span>
    (<span style="color: #0000FF;">let</span> ((n (- (abs arg) (car (org-heading-components)))))
      (<span style="color: #0000FF;">cl-loop</span> for i from 1 to (abs n)
               do
               (<span style="color: #0000FF;">if</span> (&gt; 0 n)
                   (org-promote-subtree)
                 (org-demote-subtree)))))
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Move after and change level</span>
   ((<span style="color: #0000FF;">and</span> (numberp arg) (&lt; 0 arg))
    (org-mark-subtree)
    (goto-char (region-end))
    (<span style="color: #0000FF;">when</span> (eobp) (insert <span style="color: #008000;">"\n"</span>))
    (<span style="color: #0000FF;">save-excursion</span>
      (yank))
    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">n is what we want and second is what we have</span>
    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">if n is positive, we need to demote</span>
    (<span style="color: #0000FF;">let</span> ((n (- (abs arg) (car (org-heading-components)))))
      (<span style="color: #0000FF;">cl-loop</span> for i from 1 to (abs n)
               do
               (<span style="color: #0000FF;">if</span> (&gt; 0 n) (org-promote-subtree)
                 (org-demote-subtree)))))

   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">move to before selection</span>
   ((equal arg '(4))
    (<span style="color: #0000FF;">save-excursion</span>
      (yank)))
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">move to after selection</span>
   (t
    (org-mark-subtree)
    (goto-char (region-end))
    (<span style="color: #0000FF;">when</span> (eobp) (insert <span style="color: #008000;">"\n"</span>))
    (<span style="color: #0000FF;">save-excursion</span>
      (yank))))
  (outline-hide-leaves))
</pre>
</div>

<pre class="example">
org-teleport
</pre>

<p>
Now we add some new speed commands to help us out. I think we should be able to mark subtrees ("@" is bound to this, but I like "m" better) and kill them with a key stroke, in addition to teleporting them. Since we figured out the nice way to jump to a headline up there, we bind that to "q" which isn't used so far, and maps to a similar concept in lispy. The lowercase "t" is already bound to changing the TODO state, so we use capital "T" for the speed key to teleport. Note it is possible to "compose" the same effect by typing "k" to kill a headline, then "q" to jump somewhere else (or navigate where you want,  and then "C-y" to paste it at the new location. Or, "T".
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'org-speed-commands-user (cons <span style="color: #008000;">"m"</span> 'org-mark-subtree))
(add-to-list 'org-speed-commands-user (cons <span style="color: #008000;">"k"</span> (<span style="color: #0000FF;">lambda</span> ()
                                                  (org-mark-subtree)
                                                  (kill-region
                                                   (region-beginning)
                                                   (region-end)))))
(add-to-list 'org-speed-commands-user
             (cons <span style="color: #008000;">"q"</span> (<span style="color: #0000FF;">lambda</span> ()
                         (<span style="color: #0000FF;">avy-with</span> avy-goto-line
                           (avy--generic-jump <span style="color: #008000;">"^\\*+"</span> nil avy-style)))))

(add-to-list 'org-speed-commands-user (cons <span style="color: #008000;">"T"</span> 'org-teleport))
<span style="color: #008000;">"done"</span>
</pre>
</div>

<pre class="example">
done
</pre>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/03/18/Org-teleport-headlines.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/03/18/Org-teleport-headlines#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Getting-graphical-feedback-as-tooltips-in-Emacs"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/03/16/Getting-graphical-feedback-as-tooltips-in-Emacs/" rel="bookmark" title="Permanent Link to Getting graphical feedback as tooltips in Emacs">Getting graphical feedback as tooltips in Emacs</a></h2>
      <p><small><span class="blog_post_date">Posted March 16, 2016 at 05:14 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/03/16/Getting-graphical-feedback-as-tooltips-in-Emacs#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
In a continued exploration of Emacs as a user interface today we consider how to look at alternative representations of text. The long term idea is you might have a link to a datafile, say a Raman spectrum. You could click on the link to open it, perhaps even in analysis software. But, it might be nice to have a thumbnail type image that shows the data in graphical form. That might be sufficient for some purposes to identify which file to open.
</p>

<p>
You need to see the video to see the tooltips actually working in Emacs: <a href="https://www.youtube.com/watch?v=uX_hAPb9NOc">https://www.youtube.com/watch?v=uX_hAPb9NOc</a> 
</p>

<p>
To illustrate the idea here we will have E1macs display an image when you mouse over some words that represent fruit, specifically grapes, kiwi and strawberry. We have in this directory images of those fruit:
</p>

<div class="org-src-container">

<pre class="src src-sh">ls
</pre>
</div>

<pre class="example">
grapes.png
image-tooltips.org
kiwi.png
strawberry.png
</pre>

<p>
We will use font-lock to add a tooltip to those words that displays the image in the minibuffer. I thought the image would show in the tooltip here, but for some reason it doesn't. Maybe that is ok, since it doesn't clutter the text with big images. Font lock also makes the words stand out a bit so you know there is something there. Here is our tooltip code, and the font-lock-add-keywords that activates it.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">image-tooltip</span> (window object position)
  (<span style="color: #0000FF;">save-excursion</span>
    (goto-char position)
    (<span style="color: #0000FF;">let*</span> ((img-file (format <span style="color: #008000;">"%s.png"</span> (thing-at-point 'word)))
           (s (propertize <span style="color: #008000;">"Look in the minbuffer"</span>
                          'display (create-image (expand-file-name img-file)))))
      (message <span style="color: #008000;">"%s"</span> s))))

(font-lock-add-keywords
 nil
 '((<span style="color: #008000;">"\\&lt;kiwi\\&gt;</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">\\&lt;grapes\\&gt;</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">strawberry"</span> 0 '(face font-lock-keyword-face
                                                      help-echo image-tooltip))))
</pre>
</div>

<p>
Some examples of fruit are the kiwi, the strawberry and grapes. That is a little example to illustrate the concept. Now, imagine something more sophisticated, e.g. a link to a molecular simulation that generates a thumbnail of the atomic geometry, and a summary of the energy. Or a Raman spectrum that shows a thumbnail of the spectrum.
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2016/03/16/Getting-graphical-feedback-as-tooltips-in-Emacs.org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/03/16/Getting-graphical-feedback-as-tooltips-in-Emacs#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Modern-use-of-helm-sortable-candidates"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/01/24/Modern-use-of-helm-sortable-candidates/" rel="bookmark" title="Permanent Link to Modern use of helm - sortable candidates">Modern use of helm - sortable candidates</a></h2>
      <p><small><span class="blog_post_date">Posted January 24, 2016 at 02:48 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/helm/'>helm</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/01/24/Modern-use-of-helm-sortable-candidates#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="https://github.com/emacs-helm/helm">helm</a> continues to be my goto completion engine. I was perusing the source for helm-top, and noticed some cool new features, like sorting the candidates in the completion buffer! I also noticed that helm sources are preferably created with some new factory functions (as opposed to the a-lists I used to use). Here I explore some of these and illustrate how to make a sortable helm source.
</p>

<p>
First, we need a function to give us some candidates we will select from. I will use a function that returns a list of cons cells from a variable containing some data where each element in the data is a plist containing a number and key. I list strings as the number and key  so we can see what sorting does later. The data is just a list of plists containing a "number" and a key that is a string. We will create a helm function with these as candidates, and an ability to sort them in ascending/descending order on either the number or key.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> h-data '((<span style="color: #006FE0;">:num</span> 1 <span style="color: #006FE0;">:key</span> <span style="color: #008000;">"apple"</span>)
               (<span style="color: #006FE0;">:num</span> 9 <span style="color: #006FE0;">:key</span> <span style="color: #008000;">"berry"</span>)
               (<span style="color: #006FE0;">:num</span> 2 <span style="color: #006FE0;">:key</span> <span style="color: #008000;">"cactus"</span>)
               (<span style="color: #006FE0;">:num</span> 5 <span style="color: #006FE0;">:key</span> <span style="color: #008000;">"dog"</span>)
               (<span style="color: #006FE0;">:num</span> 4 <span style="color: #006FE0;">:key</span> <span style="color: #008000;">"frog"</span>)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">h-candidates</span> ()
  <span style="color: #036A07;">"Returns candidates for the helm source."</span>
  (<span style="color: #0000FF;">loop</span> for cand in h-data
        collect (cons (format <span style="color: #008000;">"%s %s"</span>
                              (plist-get cand <span style="color: #006FE0;">:num</span>)
                              (plist-get cand <span style="color: #006FE0;">:key</span>))
                      cand)))

(print (h-candidates))
</pre>
</div>

<pre class="example">
(("1 apple" :num 1 :key "apple") ("9 berry" :num 9 :key "berry") ("2 cactus" :num 2 :key "cactus") ("5 dog" :num 5 :key "dog") ("4 frog" :num 4 :key "frog"))
</pre>


<p>
Now, provide sorting, we need to create a candidate transformer function. This function will take the current candidates and source, and return a new list of candidates, possibly sorted. We use a variable to store how to sort the candidates. We also need a way to trigger the sorting. We will bind M-&lt;down&gt; to a function that will set the sort function, and refresh helm. Here is a keymap definition we will use later.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">h-map</span>
  (<span style="color: #0000FF;">let</span> ((map (make-sparse-keymap)))
    (set-keymap-parent map helm-map)
    (define-key map (kbd <span style="color: #008000;">"M-&lt;down&gt;"</span>)   'h-sort)
    map)
  <span style="color: #036A07;">"keymap for a helm source."</span>)
</pre>
</div>

<pre class="example">
h-map
</pre>

<p>
Now, we define the sort variable, a function that sets the variable, refreshes the candidates, and finally resets the sort variable. A key point here is the sort functions must take two arguments, which will be two candidates, and each candidate is of the form (string . data). We want to sort on one of the elements in the data plists for this example.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">h-sort-fn</span> nil)

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">h-sort</span> ()
  (<span style="color: #0000FF;">interactive</span>)
  (<span style="color: #0000FF;">let</span> ((action (read-char <span style="color: #008000;">"#decreasing (d) | #increasing (i) | a-z (a) | z-a (z: "</span>)))
    (<span style="color: #0000FF;">cond</span>
     ((eq action ?d)
      (<span style="color: #0000FF;">setq</span> h-sort-fn (<span style="color: #0000FF;">lambda</span> (c1 c2) (&gt; (plist-get (cdr c1) <span style="color: #006FE0;">:num</span>) (plist-get (cdr c2) <span style="color: #006FE0;">:num</span>)))))
     ((eq action ?i)
      (<span style="color: #0000FF;">setq</span> h-sort-fn (<span style="color: #0000FF;">lambda</span> (c1 c2) (&lt; (plist-get (cdr c1) <span style="color: #006FE0;">:num</span>) (plist-get (cdr c2) <span style="color: #006FE0;">:num</span>)))))
     ((eq action ?a)
      (<span style="color: #0000FF;">setq</span> h-sort-fn (<span style="color: #0000FF;">lambda</span> (c1 c2) (string&lt; (plist-get (cdr c1) <span style="color: #006FE0;">:key</span>) (plist-get (cdr c2) <span style="color: #006FE0;">:key</span>)))))
     ((eq action ?z)
      (<span style="color: #0000FF;">setq</span> h-sort-fn (<span style="color: #0000FF;">lambda</span> (c1 c2) (string&gt; (plist-get (cdr c1) <span style="color: #006FE0;">:key</span>) (plist-get (cdr c2) <span style="color: #006FE0;">:key</span>)))))
     (t (<span style="color: #0000FF;">setq</span> h-sort-fn nil)))
     (helm-refresh)
     (<span style="color: #0000FF;">setq</span> h-sort-fn nil)))
</pre>
</div>

<pre class="example">
h-sort
</pre>

<p>
Next, we define a candidate transformer. This function takes the list of candidates and the source. Here, if we have defined a sort function, we use it to sort the candidates, and if not, return the candidates. A subtle point here is the use of -sort from dash.el, which does not modify the original list at all. The build in function sort does modify the candidate list somehow, and it does not work the way you want it to here. This function gets run as the helm pattern changes.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">h-candidate-transformer</span> (candidates source)
  (<span style="color: #0000FF;">if</span> h-sort-fn
    (<span style="color: #0000FF;">progn</span> (message <span style="color: #008000;">"Sorting with %s"</span> h-sort-fn)
    (<span style="color: #0000FF;">-sort</span> h-sort-fn candidates))
  candidates))
</pre>
</div>

<pre class="example">
h-candidate-transformer
</pre>

<p>
Now, just for fun, we show that dynamically defined actions are possible. Here, we generate an action list that is different for even and odd numbers. These actions are pretty trivial, but give you an idea of what might be possible; custom, context specific actions.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Make dynamic actions based on the candidate selected</span>
(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">h-action-transformer</span> (actions candidate)
  <span style="color: #036A07;">"Candidate is the result selected."</span>
  (<span style="color: #0000FF;">if</span> (evenp (plist-get candidate <span style="color: #006FE0;">:num</span>))
      '((<span style="color: #008000;">"Even"</span> . identity))
    '((<span style="color: #008000;">"Odd"</span> . identity))))
</pre>
</div>

<pre class="example">
h-action-transformer
</pre>

<p>
Finally, we are ready to create a helm source. We use the new factory function for creating the source with our keymap, candidates and transformer functions.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> h-source
      (<span style="color: #0000FF;">helm-build-sync-source</span> <span style="color: #008000;">"number-selector"</span>
        <span style="color: #006FE0;">:keymap</span> h-map
        <span style="color: #006FE0;">:candidates</span> #'h-candidates
        <span style="color: #006FE0;">:filtered-candidate-transformer</span> #'h-candidate-transformer
        <span style="color: #006FE0;">:action-transformer</span> #'h-action-transformer))
</pre>
</div>

<p>
Now, you can run the helm source like this.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(helm <span style="color: #006FE0;">:sources</span> 'h-source)
</pre>
</div>

<p>
You can sort the numbers in descending order by typing M-&lt;down&gt; and pressing d. To get ascending order, press i instead. To sort on the keys, type a sort from a to z, and press z to sort on z to a. If you press tab on a selection, you will see that the actions you get depend on whether the selection is an even or odd number! So, you can get some context specific actions depending on your selection. Pretty awesome.
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2016/01/24/Modern-use-of-helm---sortable-candidates.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/01/24/Modern-use-of-helm-sortable-candidates#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Side-by-side-figures-in-org-mode-for-different-export-outputs"></div>
      <h2 class="blog_post_title"><a href="/blog/2016/01/17/Side-by-side-figures-in-org-mode-for-different-export-outputs/" rel="bookmark" title="Permanent Link to Side by side figures in org-mode for different export outputs">Side by side figures in org-mode for different export outputs</a></h2>
      <p><small><span class="blog_post_date">Posted January 17, 2016 at 09:03 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/orgmode/'>orgmode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2016/01/17/Side-by-side-figures-in-org-mode-for-different-export-outputs#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated January 17, 2016 at 09:18 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Occasionally, someone wants side by side figures with subcaptions that have individually referenceable labels. This is not too hard in LaTeX, and there is a solution here:  <a href="http://www.johndcook.com/blog/2009/01/14/how-to-display-side-by-side-figurs-in-latex/">http://www.johndcook.com/blog/2009/01/14/how-to-display-side-by-side-figurs-in-latex/</a> .
</p>

<p>
We can create side by side figures in raw LaTeX like this (note however, this will not show up in html export):
</p>

<p>
And in our text we can refer to the overall Figure <a href="#fig12">fig12</a>, or the subfigures Figure <a href="#fig:a">fig:a</a> or Figure <a href="#fig:b">fig:b</a>. This works fine if your end goal is LaTeX export. It does not work fine if you want to consider HTML or some other output.
</p>

<p>
So, here we consider how we could remove the LaTeX dependency by representing the figures in a sexp data structure, for example something like this. I change the labels and captions a bit so they are actually distinguishable.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(figure ()
 (subfigure '(<span style="color: #008000;">"Left graph from sexp."</span> (label <span style="color: #008000;">"fig:sa"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/cos-plot.png"</span>))
 (enskip)
 (subfigure '(<span style="color: #008000;">"Right graph from sexp"</span> (label <span style="color: #008000;">"fig:sb"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/eos-uncertainty.png"</span>))
 (caption
  <span style="color: #008000;">"Text pertaining to both graphs from a sexp, "</span> (ref <span style="color: #008000;">"fig:sa"</span>)
  <span style="color: #008000;">" and "</span> (ref <span style="color: #008000;">"fig:sb"</span>) <span style="color: #008000;">"."</span> (label <span style="color: #008000;">"figs12"</span>)))
</pre>
</div>

<pre class="example">
"emacs-lisp"
</pre>

<p>
This doesn't look much worse than the LaTeX code itself. It might not seem useful right away, but imagine if this was really code that could evaluate to the format we want. Remember the <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/06/10/A-sexp-version-of-a-bibtex-entry/">sexp bibtex entry</a> that could evaluate to bibtex, json or xml? Let's look at this here. What we consider is kind of like <a href="http://oremacs.com/2015/01/23/eltex/">http://oremacs.com/2015/01/23/eltex/</a> , but we could include other kinds of exports if we wanted.
</p>

<p>
Here is our special block in org-mode. It should render roughly as side by side images in LaTeX and HTML.
</p>

<div class="sexp">
<p>
(figure ()
 (subfigure '("Left graph from sexp." (label "fig:sa"))
            (includegraphics '((width . "3in"))
                             "images/cos-plot.png"))
 (enskip)
 (subfigure '("Right graph from sexp" (label "fig:sb"))
            (includegraphics '((width . "3in"))
                             "images/eos-uncertainty.png"))
 (caption
  "Text pertaining to both graphs from a sexp, " (ref "fig:sa")
  " and " (ref "fig:sb") "." (label "figs12")))
</p>

</div>

<p>
Now, we need a function to format the sexp block for export. It is easy, we just eval the contents of the block. We do assume here there is just one sexp to evaluate. This function will handle all special blocks, but we only want to do something different for the sexp blocks.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">sb-format</span> (sb contents info)
  (<span style="color: #0000FF;">cond</span>
     ((string= <span style="color: #008000;">"SEXP"</span> (org-element-property <span style="color: #006FE0;">:type</span> sb))
      (eval (read (buffer-substring
                   (org-element-property <span style="color: #006FE0;">:contents-begin</span> sb)
                   (org-element-property <span style="color: #006FE0;">:contents-end</span> sb)))))
     (t
      contents)))))
</pre>
</div>

<pre class="example">
sb-format
</pre>

<p>
All that is left is to define the functions. We do that next.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Latex export</h2>
<div class="outline-text-2" id="text-1">
<p>
We do LaTeX export first because we know what it should look like. We need to define a function for each piece of the data structure that will evaluate to a string. Here are three easy ones.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">label</span> (arg)
  (format <span style="color: #008000;">"\\label{%s}"</span> arg))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ref</span> (arg)
  (format <span style="color: #008000;">"\\ref{%s}"</span> arg))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">caption</span> (<span style="color: #6434A3;">&amp;rest</span> body)
  (format <span style="color: #008000;">"\\caption{%s}"</span>
         (mapconcat 'eval body <span style="color: #008000;">""</span>)))

(caption
  <span style="color: #008000;">"Text pertaining to both graphs, "</span> (ref <span style="color: #008000;">"fig:a"</span>)
  <span style="color: #008000;">" and "</span> (ref <span style="color: #008000;">"fig:b"</span>) <span style="color: #008000;">"."</span> (label <span style="color: #008000;">"fig12"</span>))
</pre>
</div>
<pre class="example">
\caption{Text pertaining to both graphs, \ref{fig:a} and \ref{fig:b}.\label{fig12}}
</pre>

<p>
Now, for includegraphics, we allow options and a path. The options we assume are in an a-list.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">includegraphics</span> (options path)
  (format <span style="color: #008000;">"\\includegraphics%s{%s}"</span>
          (<span style="color: #0000FF;">if</span> options
              (format <span style="color: #008000;">"[%s]"</span>
                      (mapconcat (<span style="color: #0000FF;">lambda</span> (ccell)
                                   (format <span style="color: #008000;">"%s=%s"</span>
                                           (car ccell)
                                           (cdr ccell)))
                                 options
                                 <span style="color: #008000;">","</span>))
            <span style="color: #008000;">""</span>)
          path))

(includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                 <span style="color: #008000;">"images/eos-uncertainty.png"</span>)
</pre>
</div>
<pre class="example">
\includegraphics[width=3in]{images/eos-uncertainty.png}
</pre>

<p>
Similarly for subfigure, we have options, and then a body of expressions. The options here are just expressions that should evaluate to strings. This is not consistent with the way we do options in includegraphics. This is just proof of concept work, so I don't know if this inconsistency is really problematic yet, or insufficient for all options.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">subfigure</span> (options <span style="color: #6434A3;">&amp;rest</span> body)
  (format <span style="color: #008000;">"\\subfigure%s{%s}"</span>
          (<span style="color: #0000FF;">if</span> options
              (format <span style="color: #008000;">"[%s]"</span>
                      (mapconcat 'eval options <span style="color: #008000;">""</span>))
            <span style="color: #008000;">""</span>)
          (mapconcat 'eval body <span style="color: #008000;">""</span>)))

(subfigure '(<span style="color: #008000;">"Right graph"</span> (label <span style="color: #008000;">"fig:b"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/eos-uncertainty.png"</span>))
</pre>
</div>
<pre class="example">
\subfigure[Right graph\label{fig:b}]{\includegraphics[width=3in]{images/eos-uncertainty.png}}
</pre>

<p>
Now, we put the whole figure together.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">figure</span> (options <span style="color: #6434A3;">&amp;rest</span> body)
  (format <span style="color: #008000;">"\\begin{figure}</span>
<span style="color: #008000;">%s</span>
<span style="color: #008000;">\\end{figure}"</span>
(mapconcat 'eval body <span style="color: #008000;">"\n"</span>)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">enskip</span> () <span style="color: #036A07;">"\\enskip"</span>)
</pre>
</div>
<pre class="example">
enskip
</pre>

<p>
Now, we would have a block like this, and we can evaluate it.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(figure ()
 (subfigure '(<span style="color: #008000;">"Left graph from sexp."</span> (label <span style="color: #008000;">"fig:ssa"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/cos-plot.png"</span>))
 (enskip)
 (subfigure '(<span style="color: #008000;">"Right graph from sexp"</span> (label <span style="color: #008000;">"fig:ssb"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/eos-uncertainty.png"</span>))
 (caption
  <span style="color: #008000;">"Text pertaining to both graphs from a sexp, "</span> (ref <span style="color: #008000;">"fig:ssa"</span>)
  <span style="color: #008000;">" and "</span> (ref <span style="color: #008000;">"fig:ssb"</span>) <span style="color: #008000;">"."</span> (label <span style="color: #008000;">"figss12"</span>)))
</pre>
</div>

<p>
Not the most beautiful LaTeX ever, but it works. Now, to get this to work, we need to handle our special sexp blocks differently. We do that with a new derived backend.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-export-define-derived-backend 'my-latex 'latex
  <span style="color: #006FE0;">:translate-alist</span> '((special-block . sb-format)))

(org-latex-compile (org-export-to-file 'my-latex <span style="color: #008000;">"custom-sb-export.tex"</span>))
(org-open-file <span style="color: #008000;">"custom-sb-export.pdf"</span>)
</pre>
</div>

<p>
It works, and here is the pdf: <a href="/media/2016-01-17-Side-by-side-figures-in-org-mode-for-different-export-outputs/custom-sb-export.pdf">custom-sb-export.pdf</a> .
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> HTML functions</h2>
<div class="outline-text-2" id="text-2">
<p>
We can use the same sexp block to get figures side-by-side in HTML. We need to redefine each element and its HTML output.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">label</span> (arg)
  (format <span style="color: #008000;">"&lt;a name=\"%s\"&gt;&lt;/a&gt;"</span> arg))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ref</span> (arg)
  (format <span style="color: #008000;">"&lt;a href=\"#%s\"&gt;%s&lt;/a&gt;"</span> arg arg))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">caption</span> (<span style="color: #6434A3;">&amp;rest</span> body)
  (format <span style="color: #008000;">"&lt;caption&gt;%s&lt;/caption&gt;"</span>
         (mapconcat 'eval body <span style="color: #008000;">""</span>)))

(caption
  <span style="color: #008000;">"Text pertaining to both graphs, "</span> (ref <span style="color: #008000;">"fig:a"</span>)
  <span style="color: #008000;">" and "</span> (ref <span style="color: #008000;">"fig:b"</span>) <span style="color: #008000;">"."</span> (label <span style="color: #008000;">"fig12"</span>))
</pre>
</div>

<pre class="example">
&lt;caption&gt;Text pertaining to both graphs, &lt;a href="#fig:a"&gt;fig:a&lt;/a&gt; and &lt;a href="#fig:b"&gt;fig:b&lt;/a&gt;.&lt;a name="fig12"&gt;&lt;/a&gt;&lt;/caption&gt;
</pre>


<p>
We will ignore options for the includegraphics html output. We would need to specify some way to do unit conversions for html. Here we fix the width.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">includegraphics</span> (options path)
  (format <span style="color: #008000;">"&lt;img src=\"/media/%s\" width=\"300\"&gt;"</span>
          path))

(includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                 <span style="color: #008000;">"images/eos-uncertainty.png"</span>)
</pre>
</div>

<pre class="example">
&lt;img src="/media/images/eos-uncertainty.png" width="300"&gt;
</pre>

<p>
We wrap a subfigure in a table cell.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">subfigure</span> (options <span style="color: #6434A3;">&amp;rest</span> body)
  (format <span style="color: #008000;">"&lt;td&gt;%s%s&lt;/td&gt;"</span>
          (mapconcat 'eval body <span style="color: #008000;">""</span>)
          (<span style="color: #0000FF;">when</span> options
            (concat <span style="color: #008000;">"&lt;br&gt;"</span>
                    (mapconcat 'eval options <span style="color: #008000;">""</span>)))))

(subfigure '(<span style="color: #008000;">"Right graph"</span> (label <span style="color: #008000;">"fig:b"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/eos-uncertainty.png"</span>))
</pre>
</div>

<pre class="example">
&lt;td&gt;&lt;img src="/media/images/eos-uncertainty.png" width="300"&gt;&lt;br&gt;Right graph&lt;a name="fig:b"&gt;&lt;/a&gt;&lt;/td&gt;
</pre>

<p>
We assume we can put the images in a single row.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">figure</span> (options <span style="color: #6434A3;">&amp;rest</span> body)
  (format <span style="color: #008000;">"&lt;span class=\"image\"&gt;&lt;table&gt;</span>
<span style="color: #008000;">&lt;tr&gt;%s&lt;/tr&gt;</span>
<span style="color: #008000;">&lt;/table&gt;&lt;/span&gt;"</span>
(mapconcat 'eval body <span style="color: #008000;">"\n"</span>)))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">enskip</span> () <span style="color: #036A07;">""</span>)
</pre>
</div>

<pre class="example">
enskip
</pre>

<p>
Now, here is our specification.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(figure ()
 (subfigure '(<span style="color: #008000;">"Left graph"</span> (label <span style="color: #008000;">"fig:ha"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/cos-plot.png"</span>))
 (enskip)
 (subfigure '(<span style="color: #008000;">"Right graph"</span> (label <span style="color: #008000;">"fig:hb"</span>))
            (includegraphics '((width . <span style="color: #008000;">"3in"</span>))
                             <span style="color: #008000;">"images/eos-uncertainty.png"</span>))
 (caption
  <span style="color: #008000;">"Text pertaining to both graphs, "</span> (ref <span style="color: #008000;">"fig:ha"</span>)
  <span style="color: #008000;">" and "</span> (ref <span style="color: #008000;">"fig:hb"</span>) <span style="color: #008000;">"."</span> (label <span style="color: #008000;">"figh12"</span>)))
</pre>
</div>

<span class="image"><table>
<tr><td><img src="/media/images/cos-plot.png" width="300"><br>Left graph<a name="fig:ha"></a></td>

<td><img src="/media/images/eos-uncertainty.png" width="300"><br>Right graph<a name="fig:hb"></a></td>
<caption>Text pertaining to both graphs, <a href="#fig:ha">fig:ha</a> and <a href="#fig:hb">fig:hb</a>.<a name="figh12"></a></caption></tr>
</table></span>


<p>
And our derived backend for HTML.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(org-export-define-derived-backend 'my-html 'html
  <span style="color: #006FE0;">:translate-alist</span> '((special-block . sb-format)))

(browse-url (org-export-to-file 'my-html <span style="color: #008000;">"custom-sb-export.html"</span>))
</pre>
</div>

<pre class="example">
#&lt;process open custom-sb-export.html&gt;
</pre>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Summary thoughts</h2>
<div class="outline-text-2" id="text-3">
<p>
I think I like the idea. Obviously there are differences between what is possible between LaTeX and HTML, notably the attributes that may or may not be supported between them, including the units of the width, labels, and references. I still have not figured out an elegant way to switch between LaTeX and HTML exports since there is basically one set of functions that need different outputs under different conditions; maybe each function could have backend specific output.
</p>

<p>
For small things, you could achieve this with inline emacs-lisp src blocks, but I think those are limited to one liners. Alternatively, you could probably get by with output from an actual src block, but you would have to make sure it executed during export (I turn this off by default), and that it have backend specific output.
</p>

<p>
Finally, the only other alternative is a preprocessor that finds the sexps that define the data and replaces them with output.
</p>

<p>
The sexp block I described above is basically like a domain specific language (DSL). Something like this is described in "Practical Common Lisp" (<a href="http://www.gigamonkeys.com/book/practical-an-html-generation-library-the-interpreter.html">http://www.gigamonkeys.com/book/practical-an-html-generation-library-the-interpreter.html</a> ). My version is not as sophisticated as the one there.  Notably, mine uses eval which has some limitations, such as no communication between sexp blocks.</p>
</div>
</div>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2016/01/17/Side-by-side-figures-in-org-mode-for-different-export-outputs.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2016/01/17/Side-by-side-figures-in-org-mode-for-different-export-outputs#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/category/emacs/8">« Previous Page</a>
  --  
 <a href="/blog/category/emacs/10">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/05/09/Making-it-easier-to-extend-the-export-of-org-mode-links-with-generic-functions/">Making it easier to extend the export of org-mode links with generic functions</a></li>
      <li><a href="/blog/2018/04/16/New-publication-in-Nature-Catalysis/">New publication in Nature Catalysis</a></li>
      <li><a href="/blog/2018/04/11/Caching-searches-using-biblio-and-only-seeing-new-results/">Caching searches using biblio and only seeing new results</a></li>
      <li><a href="/blog/2018/04/09/Zhitao-Guo-receives-the-2017-2018-James-C-Meade-Fellowship-in-Chemical-Engineering/">Zhitao Guo receives the 2017-2018 James C. Meade Fellowship in Chemical Engineering</a></li>
      <li><a href="/blog/2018/04/01/New-publication-in-Catalysis-Today/">New publication in Catalysis Today</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



