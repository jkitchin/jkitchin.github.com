

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Kitchin Research Group</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="http://www.researcherid.com/rid/A-2363-2010" target="_new">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/group.html"
             class="">Group</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>
    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Collecting-entries-from-files-in-a-directory"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/08/25/Collecting-entries-from-files-in-a-directory/" rel="bookmark" title="Permanent Link to Collecting entries from files in a directory">Collecting entries from files in a directory</a></h2>
      <p><small><span class="blog_post_date">Posted August 25, 2014 at 09:42 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/emacs-lisp/'>emacs-lisp</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/08/25/Collecting-entries-from-files-in-a-directory#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated August 25, 2014 at 09:44 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
I am running a class where students will be generating files that contain their answers. I want to quickly get a list of counts of all the answers. For example, six students will create a file called animal.dat in a directory called example/&lt;studentid&gt;, and that file will contain their favorite animal. I made some example files to test this idea out. Here are the contents.
</p>

<div class="org-src-container">

<pre class="src src-sh">cat example/*/animal.dat
</pre>
</div>

<pre class="example">
dog
cat
dog
bird
dog
bird
</pre>

<p>
You can see there are three dogs, two birds and a cat. I want code to do this counting, because in my real application there will be 58 of these files, and lots of times I need to aggregate them. Let us start with a simple example that counts the elements in a list.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((animals '(dog cat dog bird dog bird))
      (counts '())
      place)
  (<span style="color: #8b0000;">dolist</span> (animal animals)
    (setq place (assoc animal counts))
    (message <span style="color: #228b22;">"place = %s"</span> place)
    (<span style="color: #8b0000;">if</span> place
        (setf (cdr place) (+ 1 (cdr place)))
      (setq counts (cons `(,animal . 1) counts))))
  counts)
</pre>
</div>

<p>
((bird . 2) (cat . 1) (dog . 3))
</p>

<p>
Let us turn that into a function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">counts</span> (list)
  (<span style="color: #8b0000;">let</span> ((counts '())
        place)
    (<span style="color: #8b0000;">dolist</span> (el list)   
      (setq place (assoc el  counts))
    (message <span style="color: #228b22;">"place = %s"</span> place)
    (<span style="color: #8b0000;">if</span> place
        (setf (cdr place) (+ 1 (cdr place)))
      (setq counts (cons `(,el . 1) counts))))
    counts))

(counts '(dog cat dog bird dog bird))
</pre>
</div>

<p>
((bird . 2) (cat . 1) (dog . 3))
</p>

<p>
Nice. Now we need a simple way to get that list. We need to glob the files to find them, then open them and read the value. Here is a way to get the files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(f-entries <span style="color: #228b22;">"example"</span>
           (<span style="color: #8b0000;">lambda</span> (f)
             (string= (file-name-nondirectory f) <span style="color: #228b22;">"animal.dat"</span>))
           t)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s1/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s2/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s3/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s4/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s5/animal.dat</td>
<td class="left">/Users/jkitchin/blogofile-jkitchin.github.com/<sub>blog</sub>/collect-entries/example/s6/animal.dat</td>
</tr>
</tbody>
</table>

<p>
Now we just need to run a mapcar over this list of files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(mapcar
 (<span style="color: #8b0000;">lambda</span> (f)
   (<span style="color: #8b0000;">with-temp-buffer</span>
     (insert-file-contents f)
     (s-trim (buffer-string))))
 (f-entries <span style="color: #228b22;">"example"</span>
            (<span style="color: #8b0000;">lambda</span> (f)
              (string= (file-name-nondirectory f) <span style="color: #228b22;">"animal.dat"</span>))
            t))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">dog</td>
<td class="left">cat</td>
<td class="left">dog</td>
<td class="left">bird</td>
<td class="left">dog</td>
<td class="left">bird</td>
</tr>
</tbody>
</table>


<p>
Finally, putting this together, we have some code that maps over the files, and counts the entries.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(counts
 (mapcar
  (<span style="color: #8b0000;">lambda</span> (f)
    (<span style="color: #8b0000;">with-temp-buffer</span>
      (insert-file-contents f)
      (s-trim (buffer-string))))
  (f-entries <span style="color: #228b22;">"example"</span>
             (<span style="color: #8b0000;">lambda</span> (f)
               (string= (file-name-nondirectory f) <span style="color: #228b22;">"animal.dat"</span>))
             t)))
</pre>
</div>

<p>
((bird . 2) (cat . 1) (dog . 3))
</p>

<p>
This will be helpful in dealing with 58 entries during my class!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/08/25/Collecting-entries-from-files-in-a-directory.org">org-mode source</a><p><p>Org-mode version = 8.2.7c</p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/08/25/Collecting-entries-from-files-in-a-directory#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Autogenerating-functions-in-emacs-lisp"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/05/12/Autogenerating-functions-in-emacs-lisp/" rel="bookmark" title="Permanent Link to Autogenerating functions in emacs-lisp">Autogenerating functions in emacs-lisp</a></h2>
      <p><small><span class="blog_post_date">Posted May 12, 2014 at 06:05 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/emacs-lisp/'>emacs-lisp</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/05/12/Autogenerating-functions-in-emacs-lisp#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated May 12, 2014 at 06:05 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
I have a need to generate a lot of similar functions, and I do not want to cut and paste the code. I want to generate the functions with code. This seems to be what macros are for in emacs lisp. 
</p>

<p>
As a prototype example, we will make functions that raise a number to a power. We want functions like power-3 and power-4 that raise numbers to the third and fourth powers. We will define functions like this for the numbers 0-9.
</p>

<p>
Here we define the macro. i do not want to get into the nitty gritty details of macro definitions here.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defmacro make-power-n (n)
 `(defun ,(intern (format "power-%s" n)) (arg) (expt arg ,n)))

(make-power-n 4)

(power-4 4)
</pre>
</div>

<pre class="example">
256
</pre>

<p>
Now we use the macro and mapcar on it onto a list of numbers. We have to eval the macro in the mapcar lambda function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(defmacro make-power-n (n)
 `(defun ,(intern (format "power-%s" n)) (arg) (expt arg ,n)))

(mapcar (lambda (x) (eval `(make-power-n ,x))) '(0 1 2 3 4 5 6 7 8 9))
 
;; example of a few functions
(list (power-0 3) (power-1 3) (power-2 3))
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">1</td>
<td class="right">3</td>
<td class="right">9</td>
</tr>
</tbody>
</table>

<p>
It works! We created 10 functions in a little bit of code. 
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/12/Autogenerating-functions-in-emacs-lisp.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/05/12/Autogenerating-functions-in-emacs-lisp#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Language-specific-default-headers-for-code-blocks-in-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/26/Language-specific-default-headers-for-code-blocks-in-org-mode/" rel="bookmark" title="Permanent Link to Language specific default headers for code blocks in org-mode">Language specific default headers for code blocks in org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted January 26, 2014 at 12:06 PM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/org-mode/'>org-mode</a>, <a href='/blog/category/emacs-lisp/'>emacs-lisp</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/26/Language-specific-default-headers-for-code-blocks-in-org-mode#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I use code blocks in org-mode <i>a lot</i>. I usually code in Python, and
in Python I usually write code that prints output which I want to see. So I almost always
want the code blocks to return the output, and not the value of the
last function. I have set my default header args like this:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">org-babel-default-header-args
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">(:exports . both)</td>
<td class="left">(:results . replace output)</td>
<td class="left">(:session . none)</td>
<td class="left">(:cache . no)</td>
<td class="left">(:noweb . no)</td>
<td class="left">(:hlines . no)</td>
<td class="left">(:tangle . no)</td>
</tr>
</tbody>
</table>

<p>
However, I would prefer that emacs-lisp blocks use value for the
results. I know I can get that by putting  <code>:results value</code>  in the
code block header, but that annoys me. I learned today from
<a href="http://orgmode.org/worg/org-contrib/babel/header-args.html">http://orgmode.org/worg/org-contrib/babel/header-args.html</a> that you
can make language specific default headers!
</p>

<p>
This code in my init file sets emacs-lisp specific default headers:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-babel-default-header-args:emacs-lisp 
      (cons '(<span style="color: #cd0000;">:results</span> . <span style="color: #228b22;">"value"</span>)
            (assq-delete-all <span style="color: #cd0000;">:results</span> org-babel-default-header-args)))
</pre>
</div>

<p>
That way I do not have type <code>:results value</code> at the top of every elisp
block. Of course, if I want the output I could specify <code>:results
output</code> in the block.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">org-babel-default-header-args:emacs-lisp
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">(:results . value)</td>
<td class="left">(:exports . both)</td>
<td class="left">(:session . none)</td>
<td class="left">(:cache . no)</td>
<td class="left">(:noweb . no)</td>
<td class="left">(:hlines . no)</td>
<td class="left">(:tangle . no)</td>
</tr>
</tbody>
</table>

<p>
Problem solved!
</p>

<p>
On a related note, I find I write so many blocks of python and elisp I
added these templates:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">add &lt;p for python expansion</span>
(add-to-list 'org-structure-template-alist
             '(<span style="color: #228b22;">"p"</span> <span style="color: #228b22;">"#+BEGIN_SRC python\n?\n#+END_SRC"</span> <span style="color: #228b22;">"&lt;src lang=\"python\"&gt;\n?\n&lt;/src&gt;"</span>))

<span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">add &lt;el for emacs-lisp expansion</span>
(add-to-list 'org-structure-template-alist
             '(<span style="color: #228b22;">"el"</span> <span style="color: #228b22;">"#+BEGIN_SRC emacs-lisp\n?\n#+END_SRC"</span> <span style="color: #228b22;">"&lt;src lang=\"emacs-lisp\"&gt;\n?\n&lt;/src&gt;"</span>))
</pre>
</div>

<p>
I probably could have also coded the :results header into those
too. They add a tidbit of convenience so I do not have to type python
or emacs-lisp after expanding a source block with &lt;s.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/26/Language-specific-default-headers-for-code-blocks-in-org-mode.org">org-mode source</a><p><p>Org-mode version = 8.2.5g</p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/26/Language-specific-default-headers-for-code-blocks-in-org-mode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Another-alternative-to-string-templates"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/26/Another-alternative-to-string-templates/" rel="bookmark" title="Permanent Link to Another alternative to string templates">Another alternative to string templates</a></h2>
      <p><small><span class="blog_post_date">Posted January 26, 2014 at 09:56 AM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/emacs-lisp/'>emacs-lisp</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/26/Another-alternative-to-string-templates#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
In the <a href="http://kitchingroup.cheme.cmu.edu/blog/2014/01/20/Alternatives-to-long-complex-format-statements-in-emacs-lisp/">last post</a> I explored a way to expand a string template that was
more readable than the usual format. Today I look at another approach
where I use sexp expansions to accomplish the same thing. The idea is
to embed lisp expressions and replace them by what they evaluate to.
</p>

<p>
In emacs-lisp, if we have a command in a string, we can "read" it, and
then eval it. 
</p>

<p>
Here we get the user-full-name:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(eval (read <span style="color: #228b22;">"user-full-name"</span>))
</pre>
</div>

<pre class="example">
John Kitchin
</pre>

<p>
We can use this on variables too.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq some-variable <span style="color: #228b22;">"test"</span>)
(eval (read <span style="color: #228b22;">"some-variable"</span>))
</pre>
</div>

<pre class="example">
test
</pre>

<p>
So, if we use a syntax to identify what to replace, we can substitute
in the values. Let us try %() as the syntax.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">expand-template</span> (s)
  <span style="color: #228b22;">"expand a template containing %() with the eval of its contents"</span>
  (replace-regexp-in-string <span style="color: #228b22;">"%(</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">)]+</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">)"</span>
                            (<span style="color: #8b0000;">lambda</span> (arg)
                              (format <span style="color: #228b22;">"%s"</span> (eval (read (substring arg 2 -1))))) s))


(<span style="color: #8b0000;">let</span> ((key <span style="color: #228b22;">"kitchin-2014"</span>)
      (author <span style="color: #228b22;">"Kitchin, J. R."</span>)
      (journal <span style="color: #228b22;">"HACS"</span>)
      (year <span style="color: #228b22;">"2014"</span>)
      (volume <span style="color: #228b22;">"1"</span>)
      (pages <span style="color: #228b22;">"1--10"</span>)
      (doi <span style="color: #228b22;">"10.1.1.109/hacs.1.10"</span>)
      (url <span style="color: #228b22;">"http://hacs.org/10.1.1.109/hacs.1.10"</span>)
      (pdf-dir <span style="color: #228b22;">"/home/jkitchin/pdfs"</span>)
      (template <span style="color: #228b22;">"</span>
<span style="color: #228b22;"> :PROPERTIES:</span>
<span style="color: #228b22;">  :Custom_ID: %(key)</span>
<span style="color: #228b22;">  :AUTHOR: %(author</span>
<span style="color: #228b22;">  :JOURNAL: %(journal)</span>
<span style="color: #228b22;">  :YEAR: %(year)</span>
<span style="color: #228b22;">  :VOLUME: %(volume)</span>
<span style="color: #228b22;">  :PAGES: %(pages)</span>
<span style="color: #228b22;">  :DOI: %(doi)</span>
<span style="color: #228b22;">  :URL: %(url)</span>
<span style="color: #228b22;"> :END:</span>
<span style="color: #ff0000; font-weight: bold;">[</span><span style="color: #228b22;">[cite:%(key)]] [[file:%(pdf-dir)/%(key).pdf][pdf]]\n\n"</span>))

(expand-template template))
</pre>
</div>

<pre class="example">
 :PROPERTIES:
  :Custom_ID: kitchin-2014
  :AUTHOR: Kitchin, J. R.
  :YEAR: 2014
  :VOLUME: 1
  :PAGES: 1--10
  :DOI: 10.1.1.109/hacs.1.10
  :URL: http://hacs.org/10.1.1.109/hacs.1.10
 :END:
[[cite:kitchin-2014]] [[file:/home/jkitchin/pdfs/kitchin-2014.pdf][pdf]]
</pre>

<p>
That is pretty nice. I like it better than the plist expansion I used
before. Presumably these variables would already be defined somewhere
in your code.
</p>

<p>
I thought of trying this on a more complex expansion, and discovered a
weakness in the regexp that finds the expansion values. It turns out
to be simpler to use %{} as the delimiter than %(), because you may
want nested parentheses. The regexp above does not correctly match
sets of parentheses.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">expand-template</span> (s)
  <span style="color: #228b22;">"expand a template containing %{} with the eval of its contents"</span>
  (replace-regexp-in-string <span style="color: #228b22;">"%{</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">}]+</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">}"</span>
                            (<span style="color: #8b0000;">lambda</span> (arg)
                              (<span style="color: #8b0000;">let</span> ((sexp (substring arg 2 -1)))
                                (format <span style="color: #228b22;">"%s"</span> (eval (read sexp))))) s))

(expand-template <span style="color: #228b22;">"2 * 2 = %{(* 2 2)}"</span>)
</pre>
</div>

<pre class="example">
2 * 2 = 4
</pre>


<p>
I am not sure this is a desirable way to make a template, with
multiline code to be expanded, but at least this works!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">expand-template</span> (s)
  <span style="color: #228b22;">"expand a template containing %{} with the eval of its contents"</span>
  (replace-regexp-in-string <span style="color: #228b22;">"%{</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">}]+</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">}"</span>
                            (<span style="color: #8b0000;">lambda</span> (arg)
                              (<span style="color: #8b0000;">let</span> ((sexp (substring arg 2 -1)))
                                (format <span style="color: #228b22;">"%s"</span> (eval (read sexp))))) s))

(expand-template <span style="color: #228b22;">"The result is %{(progn</span>
<span style="color: #228b22;">  (if (&gt; 4 3)</span>
<span style="color: #228b22;">      'true</span>
<span style="color: #228b22;">    'false))}"</span>)
</pre>
</div>

<pre class="example">
The result is true
</pre>

<p>
The regexp used in the expansion is not very robust. In particular if
there is a } in the code, it will probably fail because the regexp
does not match closing } correctly. Fixing that is beyond me right
now!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/26/Another-alternative-to-string-templates.org">org-mode source</a><p><p>Org-mode version = 8.2.5g</p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/26/Another-alternative-to-string-templates#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Alternatives-to-long-complex-format-statements-in-emacs-lisp"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/20/Alternatives-to-long-complex-format-statements-in-emacs-lisp/" rel="bookmark" title="Permanent Link to Alternatives to long complex format statements in emacs-lisp">Alternatives to long complex format statements in emacs-lisp</a></h2>
      <p><small><span class="blog_post_date">Posted January 20, 2014 at 09:50 AM</span> | categories: 
        <span class="blog_post_categories"><a href='/blog/category/emacs-lisp/'>emacs-lisp</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/20/Alternatives-to-long-complex-format-statements-in-emacs-lisp#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
At one point I had a string I wanted to fill in with a bunch of variables. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(insert (format<span style="color: #228b22;">"</span>
<span style="color: #228b22;"> :PROPERTIES:</span>
<span style="color: #228b22;">  :Custom_ID: %s</span>
<span style="color: #228b22;">  :AUTHOR: %s</span>
<span style="color: #228b22;">  :JOURNAL: %s</span>
<span style="color: #228b22;">  :YEAR: %s</span>
<span style="color: #228b22;">  :VOLUME: %s</span>
<span style="color: #228b22;">  :PAGES: %s</span>
<span style="color: #228b22;">  :DOI: %s</span>
<span style="color: #228b22;">  :URL: %s</span>
<span style="color: #228b22;"> :END:</span>
<span style="color: #228b22; font-weight: bold;">[</span><span style="color: #228b22;">[cite:%s]] [[file:%s/%s.pdf][pdf]]\n\n"</span>
key author journal year volume pages doi url key jorg-bib-pdf-directory key ))
</pre>
</div>

<p>
I find that very difficult to use, because it is tedious to make sure all the variables are in the right order, and it is difficult to change later. In Python, you would be able to put named expansions in, e.g. {author} and then used named arguments. That does not exist as far as I know in emacs-lisp.
</p>

<p>
Below is an alternatme approach that uses concat to construct this string.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">let</span> ((key <span style="color: #228b22;">"kitchin-2014"</span>)
      (author <span style="color: #228b22;">"Kitchin, J. R."</span>)
      (journal <span style="color: #228b22;">"HACS"</span>)
      (year <span style="color: #228b22;">"2014"</span>)
      (volume <span style="color: #228b22;">"1"</span>)
      (pages <span style="color: #228b22;">"1--10"</span>)
      (doi <span style="color: #228b22;">"10.1.1.109/hacs.1.10"</span>)
      (url <span style="color: #228b22;">"http://hacs.org/10.1.1.109/hacs.1.10"</span>)
      (jorg-bib-pdf-directory <span style="color: #228b22;">"/home/jkitchin/pdfs"</span>))

(concat <span style="color: #228b22;">"</span>
<span style="color: #228b22;"> :PROPERTIES:</span>
<span style="color: #228b22;">  :Custom_ID: "</span> key <span style="color: #228b22;">"</span>
<span style="color: #228b22;">  :AUTHOR: "</span> author <span style="color: #228b22;">"</span>
<span style="color: #228b22;">  :JOURNAL: "</span> journal <span style="color: #228b22;">"</span>
<span style="color: #228b22;">  :YEAR: "</span> year <span style="color: #228b22;">"</span>
<span style="color: #228b22;">  :VOLUME: "</span> volume <span style="color: #228b22;">"</span>
<span style="color: #228b22;">  :PAGES: "</span> pages <span style="color: #228b22;">"</span>
<span style="color: #228b22;">  :DOI: "</span> doi <span style="color: #228b22;">"</span>
<span style="color: #228b22;">  :URL: "</span> url <span style="color: #228b22;">"</span>
<span style="color: #228b22;"> :END:</span>
<span style="color: #228b22; font-weight: bold;">[</span><span style="color: #228b22;">[cite:"</span> key <span style="color: #228b22;">"]] [[file:"</span> jorg-bib-pdf-directory <span style="color: #228b22;">"/"</span> key <span style="color: #228b22;">".pdf][pdf]]\n\n"</span>))
</pre>
</div>

<pre class="example">
 :PROPERTIES:
  :Custom_ID: kitchin-2014
  :AUTHOR: Kitchin, J. R.
  :JOURNAL: HACS
  :YEAR: 2014
  :VOLUME: 1
  :PAGES: 1--10
  :DOI: 10.1.1.109/hacs.1.10
  :URL: http://hacs.org/10.1.1.109/hacs.1.10
 :END:
[[cite:kitchin-2014]] [[file:/home/jkitchin/pdfs/kitchin-2014.pdf][pdf]]
</pre>

<p>
That is kind of interesting. It is a little tedious to use all the quotes. It seems like there should be soemthing like named expansions. Let us write one of our own. We will use a regular expression to find {:keyword} and a plist. There is a regexp to match this, and then we can take the characters from position 1 to the second to last character as the keyword. That is not beautiful to me, but it works here. Then we just get the keyword from the plist. The keywords in a plist are symbols, and we will have strings. We have to use the <code>intern</code> function to convert them to symbols.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">expand-template</span> (s plist)
  <span style="color: #228b22;">"expand a template containing {:keyword} with the definitions in plist"</span>
  (replace-regexp-in-string <span style="color: #228b22;">"{</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">(</span><span style="color: #228b22;">:[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">}]+</span><span style="color: #228b22; font-weight: bold;">\\</span><span style="color: #228b22; font-weight: bold;">)</span><span style="color: #228b22;">}"</span> 
                            (<span style="color: #8b0000;">lambda</span> (arg) 
                              (<span style="color: #8b0000;">let</span> ((keyword (intern (substring arg 1 -1))))
                                (format <span style="color: #228b22;">"%s"</span> (plist-get plist keyword)))) s))

(<span style="color: #8b0000;">let</span> ((template <span style="color: #228b22;">"</span>
<span style="color: #228b22;"> :PROPERTIES:</span>
<span style="color: #228b22;">  :Custom_ID: {:key}</span>
<span style="color: #228b22;">  :AUTHOR: {:author}</span>
<span style="color: #228b22;">  :JOURNAL: {:journal}</span>
<span style="color: #228b22;">  :YEAR: {:year}</span>
<span style="color: #228b22;">  :VOLUME: {:volume}</span>
<span style="color: #228b22;">  :PAGES: {:pages}</span>
<span style="color: #228b22;">  :DOI: {:doi}</span>
<span style="color: #228b22;">  :URL: {:url}</span>
<span style="color: #228b22;"> :END:</span>
<span style="color: #228b22; font-weight: bold;">[</span><span style="color: #228b22;">[cite:{:key}]] [[file:{:pdf-dir}/{:key}.pdf][pdf]]\n\n"</span>))

(expand-template template
                 '(<span style="color: #cd0000;">:key</span> <span style="color: #228b22;">"kitchin-2014"</span>
                        <span style="color: #cd0000;">:author</span> <span style="color: #228b22;">"Kitchin, J. R."</span>
                        <span style="color: #cd0000;">:journal</span> <span style="color: #228b22;">"HACS"</span>
                        <span style="color: #cd0000;">:year</span> 2014
                        <span style="color: #cd0000;">:volume</span> 1
                        <span style="color: #cd0000;">:pages</span> <span style="color: #228b22;">"1--10"</span>
                        <span style="color: #cd0000;">:doi</span> <span style="color: #228b22;">"10.1.1.109/hacs.1.10"</span>
                        <span style="color: #cd0000;">:url</span> <span style="color: #228b22;">"http://hacs.org/10.1.1.109/hacs.1.10"</span>
                        <span style="color: #cd0000;">:pdf-dir</span> <span style="color: #228b22;">"/home/jkitchin/pdfs"</span>)))
</pre>
</div>

<pre class="example">
 :PROPERTIES:
  :Custom_ID: kitchin-2014
  :AUTHOR: Kitchin, J. R.
  :JOURNAL: HACS
  :YEAR: 2014
  :VOLUME: 1
  :PAGES: 1--10
  :DOI: 10.1.1.109/hacs.1.10
  :URL: http://hacs.org/10.1.1.109/hacs.1.10
 :END:
[[cite:kitchin-2014]] [[file:/home/jkitchin/pdfs/kitchin-2014.pdf][pdf]]
</pre>

<p>
That is pretty close to what I am used to from python! I am surprised there aren't other solutions for this around. I looked, and couldn't find them.
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/20/Alternatives-to-long-complex-format-statements-in-emacs-lisp.org">org-mode source</a><p><p>Org-mode version = 8.2.5f</p>

    </div>
  </div>
</article>



  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/20/Alternatives-to-long-complex-format-statements-in-emacs-lisp#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/category/emacs-lisp/2">Next Page Â»</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
Search
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kitchingroup.cheme.cmu.edu" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
    <li><a href="http://enthought.com">Enthought Python</a></li>
    <li><a href="/pycse">Pycse</a></li>
    <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2014/10/30/Generating-your-bibliography-in-another-file/">Generating your bibliography in another file</a></li>
      <li><a href="/blog/2014/10/21/New-publication-in-J-Physical-Chemistry-C/">New publication in J. Physical Chemistry C</a></li>
      <li><a href="/blog/2014/10/19/Using-Pymacs-to-integrate-Python-into-Emacs/">Using Pymacs to integrate Python into Emacs</a></li>
      <li><a href="/blog/2014/10/17/Generate-emacs-lisp-documentation/">Generate emacs-lisp documentation</a></li>
      <li><a href="/blog/2014/10/14/Sentence-casing-your-bibtex-entry-journal-titles/">Sentence casing your bibtex entry journal titles</a></li>
    </ul>
  </section>

  <section>
 <h1 class="post_header_gradient theme_font"><a href="http://www.citeulike.org/user/jkitchin" class="external text" title="http://www.citeulike.org/user/jkitchin" rel="nofollow">CiteULike</a> Reading List</h1>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {

var d = new Date();
curr_year = d.getFullYear();

$.getJSON('http://www.citeulike.org/json/user/jkitchin/,,?callback=?&per_page=5',
function(data) {
  var items = [];
  year=curr_year
  $.each(data, function(i) {
    year=data[i].published[0];
    var cit='<li id="' + i + '">' + '<a class="pap" href="http://dx.doi.org/'+data[i].doi+'">'+ data[i].title + '</a><br>';
    cit+='</li>';
    items.push( cit )      
  });

  $('<ul/>', {
    'class': 'my-new-list',
    html: items.join('')
  }).appendTo('#papers2');
});
});
</script>

<div id="papers2"></div>

  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
<ul id="my-github-projects">
    <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2014
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



