

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: orgmode</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Using-results-from-one-code-block-in-another-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2019/02/12/Using-results-from-one-code-block-in-another-org-mode/" rel="bookmark" title="Permanent Link to Using results from one code block in another org-mode">Using results from one code block in another org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted February 12, 2019 at 09:20 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/elisp/'>elisp</a>, <a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/orgmode/'>orgmode</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2019/02/12/Using-results-from-one-code-block-in-another-org-mode#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated February 25, 2019 at 02:17 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org679863a">1. :var</a></li>
<li><a href="#org1cd48f8">2. :cache</a></li>
<li><a href="#org744145d">3. :wrap</a></li>
<li><a href="#org603dd14">4. :file</a></li>
<li><a href="#org61d9dad">5. "remote" data</a></li>
<li><a href="#orgf9c3e0a">6. Manually saving data in files</a></li>
<li><a href="#org578795b">7. An appendix for data</a></li>
<li><a href="#org828ee8b">8. Caveats</a></li>
</ul>
</div>
</div>
<p>
One really great feature in org-mode is you have many options to pass data between code-blocks. In this post we look at some of these options using emacs-lisp as the language. This runs in a <i>session</i> where you can keep variables in memory between blocks, and use them in subsequent blocks.
</p>

<p>
Here we set a variable to a value.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> some-variable 42)
</pre>
</div>

<pre class="example">
42
</pre>


<p>
Then later in another block we can use that variable:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(+ some-variable 1)
</pre>
</div>

<pre class="example">
43
</pre>


<p>
While you are in the session, <code>some-variable</code> can be used. If you want some mind-bending trouble, the emacs-lisp session is global, and you can access <code>some-variable</code> even in another buffer! Don't do that. When you close emacs this variable will disappear, and all that is left are the results from above.
</p>

<p>
There is another way to pass information from one block to another using named src blocks and variables in the block header. This allows you to pass data between blocks by name, and you will see later you can even access the results by name from other files.
</p>

<div id="outline-container-org679863a" class="outline-2">
<h2 id="org679863a"><span class="section-number-2">1</span> :var</h2>
<div class="outline-text-2" id="text-1">
<p>
First, we give our src block a name like this:
</p>

<pre class="example">
#+name: block-1
#+BEGIN_SRC emacs-lisp
(current-time-string)
#+END_SRC
</pre>

<p>
When we run this, the results will have a name too.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org0eee06d">(current-time-string)
</pre>
</div>

<pre class="example">
Tue Feb 12 08:19:23 2019
</pre>


<p>
Now, we can use the named result as <i>input</i> to a new block using the :var header.
</p>

<pre class="example">
#+BEGIN_SRC emacs-lisp :var input=block-1
(format "We got %S in block-1" input)
#+END_SRC
</pre>

<p>
When we run this block, emacs will run block-1 and put the output in to the variable <code>input</code> which we use inside the code block.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(format <span style="color: #008000;">"We got %S in block-1"</span> input)
</pre>
</div>

<pre class="example">
We got "Tue Feb 12 08:20:44 2019" in block-1
</pre>


<p>
Some things to note:
</p>
<ol class="org-ol">
<li>Every time you run this, block-1 gets rerun.</li>
<li>The results in this block are not the same as in block-1</li>
<li>The results in block-1 are not changed when you run the second block.</li>
</ol>

<p>
You may not want to rerun block-1 each time; maybe it is an expensive calculation, or maybe it should not be changed. You can prevent this behavior by using the :cache header.
</p>
</div>
</div>

<div id="outline-container-org1cd48f8" class="outline-2">
<h2 id="org1cd48f8"><span class="section-number-2">2</span> :cache</h2>
<div class="outline-text-2" id="text-2">
<p>
If you specify <code>:cache yes</code> then org-mode <i>should</i> store a hash of the code block with the results, and if the code block hasn't changed then it should not run again.
</p>

<pre class="example">
#+name: block-2
#+BEGIN_SRC emacs-lisp :cache yes
(current-time-string)
#+END_SRC
</pre>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgb1aedb8">(current-time-string)
</pre>
</div>

<pre class="example">
Tue Feb 12 08:06:22 2019
</pre>


<p>
Now, we use block-2 as input to a block, we see the output is the same as the output from block-2.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(format <span style="color: #008000;">"We got %S in block-2"</span> input)
</pre>
</div>

<pre class="example">
We got "Tue Feb 12 08:06:22 2019" in block-2
</pre>


<p>
Ok, but what if my results are too large to put in the buffer, or too complex for text? You still have some options.
</p>
</div>
</div>

<div id="outline-container-org744145d" class="outline-2">
<h2 id="org744145d"><span class="section-number-2">3</span> :wrap</h2>
<div class="outline-text-2" id="text-3">
<p>
Suppose we generate some json in one block, and we want to use it in another block. We still want to see the json in the buffer as an intermediate result. We can wrap the output in a json block like this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd0725ee">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">json</span>)
(json-encode `((<span style="color: #008000;">"date"</span> . ,(current-time-string))))
</pre>
</div>

<div class="json">
<p>
{"date":"Tue Feb 12 08:30:20 2019"}
</p>

</div>

<p>
Then, we can simply input that output into a new block.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(format <span style="color: #008000;">"We got %S in json"</span> input)
</pre>
</div>

<pre class="example">
We got "{\"date\":\"Tue Feb 12 08:30:20 2019\"}
" in json
</pre>


<p>
This admittedly still pretty simple, text-based data. It is probably not a good idea to do this with binary data.
</p>

<p>
Note you can refer to this result even in another org-file:
</p>

<pre class="example">
#+BEGIN_SRC emacs-lisp :var input=./2019-02-12.org:json
input
#+END_SRC

#+RESULTS:
: {"date":"Tue Feb 12 08:30:20 2019"}
</pre>
</div>
</div>


<div id="outline-container-org603dd14" class="outline-2">
<h2 id="org603dd14"><span class="section-number-2">4</span> :file</h2>
<div class="outline-text-2" id="text-4">
<p>
It may be that your data is too large to conveniently put into your org-file, or maybe it is binary data. No problem, just put it into an external file using the :file header. It looks like this:
</p>

<pre class="example">
#+name: block-3
#+BEGIN_SRC emacs-lisp :cache yes :file block-3
(require 'json)
(json-encode `(("date" . ,(current-time-string))))
#+END_SRC

#+RESULTS[a14d376653bd8c40a0961ca95f21d8837dddec66]: block-3
[[file:block-3]]
</pre>


<p>
Note that you have to provide a file name for this. Sometimes that is nice if you want a human recognizable file to send to someone, but it would also be nice if there was an automatic naming scheme, e.g. based on an sha-1 hash of the src block.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org5f97d46">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">json</span>)
(json-encode `((<span style="color: #008000;">"date"</span> . ,(current-time-string))))
</pre>
</div>

<p>
<a href="/media/block-3">block-3</a> 
</p>

<p>
Now you can use other tools to check out the file. Here we can still use simple shell tools.
</p>

<div class="org-src-container">
<pre class="src src-sh">cat block-3
</pre>
</div>


<p>
The output of block-3 is a file name:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">input
</pre>
</div>

<pre class="example">
/Users/jkitchin/Box Sync/kitchingroup/jkitchin/journal/2019/02/12/block-3
</pre>


<p>
So you can use it in a new block to read the data in, and then do something new with it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">with-temp-buffer</span>
  (insert-file-contents input)
  (format <span style="color: #008000;">"We got %S in block-3"</span> (json-read-from-string (buffer-string))))
</pre>
</div>

<pre class="example">
We got ((date . "Tue Feb 12 08:46:55 2019")) in block-3
</pre>
</div>
</div>

<div id="outline-container-org61d9dad" class="outline-2">
<h2 id="org61d9dad"><span class="section-number-2">5</span> "remote" data</h2>
<div class="outline-text-2" id="text-5">
<p>
The blocks do not have to be in order. If you want, you can put your blocks in an <a href="#org578795b">appendix</a>, and then just have analysis blocks here that use them. That way, you can have short blocks here that are more readable, but longer, more complex blocks elsewhere that do not clutter your document.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">with-temp-buffer</span>
  (insert-file-contents input)
  (format <span style="color: #008000;">"We got %S in the appendix data"</span> (json-read-from-string (buffer-string))))
</pre>
</div>

<pre class="example">
We got "{\"date\":\"Tue Feb 12 09:11:12 2019\"}" in the appendix data
</pre>
</div>
</div>


<div id="outline-container-orgf9c3e0a" class="outline-2">
<h2 id="orgf9c3e0a"><span class="section-number-2">6</span> Manually saving data in files</h2>
<div class="outline-text-2" id="text-6">
<p>
Note you can also manually save data in a file, for example:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org99c8008">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">json</span>)
(<span style="color: #0000FF;">let</span> ((f <span style="color: #008000;">"block-4.json"</span>))
  (<span style="color: #0000FF;">with-temp-file</span> f
    (prin1
     (json-encode `((<span style="color: #008000;">"date"</span> . ,(current-time-string))))
     (current-buffer)))
  f)
</pre>
</div>

<pre class="example">
block-4.json
</pre>


<p>
We put the filename as the last variable which is returned by the block, so that we don't have to manually type it later in the next block. You know, try not to repeat yourself&#x2026;
</p>

<p>
This just shows we did write out to our file:
</p>

<div class="org-src-container">
<pre class="src src-sh">cat block-4.json
</pre>
</div>

<p>
And we read the file in here, using the filename from block-4 as an input variable.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">with-temp-buffer</span>
  (insert-file-contents input)
  (format <span style="color: #008000;">"We got %S in block-4"</span> (json-read-from-string (buffer-string))))
</pre>
</div>

<pre class="example">
We got "{\"date\":\"Tue Feb 12 08:51:25 2019\"}" in block-4
</pre>
</div>
</div>

<div id="outline-container-org578795b" class="outline-2">
<h2 id="org578795b"><span class="section-number-2">7</span> An appendix for data</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgfc06cf8">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">json</span>)
(<span style="color: #0000FF;">let</span> ((f <span style="color: #008000;">"appendix.json"</span>))
  (<span style="color: #0000FF;">with-temp-file</span> f
    (prin1
     (json-encode `((<span style="color: #008000;">"date"</span> . ,(current-time-string))))
     (current-buffer)))
  f)
</pre>
</div>

<pre class="example">
appendix.json
</pre>
</div>
</div>


<div id="outline-container-org828ee8b" class="outline-2">
<h2 id="org828ee8b"><span class="section-number-2">8</span> Caveats</h2>
<div class="outline-text-2" id="text-8">
<p>
Using org-mode like this is almost always finding the right tradeoffs in what is persistent, and where is it stored. Not all of the intermediate data/calculations are stored; if they are really cheap you can just run the code blocks again. If they are really small, i.e. easy for your to read in a few lines, you can store them in the document. If they are really large, you can store them in a file.
</p>

<p>
The beauty of having everything in an org-file is you have a single file that is easy to transport. When the files get too large though, it can become impractical, e.g. emacs may slow down if you try to put thousands of lines of xml data into the buffer. Then, you have to make some decisions about what to keep, where to keep it, and in what form to keep it.
</p>

<p>
For short projects where you only need a single compute session, having everything in memory may be fine. For longer projects, say one that is long enough you will close all the buffers, and possibly restart emacs in between working on it, then you have to make some decisions about what to save from each block so you can continue the work in the next session. Again, you have to decide what to save, where to save, and in what form.
</p>

<p>
Once you start saving data outside the org-file, it becomes less portable, or more tricky to move the file because you need to also move all the data files to keep it intact. I have explored a concept of making an org-archive in the past, where you get a list of all files linked in the org-file, but this so far has just been worked out for some small proof of concept ideas.
</p>

<p>
Not all languages are the same in org-mode. They do not all support sessions for example, and they may not all work like the examples here. The scimax iPython modifications do not behave like the examples above. That is probably due to bugs I have inadvertently introduced, and in the future I will try to make it work like emacs-lisp does above.
</p>

<p>
Overall, org-mode has one of the most flexible and powerful systems for passing and reusing data in documents I have ever seen. It is not perfect, and in such a powerful system there are many unexplored or lightly traveled corners that may have hazards in them. It still seems pretty promising though.
</p>
</div>
</div>
<p>Copyright (C) 2019 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2019/02/12/Using-results-from-one-code-block-in-another-org-mode.org">org-mode source</a></p>
<p>Org-mode version = 9.2.1</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2019/02/12/Using-results-from-one-code-block-in-another-org-mode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Getting-geo-tagged-information-from-photos-for-blogging"></div>
      <h2 class="blog_post_title"><a href="/blog/2018/07/01/Getting-geo-tagged-information-from-photos-for-blogging/" rel="bookmark" title="Permanent Link to Getting geo-tagged information from photos for blogging">Getting geo-tagged information from photos for blogging</a></h2>
      <p><small><span class="blog_post_date">Posted July 01, 2018 at 07:17 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/geotag/'>geotag</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2018/07/01/Getting-geo-tagged-information-from-photos-for-blogging#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated July 01, 2018 at 08:05 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I am kind of late to this game, but recently I turned on location services for the camera on my phone. That means the location of the photo is stored in the photo, and we can use that to create urls to the photo location in a map for example. While traveling, I thought this would be a good application for org-mode to add functionality to documents with photos in them, e.g. to be able to click on them to see where they are from, or to automate creation of html pages with links to maps, etc. In this post I explore some ways to achieve those ideas. What I would like is a custom org link that shows me a thumbnail of the image, and which exports to show the image in an html file with a link to a pin on Google maps.
</p>

<p>
So, let's dig in. Imagemagick provides an identify command that can extract the information stored in the images. Here we consider just the GPS information. I some pictures on a recent vacation, and one is unimaginatively named IMG_1759.JPG. Let's see where it was taken.
</p>

<div class="org-src-container">
<pre class="src src-sh">identify -verbose IMG_1759.JPG | grep GPS
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">exif:GPSAltitude:</td>
<td class="org-left">14426/387</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSAltitudeRef:</td>
<td class="org-left">0</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSDateStamp:</td>
<td class="org-left">2018:06:30</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSDestBearing:</td>
<td class="org-left">11767/80</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSDestBearingRef:</td>
<td class="org-left">T</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSImgDirection:</td>
<td class="org-left">11767/80</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSImgDirectionRef:</td>
<td class="org-left">T</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSInfo:</td>
<td class="org-left">1632</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSLatitude:</td>
<td class="org-left">22/1,</td>
<td class="org-left">11/1,</td>
<td class="org-left">614/100</td>
</tr>

<tr>
<td class="org-left">exif:GPSLatitudeRef:</td>
<td class="org-left">N</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSLongitude:</td>
<td class="org-left">159/1,</td>
<td class="org-left">40/1,</td>
<td class="org-left">4512/100</td>
</tr>

<tr>
<td class="org-left">exif:GPSLongitudeRef:</td>
<td class="org-left">W</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSSpeed:</td>
<td class="org-left">401/100</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSSpeedRef:</td>
<td class="org-left">K</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exif:GPSTimeStamp:</td>
<td class="org-left">3/1,</td>
<td class="org-left">44/1,</td>
<td class="org-left">3900/100</td>
</tr>
</tbody>
</table>

<p>
The interpretation here is that I took that photo at latitude 22° 11' 6.14" N, and longitude 159° 40' 45.12" W. Evidently I was moving at 4.01 in some unit; I can confirm that I was at least moving, I was on a ship when I took that picture, and it was moving.
</p>

<p>
According to <a href="http://alvarestech.com/temp/routeconverter/RouteConverter/navigation-formats/src/main/doc/googlemaps/Google_Map_Parameters.htm">this</a> you can make a url to a Google maps pin in satellite picture mode that looks like this: <a href="http://maps.google.com/maps?q=22%2011%206.14N,159%2040%2045.12W&amp;t=k">http://maps.google.com/maps?q=22 11 6.14N,159 40 45.12W&amp;t=k</a>. It doesn't seem possible to set the zoom in this url (at least setting the zoom doesn't do anything, and I didn't feel like trying all the other variations that are reported to sometimes work). I guess that is ok for now, it adds some suspense that you have to zoom out to see where the image is in some cases.
</p>

<p>
We need a little function to take an image file and generate that link. We have to do some algebra on the latitude and longitude which are stored as integers with a division operator. I am going to pipe this through an old unix utility called bc mostly because it is simple, and I won't have to parse it much. bc is a little archaic, you have to set the scale first, which tells it how many decimal places to output. The degrees and minutes are integers, so we will have to deal with that later.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #006FE0;">echo</span> <span style="color: #008000;">"scale=2; 614/100"</span> | bc
</pre>
</div>

<pre class="example">
6.14

</pre>

<p>
Here is our function. I filter out the lines with GPS in them into an a-list. Then, I grab out the specific quantities I want and construct the url. There is a little hackery since it appears the degrees and minutes should be integers in the url formulation used here, so I convert them to numbers and then take the floor. The function is a little longer than I thought, but it isn't too bad I guess. It is a little repetitious, but not enough to justify refactoring.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">iphoto-map-url</span> (fname)
  (<span style="color: #0000FF;">let*</span> ((gps-lines (-keep (<span style="color: #0000FF;">lambda</span> (line)
                             (<span style="color: #0000FF;">when</span> (s-contains? <span style="color: #008000;">"GPS"</span> line) (s-trim line)))
                           (process-lines <span style="color: #008000;">"identify"</span> <span style="color: #008000;">"-verbose"</span> fname)))
         (gps-alist (mapcar (<span style="color: #0000FF;">lambda</span> (s) (s-split <span style="color: #008000;">": "</span> s t))  gps-lines))
         (latitude (mapcar
                    (<span style="color: #0000FF;">lambda</span> (s)
                      (s-trim (shell-command-to-string
                               (format <span style="color: #008000;">"echo \"scale=2;%s\" | bc"</span> s))))
                    (s-split <span style="color: #008000;">","</span> (cadr (assoc <span style="color: #008000;">"exif:GPSLatitude"</span> gps-alist)))))
         (latitude-ref (cadr (assoc <span style="color: #008000;">"exif:GPSLatitudeRef"</span> gps-alist)))
         (longitude (mapcar
                     (<span style="color: #0000FF;">lambda</span> (s)
                       (s-trim
                        (shell-command-to-string
                         (format <span style="color: #008000;">"echo \"scale=2;%s\" | bc"</span> s))))
                     (s-split <span style="color: #008000;">","</span> (cadr (assoc <span style="color: #008000;">"exif:GPSLongitude"</span> gps-alist)))))
         (longitude-ref (cadr (assoc <span style="color: #008000;">"exif:GPSLongitudeRef"</span> gps-alist))))
    (s-format <span style="color: #008000;">"http://maps.google.com/maps?q=$0 $1 $2$3,$4 $5 $6$7&amp;t=k"</span>
              'elt
              (list
               (floor (string-to-number (nth 0 latitude)))
               (floor (string-to-number (nth 1 latitude)))
               (nth 2 latitude)
               latitude-ref
               (floor (string-to-number (nth 0 longitude)))
               (floor (string-to-number (nth 1 longitude)))
               (nth 2 longitude)
               longitude-ref))))
</pre>
</div>

<pre class="example">
iphoto-map-url

</pre>

<p>
Here is the function in action, making the url.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(iphoto-map-url <span style="color: #008000;">"IMG_1759.JPG"</span>)
</pre>
</div>

<pre class="example">
http://maps.google.com/maps?q=22 11 6.14N,159 40 45.12W&amp;t=k

</pre>

<p>
It is kind of slow, but that is because the identify shell command is kind of slow when you run it with the -verbose tag. Now, I would like the following things to happen when I publish it to html:
</p>

<ol class="org-ol">
<li>I want the image wrapped in an img tag inside a figure environment.</li>
<li>I want the image to by hyperlinked to its location in Google maps.</li>
</ol>

<p>
In the org file, I want a thumbnail overlay on it, so I can see the image while writing, and I want it to toggle like other images. I use an iPhone to take the photos, so we will call it an iphoto link.
</p>

<p>
Here is the html export function I will use. It is a little hacky that I hard code the width in at 300 pixels, but I didn't feel like figuring out how to get it from an #+attr_html line right now. It probably requires a filter function where you have access to the actual org-elements. I put the url to the image location in a figure caption here.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">iphoto-export</span> (path desc backend)
  (<span style="color: #0000FF;">cond</span>
   ((eq 'html backend)
    (format <span style="color: #008000;">"&lt;figure&gt;</span>
<span style="color: #008000;">&lt;img src=\"%s\" width=\"300\"&gt;</span>
<span style="color: #008000;">%s</span>
<span style="color: #008000;">&lt;/figure&gt;"</span>
            path
            (format <span style="color: #008000;">"&lt;figcaption&gt;%s &lt;a href=\"%s\"&gt;map&lt;/a&gt;&lt;/figcaption&gt;"</span>
                    (<span style="color: #0000FF;">or</span> desc <span style="color: #008000;">""</span>)
                    (iphoto-map-url path))))))
</pre>
</div>

<pre class="example">
iphoto-export

</pre>

<p>
Ok, the last detail I want is to put an image overlay on my new link so I can see it. I want this to work with org-toggle-inline-images so I can turn the images on and off like regular image links with C-c C-x C-v. This function creates overlays as needed, and ties into the org-inline-image-overlays so they get deleted on toggling. We have to advise the display function to redraw these, which we clumsily do by restarting the org font-lock machinery which will redraw the thumbnails from the activate-func property of the links. I also hard code the thumbnail width in this function, when it could be moved out to a variable or attribute.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">iphoto-thumbnails</span> (start end imgfile bracketp)
  (<span style="color: #0000FF;">unless</span> bracketp
    (<span style="color: #0000FF;">when</span> (<span style="color: #0000FF;">and</span>
           <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">it is an image</span>
           (org-string-match-p (image-file-name-regexp) imgfile)
           <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">and it exists</span>
           (f-exists? imgfile)
           <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">and there is no overlay here.</span>
           (not (ov-at start)))
      (<span style="color: #0000FF;">setq</span> img (create-image (expand-file-name imgfile)
                              'imagemagick nil <span style="color: #006FE0;">:width</span> 300
                              <span style="color: #006FE0;">:background</span> <span style="color: #008000;">"lightgray"</span>))
      (<span style="color: #0000FF;">setq</span> ov (make-overlay start end))
      (overlay-put ov 'display img)
      (overlay-put ov 'face 'default)
      (overlay-put ov 'org-image-overlay t)
      (overlay-put ov 'modification-hooks
                   (list
                    `(<span style="color: #0000FF;">lambda</span> (<span style="color: #6434A3;">&amp;rest</span> args)
                       (org-display-inline-remove-overlay ,ov t ,start ,end))))
      (<span style="color: #0000FF;">push</span> ov org-inline-image-overlays))))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">iphoto-redraw-thumbnails</span> (<span style="color: #6434A3;">&amp;rest</span> args)
  (org-restart-font-lock))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this redisplays these thumbnails on image toggling</span>
(advice-add 'org-display-inline-images <span style="color: #006FE0;">:after</span> 'iphoto-redraw-thumbnails)
</pre>
</div>

<p>
Next, we define the link with a follow, export, tooltip and activate-func (which puts the overlay on).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-link-set-parameters
 <span style="color: #008000;">"iphoto"</span>
 <span style="color: #006FE0;">:follow</span> (<span style="color: #0000FF;">lambda</span> (path) (browse-url (iphoto-map-url path)))
 <span style="color: #006FE0;">:export</span> 'iphoto-export
 <span style="color: #006FE0;">:help-echo</span> <span style="color: #008000;">"Click me to see where this photo is on a map."</span>
 <span style="color: #006FE0;">:activate-func</span> 'iphoto-thumbnails)
</pre>
</div>


<p>
So finally, here is the mysterious image.
</p>


<p>
<figure>
<img src="/media/IMG_1759.JPG" width="300">
<figcaption> <a href="http://maps.google.com/maps?q=22 11 6.14N,159 40 45.12W&t=k">map</a></figcaption>
</figure>
</p>


<p>
Now, in org-mode, I see the image in an overlay, and I can toggle it on and off. If I click on the image, it opens a browser to Google maps with a pin at the spot I took it. When I export it, it wraps the image in a &lt;figure&gt; tag, and puts a url in the caption to the map. If you click on it, and zoom out, you will see this is a picture of the Nāpali Coast on Kauai in Hawaii, and I was in fact out at sea when I took the picture. It was spectacular. Here is another one. This one is a little more obvious with the zoom. Here, I was on land. Since this link is bracketed, it does not show the overlay however in the org-file.
</p>

<p>
<figure>
<img src="/media/IMG_1749.JPG" width="300">
<figcaption>Another vacation picture, this time with a caption. <a href="http://maps.google.com/maps?q=21 57 37.01N,159 21 6.72W&t=k">map</a></figcaption>
</figure>
</p>

<p>
Overall, this was easier than I expected. It might be faster to outsource reading the exif data to some dedicate library, perhaps in python that would return everything you want in an easy to parse json data structure. The speed of computing the url is only annoying when you export or click on the links though.
</p>

<p>
I didn't build in any error handling, e.g. if you do this on a photo with no GPS data it will probably not handle it gracefully. I also haven't tested this on any other images, e.g. south of the equator, from other cameras, etc. I assume this exif data is pretty standard, but it is a wild world out there&#x2026; It would still be nice to find a way to get a string representing the nearest known location somehow, that would help the caption be more useful.
</p>

<p>
There is one little footnote to speak of, and that is I had to do a little hackery to get this to work with my blog machinery. You can see what it is in the org-source, I buried it in a noexport subheading, because it isn't that interesting in the grand scheme of things. It was just necessary because I export these org-files to blogofile, which then builds the html pages, instead of just exporting them. The images have to be copied to a source directory, and paths changed in the html to point to them. See, boring stuff. Otherwise, the code above should be fine for regular org and html files! Now, my vacation is over so it is time to get back to work.
</p>
<p>Copyright (C) 2018 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2018/07/01/Getting-geo-tagged-information-from-photos-for-blogging.org">org-mode source</a></p>
<p>Org-mode version = 9.1.13</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2018/07/01/Getting-geo-tagged-information-from-photos-for-blogging#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Literate-programming-with-python-doctests"></div>
      <h2 class="blog_post_title"><a href="/blog/2018/05/17/Literate-programming-with-python-doctests/" rel="bookmark" title="Permanent Link to Literate programming with python doctests">Literate programming with python doctests</a></h2>
      <p><small><span class="blog_post_date">Posted May 17, 2018 at 04:41 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/python/'>python</a>, <a href='/blog/category/noweb/'>noweb</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2018/05/17/Literate-programming-with-python-doctests#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated May 18, 2018 at 03:07 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org91f890f">1. Add a way to run the tests</a></li>
<li><a href="#org4759a84">2. Tangle the file</a></li>
<li><a href="#org8727607">3. Run the tests</a></li>
<li><a href="#org5a82a2f">4. The noweb doctest block</a></li>
</ul>
</div>
</div>
<p>
On the org-mode mailing list we had a nice discussion about using noweb and org-mode in literate programming. The results of that discussion were blogged about <a href="http://kdr2.com/tech/emacs/1805-approach-org-ref-code-to-text.html">here</a>. I thought of a different application of this for making <a href="https://pymotw.com/3/doctest/">doctests</a> in Python functions. I have to confess I have never liked these because I have always thought they were a pain to write since you basically have to put code and results into a docstring. The ideas developed in the discussion above led me to think of a new way to write these that seems totally reasonable.
</p>

<p>
The idea is just to put noweb placeholders in the function docstring for the doctests. The placeholders will be expanded when you tangle the file, and they will get their contents from other src-blocks where you have written and run examples to test them.
</p>

<p>
This video might make the rest of this post easier to follow:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/u8CWbedVV9Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

<p>
I will illustrate the idea using org-mode and the ob-ipython I have in scimax. The defaults of my ob-ipython setup are not useful for this example because it puts the execution count and mime types of output in the output. These are not observed in a REPL, and so we turn this off by setting these variables.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> ob-ipython-suppress-execution-count t
      ob-ipython-show-mime-types nil)
</pre>
</div>

<p>
Now, we make an example function that takes a single argument and returns one divided by that argument. This block is runnable, and the function is then defined in the jupyter kernel. The docstring contains several noweb references to doctest blocks we define later. For now, they don't do anything. See <a href="#org5a82a2f">The noweb doctest block</a> section for the block that is used to expand these. This block also has a tangle header which indicates the file to tangle the results to. When I run this block, it is sent to a Jupyter kernel and saved in memory for use in subsequent blocks.
</p>

<p>
Here is the block with no noweb expansion. Note that this is easier to read in the original org source than it is to read in the published blog format.
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>(a):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">"""A function to divide one by a.</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   &lt;&lt;doctest("doctest-1")&gt;&gt;</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   &lt;&lt;doctest("doctest-2")&gt;&gt;</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   &lt;&lt;doctest("doctest-3")&gt;&gt;</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   Returns: 1 / a.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #036A07;">   """</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> 1 / a

</pre>
</div>

<p>
Now, we can write a series of named blocks that define various tests we might want to use as doctests. You can run these blocks here, and verify they are correct. Later, when we tangle the document, these will be incorporated into the tangled file in the docstring we defined above.
</p>

<div class="org-src-container">
<pre class="src src-ipython" id="org4eaeeaf">func(5) == 0.2
</pre>
</div>

<pre class="example">
True

</pre>



<p>
This next test will raise an Exception, and we just run it to make sure it does.
</p>

<div class="org-src-container">
<pre class="src src-ipython" id="org560fcaf">func(0)
</pre>
</div>

<pre class="example">

ZeroDivisionErrorTraceback (most recent call last)
&lt;ipython-input-6-ba0cd5a88f0a&gt; in &lt;module&gt;()
----&gt; 1 func(0)

&lt;ipython-input-1-eafd354a3163&gt; in func(a)
     18     Returns: 1 / a.
     19     """
---&gt; 20     return 1 / a

ZeroDivisionError: division by zero

</pre>



<p>
This is just a doctest with indentation to show how it is used.
</p>

<div class="org-src-container">
<pre class="src src-ipython" id="org968debf"><span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(1, 4):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(func(i))
</pre>
</div>

<pre class="example">
1.0
0.5
0.3333333333333333


</pre>



<p>
That concludes the examples I want incorporated into the doctests. Each one of these blocks has a name, which is used as an argument to the noweb references in the function docstring.
</p>

<div id="outline-container-org91f890f" class="outline-2">
<h2 id="org91f890f"><span class="section-number-2">1</span> Add a way to run the tests</h2>
<div class="outline-text-2" id="text-1">
<p>
This is a common idiom to enable easy running of the doctests. This will get tangled out to the file.
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">if</span> <span style="color: #006FE0;">__name__</span> == <span style="color: #008000;">"__main__"</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">import</span> doctest
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   doctest.testmod()
</pre>
</div>
</div>
</div>


<div id="outline-container-org4759a84" class="outline-2">
<h2 id="org4759a84"><span class="section-number-2">2</span> Tangle the file</h2>
<div class="outline-text-2" id="text-2">
<p>
So far, the Python code we have written only exists in the org-file, and in memory. Tangling is the extraction of the code into a code file.
</p>

<p>
We run this command, which extracts the code blocks marked for tangling, and expands the noweb references in them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-babel-tangle)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">test.py</td>
</tr>
</tbody>
</table>

<p>
Here is what we get:
</p>

<pre class="example">
def func(a):
    """A function to divide one by a.

    &gt;&gt;&gt; func(5) == 0.2
    True

    &gt;&gt;&gt; func(0)
    Traceback (most recent call last):
    ZeroDivisionError: division by zero

    &gt;&gt;&gt; for i in range(1, 4):
    ...     print(func(i))
    1.0
    0.5
    0.3333333333333333


    Returns: 1 / a.
    """
    return 1 / a

if __name__ == "__main__":
    import doctest
    doctest.testmod()

</pre>

<p>
That looks like a reasonable python file. You can see the doctest blocks have been inserted into the docstring, as desired. The proof of course is that we can run these doctests, and use the python module. We show that next.
</p>
</div>
</div>


<div id="outline-container-org8727607" class="outline-2">
<h2 id="org8727607"><span class="section-number-2">3</span> Run the tests</h2>
<div class="outline-text-2" id="text-3">
<p>
Now, we can check if the tests pass in a fresh run (i.e. not using the version stored in the jupyter kernel.) The standard way to run the doctests is like this:
</p>

<div class="org-src-container">
<pre class="src src-sh">python test.py -v
</pre>
</div>




<p>
Well, that's it! It worked fine. Now we have a python file we can import and reuse, with some doctests that show how it works. For example, here it is in a small Python script.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> test <span style="color: #0000FF;">import</span> func
<span style="color: #0000FF;">print</span>(func(3))
</pre>
</div>

<pre class="example">
0.3333333333333333

</pre>



<p>
There are surely some caveats to keep in mind here. This was just a simple proof of concept idea that isn't tested beyond this example. I don't know how many complexities would arise from more complex doctests. But, it seems like a good idea to continue pursuing if you like using doctests, and like using org-mode and interactive/literate programming techniques.
</p>

<p>
It is definitely an interesting way to use noweb to build up better code files in my opinion.
</p>
</div>
</div>

<div id="outline-container-org5a82a2f" class="outline-2">
<h2 id="org5a82a2f"><a id="ID-D4437A03-A9D0-4B6D-B254-5F03CFB25F95"></a><span class="section-number-2">4</span> The noweb doctest block</h2>
<div class="outline-text-2" id="text-4">
<p>
These blocks are used in the noweb expansions. Each block takes a variable which is the name of a block. This block grabs the body of the named src block and formats it as if it was in a REPL.
</p>

<p>
We also grab the results of the named block and format it for the doctest. We use a heuristic to detect Tracebacks and modify the output to be consistent with it. In that case we assume the relevant Traceback is on the last line.
</p>

<p>
Admittedly, this does some fragile feeling things, like trimming whitespace here and there to remove blank lines, and quoting quotes (which was not actually used in this example), and removing the ": " pieces of ob-ipython results. Probably other ways of running the src-blocks would not be that suitable for this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org52486c2">(org-babel-goto-named-src-block name)
(<span style="color: #0000FF;">let*</span> ((src (s-trim-right (org-element-property <span style="color: #006FE0;">:value</span> (org-element-context))))
       (src-lines (split-string src <span style="color: #008000;">"\n"</span>))
       body result)
  (<span style="color: #0000FF;">setq</span> body
        (s-trim-right
         (s-concat <span style="color: #008000;">"&gt;&gt;&gt; "</span> (car src-lines) <span style="color: #008000;">"\n"</span>
                   (s-join <span style="color: #008000;">"\n"</span> (mapcar (<span style="color: #0000FF;">lambda</span> (s)
                                          (concat <span style="color: #008000;">"... "</span> s))
                                        (cdr src-lines))))))
  <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">now the results</span>
  (org-babel-goto-named-result name)
  (<span style="color: #0000FF;">let</span> ((result (org-element-context)))
    (<span style="color: #0000FF;">setq</span> result
          (<span style="color: #0000FF;">thread-last</span>
              (buffer-substring (org-element-property <span style="color: #006FE0;">:contents-begin</span> result)
                                (org-element-property <span style="color: #006FE0;">:contents-end</span> result))
            (s-trim)
            <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">remove ": " from beginning of lines</span>
            (replace-regexp-in-string <span style="color: #008000;">"^: *"</span> <span style="color: #008000;">""</span>)
            <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">quote quotes</span>
            (replace-regexp-in-string <span style="color: #008000;">"\\\""</span> <span style="color: #008000;">"\\\\\""</span>)))
    (<span style="color: #0000FF;">when</span> (string-match <span style="color: #008000;">"Traceback"</span> result)
      (<span style="color: #0000FF;">setq</span> result (format
                    <span style="color: #008000;">"Traceback (most recent call last):\n%s"</span>
                    (car (last (split-string result <span style="color: #008000;">"\n"</span>))))))
    (concat body <span style="color: #008000;">"\n"</span> result)))
</pre>
</div>
</div>
</div>
<p>Copyright (C) 2018 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2018/05/17/Literate-programming-with-python-doctests.org">org-mode source</a></p>
<p>Org-mode version = 9.1.13</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2018/05/17/Literate-programming-with-python-doctests#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Making-it-easier-to-extend-the-export-of-org-mode-links-with-generic-functions"></div>
      <h2 class="blog_post_title"><a href="/blog/2018/05/09/Making-it-easier-to-extend-the-export-of-org-mode-links-with-generic-functions/" rel="bookmark" title="Permanent Link to Making it easier to extend the export of org-mode links with generic functions">Making it easier to extend the export of org-mode links with generic functions</a></h2>
      <p><small><span class="blog_post_date">Posted May 09, 2018 at 07:49 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2018/05/09/Making-it-easier-to-extend-the-export-of-org-mode-links-with-generic-functions#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I am a big fan of org-mode links. Lately, I have had a need to modify how some links are exported, e.g. defining new exports for different backends, or fine-tuning a particular backend. This can be difficult, depending on how the link was set up. Here is a typical setup I am used to using, where the different options for the backends are handled in a conditional statement in a single function. I will just use a link that just serves to illustrate the issues here. These links are just sytactic sugar for markup, they don't do anything else. We start with an example that just converts text to italic text for different backends like html or latex.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">italic-link-export</span> (path desc backend)
  (<span style="color: #0000FF;">cond</span>
   ((eq 'html backend)
    (format <span style="color: #008000;">"&lt;em&gt;%s&lt;/em&gt;"</span> path))
   ((eq 'latex backend)
    (format <span style="color: #008000;">"\\textit{%s}"</span> path))
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">fall-through case for everything else</span>
   (t
    path)))

(org-link-set-parameters <span style="color: #008000;">"italic"</span> <span style="color: #006FE0;">:export</span> 'italic-link-export)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">:export</td>
<td class="org-left">italic-link-export</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-export-string-as <span style="color: #008000;">"italic:text"</span> 'html t)
</pre>
</div>

<pre class="example">
&lt;p&gt;
&lt;em&gt;text&lt;/em&gt;&lt;/p&gt;

</pre>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-export-string-as <span style="color: #008000;">"italic:text"</span> 'latex t)
</pre>
</div>

<pre class="example">
\textit{text}

</pre>

<p>
This falls through though to the default case.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">ox-md</span>)
(org-export-string-as <span style="color: #008000;">"italic:text"</span> 'md t)
</pre>
</div>

<pre class="example">

# Table of Contents



text


</pre>

<p>
The point I want to make here is that this is not easy to extend as a user. You have to either modify the italic-link-export function, advise it, or monkey-patch it. None of these are especially nice.
</p>

<p>
I could define italic-link-export in a way that it retrieves the function to use from an alist or hash-table using the backend, but then you have to do two things to modify the behavior: define a backend specific function <i>and</i> register it in the lookup variable. It is also possible to just look up a function by a derived symbol, e.g. using fboundp, and then using funcall to execute it. This looks something like this:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">a user definable function for exporting to latex</span>
(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">italic-link-export-latex</span> (path desc backend)
  (format <span style="color: #008000;">"\\textit{%s}"</span> path))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">generic export function that looks up functions or defaults to</span>
(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">italic-link-exporter</span> (path desc backend)
  <span style="color: #036A07;">"Run `</span><span style="color: #D0372D;">italic-link-export-BACKEND</span><span style="color: #036A07;">' if it exists, or return path."</span>
  (<span style="color: #0000FF;">let</span> ((func (intern-soft (format <span style="color: #008000;">"italic-link-export-%s"</span> backend))))
    (<span style="color: #0000FF;">if</span> (fboundp func)
        (funcall func path desc backend)
      path)))
</pre>
</div>

<p>
This has some indirection, but allows you to just define new functions to add new export backends, or replace single backend exports. It isn't bad, but there is room for improvement.
</p>

<p>
In this <a href="https://github.com/jkitchin/org-ref/issues/492#issuecomment-387806180">comment</a> in org-ref, I saw a new opportunity to address this issue using generic functions in elisp! The idea is to define a generic function that handles the general export case, and then define additional functions for each specific backend based on the signature of the export function. I will switch to bold markup for this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">cl-defgeneric</span> <span style="color: #006699;">bold-link-export</span> (path desc backend)
 <span style="color: #036A07;">"Generic function to export a bold link."</span>
 path)

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this one runs when the backend is equal to html</span>
(<span style="color: #0000FF;">cl-defmethod</span> <span style="color: #006699;">bold-link-export</span> ((path t) (desc t) (backend (eql html)))
 (format <span style="color: #008000;">"&lt;b&gt;%s&lt;/b&gt;"</span> path))

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this one runs when the backend is equal to latex</span>
(<span style="color: #0000FF;">cl-defmethod</span> <span style="color: #006699;">bold-link-export</span> ((path t) (desc t) (backend (eql latex)))
 (format <span style="color: #008000;">"\\textit{%s}"</span> path))

(org-link-set-parameters <span style="color: #008000;">"bold"</span> <span style="color: #006FE0;">:export</span> 'bold-link-export)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">:export</td>
<td class="org-left">bold-link-export</td>
</tr>
</tbody>
</table>

<p>
Here it is in action:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-export-string-as <span style="color: #008000;">"some bold:text"</span> 'html t)
</pre>
</div>

<pre class="example">
&lt;p&gt;
some &lt;b&gt;text&lt;/b&gt;&lt;/p&gt;

</pre>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-export-string-as <span style="color: #008000;">"some bold:text"</span> 'latex t)
</pre>
</div>

<p>
This uses the generic function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">ox-md</span>)
(org-export-string-as <span style="color: #008000;">"some bold:text"</span> 'md t)
</pre>
</div>

<pre class="example">

# Table of Contents



some text


</pre>

<p>
The syntax for defining the generic function is pretty similar to a regular function. The specific methods are a little different since they have to provide the specific "signature" that triggers each method. Here we only differentiate on the type of the backend. It is nice these are all separate functions though. It makes it trivial to add new ones, and less intrusive to replace in my opinion.
</p>

<p>
Generic functions have many other potential applications to replace functions that use lots of conditions to control flow, with a fall-through option at the end. You can learn more about them here: <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Generic-Functions.html">https://www.gnu.org/software/emacs/manual/html_node/elisp/Generic-Functions.html</a>. There is a lot more to them than I have illustrated here.
</p>
<p>Copyright (C) 2018 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2018/05/09/Making-it-easier-to-extend-the-export-of-org-mode-links-with-generic-functions.org">org-mode source</a></p>
<p>Org-mode version = 9.1.13</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2018/05/09/Making-it-easier-to-extend-the-export-of-org-mode-links-with-generic-functions#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Adding-keymaps-to-src-blocks-via-org-font-lock-hook"></div>
      <h2 class="blog_post_title"><a href="/blog/2017/06/10/Adding-keymaps-to-src-blocks-via-org-font-lock-hook/" rel="bookmark" title="Permanent Link to Adding keymaps to src blocks via org-font-lock-hook">Adding keymaps to src blocks via org-font-lock-hook</a></h2>
      <p><small><span class="blog_post_date">Posted June 10, 2017 at 03:27 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2017/06/10/Adding-keymaps-to-src-blocks-via-org-font-lock-hook#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated June 12, 2017 at 11:28 AM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org49daca5">1. Update</a></li>
<li><a href="#org004cb53">2. Update #2</a></li>
</ul>
</div>
</div>
<p>
I had an idea to use custom keymaps in src-blocks. For example, you could then use lispy directly in your org-files without entering org-special-edit, or the elpy key-bindings in python blocks. There are other solutions I have seen, e.g. polymode, that claim to do this. You might guess that if they worked, I would not be writing this! There was some nice discussion about this idea on the org-mode mailing list, and Nicolas Goaziou pointed out this might be accomplished with the org-font-lock-hook.
</p>

<p>
You can check out the video here:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/a2jHqB1qWiY" frameborder="0" allowfullscreen></iframe>

<p>
It was relatively easy to figure out how to do this. Keymaps can be added to regions during font-lock, so I just had to hook into the org-mode font lock system with a function to find the src blocks and add the keymap as a text-property. That took three steps:
</p>

<ol class="org-ol">
<li>Define the keymaps to use. I use an a-list of (language . map) for this.</li>
<li>Define the font-lock function. This will add the keymap properties to src-blocks.</li>
<li>Define a minor mode to toggle this feature on and off.</li>
</ol>

<p>
Here is the definition of the keymaps. Generally I just copy the mode-map I want and then add some things to them. For example sometimes it is still a good idea to jump into the org-special-edit mode. For example, if you try to use a command in a Python block to send the buffer to the repl while in org-mode you are sure to get an error! You might also want to add the C-c C-e export command if you use that a lot. An alternative approach, of course, is to copy the org-map and add additional bindings to it. The choice is up to you.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">lispy</span>)
(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">elpy</span>)

(<span style="color: #0000FF;">setq</span> scimax-src-block-keymaps
      `((<span style="color: #008000;">"ipython"</span> . ,(<span style="color: #0000FF;">let</span> ((map (make-composed-keymap
                                  `(,elpy-mode-map ,python-mode-map ,pyvenv-mode-map)
                                  org-mode-map)))
                        <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">In org-mode I define RET so we f</span>
                        (define-key map (kbd <span style="color: #008000;">"&lt;return&gt;"</span>) 'newline)
                        (define-key map (kbd <span style="color: #008000;">"C-c C-c"</span>) 'org-ctrl-c-ctrl-c)
                        map))
        (<span style="color: #008000;">"python"</span> . ,(<span style="color: #0000FF;">let</span> ((map (make-composed-keymap
                                 `(,elpy-mode-map ,python-mode-map ,pyvenv-mode-map)
                                 org-mode-map)))
                       <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">In org-mode I define RET so we f</span>
                       (define-key map (kbd <span style="color: #008000;">"&lt;return&gt;"</span>) 'newline)
                       (define-key map (kbd <span style="color: #008000;">"C-c C-c"</span>) 'org-ctrl-c-ctrl-c)
                       map))
        (<span style="color: #008000;">"emacs-lisp"</span> . ,(<span style="color: #0000FF;">let</span> ((map (make-composed-keymap `(,lispy-mode-map
                                                            ,emacs-lisp-mode-map
                                                            ,outline-minor-mode-map)
                                                          org-mode-map)))
                           (define-key map (kbd <span style="color: #008000;">"C-c C-c"</span>) 'org-ctrl-c-ctrl-c)
                           map))))
</pre>
</div>

<p>
Next we define the function that will apply the keymap to each src block. The keymaps are only applied when they are defined in the variable above. This function is derived from org-fontify-meta-lines-and-blocks-1.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">scimax-add-keymap-to-src-blocks</span> (limit)
  <span style="color: #036A07;">"Add keymaps to src-blocks defined in `</span><span style="color: #D0372D;">scimax-src-block-keymaps</span><span style="color: #036A07;">'."</span>
  (<span style="color: #0000FF;">let</span> ((case-fold-search t)
        lang)
    (<span style="color: #0000FF;">while</span> (re-search-forward org-babel-src-block-regexp limit t)
      (<span style="color: #0000FF;">let</span> ((lang (match-string 2))
            (beg (match-beginning 0))
            (end (match-end 0)))
        (<span style="color: #0000FF;">if</span> (assoc (org-no-properties lang) scimax-src-block-keymaps)
            (<span style="color: #0000FF;">progn</span>
              (add-text-properties
               beg end `(local-map ,(cdr (assoc
                                          (org-no-properties lang)
                                          scimax-src-block-keymaps))))
              (add-text-properties
               beg end `(cursor-sensor-functions
                         ((<span style="color: #0000FF;">lambda</span> (win prev-pos sym)
                            <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">This simulates a mouse click and makes a menu change</span>
                            (org-mouse-down-mouse nil)))))))))))
</pre>
</div>

<p>
Here we create an advice to trick any functions that need to know the major mode. We only apply the spoof if we are in org-mode and in a src block though. Otherwise we call the original function. So far lispy&#x2013;eval is the only function I have needed it for. This might be a general strategy though to do other things like narrow to the src-block, or even go into special edit mode temporarily if there are commands that require it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">scimax-spoof-mode</span> (orig-func <span style="color: #6434A3;">&amp;rest</span> args)
  <span style="color: #036A07;">"Advice function to spoof commands in org-mode src blocks.</span>
<span style="color: #036A07;">It is for commands that depend on the major mode. One example is</span>
<span style="color: #036A07;">`</span><span style="color: #D0372D;">lispy--eval</span><span style="color: #036A07;">'."</span>
  (<span style="color: #0000FF;">if</span> (org-in-src-block-p)
      (<span style="color: #0000FF;">let</span> ((major-mode (intern (format <span style="color: #008000;">"%s-mode"</span> (first (org-babel-get-src-block-info))))))
        (apply orig-func args))
    (apply orig-func args)))
</pre>
</div>

<p>
We define a minor mode so we can toggle this on and off. Here we add the function to the org-font-lock-hook and advise the lispy&#x2013;eval function. I had to add the font-lock-function to the end of the org-font-lock hook for some reason, and also add local-map as an extra-managed property so it would be removed when we toggle it off.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">define-minor-mode</span> <span style="color: #006699;">scimax-src-keymap-mode</span>
  <span style="color: #036A07;">"Minor mode to add mode keymaps to src-blocks."</span>
  <span style="color: #006FE0;">:init-value</span> nil
  (<span style="color: #0000FF;">if</span> scimax-src-keymap-mode
      (<span style="color: #0000FF;">progn</span>
        (add-hook 'org-font-lock-hook #'scimax-add-keymap-to-src-blocks t)
        (add-to-list 'font-lock-extra-managed-props 'local-map)
        (add-to-list 'font-lock-extra-managed-props 'cursor-sensor-functions)
        (advice-add 'lispy--eval <span style="color: #006FE0;">:around</span> 'scimax-spoof-mode)
        (cursor-sensor-mode +1))
    (remove-hook 'org-font-lock-hook #'scimax-add-keymap-to-src-blocks)
    (advice-remove 'lispy--eval 'scimax-spoof-mode)
    (cursor-sensor-mode -1))
  (font-lock-fontify-buffer))

(add-hook 'org-mode-hook (<span style="color: #0000FF;">lambda</span> ()
                           (scimax-src-keymap-mode +1)))
</pre>
</div>

<p>
That is it! I am pretty sure this is a good idea. It helps a lot when you are writing a lot of short code blocks and near equal amounts of text (like in this blog post). It also helps write the code since many things like indentation, parentheses, etc. are automatically handled. That is what I used to go into special-edit mode all the time for!
</p>

<p>
I have not used this long enough to know if it causes any other surprises. If you try it and find any, leave a comment!
</p>

<div id="outline-container-org49daca5" class="outline-2">
<h2 id="org49daca5"><span class="section-number-2">1</span> Update</h2>
<div class="outline-text-2" id="text-1">
<p>
It turns out you can have the best of all the worlds by combining keymaps. The make-composed-keymap creates a new keymap that combines a keymaps and falls through to a parent keymap. So here we use that to combine several keymaps, falling through to org-mode. The only subtlety I have come across is that I remapped &lt;return&gt; in orgmode to scimax/org-return, and not all modes define it, so I redefine it in some places to just be newline. Also to keep C-c C-c for executing the block, I add that back too.
</p>

<p>
I use a few maps here, and some of them seem to just add menus that are only active when your cursor is in the block. Pretty handy!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">setq</span> scimax-src-block-keymaps
      `((<span style="color: #008000;">"ipython"</span> . ,(<span style="color: #0000FF;">let</span> ((map (make-composed-keymap
                                  `(,elpy-mode-map ,python-mode-map ,pyvenv-mode-map)
                                  org-mode-map)))
                        <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">In org-mode I define RET so we f</span>
                        (define-key map (kbd <span style="color: #008000;">"&lt;return&gt;"</span>) 'newline)
                        (define-key map (kbd <span style="color: #008000;">"C-c C-c"</span>) 'org-ctrl-c-ctrl-c)
                        map))
        (<span style="color: #008000;">"python"</span> . ,(<span style="color: #0000FF;">let</span> ((map (make-composed-keymap
                                 `(,elpy-mode-map ,python-mode-map ,pyvenv-mode-map)
                                 org-mode-map)))
                       <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">In org-mode I define RET so we f</span>
                       (define-key map (kbd <span style="color: #008000;">"&lt;return&gt;"</span>) 'newline)
                       (define-key map (kbd <span style="color: #008000;">"C-c C-c"</span>) 'org-ctrl-c-ctrl-c)
                       map))
        (<span style="color: #008000;">"emacs-lisp"</span> . ,(<span style="color: #0000FF;">let</span> ((map (make-composed-keymap `(,lispy-mode-map
                                                            ,emacs-lisp-mode-map
                                                            ,outline-minor-mode-map)
                                                          org-mode-map)))
                           (define-key map (kbd <span style="color: #008000;">"C-c C-c"</span>) 'org-ctrl-c-ctrl-c)
                           map))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org004cb53" class="outline-2">
<h2 id="org004cb53"><span class="section-number-2">2</span> Update #2</h2>
<div class="outline-text-2" id="text-2">
<p>
The previous version had some issues where it would only add a keymap to the first block. The code in this post now addresses that and uses cursor-sensor-functions to make sure we change key map on entering and leaving blocks. That might mean you need an emacs of at least version 25 to use this. I guess it will work with an earlier version, but the cursor-sensor-functions might get ignored. You might have to comment out the cursor-sensor-mode line
</p>

<p>
Thanks to those brave people alpha-testing this and helping refine the idea!
</p>
</div>
</div>
<p>Copyright (C) 2017 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2017/06/10/Adding-keymaps-to-src-blocks-via-org-font-lock-hook.org">org-mode source</a></p>
<p>Org-mode version = 9.0.7</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2017/06/10/Adding-keymaps-to-src-blocks-via-org-font-lock-hook#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/category/orgmode/2">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2019/10/02/Using-autograd-to-plot-implicit-functions/">Using autograd to plot implicit functions</a></li>
      <li><a href="/blog/2019/09/22/Solving-differential-algebraic-equations-with-help-from-autograd/">Solving differential algebraic equations with help from autograd</a></li>
      <li><a href="/blog/2019/09/13/Sensitivity-analysis-with-odeint-and-autograd/">Sensitivity analysis with odeint and autograd</a></li>
      <li><a href="/blog/2019/07/08/New-publication-in-SoftwareX/">New publication in SoftwareX</a></li>
      <li><a href="/blog/2019/03/12/An-improvement-for-figures-in-ipython-+-scimax/">An improvement for figures in ipython + scimax</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2019
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



