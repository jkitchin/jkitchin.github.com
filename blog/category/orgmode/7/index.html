

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: orgmode</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Introduction-to-a-citation-processor-in-org-ref"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/12/11/Introduction-to-a-citation-processor-in-org-ref/" rel="bookmark" title="Permanent Link to Introduction to a citation processor in org-ref">Introduction to a citation processor in org-ref</a></h2>
      <p><small><span class="blog_post_date">Posted December 11, 2015 at 06:05 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/citations/'>citations</a>, <a href='/blog/category/orgref/'>orgref</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/12/11/Introduction-to-a-citation-processor-in-org-ref#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated December 12, 2015 at 10:08 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Reference types</a></li>
<li><a href="#sec-2">2. Citation types</a></li>
<li><a href="#sec-3">3. Multiple citations and sorting within citation</a></li>
<li><a href="#sec-4">4. Space chomping and punctuation testing</a></li>
<li><a href="#sec-5">5. Building</a></li>
<li><a href="#sec-6">6. Summary thoughts</a></li>
<li><a href="#sec-7">7. Bibliography</a></li>
</ul>
</div>
</div>

<p>
As a potential solution for citations in org-mode for non-LaTeX export, here we introduce csl (citation syntax lisp). The idea is heavily influenced by the xml-based Citation Syntax Language, but uses lisp sexps instead.
</p>

<p>
Briefly, there is a csl file that contains two variables: citation-style and bibliography-style. The citation-style defines how the in-text citations are represented for different types of citations. The bibliography-style defines how the bibliography is constructed.
</p>

<p>
What do we gain by this?
</p>
<ol class="org-ol">
<li>No need for external citeproc program, and hackability by org-mode experts.
</li>
<li>Punctuation transposition and space chomping, i.e. put superscripts on the right side of punctuation if you want it, and remove whitespace before superscripts if you want it.
</li>
<li>Total tunability of the citation format to different backends.
</li>
<li>Easy to change bibliography format with the bibliographystyle link.
</li>
<li>The use of Bibtex databases. These are plain text, and flexible.
</li>
</ol>

<p>
The real code for this is too long to blog about. Instead, you should check it out here: <a href="https://github.com/jkitchin/org-ref/tree/master/citeproc">https://github.com/jkitchin/org-ref/tree/master/citeproc</a>
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Reference types</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>A book.<sup>1</sup>
</li>

<li>An article<sup>2</sup>
</li>

<li>A miscellaneous bibtex type.<sup>3</sup>
</li>
</ul>

<p>
There is work to do in supporting other types of entry types that are common in bibtex files.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Citation types</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>Regular citation:<sup>2</sup>
</li>
<li>citenum: See Ref.  2
</li>
<li>citeauthor:  Kitchin
</li>
<li>citeyear:   2015
</li>
</ul>

<p>
There is work to do in supporting other types of citations.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Multiple citations and sorting within citation</h2>
<div class="outline-text-2" id="text-3">
<p>
You can specify that the cites within a citation are consistently sorted in the export.
</p>

<ul class="org-ul">
<li>a,b:<sup>2,4</sup>
</li>
<li>b,a:<sup>2,4</sup>
</li>
</ul>

<p>
There is work to do for range collapsing, e.g. to turn 1,2,3 into 1-3.
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Space chomping and punctuation testing</h2>
<div class="outline-text-2" id="text-4">
<p>
I think citations should always be put in the sentence they logically belong to. LaTeX has a feature through natbib I think where for some styles, e.g. superscripts, the citations are moved to the right side of punctuation, and whitespace is chomped so the superscript is next to words, not separated by spaces. We can do that here too.
</p>

<ul class="org-ul">
<li>Citation at end of sentence.<sup>2</sup>
</li>
<li>Citation in clause,<sup>2,4</sup> with a comma.
</li>
<li>Citation in middle of<sup>2,4</sup> a sentence.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Building</h2>
<div class="outline-text-2" id="text-5">

<p>
At the moment, you have to add a hook function to put the replacements in the document before parsing.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'load-path <span style="color: #008000;">"."</span>)
(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">org-ref-citeproc</span>)

(<span style="color: #0000FF;">when</span> (file-exists-p <span style="color: #008000;">"readme.html"</span>) (delete-file <span style="color: #008000;">"readme.html"</span>))
(<span style="color: #0000FF;">let</span> ((org-export-before-parsing-hook '(orcp-citeproc)))
  (browse-url (org-html-export-to-html)))
</pre>
</div>

<pre class="example">
#&lt;process open ./readme.html&gt;
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'org-export-before-parsing-hook 'orcp-citeproc)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">orcp-citeproc</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Summary thoughts</h2>
<div class="outline-text-2" id="text-6">
<p>
This looks promising. There is probably a lot of work to do to make this as robust as say citeproc-js or the Zotero handler. I am not sure if we could write this in a way to directly use the CSL. My feeling is it would not be as flexible as this, and we would have to add to it anyway.
</p>

<p>
Here are some remaining things that could be worked on if we continue this direction.
</p>

<ol class="org-ol">
<li>Other bibtex entries need to be tested out.
</li>
<li>Remaining bibtex fields need to be defined.
</li>
<li>Standardization of styling that can be done. Not all features described in my csl are supported, e.g. et. al. and probably others.
</li>
<li>The author-year style needs name disambiguation somehow.
</li>
<li>Hyperlinking in html.
</li>
<li>Make sure export to other backends works.
</li>
<li>Can this work for notes-based styles?
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Bibliography</h2>
<div class="outline-text-2" id="text-7">
<p>
You use a bibliographystyle link to specify a csl. These are similar to bibtex styles, and in some cases no change is needed for LaTeX export (although you may have to remove the citeproc hook function).
</p>


<ol class="org-ol">
<li>Kittel, Charles, <i>Introduction to Solid State Physics</i>, (2005). <br>
</li>
<li>Kitchin,  John R., <i>Examples of Effective Data Sharing in Scientific Publishing</i>, ACS Catalysis, 5<b>(6)</b>, pp. 3894-3899 (2015). <a href="https://doi.org/10.1021/acscatal.5b00538">https://doi.org/10.1021/acscatal.5b00538</a>. <br>
</li>
<li>Xu, Zhongnan; Rossmeisl, Jan and Kitchin, John R., <i>Supporting data for: A linear response, {DFT+U} study of trends in the oxygen evolution activity of transition metal rutile dioxides. doi:10.5281/zenodo.12635</i>,  <a href="https://doi.org/https://zenodo.org/record/12635">https://doi.org/https://zenodo.org/record/12635</a>. <a href="https://doi.org/10.5281/zenodo.12635">https://doi.org/10.5281/zenodo.12635</a>. <br>
</li>
<li>Kitchin, John R., <i>Data Sharing in Surface Science</i>, Surface Science , N/A, pp. in press (2015). <a href="https://doi.org/10.1016/j.susc.2015.05.007">https://doi.org/10.1016/j.susc.2015.05.007</a>.
</li>
</ol>
</div>
</div>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/12/11/Introduction-to-a-citation-processor-in-org-ref.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>


    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/12/11/Introduction-to-a-citation-processor-in-org-ref#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Post-processing-an-org-buffer-on-export"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/12/01/Post-processing-an-org-buffer-on-export/" rel="bookmark" title="Permanent Link to Post-processing an org-buffer on export">Post-processing an org-buffer on export</a></h2>
      <p><small><span class="blog_post_date">Posted December 01, 2015 at 01:58 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/12/01/Post-processing-an-org-buffer-on-export#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated December 01, 2015 at 09:01 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
In a previous <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/11/22/Adding-emacs-command-key-bindings-and-help-functionality-to-org-mode/">post</a> we examined getting tooltips on emacs keybindings and command syntax in an org-buffer. Someone asked in a comment if we could get that to export to html, or LaTeX. The short answer is not directly, org-mode doesn't recognize our functionalized syntax as an element, and there is no direct way to modify their appearance on export.
</p>

<p>
There is, however, a hook function that runs before parsing, and we can use that to transform these patterns to what we want. Here, I illustrate how to make the key-bindings and commands bold with a tooltip on them for an html export. Basically, we do an export, and then post-process the html output to put what we want in. I found this easier than pre-processing because the documentation for the command tooltip was too big to fit into an html snippet, and an html block causes carriage returns in the html. I didn't find a more elegant solution to that problem.
</p>

<p>
Here we replace the key-binding syntax with the actual keybinding in bold, and a tooltip of the command, and the command syntax we replace with bold command and a tooltip for the documentation. It works pretty well. The documentation for helm is pretty extensive, and gets cutoff in the tooltip. Otherwise, this seems pretty satisfactory.
</p>

<p>
This won't show in the blog post, so you will have to checkout the exported html here: <a href="/media/2015-12-01-Post-processing-an-org-buffer-on-export/blog.html">blog.html</a> .
</p>

<p>
Try \<b title="The command is helm-find-files.">C-x C-f</b> to open a file. You might enjoy using <b title="Main function to execute helm sources.

Keywords supported:
:sources :input :prompt :resume :preselect
:buffer :keymap :default :history :allow-nest

Extra LOCAL-VARS keywords are supported, see below.

PLIST is a list like (:key1 val1 :key2 val2 ...) or
(&optional sources input prompt resume
            preselect buffer keymap default history).

Basic keywords are the following:

:sources

A list of sources used for this session.  It also accepts a
symbol, interpreted as a variable of a helm source
i.e (a symbol can be passed instead of a list of sources).
It also accepts an alist representing a helm source, which is
detected by (assq 'name ANY-SOURCES).
NOTE: In this case the source is embedded in the helm command and
have no symbol name, so it is not reachable from outside.
It will be referenced in `helm-sources' as a whole alist.

:input

Temporary value of `helm-pattern', ie. initial input of minibuffer.

:prompt

Prompt other than "pattern: ".

:resume

If t, Resurrect previously instance of `helm'.  Skip the initialization.
If 'noresume, this instance of `helm' cannot be resumed.

:preselect

Initially selected candidate.  Specified by exact candidate or a regexp.

:buffer

`helm-buffer' instead of *helm*.

:keymap

`helm-map' for current `helm' session.

:default

A default argument that will be inserted in minibuffer with M-n.
When nil or not present `thing-at-point' will be used instead.
If `helm--maybe-use-default-as-input' is non--nil display will be
updated using :default arg as input unless :input is specified,
which in this case will take precedence on :default
This is a string or a list, in this case the car of the list will
be used as initial default input, but you will be able to cycle in this
list with M-n.

:history

By default all minibuffer input is pushed to `minibuffer-history',
if an argument HISTORY is provided, input will be pushed to HISTORY.
History element should be a symbol.

:allow-nest

Allow running this helm command within a running helm session.

Of course, conventional arguments are supported, the two are same.

(helm :sources sources :input input :prompt prompt :resume resume
       :preselect preselect :buffer buffer :keymap keymap :default default
       :history history)

and

(helm sources input prompt resume preselect buffer keymap default history)

are the same.

However the use of non keyword args is deprecated and should not be used.

Other keywords are interpreted as local variables of this helm session.
The `helm-' prefix can be omitted.  For example,

(helm :sources 'helm-source-buffers-list
       :buffer "*buffers*" :candidate-number-limit 10)

means starting helm session with `helm-source-buffers'
source in *buffers* buffer and set variable `helm-candidate-number-limit'
to 10 as session local variable.

(fn &key SOURCES INPUT PROMPT RESUME PRESELECT BUFFER KEYMAP DEFAULT HISTORY ALLOW-NEST OTHER-LOCAL-VARS)">helm</b> too. Or this variable <b title="Get the list of agenda files.
Optional UNRESTRICTED means return the full list even if a restriction
is currently in place.
When ARCHIVES is t, include all archive files that are really being
used by the agenda files.  If ARCHIVE is `ifmode', do this only if
`org-agenda-archives-mode' is t.">org-agenda-files</b>.
</p>


<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">rx</span>)

(<span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">elisp-symbol-keybinding-re</span>
  (<span style="color: #0000FF;">rx</span>
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">opening \\[</span>
   (eval <span style="color: #008000;">"\\["</span>)
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">one or more characters that are not ]</span>
   (group (one-or-more (not (any <span style="color: #008000;">"]"</span>))))
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">The closing ]</span>
   <span style="color: #008000;">"]"</span>)
<span style="color: #036A07;">"Regexp for an elisp command keybinding syntax. \\[</span><span style="color: #D0372D;">some-command</span><span style="color: #036A07;">]</span>
<span style="color: #036A07;">Regexp group 1 matches src_emacs-lisp[:results html]{(command-html "</span>some-command<span style="color: #008000;">")}."</span>)

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-process-key-bindings</span> (backend)
  (goto-char (point-min))
  (<span style="color: #0000FF;">while</span> (re-search-forward elisp-symbol-keybinding-re nil t)
    (replace-match
     (<span style="color: #0000FF;">cond</span>
      ((eq backend 'html)
       (format <span style="color: #008000;">"&lt;b title=\"The command is %s.\"&gt;%s&lt;/b&gt;"</span>
               (match-string 1)
               (substitute-command-keys (match-string 0))))))))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-process-emacs-commands</span> (backend)
  (goto-char (point-min))
  (<span style="color: #0000FF;">while</span> (re-search-forward <span style="color: #008000;">"`</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">']+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">'"</span> nil t)
    (replace-match
     (<span style="color: #0000FF;">cond</span>
      ((eq backend 'html)
       (format <span style="color: #008000;">"&lt;b title=\"%s\"&gt;%s&lt;/b&gt;"</span>
          (<span style="color: #0000FF;">if</span> (<span style="color: #0000FF;">or</span> (fboundp (intern (match-string 1)))
                  (boundp (intern (match-string 1))))
              (documentation (intern (match-string 1)))
            <span style="color: #008000;">"No command found."</span>)
          (match-string 1)))))))

(<span style="color: #0000FF;">with-current-buffer</span> (org-html-export-as-html)
  (org-process-key-bindings 'html)
  (org-process-emacs-commands 'html)
  (write-file <span style="color: #008000;">"blog.html"</span>)
  (browse-url <span style="color: #008000;">"blog.html"</span>))
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">org-process-emacs-commands</td>
</tr>
</tbody>
</table>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Update: A filter approach to exporting</h2>
<div class="outline-text-2" id="text-1">
<p>
Our patterns are all in org-paragraphs. We can use a filter to modify the paragraph after it is "transcoded". Here is the filter function. It basically does the same thing, through another mechanism.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">my-paragraph-filter</span> (data backend info)
  (<span style="color: #0000FF;">cond</span>
   ((eq 'html backend)
    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">emacs commands</span>
    (<span style="color: #0000FF;">setq</span> data (replace-regexp-in-string
                <span style="color: #008000;">"`</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">']+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">'"</span>
                (<span style="color: #0000FF;">lambda</span> (x)
                  (string-match <span style="color: #008000;">"`</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">']+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">'"</span> x)
                  (<span style="color: #0000FF;">when</span> (match-string 1 x)
                    (format <span style="color: #008000;">"&lt;b title=\"%s\"&gt;%s&lt;/b&gt;"</span>
                            (<span style="color: #0000FF;">if</span> (<span style="color: #0000FF;">or</span> (fboundp (intern (match-string 1 x)))
                                    (boundp (intern (match-string 1 x))))
                                (documentation (intern (match-string 1 x)))
                              <span style="color: #008000;">"No command found."</span>)
                            (match-string 1 x))))
                data))
    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">keybindings</span>
    (<span style="color: #0000FF;">setq</span> data (replace-regexp-in-string
                <span style="color: #008000;">"\\\\\\[</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">]]+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">]"</span>
                (<span style="color: #0000FF;">lambda</span> (x)
                  (string-match <span style="color: #008000;">"\\\\\\[</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">]]+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">]"</span> x)
                  (<span style="color: #0000FF;">when</span> (fboundp  (intern (match-string-no-properties 1 x)))
                    (format <span style="color: #008000;">"&lt;b title=\"The command is %s.\"&gt;%s&lt;/b&gt;"</span>
                            (match-string 1 x)
                            (substitute-command-keys (match-string 0 x)))))
                data)))))

(add-to-list 'org-export-filter-paragraph-functions 'my-paragraph-filter)
(browse-url (org-html-export-to-html))
</pre>
</div>

<pre class="example">
#&lt;process open ./blog.html&gt;
</pre>

<p>
Try the command <b title="Opens a helm interface to actions for org-ref.
Shows bad citations, ref links and labels">org-ref</b> to check your document for issues.  Insert a citation with org-ref using \<b title="The command is org-ref-insert-cite-link.">M-ESC C</b>.
</p>

<p>
Now, this should show up in the blog!</p>
</div>
</div>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/12/01/Post-processing-an-org-buffer-on-export.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/12/01/Post-processing-an-org-buffer-on-export#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Contextual-help-in-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/11/24/Contextual-help-in-org-mode/" rel="bookmark" title="Permanent Link to Contextual help in org-mode">Contextual help in org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted November 24, 2015 at 10:08 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/11/24/Contextual-help-in-org-mode#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
org-mode is great, plain text and all, but it can be difficult to figure out all the things you can do at any particular place in the buffer. Here, we explore some ideas on making org-mode a bit more discoverable. One way to do this that we explore here is to create a help function that you run, and it tells you about the element that `org-element-context' knows about, then gives you some hints of what you can do there. To do this, we create a series of functions for each kind of element we provide help on.
</p>

<p>
You may want to see the video: <a href="https://www.youtube.com/watch?v=99uxJWqZGzA">https://www.youtube.com/watch?v=99uxJWqZGzA</a> 
</p>

<p>
The kind of help we want is a description of the element, some commands we can run on the element and what they do, and if there are some key-bindings. We also want to make sure if the user has changed the key-bindings, the right values get shown. Finally, it would be nice to allow users to add their own documentation if they want.
</p>

<p>
So, here is the lengthy block of code we use for this purpose. We create a function for each element type that we provide documentation for. We also provide a mechanism for users to add their own notes for future reference. I leverage the help-buffer here to simplify some functional text, e.g. the key commands and clickable functions, as well as history navigation. I could also do most of that in org-mode buffers, with different functionality, but I save that for another day.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">ore-user-directory</span> <span style="color: #008000;">"~/.emacs.d/ore/"</span>
  <span style="color: #036A07;">"Directory to store user additions to the notes."</span>)


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-user-documentation</span> (type)
  <span style="color: #036A07;">"Return user documentation for org element TYPE if it exists.</span>
<span style="color: #036A07;">Notes are returned as plain text, and will be rendered in `</span><span style="color: #D0372D;">help-mode</span><span style="color: #036A07;">'."</span>
  (<span style="color: #0000FF;">let</span> ((fname (expand-file-name (format <span style="color: #008000;">"%s.org"</span> type) ore-user-directory)))
    (concat
     <span style="color: #008000;">"User documentation:\n"</span>
     (<span style="color: #0000FF;">if</span> (file-exists-p fname)
         (<span style="color: #0000FF;">with-temp-buffer</span>
           (insert <span style="color: #008000;">"\n"</span>)
           (insert-file-contents fname)
           (indent-rigidly (point-min) (point-max) 5)
           (buffer-string))
       <span style="color: #008000;">"None defined."</span>)
     (format  <span style="color: #008000;">"\n\nEdit [[file:%s]]"</span> fname))))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-latex</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for latex fragment."</span>
  (concat
   (substitute-command-keys <span style="color: #008000;">"You are on a LaTeX fragment or environment.</span>

<span style="color: #008000;">\\[</span><span style="color: #D0372D;">org-toggle-latex-overlays</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-toggle-latex-overlays</span><span style="color: #008000;">' to toggle LaTeX images on it.</span>

<span style="color: #008000;">"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'latex)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-link</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for org links."</span>
  (<span style="color: #0000FF;">let*</span> ((link (org-element-context))
         (type (org-element-property <span style="color: #006FE0;">:type</span> link))
         (protocols (assoc type org-link-protocols))
         (follow-func (cadr protocols))
         (export-func (caddr protocols)))
    (concat
     (format
      (substitute-command-keys <span style="color: #008000;">"You are on a %s link.</span>

<span style="color: #008000;">Link path: %s</span>
<span style="color: #008000;">%s</span>

<span style="color: #008000;">Clicking on the link will run `</span><span style="color: #D0372D;">%s</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">This link uses this function for export: `</span><span style="color: #D0372D;">%s</span><span style="color: #008000;">'</span>

<span style="color: #008000;">If you are on an image link, you can toggle it with \\[</span><span style="color: #D0372D;">org-toggle-inline-images</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-toggle-inline-images</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">You can toggle the link display with `</span><span style="color: #D0372D;">org-toggle-link-display</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">See Info node `(org) Hyperlinks'.</span>

<span style="color: #008000;">%s</span>

<span style="color: #008000;">%s\n\n"</span>)
      type
      (org-element-property <span style="color: #006FE0;">:path</span> link)
      (format <span style="color: #008000;">"Whole link: %s"</span> (buffer-substring
                                (org-element-property <span style="color: #006FE0;">:begin</span> link)
                                (org-element-property <span style="color: #006FE0;">:end</span> link)))
      (pp-to-string follow-func)
      (pp-to-string export-func)
      (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
      (ore-user-documentation 'link)))))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-src-block-header-p</span> (element)
  <span style="color: #036A07;">"Return whether point is in a src-block header."</span>
  (<span style="color: #0000FF;">and</span> (eq 'src-block (car element))
       (<span style="color: #0000FF;">save-excursion</span>
         (<span style="color: #0000FF;">let</span> ((cp (point))
               (lp (line-number-at-pos)))
           (goto-char (org-element-property <span style="color: #006FE0;">:begin</span> element))
           (= lp (line-number-at-pos))))))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-src-block-header</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for src-block header."</span>
  (concat
   <span style="color: #008000;">"You are in a src-block header.</span>

<span style="color: #008000;">This line tells org-mode that</span>
<span style="color: #008000;">it is a src-block, and language of the src-block. There are</span>
<span style="color: #008000;">also optional header arguments. See Info node `(org) Header arguments'</span>

<span style="color: #008000;">"</span>
   (format <span style="color: #008000;">"The default headers are described here: `</span><span style="color: #D0372D;">org-babel-default-header-args:%s</span><span style="color: #008000;">'</span>

<span style="color: #008000;">"</span> (org-element-property <span style="color: #006FE0;">:language</span> element))
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'src-block-header)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-src-block</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for a src-block."</span>
  (concat
   (substitute-command-keys <span style="color: #008000;">"You are in a src-block.</span>

<span style="color: #008000;">C-c C-c to execute this block.</span>
<span style="color: #008000;">\\[</span><span style="color: #D0372D;">org-babel-tangle</span><span style="color: #008000;">]  org-babel-tangle</span>

<span style="color: #008000;">You can edit the block with \\[</span><span style="color: #D0372D;">org-edit-special</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-edit-special</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">See Info node `(org) Working with source code' for more details.\n\n"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'src-block)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-headline</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for a headline."</span>
  (concat
   (<span style="color: #0000FF;">when</span> (bolp)
     (format  <span style="color: #008000;">"You are at the beginning of a headline.</span>

<span style="color: #008000;">\\[</span><span style="color: #D0372D;">org-cycle</span><span style="color: #008000;">] to cycle Info node `(org) Global and local cycling'.</span>

<span style="color: #008000;">Check `</span><span style="color: #D0372D;">org-use-speed-commands</span><span style="color: #008000;">'\n\n"</span>))

   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">in a headline</span>
   (substitute-command-keys
    <span style="color: #008000;">"You are in a headline. You can change:</span>

<span style="color: #008000;"> Visibility with \\[</span><span style="color: #D0372D;">org-cycle</span><span style="color: #008000;">]</span>

<span style="color: #008000;"> TODO state \\[</span><span style="color: #D0372D;">org-shiftleft</span><span style="color: #008000;">] and \\[</span><span style="color: #D0372D;">org-shiftright</span><span style="color: #008000;">] or</span>
<span style="color: #008000;"> `</span><span style="color: #D0372D;">org-todo</span><span style="color: #008000;">'.</span>

<span style="color: #008000;"> Your current todo sets can be found in `</span><span style="color: #D0372D;">org-todo-sets</span><span style="color: #008000;">'.</span>

<span style="color: #008000;"> Priority \\[</span><span style="color: #D0372D;">org-shiftup</span><span style="color: #008000;">] (`</span><span style="color: #D0372D;">org-priority-up</span><span style="color: #008000;">') and</span>
<span style="color: #008000;"> \\[</span><span style="color: #D0372D;">org-shiftdown</span><span style="color: #008000;">] (`</span><span style="color: #D0372D;">org-priority-down</span><span style="color: #008000;">')</span>

<span style="color: #008000;"> Tags  \\[</span><span style="color: #D0372D;">org-ctrl-c-ctrl-c</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-set-tags</span><span style="color: #008000;">'</span>

<span style="color: #008000;"> Set a property with \\[</span><span style="color: #D0372D;">org-set-property</span><span style="color: #008000;">] `</span><span style="color: #D0372D;">org-set-property</span><span style="color: #008000;">'.</span>

<span style="color: #008000;"> Delete a property with \\[</span><span style="color: #D0372D;">org-delete-property</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-delete-property</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'headline)))


<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">timestamp</span>
(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-timestamp</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for timestamps."</span>
  (concat
   (substitute-command-keys <span style="color: #008000;">"You are on a timestamp.</span>

<span style="color: #008000;">If you click on it, you will see the date in the agenda. With the</span>
<span style="color: #008000;">cursor on the &lt;&gt; or [] \\[</span><span style="color: #D0372D;">org-shiftup</span><span style="color: #008000;">] and \\[</span><span style="color: #D0372D;">org-shiftdown</span><span style="color: #008000;">] will</span>
<span style="color: #008000;">switch from active to inactive timestamps.</span>

<span style="color: #008000;">You can change the date by putting the cursor on a date part and</span>
<span style="color: #008000;">using \\[</span><span style="color: #D0372D;">org-shiftup</span><span style="color: #008000;">] and \\[</span><span style="color: #D0372D;">org-shiftdown</span><span style="color: #008000;">] or \\[</span><span style="color: #D0372D;">org-shiftleft</span><span style="color: #008000;">]</span>
<span style="color: #008000;">and \\[</span><span style="color: #D0372D;">org-shiftright</span><span style="color: #008000;">]</span>

<span style="color: #008000;">See Info node `(org) Dates and times'.</span>

<span style="color: #008000;">"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'timestamp)))


<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">table table-row table-cell</span>
(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-table</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for tables."</span>
  (concat
   <span style="color: #008000;">"You are in a table.</span>

<span style="color: #008000;">Move cell to cell with [TAB]. When you are in the last cell, TAB adds a new row.</span>

<span style="color: #008000;">Move rows up and down with \\[</span><span style="color: #D0372D;">org-metaup</span><span style="color: #008000;">] and \\[</span><span style="color: #D0372D;">org-metadown</span><span style="color: #008000;">].</span>
<span style="color: #008000;">Move columns left and right with \\[</span><span style="color: #D0372D;">org-metaleft</span><span style="color: #008000;">] and \\[</span><span style="color: #D0372D;">org-metaright</span><span style="color: #008000;">].</span>

<span style="color: #008000;">Sort a column with \\[</span><span style="color: #D0372D;">org-sort</span><span style="color: #008000;">] `</span><span style="color: #D0372D;">org-sort</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">Insert a row with `</span><span style="color: #D0372D;">org-table-insert-row</span><span style="color: #008000;">'.</span>
<span style="color: #008000;">Delete a row with `</span><span style="color: #D0372D;">org-table-kill-row</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">Insert a column with `</span><span style="color: #D0372D;">org-table-insert-column</span><span style="color: #008000;">'.</span>
<span style="color: #008000;">Delete a column with `</span><span style="color: #D0372D;">org-table-delete-column</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">`C-c -     (`</span><span style="color: #D0372D;">org-table-insert-hline</span><span style="color: #008000;">')'</span>
<span style="color: #008000;">     Insert a horizontal line below current row.  With a prefix</span>
<span style="color: #008000;">     argument, the line is created above the current line.</span>

<span style="color: #008000;">`C-c &lt;RET&gt;     (`</span><span style="color: #D0372D;">org-table-hline-and-move</span><span style="color: #008000;">')'</span>
<span style="color: #008000;">     Insert a horizontal line below current row, and move the cursor</span>
<span style="color: #008000;">     into the row below that line.</span>

<span style="color: #008000;">You can transpose a table with `</span><span style="color: #D0372D;">org-table-transpose-table-at-point</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">Info node `(org) Tables'.</span>

<span style="color: #008000;">"</span>
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'table)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-plain-list</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' doucmentation for plain lists."</span>
  (concat
   (substitute-command-keys
    <span style="color: #008000;">"You are on a plain list.</span>
<span style="color: #008000;">See Info node `(org) Plain lists'.</span>

<span style="color: #008000;">"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'plain-list)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-item</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for items in a list"</span>
  (concat
   (substitute-command-keys
    <span style="color: #008000;">"You are on an item in a list.</span>

<span style="color: #008000;">You can move items up and down with \\[</span><span style="color: #D0372D;">org-metaup</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-metaup</span><span style="color: #008000;">' and \\[</span><span style="color: #D0372D;">org-meta-down</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-metadown</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">You can add a new item with \\[</span><span style="color: #D0372D;">org-meta-return</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-meta-return</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">You can change the indentation of an item with  \\[</span><span style="color: #D0372D;">org-metaleft</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-metaleft</span><span style="color: #008000;">' and \\[</span><span style="color: #D0372D;">org-meta-right</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-meta-right</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">You can change the bullet of the item with  \\[</span><span style="color: #D0372D;">org-shiftleft</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-shiftleft</span><span style="color: #008000;">' and \\[</span><span style="color: #D0372D;">org-shiftright</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-shiftright</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">See Info node `(org) Plain lists' for other things like sorting, cycling, checkboxes, etc...</span>

<span style="color: #008000;">"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'item)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-keyword</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for a keyword."</span>
  (concat
   (substitute-command-keys
    <span style="color: #008000;">"You are on a keyword.</span>

<span style="color: #008000;">You may need to run \\[</span><span style="color: #D0372D;">org-ctrl-c-ctrl-c</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-ctrl-c-ctrl-c</span><span style="color: #008000;">' to refresh its value if you change it.</span>

<span style="color: #008000;">You can move keywords up and down with \\[</span><span style="color: #D0372D;">org-metaup</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-metaup</span><span style="color: #008000;">' and \\[</span><span style="color: #D0372D;">org-metadown</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-metadown</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'keyword)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore-paragraph</span> (element)
  <span style="color: #036A07;">"`</span><span style="color: #D0372D;">ore</span><span style="color: #036A07;">' documentation for a paragraph."</span>
  (concat
   (substitute-command-keys
    <span style="color: #008000;">"You are in a paragraph.</span>

<span style="color: #008000;">You can move a paragraph up with \\[</span><span style="color: #D0372D;">org-metaup</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-metaup</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">You can move a paragraph up with \\[</span><span style="color: #D0372D;">org-metadown</span><span style="color: #008000;">] or `</span><span style="color: #D0372D;">org-metadown</span><span style="color: #008000;">'.</span>

<span style="color: #008000;">You can mark the paragraph with `</span><span style="color: #D0372D;">mark-paragraph</span><span style="color: #008000;">'.</span>


<span style="color: #008000;">"</span>)
   (format  <span style="color: #008000;">"\nClick for details on the face [[face:%s]]\n"</span> (face-at-point))
   (ore-user-documentation 'paragraph)))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">ore</span> ()
  <span style="color: #036A07;">"Help function for the org-mode element at point."</span>
  (<span style="color: #0000FF;">interactive</span>)
  (<span style="color: #0000FF;">with-help-window</span>
      (help-buffer)
    (<span style="color: #0000FF;">let*</span> ((oeap (org-element-context))
           (ore-func (intern (format <span style="color: #008000;">"ore-%s"</span> (car oeap))))
           (s (<span style="color: #0000FF;">if</span> (fboundp ore-func)
                  (funcall ore-func oeap)
                (format
                 <span style="color: #008000;">"No documentation found for %s.</span>

<span style="color: #008000;">%s"</span>
                 (car oeap)
                 (ore-user-documentation (car oeap))))))
      <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">There are some special cases.</span>
      (<span style="color: #0000FF;">cond</span>
       ((<span style="color: #0000FF;">and</span>  (eq 'src-block (car oeap))
              (ore-src-block-header-p oeap))
        (<span style="color: #0000FF;">setq</span> s (ore-src-block-header oeap)))

       ((<span style="color: #0000FF;">or</span> (eq 'table (car oeap))
            (eq 'table-row (car oeap))
            (eq 'table-cell (car oeap)))
        (<span style="color: #0000FF;">setq</span> s (ore-table oeap)))

       ((<span style="color: #0000FF;">or</span> (eq 'latex-fragment (car oeap))
            (eq 'latex-environment (car oeap)))
        (<span style="color: #0000FF;">setq</span> s (ore-latex oeap))))

      (princ s)
      (princ <span style="color: #008000;">"\n\nHere is how org-mode sees the element.\n\n"</span>)
      (pp oeap))))


(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">match-next-ore-file</span> (<span style="color: #6434A3;">&amp;optional</span> limit)
  <span style="color: #036A07;">"Font-lock function to make file links clickable in help-mode."</span>
  (<span style="color: #0000FF;">when</span>  (re-search-forward <span style="color: #008000;">"\\[\\[file:</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">]]*</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">\\]\\]"</span> limit t)
    (<span style="color: #0000FF;">let*</span> ((fname (expand-file-name
                   (match-string 1)
                   ore-user-directory))
           (beg (match-beginning 0))
           (end (match-end 0))
           (find-func `(<span style="color: #0000FF;">lambda</span> ()
                         (<span style="color: #0000FF;">interactive</span>)
                         (find-file ,fname))))

      (add-text-properties
       beg
       end
       `(mouse-face
         highlight
         display <span style="color: #008000;">"User documentation"</span>
         local-map ,(<span style="color: #0000FF;">let</span> ((map (copy-keymap help-mode-map)))
                      (define-key map [mouse-1] find-func)
                      map)
         help-echo (format
                    <span style="color: #008000;">"Click to edit User documentation.\n%s"</span>
                    fname))))))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">match-next-ore-face</span> (<span style="color: #6434A3;">&amp;optional</span> limit)
  <span style="color: #036A07;">"Font-lock function to make face links clickable in help-mode."</span>
  (<span style="color: #0000FF;">when</span>  (re-search-forward <span style="color: #008000;">"\\[\\[face:</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">]]*</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">\\]\\]"</span> limit t)
    (<span style="color: #0000FF;">let*</span> ((face (match-string 1))
           (beg (match-beginning 0))
           (end (match-end 0))
           (func `(<span style="color: #0000FF;">lambda</span> ()
                    (<span style="color: #0000FF;">interactive</span>)
                    (describe-face ,face))))

      (add-text-properties
       beg
       end
       `(mouse-face
         highlight
         local-map ,(<span style="color: #0000FF;">let</span> ((map (copy-keymap help-mode-map)))
                      (define-key map [mouse-1] func)
                      map)
         display ,face
         help-echo (format
                    <span style="color: #008000;">"Click to show face information.\n%s"</span>
                    face))))))

(add-hook 'help-mode-hook
          (<span style="color: #0000FF;">lambda</span> ()
            (font-lock-add-keywords
             nil
             '((match-next-ore-file . font-lock-keyword-face)
               (match-next-ore-face . font-lock-keyword-face)))))


<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Let's add to the org menu for "Help at point"</span>
(easy-menu-change
 '(<span style="color: #008000;">"Org"</span>)
 <span style="color: #008000;">"Help"</span>
 '([<span style="color: #008000;">"Help at point"</span> ore])
 <span style="color: #008000;">"Show/Hide"</span>)
</pre>
</div>

<p>
<a class='org-ref-reference' href="#xu-suppor">xu-suppor</a>   \(e^x\)
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> <span class="todo TODO">TODO</span> elements</h2>
<div class="outline-text-2" id="text-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="right">a</td>
<td class="right">b</td>
</tr>

<tr>
<td class="right">3</td>
<td class="right">4</td>
</tr>
</tbody>
</table>

<p>
list (plain/numbered)
</p>
<ul class="org-ul">
<li>add element
<ul class="org-ul">
<li>move elements (up/down indent/outdent)
</li>
</ul>
</li>
<li>
</li>

<li>item 1
</li>
<li>item 2
</li>
<li>item 3
</li>
</ul>

<p>
checkbox
</p>
<ul class="org-ul">
<li><code>[&#xa0;]</code> check it
</li>
</ul>


<div class="figure">
<p><img src="/media/2015-11-24-Contextual-help-in-org-mode/11-eos.png"> 
</p>
</div>

<p>
<a href="org#External links">org#External links</a>
</p>

<p>
<a class='org-ref-reference' href="#lizzit-2001-surfac-ru">lizzit-2001-surfac-ru</a>
</p>


<p>

</p>

<p>
\(latex_fragment\)
</p>

<p>
\(latex fragment\)
</p>

\begin{equation}
2-3
\end{equation}

<div class="org-src-container">

<pre class="src src-emacs-lisp">(+ 3 4 5)
</pre>
</div>

<pre class="example">
12
</pre>

<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2015-10-18 Sun&gt;</span></span>   <span class="timestamp-wrapper"><span class="timestamp">[2015-10-18 Sun]</span></span></p>
</div>
</div>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/11/24/Contextual-help-in-org-mode.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/11/24/Contextual-help-in-org-mode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Improving-org-ref-cite-links-with-tooltips"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/11/23/Improving-org-ref-cite-links-with-tooltips/" rel="bookmark" title="Permanent Link to Improving org-ref cite links with tooltips">Improving org-ref cite links with tooltips</a></h2>
      <p><small><span class="blog_post_date">Posted November 23, 2015 at 07:03 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/orgref/'>orgref</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/11/23/Improving-org-ref-cite-links-with-tooltips#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Org-ref uses timers to give you messages about the cite link at point. I am not so crazy about the timer, there is always a (short) delay, and I have had trouble debugging timers in the past, and you have to put the point on the link. Since I wrote that code, I have learned some new things about Emacs, including dynamic tooltips. This will allow me to use the mouse to see what a cite link refers to. While reading documents, I am more likely to use a mouse than when typing a document, and getting a tooltip by hovering sounds like a good idea.
</p>

<p>
Here, we explore using dynamic tooltips on cite links. The idea is pretty simple, we tie into font-lock to add a function to the :help-echo property of a cite link. The function will go to point, and compute the citation string at point, which will be displayed as a tooltip when the mouse hovers over the citation.
</p>

<p>
Font-lock allows you to specify a function that sets match-data and that can have other side-effects, e.g. setting text properties. Org-ref has a regexp that defines cite links, which we use here, and a function that gets the citation string at point. We just go to the mouse position, and get that string, wrapped in a save-excursion macro so that point does not actually move. Then, we add the function to font-lock keywords, and we are done!
</p>

<p>
Here are some papers we wrote on using org-mode
<a class='org-ref-reference' href="#kitchin-2015-examp">kitchin-2015-examp</a>,<a class='org-ref-reference' href="#kitchin-2015-data-surfac-scien">kitchin-2015-data-surfac-scien</a> and some other references
in my bibliography <a class='org-ref-reference' href="#zou-2014-cobal-embed">zou-2014-cobal-embed</a>,<a class='org-ref-reference' href="#zlotea-2014-nanoal">zlotea-2014-nanoal</a> and one final
example <a class='org-ref-reference' href="#zhu-2015">zhu-2015</a>.
</p>


<p>
Here is the short code required to do this. You can see the tooltips in action here: <a href="https://www.youtube.com/watch?v=ifSmlId2rk0">https://www.youtube.com/watch?v=ifSmlId2rk0</a>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-ref-match-next-cite-link</span> (<span style="color: #6434A3;">&amp;optional</span> limit)
  (<span style="color: #0000FF;">when</span> (re-search-forward org-ref-cite-re limit t)
    (add-text-properties
     (match-beginning 0) (match-end 0)
     (list
      'help-echo (<span style="color: #0000FF;">lambda</span> (window object position)
                   (<span style="color: #0000FF;">save-excursion</span>
                     (goto-char position)
                     (<span style="color: #0000FF;">let</span> ((s (org-ref-get-citation-string-at-point)))
                       (<span style="color: #0000FF;">with-temp-buffer</span>
                         (insert s)
                         (fill-paragraph)
                         (buffer-string)))))))))

<span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">do this for this buffer</span>
(font-lock-add-keywords
    nil
    '((org-ref-match-next-cite-link (0  'org-ref-cite-face t)))
    t)
(font-lock-fontify-buffer)

<span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">do this for every org file</span>
(add-hook
 'org-mode-hook
 (<span style="color: #0000FF;">lambda</span> ()
   (font-lock-add-keywords
    nil
    '((org-ref-match-next-cite-link (0  'org-ref-cite-face t)))
    t)))
</pre>
</div>


<p>
<h1 class='org-ref-bib-h1'>Bibliography</h1>
<ul class='org-ref-bib'><li><a id="kitchin-2015-data-surfac-scien">[kitchin-2015-data-surfac-scien] "John Kitchin", Data Sharing in Surface Science, <i>"Surface Science "</i>, <b>(0)</b>,  -  (2015). <a href="http://www.sciencedirect.com/science/article/pii/S0039602815001326">link</a>. <a href="https://doi.org/10.1016/j.susc.2015.05.007">doi</a>.</a></li>
<li><a id="kitchin-2015-examp">[kitchin-2015-examp] Kitchin, Examples of Effective Data Sharing in Scientific Publishing, <i>ACS Catalysis</i>, <b>5(6)</b>, 3894-3899 (2015). <a href=" https://doi.org/10.1021/acscatal.5b00538 ">link</a>. <a href="https://doi.org/10.1021/acscatal.5b00538">doi</a>.</a></li>
<li><a id="zhu-2015">[zhu-2015] Yinlong Zhu, Wei Zhou, Zhi-Gang Chen, Yubo Chen, , Chao Su, Moses Tad\'e & Zongping Shao, \ceSrNb_0.1Co_0.7Fe_0.2 O_3-$\delta$ Perovskite As a  Next-Generation Electrocatalyst for Oxygen Evolution in  Alkaline Solution, <i>Angew. Chem. Int. Ed.</i>, <b>54(13)</b>, 3897-3901 (2015). <a href="https://doi.org/10.1002/anie.201408998">link</a>. <a href="https://doi.org/10.1002/anie.201408998">doi</a>.</a></li>
<li><a id="zlotea-2014-nanoal">[zlotea-2014-nanoal] Zlotea, Morfin, Nguyen, Nguyen, , Nelayah, Ricolleau, Latroche & Piccolo, Nanoalloying Bulk-Immiscible Iridium and Palladium Inhibits  Hydride Formation and Promotes Catalytic Performances, <i>Nanoscale</i>, <b>6(17)</b>, 9955 (2014). <a href="https://doi.org/10.1039/C4NR02836H">link</a>. <a href="https://doi.org/10.1039/c4nr02836h">doi</a>.</a></li>
<li><a id="zou-2014-cobal-embed">[zou-2014-cobal-embed] Zou, Huang, Goswami, , Silva, Sathe, Mikmekov\'a, ska & Asefa, Cobalt-Embedded Nitrogen-Rich Carbon Nanotubes Efficiently  Catalyze Hydrogen Evolution Reaction At All pH Values, <i>Angewandte Chemie</i>, <b></b>, 4461-4465 (2014). <a href="https://doi.org/10.1002/ange.201311111">link</a>. <a href="https://doi.org/10.1002/ange.201311111">doi</a>.</a></li>
</ul>
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/11/23/Improving-org-ref-cite-links-with-tooltips.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>


    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/11/23/Improving-org-ref-cite-links-with-tooltips#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Adding-emacs-command-key-bindings-and-help-functionality-to-org-mode"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/11/22/Adding-emacs-command-key-bindings-and-help-functionality-to-org-mode/" rel="bookmark" title="Permanent Link to Adding emacs command key-bindings and help functionality to org-mode">Adding emacs command key-bindings and help functionality to org-mode</a></h2>
      <p><small><span class="blog_post_date">Posted November 22, 2015 at 10:08 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/11/22/Adding-emacs-command-key-bindings-and-help-functionality-to-org-mode#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
The documentation of functions in emacs allows you to put some light markup into function doc strings that will render as the key sequence required to run the command when you look up the help on the function. I would like to have something like that in org-mode. You can look up the key-binding to a command like this:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(substitute-command-keys <span style="color: #008000;">"\\[</span><span style="color: #D0372D;">org-agenda</span><span style="color: #008000;">]"</span>)
</pre>
</div>

<pre class="example">
C-c a
</pre>

<p>
We are going to explore a way to recognize the syntax shown above, change its appearance to alert us that we are looking at an emacs command, add a tooltip, and make it clickable to open the documentation, and s (super) clickable to find the function code. Font lock is the tool we will use for this. Basically, we need a regular expression to match the syntax, and a function to find the next instance, and put some properties on the matched text.
</p>

<p>
I made a video (<a href="https://www.youtube.com/watch?v=VLUMW0sR4Vk">https://www.youtube.com/watch?v=VLUMW0sR4Vk</a> ) showing what this post is all about. It isn't easy to see in the post ☺.
</p>

<p>
Here we use the `rx' library to build up a regular expression for this. It is a bit easier to document than a raw regexp. Since we are matching \ in the pattern, there are some obligatory escaping \ characters in there too. All we need is to integrate this into font-lock. We define a function that will move the point to the end of the next match, and put properties on the match. We will go ahead and make the text clickable so we can access documentation and code easily. The tooltip will show the key-binding to run the command.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">rx</span>)

(<span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">elisp-symbol-keybinding-re</span>
  (<span style="color: #0000FF;">rx</span>
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">opening \\[</span>
   (eval <span style="color: #008000;">"\\["</span>)
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">one or more characters that are not ]</span>
   (group (one-or-more (not (any <span style="color: #008000;">"]"</span>))))
   <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">The closing ]</span>
   <span style="color: #008000;">"]"</span>)
<span style="color: #036A07;">"Regexp for an elisp command keybinding syntax. \\[</span><span style="color: #D0372D;">some-command</span><span style="color: #036A07;">]</span>
<span style="color: #036A07;">Regexp group 1 matches `</span><span style="color: #D0372D;">some-command</span><span style="color: #036A07;">'."</span>)

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">match-next-keybinding</span> (<span style="color: #6434A3;">&amp;optional</span> limit)
  <span style="color: #036A07;">"Move point to the end of the next expression matching</span>
<span style="color: #036A07;">`</span><span style="color: #D0372D;">elisp-symbol-keybinding-re</span><span style="color: #036A07;">', and put properties on the match</span>
<span style="color: #036A07;">that shows the key sequence. Non-bound commands are not</span>
<span style="color: #036A07;">fontified."</span>
  (<span style="color: #0000FF;">when</span> (<span style="color: #0000FF;">and</span> (re-search-forward
              elisp-symbol-keybinding-re
              limit t)
             (fboundp (intern (match-string 1))))
    (<span style="color: #0000FF;">let*</span> ((beg (match-beginning 0))
           (end (match-end 0))
           (s (match-string 0))
           (command (match-string 1))
           (describe-func `(<span style="color: #0000FF;">lambda</span> ()
                    <span style="color: #036A07;">"Run `</span><span style="color: #D0372D;">describe-function</span><span style="color: #036A07;">' on the command."</span>
                    (<span style="color: #0000FF;">interactive</span>)
                    (describe-function (intern ,command))))
           (find-func `(<span style="color: #0000FF;">lambda</span> ()
                     <span style="color: #036A07;">"Run `</span><span style="color: #D0372D;">find-function</span><span style="color: #036A07;">' on the command."</span>
                     (<span style="color: #0000FF;">interactive</span>)
                     (find-function (intern ,command))))
           (map (make-sparse-keymap)))

      <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this is what gets run when you click on it.</span>
      (define-key map [mouse-1] describe-func)
      (define-key map [s-mouse-1] find-func)
      <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Here we define the text properties</span>
      (add-text-properties
       beg end
       `(local-map ,map
         mouse-face highlight
         help-echo ,(format
                     <span style="color: #008000;">"%s\n\nClick for documentation.\ns-mouse-1 to find function."</span>
                     (substitute-command-keys s))
         keybinding t)))))
</pre>
</div>

<p>
Let's go ahead and make syntax for `some-command' too. This one seems simple enough we just write a regexp for it.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">match-next-emacs-command</span> (<span style="color: #6434A3;">&amp;optional</span> limit)
  <span style="color: #036A07;">"Move point to the end of the next expression matching</span>
<span style="color: #036A07;">`</span><span style="color: #D0372D;">this-syntax</span><span style="color: #036A07;">', and put a tooltip on the match</span>
<span style="color: #036A07;">that shows the key sequence. Works on commands and variables."</span>
  (<span style="color: #0000FF;">when</span> (<span style="color: #0000FF;">and</span> (re-search-forward
              <span style="color: #008000;">"`</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">[</span><span style="color: #008000;">^</span><span style="color: #008000;">']+</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">'"</span>
              limit t)
             (<span style="color: #0000FF;">or</span> (boundp (intern (match-string 1)))
                 (fboundp (intern (match-string 1)))))
    (<span style="color: #0000FF;">let*</span> ((beg (match-beginning 0))
           (end (match-end 0))
           (s (match-string 0))
           (command (match-string 1))
           (describe-func
            `(<span style="color: #0000FF;">lambda</span> ()
               <span style="color: #036A07;">"Run `</span><span style="color: #D0372D;">describe-function/variable</span><span style="color: #036A07;">' on the command."</span>
               (<span style="color: #0000FF;">interactive</span>)
               (<span style="color: #0000FF;">cond</span> ((fboundp (intern ,command))
                      (describe-function (intern ,command)))
                     ((boundp (intern ,command))
                      (describe-variable (intern ,command))))))
           (find-func `(<span style="color: #0000FF;">lambda</span> ()
                     <span style="color: #036A07;">"Run `</span><span style="color: #D0372D;">find-function</span><span style="color: #036A07;">' on the command."</span>
                     (<span style="color: #0000FF;">interactive</span>)
                     (find-function (intern ,command))))
           (map (make-sparse-keymap)))

      <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this is what gets run when you click on it.</span>
      (define-key map [mouse-1] describe-func)
      (define-key map [s-mouse-1] find-func)
      <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">Here we define the text properties</span>
      (add-text-properties
       beg end
       `(local-map ,map
         mouse-face highlight
         help-echo ,(format
                     <span style="color: #008000;">"%s\n\nClick for documentation.%s"</span>
                     (<span style="color: #0000FF;">if</span> (fboundp (intern command))
                         (substitute-command-keys (format <span style="color: #008000;">"\\[</span><span style="color: #D0372D;">%s</span><span style="color: #008000;">]"</span> command))
                       <span style="color: #008000;">"Variable"</span>)
                     (<span style="color: #0000FF;">if</span> (fboundp (intern command))
                         <span style="color: #008000;">"\ns-mouse-1 to find function."</span>
                       <span style="color: #008000;">""</span>))
         keybinding t)))))
</pre>
</div>

<p>
Now we need a way to turn them on and off. We do that here with a minor mode.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">define-minor-mode</span> <span style="color: #006699;">emacs-keybinding-command-tooltip-mode</span>
  <span style="color: #036A07;">"Fontify on emacs keybinding syntax. Adds a tooltip for</span>
<span style="color: #036A07;">keybinding, and make the command clickable to get to the</span>
<span style="color: #036A07;">documentation."</span>
  <span style="color: #006FE0;">:lighter</span> <span style="color: #008000;">" KB"</span>
  (<span style="color: #0000FF;">if</span> emacs-keybinding-command-tooltip-mode
      <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">turn them on</span>
      (font-lock-add-keywords
       nil
       '((match-next-keybinding 1 font-lock-constant-face)
         (match-next-emacs-command 1 font-lock-constant-face)))
    <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">turn them off</span>
    (font-lock-remove-keywords
     nil
     '((match-next-keybinding 1 font-lock-constant-face)
       (match-next-emacs-command 1 font-lock-constant-face))))
  (font-lock-fontify-buffer))
</pre>
</div>

<p>
Here we turn it on:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(emacs-keybinding-command-tooltip-mode -1)
</pre>
</div>

<p>
Here are some sample uses. You can use  \\[org-toggle-latex-overlays] to toggle latex overlays.
</p>

<p>
You can use \\[org-ref-helm-insert-cite-link]  to insert citations.
</p>

<p>
That more or less does it! I don't know if this is the canonical way to do this, but it works nicely here. You can also use overlays, but I found them a little confusing because they are not editable, and you have to toggle the minor mode to see them. Here we have unobtrusive tooltips. One downside is these won't export in any fashion in org-mode since it is not part of the syntax. It might be a good idea to adjust `font-lock-extra-managed-props' for this
</p>

<p>
It works for this syntax too: `helm', which is also commonly used in doc strings. This should be pretty handy in org-mode documents about Emacs!
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/11/22/Adding-emacs-command-key-bindings-and-help-functionality-to-org-mode.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/11/22/Adding-emacs-command-key-bindings-and-help-functionality-to-org-mode#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/category/orgmode/6">« Previous Page</a>
  --  
 <a href="/blog/category/orgmode/8">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2018/11/03/Constrained-optimization-with-Lagrange-multipliers-and-autograd/">Constrained optimization with Lagrange multipliers and autograd</a></li>
      <li><a href="/blog/2018/11/02/Solving-coupled-ODEs-with-a-neural-network-and-autograd/">Solving coupled ODEs with a neural network and autograd</a></li>
      <li><a href="/blog/2018/10/11/A-differentiable-ODE-integrator-for-sensitivity-analysis/">A differentiable ODE integrator for sensitivity analysis</a></li>
      <li><a href="/blog/2018/10/10/Autograd-and-the-derivative-of-an-integral-function/">Autograd and the derivative of an integral function</a></li>
      <li><a href="/blog/2018/10/09/Compressibility-variation-from-an-implicit-equation-of-state/">Compressibility variation from an implicit equation of state</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2018
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



