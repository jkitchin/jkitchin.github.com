

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: programming</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Reading-and-writing-pdf-metadata"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/06/13/Reading-and-writing-pdf-metadata/" rel="bookmark" title="Permanent Link to Reading and writing pdf metadata">Reading and writing pdf metadata</a></h2>
      <p><small><span class="blog_post_date">Posted June 13, 2013 at 10:19 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/programming/'>programming</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
One key to automating analysis of files is that data be stored in files in a way that is easy to add and retrieve. I have been examining ways to add grades to files so that a program could read the file, extract the grade, and collect it in a gradebook. 
</p>

<p>
PDF files could be one format where this is possible. The idea is that students would turn in a PDF file as their homework. The assignment would be graded, perhaps with hand-written markup from a tablet, and the grader would enter the grade as custom metadata in the file. Later a program would read the grade in and compile the results. 
</p>

<p>
In this post I examine some python modules that can do this. There are several python modules that can interact with PDF files.
</p>

<ol class="org-ol">
<li><a href="http://pybrary.net/pyPdf/">pyPDF</a> (seems to be replaced by <a href="http://knowah.github.io/PyPDF2/">PyPDF2</a>).
</li>
<li><a href="http://code.google.com/p/pdfrw/">pdfrw</a>
</li>
<li><a href="http://www.unixuser.org/~euske/python/pdfminer/index.html">pdfMiner</a> (seems to be read-only)
</li>
</ol>

<p>
All of these can be installed with pip. First, we look at getting existing information from a PDF file. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> pyPdf <span style="color: #8b0000;">import</span> PdfFileReader, PdfFileWriter

fname = <span style="color: #228b22;">'../../../Desktop/Program Organizer Controls.pdf'</span>

pdf = PdfFileReader(<span style="color: #8b0000;">open</span>(fname, <span style="color: #228b22;">'rb'</span>))

<span style="color: #8b0000;">print</span> pdf.getDocumentInfo()
</pre>
</div>

<pre class="example">
{'/Creator': u'Bluebeam Stapler 10.2.1', '/Author': u'John Kitchin', '/Producer': u'Bluebeam Brewery 5.0', '/CreationDate': u"D:20130612143804-04'00'", '/ModDate': u"D:20130613095927-04'00'"}
</pre>

<p>
That is pretty straightfoward. Now, let us add some new metadata. We will create a <code>Grade</code> metadata, and store the grade in it. It appears we need to read in the pdf file, add its pages and metadata to a writer, set the new metadata, and then write out the file.
</p>

<p>
It seems that we cannot directly modify the PDF file, so we will write out to a new file, delete the old file, and rename the new file to the old file.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> pyPdf <span style="color: #8b0000;">import</span> PdfFileReader, PdfFileWriter
<span style="color: #8b0000;">from</span> pyPdf.generic <span style="color: #8b0000;">import</span> NameObject, createStringObject

inpfn = <span style="color: #228b22;">'../../../Desktop/Program Organizer Controls.pdf'</span>

fin = <span style="color: #8b0000;">file</span>(inpfn, <span style="color: #228b22;">'rb'</span>)
pdf_in = PdfFileReader(fin)

writer = PdfFileWriter()

<span style="color: #8b0000;">for</span> page <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(pdf_in.getNumPages()):
    writer.addPage(pdf_in.getPage(page))

infoDict = writer._info.getObject()

info = pdf_in.documentInfo
<span style="color: #8b0000;">for</span> key <span style="color: #8b0000;">in</span> info:
    infoDict.update({NameObject(key): createStringObject(info[key])})

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">add the grade</span>
infoDict.update({NameObject(<span style="color: #228b22;">'/Grade'</span>): createStringObject(u<span style="color: #228b22;">'A+'</span>)})

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">It does not appear possible to alter in place.</span>
fout = <span style="color: #8b0000;">open</span>(inpfn+<span style="color: #228b22;">'out.pdf'</span>, <span style="color: #228b22;">'wb'</span>)

writer.write(fout)
fin.close()
fout.close()

<span style="color: #8b0000;">import</span> os
os.unlink(inpfn)
os.rename(inpfn+<span style="color: #228b22;">'out.pdf'</span>, inpfn)
</pre>
</div>

<p>
Finally, we can see we successfully modified the file.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> pyPdf <span style="color: #8b0000;">import</span> PdfFileReader, PdfFileWriter

fname = <span style="color: #228b22;">'../../../Desktop/Program Organizer Controls.pdf'</span>

pdf = PdfFileReader(<span style="color: #8b0000;">open</span>(fname, <span style="color: #228b22;">'rb'</span>))

<span style="color: #8b0000;">print</span> pdf.getDocumentInfo()
<span style="color: #8b0000;">print</span> pdf.getDocumentInfo()[<span style="color: #228b22;">'/Grade'</span>]
</pre>
</div>

<pre class="example">
{'/Grade': u'A+', '/CreationDate': u"D:20130612143804-04'00'", '/Producer': u'Bluebeam Brewery 5.0', '/Creator': u'Bluebeam Stapler 10.2.1', '/ModDate': u"D:20130613095927-04'00'", '/Author': u'John Kitchin'}
A+
</pre>

<p>
You can see we were able to successfully add a Grade metadata field. It is stored as a Custom Document Property in my PDF viewer. I am not sure how easy it would be for a grader to enter this into a PDF. It could be possible to automate this with some kind of script that made a decent workflow. For example an org-mode file could have links that open the PDF, allow you to grade it. Then, you could click on another link that would prompt you for the grade, and then add it to the pdf. Or maybe a small script could be written that would open the pdf, wait for your to close it, then prompt you for the grade before moving to the next one.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/06/13/Reading-and-writing-pdf-metadata.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/06/13/Reading-and-writing-pdf-metadata">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="What-region-is-a-point-in"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/06/06/What-region-is-a-point-in/" rel="bookmark" title="Permanent Link to What region is a point in">What region is a point in</a></h2>
      <p><small><span class="blog_post_date">Posted June 06, 2013 at 10:35 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/programming/'>programming</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated June 26, 2013 at 06:55 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
Suppose we have a space that is divided by a boundary into two regions, and we want to know if an arbitrary point is on one region or the other. One way to figure this out is to pick a point that is known to be in a region, and then draw a line to the arbitrary point counting the number of times it crosses the boundary. If the line crosses an even number of times, then the point is in the same region and if it crosses an odd number of times, then the point is in the other region. 
</p>

<p>
Here is the boundary and region we consider in this example:
</p>

<div class="org-src-container">

<pre class="src src-python">boundary = [[0.1, 0],
            [0.25, 0.1],
            [0.3, 0.2],
            [0.35, 0.34],
            [0.4, 0.43],
            [0.51, 0.47],
            [0.48, 0.55],
            [0.44, 0.62],
            [0.5, 0.66],
            [0.55,0.57],
            [0.556, 0.48],
            [0.63, 0.43],
            [0.70, 0.44],
            [0.8, 0.51],
            [0.91, 0.57],
            [1.0, 0.6]]

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

plt.plot([p[0] <span style="color: #8b0000;">for</span> p <span style="color: #8b0000;">in</span> boundary],
         [p[1] <span style="color: #8b0000;">for</span> p <span style="color: #8b0000;">in</span> boundary])
plt.ylim([0, 1])
plt.savefig(<span style="color: #228b22;">'images/boundary-1.png'</span>)
</pre>
</div>

<pre class="example">
... ... ... ... ... ... ... ... ... ... ... ... ... ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... [&lt;matplotlib.lines.Line2D object at 0x00000000062FEBA8&gt;]
(0, 1)
</pre>

<p><img src="/img/./images/boundary-1.png"><p>

<p>
In this example, the boundary is complicated, and not described by a simple function. We will check for intersections of the line from the arbitrary point to the reference point with each segment defining the boundary. If there is an intersection in the boundary, we count that as a crossing. We choose the origin (0, 0) in this case for the reference point. For an arbitrary point (x1, y1), the equation of the line is therefore (provided x1 !=0):
</p>

<p>
\(y = \frac{y1}{x1} x\).
</p>

<p>
Let the points defining a boundary segment be (bx1, by1) and (bx2, by2). The equation for the line connecting these points (provided bx1 != bx2) is:
</p>

<p>
\(y = by1 + \frac{by2 - by1}{bx2 - bx1}(x - bx1)\)
</p>

<p>
Setting these two equations equal to each other, we can solve for the value of \(x\), and if \(bx1 <= x <= bx2\) then we would say there is an intersection with that segment. The solution for x is:
</p>

<p>
\(x = \frac{m bx1 - by1}{m - y1/x1}\)
</p>

<p>
This can only fail if \(m = y1/x1\) which means the segments are parallel and either do not intersect or go through each other. One issue we have to resolve is what to do when the intersection is at the boundary. In that case, we would see an intersection with two segments since bx1 of one segment is also bx2 of another segment. We resolve the issue by only counting intersections with bx1. Finally, there may be intersections at values of \(x\) greater than the point, and we are not interested in those because the intersections are not between the point and reference point.
</p>

<p>
Here are all of the special cases that we  have to handle:
</p>

<p><img src="/img/./images/region-determination.png"><p>

<p>
We will have to do float comparisons, so we will define <i>tolerance functions</i> for all of these. I tried this previously with regular comparison operators, and there were many cases that did not work because of float comparisons. In the code that follows, we define the tolerance functions, the function that handles almost all the special cases, and show that it almost always correctly identifies the region a point is in.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

TOLERANCE = 2 * np.spacing(1)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">feq</span>(x, y, epsilon=TOLERANCE):
    <span style="color: #228b22;">'x == y'</span>
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">not</span>((x &lt; (y - epsilon)) <span style="color: #8b0000;">or</span> (y &lt; (x - epsilon)))

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">flt</span>(x, y, epsilon=TOLERANCE):
    <span style="color: #228b22;">'x &lt; y'</span>
    <span style="color: #8b0000;">return</span> x &lt; (y - epsilon)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fgt</span>(x, y, epsilon=TOLERANCE):
    <span style="color: #228b22;">'x &gt; y'</span>
    <span style="color: #8b0000;">return</span> y &lt; (x - epsilon)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fle</span>(x, y, epsilon=TOLERANCE):
    <span style="color: #228b22;">'x &lt;= y'</span>
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">not</span>(y &lt; (x - epsilon))

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fge</span>(x, y, epsilon=TOLERANCE):
    <span style="color: #228b22;">'x &gt;= y'</span>
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">not</span>(x &lt; (y - epsilon))

boundary = [[0.1, 0],
            [0.25, 0.1],
            [0.3, 0.2],
            [0.35, 0.34],
            [0.4, 0.43],
            [0.51, 0.47],
            [0.48, 0.55],
            [0.44, 0.62],
            [0.5, 0.66],
            [0.55,0.57],
            [0.556, 0.48],
            [0.63, 0.43],
            [0.70, 0.44],
            [0.8, 0.51],
            [0.91, 0.57],
            [1.0, 0.6]]

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">intersects</span>(p, isegment):
    <span style="color: #228b22;">'p is a point (x1, y1), isegment is an integer indicating which segment starting with 0'</span>
    x1, y1 = p
    bx1, by1 = boundary[isegment]
    bx2, by2 = boundary[isegment + 1]

    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">outline cases to handle</span>
    <span style="color: #8b0000;">if</span> feq(bx1, bx2) <span style="color: #8b0000;">and</span> feq(x1, 0.0): <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">both segments are vertical</span>
        <span style="color: #8b0000;">if</span> feq(bx1, x1):
            <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">True</span>
        <span style="color: #8b0000;">else:</span>
            <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">False</span>
    <span style="color: #8b0000;">elif</span> feq(bx1, bx2):  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">segment is vertical</span>
        m1 = y1 / x1 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">slope of reference line</span>
        y = m1 * bx1 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">value of reference line at bx1</span>
        <span style="color: #8b0000;">if</span> ((fge(y, by1) <span style="color: #8b0000;">and</span> flt(y, by2))
            <span style="color: #8b0000;">or</span> (fle(y, by1) <span style="color: #8b0000;">and</span> fgt(y,by2))):
            <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">reference line intersects the segment</span>
            <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">True</span>
        <span style="color: #8b0000;">else:</span>
            <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">False</span>
    <span style="color: #8b0000;">else:</span> <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">neither reference line nor segment is vertical</span>
        m = (by2 - by1) / (bx2 - bx1) <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">segment slope</span>
        m1 = y1 / x1
        <span style="color: #8b0000;">if</span> feq(m, m1): <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">line and segment are parallel</span>
            <span style="color: #8b0000;">if</span> feq(y1, m * bx1):
                <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">True</span>
            <span style="color: #8b0000;">else:</span>
                <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">False</span>
        <span style="color: #8b0000;">else:</span> <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">lines are not parallel</span>
            x = (m * bx1 - by1) / (m - m1) <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">x at intersection</span>

            <span style="color: #8b0000;">if</span> ((fge(x, bx1) <span style="color: #8b0000;">and</span> flt(x, bx2))
                <span style="color: #8b0000;">or</span> (fle(x, bx1) <span style="color: #8b0000;">and</span> fgt(x, bx2))) <span style="color: #8b0000;">and</span> fle(x, x1):
                <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">True</span>
            <span style="color: #8b0000;">else:</span>
                <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">False</span>

    <span style="color: #8b0000;">raise</span> <span style="color: #cd0000;">Exception</span>(<span style="color: #228b22;">'you should not get here'</span>)

<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

plt.plot([p[0] <span style="color: #8b0000;">for</span> p <span style="color: #8b0000;">in</span> boundary],
         [p[1] <span style="color: #8b0000;">for</span> p <span style="color: #8b0000;">in</span> boundary], <span style="color: #228b22;">'go-'</span>)
plt.ylim([0, 1])

N = 100

X = np.linspace(0, 1, N)

<span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> X:
    <span style="color: #8b0000;">for</span> y <span style="color: #8b0000;">in</span> X:
        p = (x, y)
        
        nintersections = <span style="color: #8b0000;">sum</span>([intersects(p, i) <span style="color: #8b0000;">for</span> i <span style="color: #8b0000;">in</span> <span style="color: #8b0000;">range</span>(len(boundary) - 1)])

        <span style="color: #8b0000;">if</span> nintersections % 2 == 0:
            plt.plot(x, y, <span style="color: #228b22;">'r.'</span>)
        <span style="color: #8b0000;">else:</span>
            plt.plot(x, y, <span style="color: #228b22;">'b.'</span>)

plt.savefig(<span style="color: #228b22;">'images/boundary-2.png'</span>)
plt.show()
</pre>
</div>

<p><img src="/img/./images/boundary-2.png"><p>

<p>
If you look carefully, there are two blue points in the red region, which means there is some edge case we do not capture in our function. Kudos to the person who figures it out. 
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/06/06/What-region-is-a-point-in.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/06/06/What-region-is-a-point-in">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Getting-a-dictionary-of-counts"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/05/29/Getting-a-dictionary-of-counts/" rel="bookmark" title="Permanent Link to Getting a dictionary of counts">Getting a dictionary of counts</a></h2>
      <p><small><span class="blog_post_date">Posted May 29, 2013 at 08:18 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/programming/'>programming</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated May 29, 2013 at 08:20 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
I frequently want to take a list and get a dictionary of keys that have the count of each element in the list. Here is how I have typically done this countless times in the past. 
</p>

<div class="org-src-container">

<pre class="src src-python">L = [<span style="color: #228b22;">'a'</span>, <span style="color: #228b22;">'a'</span>, <span style="color: #228b22;">'b'</span>,<span style="color: #228b22;">'d'</span>, <span style="color: #228b22;">'e'</span>, <span style="color: #228b22;">'b'</span>, <span style="color: #228b22;">'e'</span>, <span style="color: #228b22;">'a'</span>]

d = {}
<span style="color: #8b0000;">for</span> el <span style="color: #8b0000;">in</span> L:
    <span style="color: #8b0000;">if</span> el <span style="color: #8b0000;">in</span> d:
        d[el] += 1
    <span style="color: #8b0000;">else:</span>
        d[el] = 1

<span style="color: #8b0000;">print</span> d
</pre>
</div>

<pre class="example">
{'a': 3, 'b': 2, 'e': 2, 'd': 1}
</pre>

<p>
That seems like too much code, and that there must be a list comprehension approach combined with a dictionary constructor. 
</p>

<div class="org-src-container">

<pre class="src src-python">L = [<span style="color: #228b22;">'a'</span>, <span style="color: #228b22;">'a'</span>, <span style="color: #228b22;">'b'</span>,<span style="color: #228b22;">'d'</span>, <span style="color: #228b22;">'e'</span>, <span style="color: #228b22;">'b'</span>, <span style="color: #228b22;">'e'</span>, <span style="color: #228b22;">'a'</span>]

<span style="color: #8b0000;">print</span> dict((el,L.count(el)) <span style="color: #8b0000;">for</span> el <span style="color: #8b0000;">in</span> L)
</pre>
</div>

<pre class="example">
{'a': 3, 'b': 2, 'e': 2, 'd': 1}
</pre>

<p>
Wow, that is a lot simpler! I suppose for large lists this might be slow, since count must look through the list for each element, whereas the longer code looks at each element once, and does one conditional analysis.
</p>

<p>
Here is another example of much shorter and cleaner code. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> collections <span style="color: #8b0000;">import</span> Counter
L = [<span style="color: #228b22;">'a'</span>, <span style="color: #228b22;">'a'</span>, <span style="color: #228b22;">'b'</span>,<span style="color: #228b22;">'d'</span>, <span style="color: #228b22;">'e'</span>, <span style="color: #228b22;">'b'</span>, <span style="color: #228b22;">'e'</span>, <span style="color: #228b22;">'a'</span>]
<span style="color: #8b0000;">print</span> Counter(L)
<span style="color: #8b0000;">print</span> Counter(L)[<span style="color: #228b22;">'a'</span>]
</pre>
</div>

<pre class="example">
Counter({'a': 3, 'b': 2, 'e': 2, 'd': 1})
3
</pre>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/05/29/Getting-a-dictionary-of-counts.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/05/29/Getting-a-dictionary-of-counts">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Lambda-Lambda-Lambda"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/05/20/Lambda-Lambda-Lambda/" rel="bookmark" title="Permanent Link to Lambda Lambda Lambda">Lambda Lambda Lambda</a></h2>
      <p><small><span class="blog_post_date">Posted May 20, 2013 at 10:13 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/programming/'>programming</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated June 26, 2013 at 06:56 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Applications of lambda functions</a></li>
<li><a href="#sec-2">2. Summary</a></li>
</ul>
</div>
</div>
<p>
Is that some kind of fraternity? of anonymous functions? What is that!? There are many times where you need a callable, small function in python, and it is inconvenient to have to use <code>def</code> to create a named function. Lambda functions solve this problem. Let us look at some examples. First, we create a lambda function, and assign it to a variable. Then we show that variable is a function, and that we can call it with an argument.
</p>

<div class="org-src-container">

<pre class="src src-python">f = <span style="color: #8b0000;">lambda</span> x: 2*x
<span style="color: #8b0000;">print</span> f
<span style="color: #8b0000;">print</span> f(2)
</pre>
</div>

<pre class="example">
&lt;function &lt;lambda&gt; at 0x0000000001E6AAC8&gt;
4
</pre>

<p>
We can have more than one argument:
</p>
<div class="org-src-container">

<pre class="src src-python">f = <span style="color: #8b0000;">lambda</span> x,y: x + y
<span style="color: #8b0000;">print</span> f
<span style="color: #8b0000;">print</span> f(2, 3)
</pre>
</div>

<pre class="example">
&lt;function &lt;lambda&gt; at 0x0000000001E3AAC8&gt;
5
</pre>

<p>
And default arguments:
</p>

<div class="org-src-container">

<pre class="src src-python">f = <span style="color: #8b0000;">lambda</span> x, y=3: x + y
<span style="color: #8b0000;">print</span> f
<span style="color: #8b0000;">print</span> f(2)
<span style="color: #8b0000;">print</span> f(4, 1)
</pre>
</div>

<pre class="example">
&lt;function &lt;lambda&gt; at 0x0000000001E9AAC8&gt;
5
5
</pre>

<p>
It is also possible to have arbitrary numbers of positional arguments. Here is an example that provides the sum of an arbitrary number of arguments.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> operator
f = <span style="color: #8b0000;">lambda</span> *x: <span style="color: #8b0000;">reduce</span>(operator.add, x)
<span style="color: #8b0000;">print</span> f

<span style="color: #8b0000;">print</span> f(1)
<span style="color: #8b0000;">print</span> f(1, 2)
<span style="color: #8b0000;">print</span> f(1, 2, 3)
</pre>
</div>

<pre class="example">
&lt;function &lt;lambda&gt; at 0x0000000001DFAAC8&gt;
1
3
6
</pre>

<p>
You can also make arbitrary keyword arguments. Here we make a function that simply returns the kwargs as a dictionary. This feature may be helpful in passing kwargs to other functions.
</p>

<div class="org-src-container">

<pre class="src src-python">f = <span style="color: #8b0000;">lambda</span> **kwargs: kwargs

<span style="color: #8b0000;">print</span> f(a=1, b=3)
</pre>
</div>

<pre class="example">
{'a': 1, 'b': 3}
</pre>

<p>
Of course, you can combine these options. Here is a function with all the options.
</p>

<div class="org-src-container">

<pre class="src src-python">f = <span style="color: #8b0000;">lambda</span> a, b=4, *args, **kwargs: (a, b, args, kwargs)

<span style="color: #8b0000;">print</span> f(<span style="color: #228b22;">'required'</span>, 3, <span style="color: #228b22;">'optional-positional'</span>, g=4)
</pre>
</div>

<pre class="example">
('required', 3, ('optional-positional',), {'g': 4})
</pre>

<p>
One of the primary limitations of lambda functions is they are limited to single expressions. They also do not have documentation strings, so it can be difficult to understand what they were written for later. 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Applications of lambda functions</h2>
<div class="outline-text-2" id="text-1">
<p>
Lambda functions are used in places where you need a function, but may not want to define one using <code>def</code>. For example, say you want to solve the nonlinear equation \(\sqrt{x} = 2.5\). 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

sol, = fsolve(<span style="color: #8b0000;">lambda</span> x: 2.5 - np.sqrt(x), 8)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
6.25
</pre>

<p>
Another time to use lambda functions is if you want to set a particular value of a parameter in a function. Say we have a function with an independent variable, \(x\) and a parameter \(a\), i.e. \(f(x; a)\). If we want to find a solution \(f(x; a) = 0\) for some value of \(a\), we can use a lambda function to make a function of the single variable \(x\). Here is a example.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fsolve
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(x, a):
    <span style="color: #8b0000;">return</span> a * np.sqrt(x) - 4.0

sol, = fsolve(<span style="color: #8b0000;">lambda</span> x: func(x, 3.2), 3)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
1.5625
</pre>


<p>
Any function that takes a function as an argument can use lambda functions. Here we use a lambda function that adds two numbers in the <code>reduce</code> function to sum a list of numbers.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> reduce(<span style="color: #8b0000;">lambda</span> x, y: x + y, [0, 1, 2, 3, 4])
</pre>
</div>

<pre class="example">
10
</pre>

<p>
We can evaluate the integral \(\int_0^2 x^2 dx\) with a lambda function.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> quad

<span style="color: #8b0000;">print</span> quad(<span style="color: #8b0000;">lambda</span> x: x**2, 0, 2)
</pre>
</div>

<pre class="example">
(2.666666666666667, 2.960594732333751e-14)
</pre>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Summary</h2>
<div class="outline-text-2" id="text-2">
<p>
Lambda functions can be helpful. They are never necessary. You can always define a function using <code>def</code>, but for some small, single-use functions, a lambda function could make sense. Lambda functions have some limitations, including that they are limited to a single expression, and they lack documentation strings.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/05/20/Lambda-Lambda-Lambda.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/05/20/Lambda-Lambda-Lambda">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Redirecting-the-print-function"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/05/19/Redirecting-the-print-function/" rel="bookmark" title="Permanent Link to Redirecting the print function">Redirecting the print function</a></h2>
      <p><small><span class="blog_post_date">Posted May 19, 2013 at 11:19 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/programming/'>programming</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated May 29, 2013 at 08:17 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Ordinarily a print statement prints to stdout, or your terminal/screen. You can redirect this so that printing is done to a file, for example. This might be helpful if you use print statements for debugging, and later want to save what is printed to a file. Here we make a simple function that prints some things.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">def</span> <span style="color: #8b2323;">debug</span>():
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'step 1'</span>
    <span style="color: #8b0000;">print</span> 3 + 4
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'finished'</span>

debug()
</pre>
</div>

<pre class="example">
... ... ... &gt;&gt;&gt; step 1
7
finished
</pre>

<p>
Now, let us redirect the printed lines to a file. We create a file object, and set sys.stdout equal to that file object.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys
<span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__, <span style="color: #228b22;">'__stdout__ before = '</span>, sys.__stdout__
<span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__, <span style="color: #228b22;">'stdout before = '</span>, sys.stdout

f = <span style="color: #8b0000;">open</span>(<span style="color: #228b22;">'data/debug.txt'</span>, <span style="color: #228b22;">'w'</span>)
sys.stdout = f

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">note that sys.__stdout__ does not change, but stdout does.</span>
<span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__, <span style="color: #228b22;">'__stdout__ after = '</span>, sys.__stdout__
<span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__, <span style="color: #228b22;">'stdout after = '</span>, sys.stdout

debug()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">reset stdout back to console</span>
sys.stdout = sys.__stdout__

<span style="color: #8b0000;">print</span> f
f.close() <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">try to make it a habit to close files</span>
<span style="color: #8b0000;">print</span> f
</pre>
</div>

<pre class="example">
__stdout__ before =  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
stdout before =  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... __stdout__ after =  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
stdout after =  &lt;open file 'data/debug.txt', mode 'w' at 0x2ae7dbcbbb70&gt;
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; ... &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &lt;open file 'data/debug.txt', mode 'w' at 0x2ae7dbcbbb70&gt;
&gt;&gt;&gt; &lt;closed file 'data/debug.txt', mode 'w' at 0x2ae7dbcbbb70&gt;
</pre>

<p>
Note it can be important to close files. If you are looping through large numbers of files, you will eventually run out of file handles, causing an error. We can use a context manager to automatically close the file like this
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">use the open context manager to automatically close the file</span>
<span style="color: #8b0000;">with</span> <span style="color: #8b0000;">open</span>(<span style="color: #228b22;">'data/debug.txt'</span>, <span style="color: #228b22;">'w'</span>) <span style="color: #8b0000;">as</span> f:
    sys.stdout = f
    debug()
    <span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__, f

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">reset stdout</span>
sys.stdout = sys.__stdout__
<span style="color: #8b0000;">print</span> f
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; ... ... ... ... ... &lt;open file 'data/debug.txt', mode 'w' at 0x0000000002071C00&gt;
... &gt;&gt;&gt; &lt;closed file 'data/debug.txt', mode 'w' at 0x0000000002071C00&gt;
</pre>

<p>
See, the file is closed for us! We can see the contents of our file like this.
</p>
<div class="org-src-container">

<pre class="src src-sh">cat data/debug.txt
</pre>
</div>

<pre class="example">
step 1
7
finished
</pre>

<p>
The approaches above are not fault safe. Suppose our debug function raised an exception. Then, it could be possible the line to reset the stdout would not be executed. We can solve this with try/finally code.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'before: '</span>, sys.stdout
<span style="color: #8b0000;">try:</span>
    <span style="color: #8b0000;">with</span> <span style="color: #8b0000;">open</span>(<span style="color: #228b22;">'data/debug-2.txt'</span>, <span style="color: #228b22;">'w'</span>) <span style="color: #8b0000;">as</span> f:
        sys.stdout = f
        <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">print to the original stdout</span>
        <span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__, <span style="color: #228b22;">'during: '</span>, sys.stdout
        debug()
        <span style="color: #8b0000;">raise</span> <span style="color: #cd0000;">Exception</span>(<span style="color: #228b22;">'something bad happened'</span>)
<span style="color: #8b0000;">finally:</span>
    <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">reset stdout</span>
    sys.stdout = sys.__stdout__

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'after: '</span>, sys.stdout
<span style="color: #8b0000;">print</span> f <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">verify it is closed</span>
<span style="color: #8b0000;">print</span> sys.stdout <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">verify this is reset</span>
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; before:  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
... ... ... ... ... ... ... ... ... ... during:  &lt;open file 'data/debug-2.txt', mode 'w' at 0x2ae7dbcbbf60&gt;
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 7, in &lt;module&gt;
Exception: something bad happened
after:  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
&lt;closed file 'data/debug-2.txt', mode 'w' at 0x2ae7dbcbbf60&gt;
&lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
</pre>

<div class="org-src-container">

<pre class="src src-sh">cat data/debug-2.txt
</pre>
</div>

<pre class="example">
step 1
7
finished
</pre>

<p>
This is the kind of situation where a context manager is handy. Context managers are typically a class that executes some code when you &ldquo;enter&rdquo; the context, and then execute some code when you &ldquo;exit&rdquo; the context. Here we want to change sys.stdout to a new value inside our context, and change it back when we exit the context. We will store the value of sys.stdout going in, and restore it on the way out.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys

<span style="color: #8b0000;">class</span> <span style="color: #4682b4;">redirect</span>:
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__init__</span>(<span style="color: #8b0000;">self</span>, f=sys.stdout):
        <span style="color: #228b22;">"redirect print statement to f. f must be a file-like object"</span>
        <span style="color: #8b0000;">self</span>.f = f
        <span style="color: #8b0000;">self</span>.stdout = sys.stdout
        <span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__, <span style="color: #228b22;">'init stdout: '</span>, sys.stdout        
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__enter__</span>(<span style="color: #8b0000;">self</span>): 
        sys.stdout = <span style="color: #8b0000;">self</span>.f
        <span style="color: #8b0000;">print</span> &gt;&gt; sys.__stdout__,  <span style="color: #228b22;">'stdout in context-manager: '</span>,sys.stdout
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__exit__</span>(<span style="color: #8b0000;">self</span>, *args):
        sys.stdout = <span style="color: #8b0000;">self</span>.stdout
        <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'__stdout__ at exit = '</span>,sys.__stdout__        

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">regular printing</span>
<span style="color: #8b0000;">with</span> redirect():
    debug()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">write to a file</span>
<span style="color: #8b0000;">with</span> <span style="color: #8b0000;">open</span>(<span style="color: #228b22;">'data/debug-3.txt'</span>, <span style="color: #228b22;">'w'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b0000;">with</span> redirect(f):
        debug()

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">mixed regular and </span>
<span style="color: #8b0000;">with</span> <span style="color: #8b0000;">open</span>(<span style="color: #228b22;">'data/debug-4.txt'</span>, <span style="color: #228b22;">'w'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b0000;">with</span> redirect(f):
        <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'testing redirect'</span>
        <span style="color: #8b0000;">with</span> redirect():
            <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'temporary console printing'</span>
            debug()
        <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'Now outside the inner context. this should go to data/debug-4.txt'</span>
        debug()
        <span style="color: #8b0000;">raise</span> <span style="color: #cd0000;">Exception</span>(<span style="color: #228b22;">'something else bad happened'</span>)

<span style="color: #8b0000;">print</span> sys.stdout
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; ... ... ... ... ... ... ... ... ... ... ... ... &gt;&gt;&gt; ... ... ... init stdout:  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
stdout in context-manager:  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
step 1
7
finished
__stdout__ at exit =  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
... ... ... ... init stdout:  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
stdout in context-manager:  &lt;open file 'data/debug-3.txt', mode 'w' at 0x2ae7dbcbbb70&gt;
__stdout__ at exit =  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
... ... ... ... ... ... ... ... ... ... init stdout:  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
stdout in context-manager:  &lt;open file 'data/debug-4.txt', mode 'w' at 0x2ae7dca4d030&gt;
init stdout:  &lt;open file 'data/debug-4.txt', mode 'w' at 0x2ae7dca4d030&gt;
stdout in context-manager:  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
temporary console printing
step 1
7
finished
__stdout__ at exit =  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 10, in &lt;module&gt;
Exception: something else bad happened
&lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
</pre>

<p>
Here are the contents of the debug file. 
</p>
<div class="org-src-container">

<pre class="src src-sh">cat data/debug-3.txt
</pre>
</div>

<pre class="example">
step 1
7
finished
</pre>

<p>
The contents of the other debug file have some additional lines, because we printed some things while in the redirect context.
</p>
<div class="org-src-container">

<pre class="src src-sh">cat data/debug-4.txt
</pre>
</div>

<pre class="example">
testing redirect
__stdout__ at exit =  &lt;open file '&lt;stdout&gt;', mode 'w' at 0x2ae7d70e01e0&gt;
Now outside the inner context. this should go to data/debug-4.txt
step 1
7
finished
</pre>

<p>
See <a href="http://www.python.org/dev/peps/pep-0343/" >http://www.python.org/dev/peps/pep-0343/</a> (number 5) for another example of redirecting using a function decorator. I think it is harder to understand, because it uses a generator.
</p>

<p>
There were a couple of points in this section:
</p>

<ol>
<li>You can control where things are printed in your programs by modifying the value of sys.stdout
</li>
<li>You can use try/except/finally blocks to make sure code gets executed in the event an exception is raised
</li>
<li>You can use context managers to make sure files get closed, and code gets executed if exceptions are raised.
</li>
</ol>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/05/19/Redirecting-the-print-function.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/05/19/Redirecting-the-print-function">Discuss on Twitter</a>

  <hr class="interblog" />
 <a href="/blog/category/programming/2">« Previous Page</a>
  --  
 <a href="/blog/category/programming/4">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2023/09/19/New-publication-Sequential-Sampling-Methods-for-Finding-Classification-Boundaries-in-Engineering-Applications/">New publication - Sequential Sampling Methods for Finding Classification Boundaries in Engineering Applications</a></li>
      <li><a href="/blog/2023/09/19/Using-Custodian-to-help-converge-an-optimization-problem/">Using Custodian to help converge an optimization problem</a></li>
      <li><a href="/blog/2023/04/25/New-Publication-An-Inverse-Mapping-Approach-for-Process-Systems-Engineering-Using-Automatic-Differentiation-and-the-Implicit-Function-Theorem/">New Publication - An Inverse Mapping Approach for Process Systems Engineering Using Automatic Differentiation and the Implicit Function Theorem</a></li>
      <li><a href="/blog/2023/04/16/New-publication-WhereWulff-A-Semiautonomous-Workflow-for-Systematic-Catalyst-Surface-Reactivity-under-Reaction-Conditions/">New publication - WhereWulff A Semiautonomous Workflow for Systematic Catalyst Surface Reactivity under Reaction Conditions</a></li>
      <li><a href="/blog/2023/04/15/New-publication-High-throughput-discovery-of-ternary-Cu-Fe-Ru-alloy-catalysts-for-photo-driven-hydrogen-production/">New publication - High throughput discovery of ternary Cu-Fe-Ru alloy catalysts for photo-driven hydrogen production</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2023
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



