

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: optimization</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Using-Custodian-to-help-converge-an-optimization-problem"></div>
      <h2 class="blog_post_title"><a href="/blog/2023/09/19/Using-Custodian-to-help-converge-an-optimization-problem/" rel="bookmark" title="Permanent Link to Using Custodian to help converge an optimization problem">Using Custodian to help converge an optimization problem</a></h2>
      <p><small><span class="blog_post_date">Posted September 19, 2023 at 03:34 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a>, <a href='/blog/category/programming/'>programming</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated September 19, 2023 at 03:35 PM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
In high-throughput calculations, some fraction of them usually fail for some reason. Sometimes it is easy to fix these calculations and re-run them successfully, for example, you might just need a different initialization, or to increase memory or the number of allowed steps, etc.  <a href="http://materialsproject.github.io/custodian/">custodian</a> is a tool that is designed for this purpose. 
</p>

<p>
The idea is we make a function to do what we want that has arguments that control that. We need a function that can examine the output of the function and determine if it succeeded, and if it didn't succeed to say what new arguments to try next. Then we run the function in custodian and let it take care of rerunning with new arguments until it either succeeds, or tries too many times.
</p>

<p>
The goal here is to use <a href="http://materialsproject.github.io/custodian/">custodian</a> to fix a problem optimization. The example is a little contrived, we set a number of iterations artificially low so that the minimization fails by reaching the maximum number of iterations. Custodian will catch this, and increase the number of iterations until it succeeds. Here is the objective function:
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(x):
    <span style="color: #0000FF;">return</span> np.exp(x**2) - 10*np.exp(x)

<span style="color: #BA36A5;">x</span> = np.linspace(0, 2)
plt.plot(x, objective(x))
plt.xlabel(<span style="color: #008000;">'x'</span>)
plt.ylabel(<span style="color: #008000;">'y'</span>);
</pre>
</div>

<p>
<figure><img src="/media/354616de80c1f529dd249d03f96e5bc023bbd321.png"></figure> 
</p>

<p>
Clearly there is a minimum near 1.75, but with a bad initial guess, and not enough iterations, an optimizer fails here. We can tell it fails from the message here, and the solution is run it again with more iterations.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> minimize

minimize(objective, 0.0, options={<span style="color: #008000;">'maxiter'</span>: 2})
</pre>
</div>

<pre class="example" id="org27fcdb3">
:RESULTS:
  message: Maximum number of iterations has been exceeded.
  success: False
   status: 1
      fun: -36.86289091418059
        x: [ 1.661e+00]
      nit: 2
      jac: [-2.374e-01]
 hess_inv: [[ 6.889e-03]]
     nfev: 20
     njev: 10
:END:
</pre>

<p>
With Custodian you define a "Job". This is a class with  <code>params</code> that contain the adjustable arguments in a dictionary, and a <code>run</code> method that stores the results in the params attribute. This is an important step, because the error handlers only get the params, so you need the results in there to inspect them.
</p>

<p>
The error handlers are another class with a <code>check</code> method that returns True if you should rerun, and a <code>correct</code> method that sets the params to new values to try next. It seems to return some information about what happened. In the <code>correct</code> method, we double the maximum number of iterations allowed, and use the last solution point that failed as the initial guess for the next run.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> custodian.custodian <span style="color: #0000FF;">import</span> Custodian, Job, ErrorHandler

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Minimizer</span>(Job):
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(<span style="color: #0000FF;">self</span>, params=<span style="color: #D0372D;">None</span>):
        <span style="color: #0000FF;">self</span>.params = params <span style="color: #0000FF;">if</span> params <span style="color: #0000FF;">else</span> {<span style="color: #008000;">'maxiter'</span>: 2, <span style="color: #008000;">'x0'</span>: 0}
        
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">run</span>(<span style="color: #0000FF;">self</span>):
        sol = minimize(objective,
                       <span style="color: #0000FF;">self</span>.params[<span style="color: #008000;">'x0'</span>],
                       options={<span style="color: #008000;">'maxiter'</span>: <span style="color: #0000FF;">self</span>.params[<span style="color: #008000;">'maxiter'</span>]})
        <span style="color: #0000FF;">self</span>.params[<span style="color: #008000;">'sol'</span>] = sol

<span style="color: #0000FF;">class</span> <span style="color: #6434A3;">MaximumIterationsExceeded</span>(ErrorHandler):
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">__init__</span>(<span style="color: #0000FF;">self</span>, params):
        <span style="color: #0000FF;">self</span>.params = params

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">check</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">self</span>.params[<span style="color: #008000;">'sol'</span>].message == <span style="color: #008000;">'Maximum number of iterations has been exceeded.'</span>

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">correct</span>(<span style="color: #0000FF;">self</span>):
        <span style="color: #0000FF;">self</span>.params[<span style="color: #008000;">'maxiter'</span>] *= 2
        <span style="color: #0000FF;">self</span>.params[<span style="color: #008000;">'x0'</span>] = <span style="color: #0000FF;">self</span>.params[<span style="color: #008000;">'sol'</span>].x        
        <span style="color: #0000FF;">return</span> {<span style="color: #008000;">'errors'</span>: <span style="color: #008000;">'MaximumIterations Exceeded'</span>,
                <span style="color: #008000;">'actions'</span>: <span style="color: #008000;">'maxiter = {self.params["maxiter"]}, x0 = {self.params["x0"]}'</span>}
</pre>
</div>

<p>
Now we setup the initial params to try, create a Custodian object with the handler and job, and then run it. The results and final params are stored in the params object.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">params</span> = {<span style="color: #008000;">'maxiter'</span>: 1, <span style="color: #008000;">'x0'</span>: 0}

<span style="color: #BA36A5;">c</span> = Custodian([MaximumIterationsExceeded(params)],
              [Minimizer(params)],
               max_errors=5)

c.run()
<span style="color: #0000FF;">for</span> key <span style="color: #0000FF;">in</span> params:
    <span style="color: #006FE0;">print</span>(key, params[key])
</pre>
</div>

<pre class="example" id="orgca61279">
MaximumIterationsExceeded
MaximumIterationsExceeded
maxiter 4
x0 [1.66250127]
sol   message: Optimization terminated successfully.
  success: True
   status: 0
      fun: -36.86307468296398
        x: [ 1.662e+00]
      nit: 1
      jac: [-9.060e-06]
 hess_inv: [[1]]
     nfev: 6
     njev: 3
</pre>



<p>
Note that params is modified, and finally has the maxiter value that worked, and the solution in it. You can see we had to rerun this problem  twice before it succeeded, but this happened automatically after the setup. This example is easy because we can simply increase the maxiter value, and no serious logic is needed. Other use cases might include try it again with another solver, try again with a different initial guess, etc. 
</p>

<p>
It feels a little heavyweight to define the classes, and to store the results in params here, but this was overall under an hour of work to put it all together, starting from scratch with the <a href="http://materialsproject.github.io/custodian/">Custodian documentation</a> from the example on the front page. You can do more sophisticated things, including having multiple error handlers. Overall, for a package designed for molecular simulations, this worked well for a different kind of problem.
</p>
<p>Copyright (C) 2023 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2023/09/19/Using-Custodian-to-help-converge-an-optimization-problem.org">org-mode source</a></p>
<p>Org-mode version = 9.7-pre</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2023/09/19/Using-Custodian-to-help-converge-an-optimization-problem">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Update-on-finding-the-minimum-distance-from-a-point-to-a-curve"></div>
      <h2 class="blog_post_title"><a href="/blog/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve/" rel="bookmark" title="Permanent Link to Update on finding the minimum distance from a point to a curve">Update on finding the minimum distance from a point to a curve</a></h2>
      <p><small><span class="blog_post_date">Posted February 17, 2023 at 06:41 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Almost 10 years ago I <a href="https://kitchingroup.cheme.cmu.edu/blog/2013/02/14/Find-the-minimum-distance-from-a-point-to-a-curve/">wrote</a> about finding the minimum distance from a point to a curve using a constrained optimization. At that time, the way to do this used <code>scipy.optimize.fmin_coblya</code>. I learned today from a student, that sometimes this method fails! I reproduce the code here, updated for Python 3, some style updates, and to show it does indeed fail sometimes, notably when the point is "outside" the parabola.
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fmin_cobyla

<span style="color: #0000FF;">def</span> <span style="color: #006699;">f</span>(x):
    <span style="color: #0000FF;">return</span> x**2

<span style="color: #0000FF;">for</span> P <span style="color: #0000FF;">in</span> np.array([[0.5, 2],
                   [2, 2],
                   [-1, 2],
                   [-2, 2],
                   [0, 0.5],
                   [0, -0.5]]):
    
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(X):
        <span style="color: #BA36A5;">X</span> = np.array(X)
        <span style="color: #0000FF;">return</span> np.linalg.norm(X - P)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">c1</span>(X):
        <span style="color: #BA36A5;">x</span>,<span style="color: #BA36A5;">y</span> = X
        <span style="color: #0000FF;">return</span> f(x) - y

    <span style="color: #BA36A5;">X</span> = fmin_cobyla(objective, x0=[P[0], f(P[0])], cons=[c1])

    <span style="color: #006FE0;">print</span>(f<span style="color: #008000;">'The minimum distance is </span>{objective(X):1.2f}<span style="color: #008000;">. Constraint satisfied = </span>{c1(X) &lt; 1e-6}<span style="color: #008000;">'</span>)

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Verify the vector to this point is normal to the tangent of the curve</span>
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector from curve to point</span>
    v1 = np.array(P) - np.array(X)
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector</span>
    v2 = np.array([1, 2.0 * X[0]])
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'dot(v1, v2) = '</span>, np.dot(v1, v2))

    x = np.linspace(-2, 2, 100)

    plt.plot(x, f(x), <span style="color: #008000;">'r-'</span>, label=<span style="color: #008000;">'f(x)'</span>)
    plt.plot(P[0], P[1], <span style="color: #008000;">'bo'</span>, label=<span style="color: #008000;">'point'</span>)
    plt.plot([P[0], X[0]], [P[1], X[1]], <span style="color: #008000;">'b-'</span>, label=<span style="color: #008000;">'shortest distance'</span>)
    plt.plot([X[0], X[0] + 1], [X[1], X[1] + 2.0 * X[0]], <span style="color: #008000;">'g-'</span>, label=<span style="color: #008000;">'tangent'</span>)
    plt.axis(<span style="color: #008000;">'equal'</span>)
    plt.xlabel(<span style="color: #008000;">'x'</span>)
    plt.ylabel(<span style="color: #008000;">'y'</span>)    
</pre>
</div>

<p>
The minimum distance is 0.86. Constraint satisfied = True
dot(v1, v2) =  0.0002913487659186309
The minimum distance is 0.00. Constraint satisfied = False
dot(v1, v2) =  0.00021460906432962284
The minimum distance is 0.39. Constraint satisfied = True
dot(v1, v2) =  0.00014271520451364372
The minimum distance is 0.00. Constraint satisfied = False
dot(v1, v2) =  -0.0004089466778209598
The minimum distance is 0.50. Constraint satisfied = True
dot(v1, v2) =  1.9999998429305957e-12
The minimum distance is 0.00. Constraint satisfied = False
dot(v1, v2) =  8.588744170160093e-06
<figure><img src="/media/f66cff16ba65526d5877bd894142fa021c51f434.png"></figure> 
</p>

<p>
So, sure enough, the optimizer is failing to find a solution that meets the constraint. It is strange it does not work on the outside. That is almost certainly an algorithm problem. Here we solve it nearly identically with the more modern <code>scipy.optimize.minimize</code> function, and it converges every time. 
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> minimize

<span style="color: #0000FF;">for</span> P <span style="color: #0000FF;">in</span> np.array([[0.5, 2],
                   [2, 2],
                   [-1, 2],
                   [-2, 2],
                   [0, 0.5],
                   [0, -0.5]]):
    
    <span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(X):
        <span style="color: #BA36A5;">X</span> = np.array(X)
        <span style="color: #0000FF;">return</span> np.linalg.norm(X - P)

    <span style="color: #0000FF;">def</span> <span style="color: #006699;">c1</span>(X):
        <span style="color: #BA36A5;">x</span>,<span style="color: #BA36A5;">y</span> = X
        <span style="color: #0000FF;">return</span> f(x) - y

    <span style="color: #BA36A5;">sol</span> = minimize(objective, x0=[P[0], f(P[0])], constraints={<span style="color: #008000;">'type'</span>: <span style="color: #008000;">'eq'</span>, <span style="color: #008000;">'fun'</span>: c1})
    X = sol.x

    <span style="color: #006FE0;">print</span>(f<span style="color: #008000;">'The minimum distance is </span>{objective(X):1.2f}<span style="color: #008000;">. Constraint satisfied = </span>{sol.status &lt; 1e-6}<span style="color: #008000;">'</span>)

    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Verify the vector to this point is normal to the tangent of the curve</span>
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector from curve to point</span>
    v1 = np.array(P) - np.array(X)
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">position vector</span>
    v2 = np.array([1, 2.0 * X[0]])
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'dot(v1, v2) = '</span>, np.dot(v1, v2))

    x = np.linspace(-2, 2, 100)

    plt.plot(x, f(x), <span style="color: #008000;">'r-'</span>, label=<span style="color: #008000;">'f(x)'</span>)
    plt.plot(P[0], P[1], <span style="color: #008000;">'bo'</span>, label=<span style="color: #008000;">'point'</span>)
    plt.plot([P[0], X[0]], [P[1], X[1]], <span style="color: #008000;">'b-'</span>, label=<span style="color: #008000;">'shortest distance'</span>)
    plt.plot([X[0], X[0] + 1], [X[1], X[1] + 2.0 * X[0]], <span style="color: #008000;">'g-'</span>, label=<span style="color: #008000;">'tangent'</span>)
    plt.axis(<span style="color: #008000;">'equal'</span>)
    plt.xlabel(<span style="color: #008000;">'x'</span>)
    plt.ylabel(<span style="color: #008000;">'y'</span>)
</pre>
</div>

<p>
The minimum distance is 0.86. Constraint satisfied = True
dot(v1, v2) =  1.0701251773603815e-08
The minimum distance is 0.55. Constraint satisfied = True
dot(v1, v2) =  -0.0005793028003104883
The minimum distance is 0.39. Constraint satisfied = True
dot(v1, v2) =  -1.869272921939391e-05
The minimum distance is 0.55. Constraint satisfied = True
dot(v1, v2) =  0.0005792953298950909
The minimum distance is 0.50. Constraint satisfied = True
dot(v1, v2) =  0.0
The minimum distance is 0.50. Constraint satisfied = True
dot(v1, v2) =  0.0
<figure><img src="/media/4776aa1f11411aa8cf0c3ea47f96e2a8973e314e.png"></figure> 
</p>

<p>
There is no wisdom in fixing the first problem, here I just tried a newer optimization method. Out of the box with default settings it just worked. I did learn the answer is sensitive to the initial guess, so it could make sense to sample the function and find the point that is closest as the initial guess, but here the simple heuristic guess I used worked fine.
</p>
<p>Copyright (C) 2023 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve.org">org-mode source</a></p>
<p>Org-mode version = 9.5.5</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2023/02/17/Update-on-finding-the-minimum-distance-from-a-point-to-a-curve">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Constrained-optimization-with-Lagrange-multipliers-and-autograd"></div>
      <h2 class="blog_post_title"><a href="/blog/2018/11/03/Constrained-optimization-with-Lagrange-multipliers-and-autograd/" rel="bookmark" title="Permanent Link to Constrained optimization with Lagrange multipliers and autograd">Constrained optimization with Lagrange multipliers and autograd</a></h2>
      <p><small><span class="blog_post_date">Posted November 03, 2018 at 09:39 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/autograd/'>autograd</a>, <a href='/blog/category/optimization/'>optimization</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Constrained optimization is common in engineering problems solving. A prototypical example (from Greenberg, Advanced Engineering Mathematics, Ch 13.7) is to find the point on a plane that is closest to the origin. The plane is defined by the equation \(2x - y + z = 3\), and we seek to minimize \(x^2 + y^2 + z^2\) subject to the equality constraint defined by the plane. <code>scipy.optimize.minimize</code> provides a pretty convenient interface to solve a problem like this, ans shown here.
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> minimize

<span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(X):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span> = X
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> x**2 + y**2 + z**2

<span style="color: #0000FF;">def</span> <span style="color: #006699;">eq</span>(X):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span> = X
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> 2 * x - y + z - 3

<span style="color: #BA36A5;">sol</span> = minimize(objective, [1, -0.5, 0.5], constraints={<span style="color: #008000;">'type'</span>: <span style="color: #008000;">'eq'</span>, <span style="color: #008000;">'fun'</span>: eq})
sol
</pre>
</div>

<pre class="example">
    fun: 1.5
    jac: array([ 2.00000001, -0.99999999,  1.00000001])
message: 'Optimization terminated successfully.'
   nfev: 5
    nit: 1
   njev: 1
 status: 0
success: True
      x: array([ 1. , -0.5,  0.5])

</pre>

<p>
I like the minimize function a lot, although I am not crazy for how the constraints are provided. The alternative used to be that there was an argument for equality constraints and another for inequality constraints. Analogous to <code>scipy.integrate.solve_ivp</code> event functions, they could have also used function attributes.
</p>

<p>
Sometimes, it might be desirable to go back to basics though, especially if you are unaware of the <code>minimize</code> function or perhaps suspect it is not working right and want an independent answer. Next we look at how to construct this constrained optimization problem using Lagrange multipliers. This converts the problem into an augmented unconstrained optimization problem we can use <code>fsolve</code> on. The gist of this method is we formulate a new problem:
</p>

<p>
\(F(X) = f(X) - \lambda g(X)\)
</p>

<p>
and then solve the simultaneous resulting equations:
</p>

<p>
\(F_x(X) = F_y(X) = F_z(X) = g(X) = 0\) where \(F_x\) is the derivative of \(f*\) with respect to \(x\), and \(g(X)\) is the equality constraint written so it is equal to zero. Since we end up with four equations that equal zero, we can simply use fsolve to get the solution. Many <a href="http://kitchingroup.cheme.cmu.edu/blog/2013/02/03/Using-Lagrange-multipliers-in-optimization/">years ago</a> I used a finite difference approximation to the derivatives. Today we use autograd to get the desired derivatives. Here it is.
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">import</span> autograd.numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> autograd <span style="color: #0000FF;">import</span> grad

<span style="color: #0000FF;">def</span> <span style="color: #006699;">F</span>(L):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">'Augmented Lagrange function'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">_lambda</span> = L
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> objective([x, y, z]) - _lambda * eq([x, y, z])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gradients of the Lagrange function</span>
<span style="color: #BA36A5;">dfdL</span> = grad(F, 0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Find L that returns all zeros in this function.</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">obj</span>(L):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">_lambda</span> = L
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dFdx</span>, <span style="color: #BA36A5;">dFdy</span>, <span style="color: #BA36A5;">dFdz</span>, <span style="color: #BA36A5;">dFdlam</span> = dfdL(L)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> [dFdx, dFdy, dFdz, eq([x, y, z])]

<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fsolve
<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">_lam</span> = fsolve(obj, [0.0, 0.0, 0.0, 1.0])
<span style="color: #0000FF;">print</span>(f<span style="color: #008000;">'The answer is at {x, y, z}'</span>)
</pre>
</div>

<pre class="example">
The answer is at (1.0, -0.5, 0.5)


</pre>

<p>
That is the same answer as before. Note we have still relied on some black box solver inside of fsolve (instead of inside minimize), but it might be more clear what problem we are solving (e.g. finding zeros). It takes a bit more work to set this up, since we have to construct the augmented function, but autograd makes it pretty convenient to set up the final objective function we want to solve.
</p>

<p>
How do we know we are at a minimum? We can check that the Hessian is positive definite in the original function we wanted to minimize. You can see here the array is positive definite, e.g. all the eigenvalues are positive. autograd makes this easy too.
</p>

<div class="org-src-container">
<pre class="src src-ipython"><span style="color: #0000FF;">from</span> autograd <span style="color: #0000FF;">import</span> hessian
<span style="color: #BA36A5;">h</span> = hessian(objective, 0)
h(np.array([x, y, z]))
</pre>
</div>

<pre class="example">
array([[ 2.,  0.,  0.],
       [ 0.,  2.,  0.],
       [ 0.,  0.,  2.]])

</pre>

<p>
In case it isn't evident from that structure that the eigenvalues are all positive, here we compute them:
</p>

<div class="org-src-container">
<pre class="src src-ipython">np.linalg.eig(h(np.array([x, y, z])))[0]
</pre>
</div>

<pre class="example">
array([ 2.,  2.,  2.])

</pre>

<p>
In summary, autograd continues to enable advanced engineering problems to be solved.
</p>
<p>Copyright (C) 2018 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2018/11/03/Constrained-optimization-with-Lagrange-multipliers-and-autograd.org">org-mode source</a></p>
<p>Org-mode version = 9.1.14</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2018/11/03/Constrained-optimization-with-Lagrange-multipliers-and-autograd">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Finding-the-maximum-power-of-a-photovoltaic-device"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/04/15/Finding-the-maximum-power-of-a-photovoltaic-device/" rel="bookmark" title="Permanent Link to Finding the maximum power of a photovoltaic device.">Finding the maximum power of a photovoltaic device.</a></h2>
      <p><small><span class="blog_post_date">Posted April 15, 2014 at 08:38 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/optimization/'>optimization</a>, <a href='/blog/category/python/'>python</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated April 04, 2016 at 11:54 AM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
A photovoltaic device is characterized by a current-voltage relationship. Let us say, for argument's sake, that the relationship is known and defined by
</p>

<p>
\(i = 0.5 - 0.5 * V^2\)
</p>

<p>
The voltage is highest when the current is equal to zero, but of course then you get no power. The current is highest when the voltage is zero, i.e. short-circuited, but there is again no power. We seek the highest power condition, which is to find the maximum of \(i V\). This is a constrained optimization. We solve it by creating an objective function that returns the negative of (\i V\), and then find the minimum.
</p>

<p>
First, let us examine the i-V relationship.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">V</span> = np.linspace(0, 1)

<span style="color: #0000FF;">def</span> <span style="color: #006699;">i</span>(V):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> 0.5 - 0.5 * V**2

plt.figure()
plt.plot(V, i(V))
plt.savefig(<span style="color: #008000;">'images/iV.png'</span>)
</pre>
</div>

<pre class="example">
&lt;matplotlib.figure.Figure object at 0x11193ec18&gt;
[&lt;matplotlib.lines.Line2D object at 0x111d43668&gt;]
</pre>


<div class="figure">
<p><img src="/media/2014-04-15-Finding-the-maximum-power-of-a-photovoltaic-device./iV.png"> 
</p>
</div>


<p>
Now, let us be sure there is a maximum in power.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">V</span> = np.linspace(0, 1)

<span style="color: #0000FF;">def</span> <span style="color: #006699;">i</span>(V):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> 0.5 - 0.5 * V**2

plt.plot(V, i(V) * V)
plt.savefig(<span style="color: #008000;">'images/P1.png'</span>)
</pre>
</div>

<pre class="example">
[&lt;matplotlib.lines.Line2D object at 0x111d437f0&gt;]
</pre>


<div class="figure">
<p><img src="/media/2014-04-15-Finding-the-maximum-power-of-a-photovoltaic-device./P1.png"> 
</p>
</div>

<p>
You can see in fact there is a maximum, near V=0.6. We could solve this problem analytically by taking the appropriate derivative and solving it for zero. That still might require solving a nonlinear problem though. We will directly setup and solve the constrained optimization.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fmin_slsqp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(X):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">i</span>, <span style="color: #BA36A5;">V</span> = X
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> - i * V

<span style="color: #0000FF;">def</span> <span style="color: #006699;">eqc</span>(X):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #036A07;">'equality constraint'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">i</span>, <span style="color: #BA36A5;">V</span> = X
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> (0.5 - 0.5 * V**2) - i

<span style="color: #BA36A5;">X0</span> = [0.2, 0.6]
<span style="color: #BA36A5;">X</span> = fmin_slsqp(objective, X0, eqcons=[eqc])

<span style="color: #BA36A5;">imax</span>, <span style="color: #BA36A5;">Vmax</span> = X


<span style="color: #BA36A5;">V</span> = np.linspace(0, 1)

<span style="color: #0000FF;">def</span> <span style="color: #006699;">i</span>(V):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> 0.5 - 0.5 * V**2

plt.plot(V, i(V), Vmax, imax, <span style="color: #008000;">'ro'</span>)
plt.savefig(<span style="color: #008000;">'images/P2.png'</span>)
</pre>
</div>

<pre class="example">
Optimization terminated successfully.    (Exit mode 0)
            Current function value: -0.192450127337
            Iterations: 5
            Function evaluations: 20
            Gradient evaluations: 5
[&lt;matplotlib.lines.Line2D object at 0x111946470&gt;, &lt;matplotlib.lines.Line2D object at 0x11192c518&gt;]
</pre>


<div class="figure">
<p><img src="/media/2014-04-15-Finding-the-maximum-power-of-a-photovoltaic-device./P2.png"> 
</p>
</div>

<p>
You can see the maximum power is approximately 0.2 (unspecified units), at the conditions indicated by the red dot in the figure above.
</p>
<p>Copyright (C) 2016 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2014/04/15/Finding-the-maximum-power-of-a-photovoltaic-device..org">org-mode source</a></p>
<p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2014/04/15/Finding-the-maximum-power-of-a-photovoltaic-device">Discuss on Twitter</a>

  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Constrained-fits-to-data"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/06/11/Constrained-fits-to-data/" rel="bookmark" title="Permanent Link to Constrained fits to data">Constrained fits to data</a></h2>
      <p><small><span class="blog_post_date">Posted June 11, 2013 at 07:39 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/data-analysis/'>data analysis</a>, <a href='/blog/category/optimization/'>optimization</a></span> | tags: 
      <p><small><span class="blog_post_date">Updated June 12, 2013 at 08:31 AM</span></small>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Our objective here is to fit a quadratic function in the least squares sense to some data, but we want to constrain the fit so that the function has specific values at the end-points. The application is to fit a function to the lattice constant of an alloy at different compositions. We constrain the fit because we know the lattice constant of the pure metals, which are at the end-points of the fit and we want these to be correct. 
</p>

<p>
We define the alloy composition in terms of the mole fraction of one species, e.g. \(A_xB_{1-x}\). For \(x=0\), the alloy is pure B, whereas for \(x=1\) the alloy is pure A. According to Vegard's law the lattice constant is a linear composition weighted average of the pure component lattice constants, but sometimes small deviations are observed. Here we will fit a quadratic function that is constrained to give the pure metal component lattice constants at the end points. 
</p>

<p>
The quadratic function is \(y = a x^2 + b x + c\). One constraint is at \(x=0\) where \(y = c\), or \(c\) is the lattice constant of pure B. The second constraint is at \(x=1\), where \(a + b + c\) is equal to the lattice constant of pure A. Thus, there is only one degree of freedom. \(c = LC_B\), and \(b = LC_A - c - a\), so \(a\) is our only variable.
</p>

<p>
We will solve this problem by minimizing the summed squared error between the fit and the data. We use the <code>fmin</code> function in <code>scipy.optimize</code>. First we create a fit function that encodes the constraints. Then we create an objective function that will be minimized. We have to make a guess about the value of \(a\) that minimizes the summed squared error. A line fits the data moderately well, so we guess a small value, i.e. near zero, for \(a\). Here is the solution.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> matplotlib.pyplot <span style="color: #8b0000;">as</span> plt

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Data to fit to</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">x=0 is pure B</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">x=1 is pure A</span>
X = np.array([0.0, 0.1,  0.25, 0.5,  0.6,  0.8,  1.0])
Y = np.array([3.9, 3.89, 3.87, 3.78, 3.75, 3.69, 3.6])

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">func</span>(a, XX):
    LC_A = 3.6
    LC_B = 3.9

    c = LC_B
    b = LC_A - c - a

    yfit = a * XX**2 + b * XX + c
    <span style="color: #8b0000;">return</span> yfit

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">objective</span>(a):
    <span style="color: #228b22;">'function to minimize'</span>
    SSE = np.sum((Y - func(a, X))**2)
    <span style="color: #8b0000;">return</span> SSE


<span style="color: #8b0000;">from</span> scipy.optimize <span style="color: #8b0000;">import</span> fmin

a_fit = fmin(objective, 0)
plt.plot(X, Y, <span style="color: #228b22;">'bo '</span>)

x = np.linspace(0, 1)
plt.plot(x, func(a_fit, x))
plt.savefig(<span style="color: #228b22;">'images/constrained-quadratic-fit.png'</span>)
</pre>
</div>

<pre class="example">
Optimization terminated successfully.
         Current function value: 0.000445
         Iterations: 19
         Function evaluations: 38
</pre>

<p>
Here is the result:
<p><img src="/img/./images/constrained-quadratic-fit.png"><p>
</p>

<p>
You can see that the end points go through the end-points as prescribed. 
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/06/11/Constrained-fits-to-data.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2013/06/11/Constrained-fits-to-data">Discuss on Twitter</a>

  <hr class="interblog" />
 <a href="/blog/category/optimization/2">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2025/01/30/New-publication-Unifying-theory-of-electronic-descriptors-of-metal-surfaces-upon-perturbation/">New publication - Unifying theory of electronic descriptors of metal surfaces upon perturbation</a></li>
      <li><a href="/blog/2025/01/29/New-publication-The-Potential-of-Zero-Total-Charge-Predicts-Cation-Effects-for-the-Oxygen-Reduction-Reaction/">New publication - The Potential of Zero Total Charge Predicts Cation Effects for the Oxygen Reduction Reaction</a></li>
      <li><a href="/blog/2025/01/28/New-publication-Investigating-the-Error-Imbalance-of-Large-Scale-Machine-Learning-Potentials-in-Catalysis/">New publication - Investigating the Error Imbalance of Large-Scale Machine Learning Potentials in Catalysis</a></li>
      <li><a href="/blog/2025/01/27/New-publication-Structure-Sensitive-Reaction-Kinetics-of-Chiral-Molecules-on-Intrinsically-Chiral-Surfaces/">New publication - Structure Sensitive Reaction Kinetics of Chiral Molecules on Intrinsically Chiral Surfaces</a></li>
      <li><a href="/blog/2024/07/04/10-years-ago-org-mode-is-awesome-video/">10 years ago - org mode is awesome video</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2025
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
 
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PH8NF4F0RE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PH8NF4F0RE');
</script>


  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



