

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: python</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications/index.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Using-YAML-in-python-for-structured-data"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/02/03/Using-YAML-in-python-for-structured-data/" rel="bookmark" title="Permanent Link to Using YAML in python for structured data">Using YAML in python for structured data</a></h2>
      <p><small><span class="blog_post_date">Posted February 03, 2014 at 09:36 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/template/'>template</a>, <a href='/blog/category/python/'>python</a>, <a href='/blog/category/yaml/'>yaml</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/02/03/Using-YAML-in-python-for-structured-data#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
<a href="http://www.yaml.org/">YAML</a> is a data format that is most text, with some indentation. It is like JSON, but without the braces. What is important here is that you can read a yaml document into a python dictionary. Here is an example of reading a yaml string so you can see the format.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> yaml
<span style="color: #8b008b;">document</span> = <span style="color: #228b22;">"""</span>
<span style="color: #228b22;">a: 1</span>
<span style="color: #228b22;">b:</span>
<span style="color: #228b22;">  c: 3</span>
<span style="color: #228b22;">  d: 4</span>
<span style="color: #228b22;">"""</span>
<span style="color: #8b0000;">print</span> yaml.load(document)
</pre>
</div>

<pre class="example">
{'a': 1, 'b': {'c': 3, 'd': 4}}
</pre>

<p>
Everything indented by the same level is grouped in its own dictionary. If we put that string into a file (<a href="/media/2014-02-03-Using-YAML-in-python-for-structured-data/test.yaml">test.yaml</a> ), we can read that in to python like this.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> yaml
<span style="color: #8b008b;">document</span> = <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'test.yaml'</span>).read()
<span style="color: #8b0000;">print</span> yaml.load(document)
</pre>
</div>

<pre class="example">
{'a': 1, 'b': {'c': 3, 'd': 4}}
</pre>

<p>
That example is pretty trivial. What I want to do is have  yaml file that represents a course syllabus. Then, if I had a set of these files, I could write code to analyze the collection of syllabi. For example, to figure out how many units of particular category there are. Alternatively, I could create different representations of the document, e.g. a pdf or html file for students or accreditation boards. Below is a YAML representtion of an ABET syllabus. It is pretty readable for a person.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> yaml
<span style="color: #8b008b;">document</span> = <span style="color: #228b22;">"""</span>
<span style="color: #228b22;">course:</span>
<span style="color: #228b22;">  course-number: 06-364</span>
<span style="color: #228b22;">  title: Chemical Reaction Engineering</span>
<span style="color: #228b22;">  units: 9</span>
<span style="color: #228b22;">  description: Fundamental concepts in the kinetic modeling of chemical reactions, the treatment and analysis of rate data. Multiple reactions and reaction mechanisms. Analysis and design of ideal and non-ideal reactor systems. Energy effects and mass transfer in reactor systems. Introductory principles in heterogeneous catalysis. </span>

<span style="color: #228b22;">  textbook: H. S. Fogler, Elements of Chemical Reaction Engineering, 4th edition, Prentice Hall, New York, 2006.</span>
<span style="color: #228b22;">  prerequisites: [06-321, 06-323, 09-347]</span>
<span style="color: #228b22;">  required: Yes</span>

<span style="color: #228b22;">  goals:</span>
<span style="color: #228b22;">    goal1: </span>
<span style="color: #228b22;">      description: To analyze kinetic data and obtain rate laws </span>
<span style="color: #228b22;">      outcomes: [a, k]</span>
<span style="color: #228b22;">      criteria: [A, F]</span>
<span style="color: #228b22;">    goal2:</span>
<span style="color: #228b22;">      description: To develop a mechanism that is consistent with an experimental rate law </span>
<span style="color: #228b22;">    goal3:</span>
<span style="color: #228b22;">      description: To understand the behavior of different reactor types when they are used either individually or in combination </span>
<span style="color: #228b22;">    goal4: </span>
<span style="color: #228b22;">      description: To choose a reactor and determine its size for a given application</span>
<span style="color: #228b22;">    goal5:</span>
<span style="color: #228b22;">      description: To work with mass and energy balances in the design of non-isothermal reactors </span>
<span style="color: #228b22;">    goal6:</span>
<span style="color: #228b22;">      description: To understand the importance of selectivity and know the strategies that are commonly used in maximizing yields</span>
<span style="color: #228b22;">    goal7:</span>
<span style="color: #228b22;">      description: To effectively use mathematical software in the design of reactors and analysis of data </span>

<span style="color: #228b22;">  topics:</span>
<span style="color: #228b22;">    - Conversion and reactor sizing</span>
<span style="color: #228b22;">    - Rate laws and stoichiometry</span>
<span style="color: #228b22;">    - Isothermal reactor design</span>
<span style="color: #228b22;">    - Collection and analysis of rate data</span>
<span style="color: #228b22;">    - Multiple reactions and selectivity</span>
<span style="color: #228b22;">    - Non-elementary reaction kinetics</span>
<span style="color: #228b22;">    - Non-isothermal reactor design</span>
<span style="color: #228b22;">    - Unsteady operation of reactors</span>
<span style="color: #228b22;">    - Catalysis and catalytic reactors</span>
<span style="color: #228b22;">"""</span>
<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'06-364.yaml'</span>, <span style="color: #228b22;">'w'</span>) <span style="color: #8b0000;">as</span> f:
    f.write(document)

<span style="color: #8b0000;">print</span> yaml.load(document)
</pre>
</div>

<pre class="example">
{'course': {'description': 'Fundamental concepts in the kinetic modeling of chemical reactions, the treatment and analysis of rate data. Multiple reactions and reaction mechanisms. Analysis and design of ideal and non-ideal reactor systems. Energy effects and mass transfer in reactor systems. Introductory principles in heterogeneous catalysis.', 'title': 'Chemical Reaction Engineering', 'prerequisites': ['06-321', '06-323', '09-347'], 'topics': ['Conversion and reactor sizing', 'Rate laws and stoichiometry', 'Isothermal reactor design', 'Collection and analysis of rate data', 'Multiple reactions and selectivity', 'Non-elementary reaction kinetics', 'Non-isothermal reactor design', 'Unsteady operation of reactors', 'Catalysis and catalytic reactors'], 'required': True, 'textbook': 'H. S. Fogler, Elements of Chemical Reaction Engineering, 4th edition, Prentice Hall, New York, 2006.', 'goals': {'goal6': {'description': 'To understand the importance of selectivity and know the strategies that are commonly used in maximizing yields'}, 'goal7': {'description': 'To effectively use mathematical software in the design of reactors and analysis of data'}, 'goal4': {'description': 'To choose a reactor and determine its size for a given application'}, 'goal5': {'description': 'To work with mass and energy balances in the design of non-isothermal reactors'}, 'goal2': {'description': 'To develop a mechanism that is consistent with an experimental rate law'}, 'goal3': {'description': 'To understand the behavior of different reactor types when they are used either individually or in combination'}, 'goal1': {'outcomes': ['a', 'k'], 'description': 'To analyze kinetic data and obtain rate laws', 'criteria': ['A', 'F']}}, 'units': 9, 'course-number': '06-364'}}
</pre>




<p>
You can see here the whole document is now stored as a dictionary. You
might ask why? I have the following interests:
</p>
<ol class="org-ol">
<li>If I have a set of these files, I could loop through them and
generate some kind of summary, e.g. total units of some category.
</li>
<li>I could generate a consistent format using a template. 
</li>
</ol>

<p>
Let us explore the template. We will generate a LaTeX document using
the Cheetah template engine (<a href="http://www.cheetahtemplate.org/">http://www.cheetahtemplate.org/</a> ). I have also used <a href="http://www.makotemplates.org/">Mako</a> , and <a href="http://jinja.pocoo.org/">jinja</a> . A
template is a fancy string that has code in that can be evaluated and
substituted at generation time. We use this to replace elements of the
template with data from our yaml document.  Below I created a template
that generates a LaTeX document.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> yaml
<span style="color: #8b0000;">from</span> Cheetah.Template <span style="color: #8b0000;">import</span> Template

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'06-364.yaml'</span>, <span style="color: #228b22;">'r'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b008b;">document</span> = yaml.load(f.read())

<span style="color: #8b008b;">data</span> = document[<span style="color: #228b22;">'course'</span>]

<span style="color: #8b008b;">template</span> = r<span style="color: #228b22;">'''\documentclass{article}</span>
<span style="color: #228b22;">\renewcommand{\abstractname}{Course Description}</span>

<span style="color: #228b22;">\begin{document}</span>
<span style="color: #228b22;">\title{$data['course-number'] $data['title']}</span>
<span style="color: #228b22;">\maketitle</span>
<span style="color: #228b22;">\begin{abstract}</span>
<span style="color: #228b22;">$data['description']</span>
<span style="color: #228b22;">\end{abstract}</span>

<span style="color: #228b22;">\textbf{Required:} $data['required']</span>

<span style="color: #228b22;">\textbf{Prerequisites:} #echo ', '.join($data['prerequisites'])</span>

<span style="color: #228b22;">{\textbf{Textbook:} $data['textbook']</span>

<span style="color: #228b22;">\section{Course goals}</span>
<span style="color: #228b22;">\begin{enumerate}</span>
<span style="color: #228b22;">#for $goal in $data['goals']</span>
<span style="color: #228b22;">\item $data['goals'][$goal]['description'] \label{$goal}</span>
<span style="color: #228b22;">#end for</span>
<span style="color: #228b22;">\end{enumerate}</span>

<span style="color: #228b22;">\section{Topics}</span>
<span style="color: #228b22;">\begin{itemize}</span>
<span style="color: #228b22;">#for $topic in $data['topics']</span>
<span style="color: #228b22;">\item $topic</span>
<span style="color: #228b22;">#end for</span>
<span style="color: #228b22;">\end{itemize}</span>
<span style="color: #228b22;">\end{document}'''</span>

<span style="color: #8b008b;">t</span> = Template(template, searchList=<span style="color: #cd0000;">locals</span>())

<span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">import sys; sys.exit()</span>
<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'06-364.tex'</span>, <span style="color: #228b22;">'w'</span>) <span style="color: #8b0000;">as</span> f:
    f.write(t.respond())
</pre>
</div>

<pre class="example">
None
</pre>

<p>
You can see the results of the tex file here: <a href="/media/2014-02-03-Using-YAML-in-python-for-structured-data/06-364.tex">06-364.tex</a> , and the
corresponding pdf here: <a href="/media/2014-02-03-Using-YAML-in-python-for-structured-data/06-364.pdf">06-364.pdf</a> . It is not spectacular by any
means, but if I had 16 of these to create, this sure would be
convenient! And if we need some other format, we just make a new template!
</p>

<p>
Some notes about this:
</p>
<ol class="org-ol">
<li>The course goals are not in the order defined in the yaml file. That is not too surprising, since dictionaries do not preserve order.
</li>
<li>Yes in yaml apparently is read in as a boolean, so in the pdf, it is printed as True.
</li>
<li>I have not thought about how to prepare a table that maps student outcomes (a-k in ABET) to the course goals
</li>
<li>It would be nice if there were links in the pdf to other syllabi, e.g. the prerequisites. See <a href="http://ctan.mirrorcatalogs.com/macros/latex/required/tools/xr.pdf">http://ctan.mirrorcatalogs.com/macros/latex/required/tools/xr.pdf</a> 
</li>
</ol>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/03/Using-YAML-in-python-for-structured-data.org">org-mode source</a><p><p>Org-mode version = 8.2.5g</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/02/03/Using-YAML-in-python-for-structured-data#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Printing-unicode-characters-in-Python-strings"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/02/02/Printing-unicode-characters-in-Python-strings/" rel="bookmark" title="Permanent Link to Printing unicode characters in Python strings">Printing unicode characters in Python strings</a></h2>
      <p><small><span class="blog_post_date">Posted February 02, 2014 at 12:18 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/unicode/'>unicode</a>, <a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/02/02/Printing-unicode-characters-in-Python-strings#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Are you tired of printing strings like this:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> <span style="color: #228b22;">'The volume is {0} Angstrom^3'</span>.<span style="color: #cd0000;">format</span>(125)
</pre>
</div>

<pre class="example">
The volume is 125 Angstrom^3
</pre>

<p>
Wish you could get Å in your string? That is the unicode character
U+212B. We can get that to print in Python, but we have to create it
in a unicode string, and print the string properly encoded. Let us try
it out.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> u<span style="color: #228b22;">'\u212B'</span>.encode(<span style="color: #228b22;">'utf-8'</span>)
</pre>
</div>

<pre class="example">
Å
</pre>

<p>
We use u'' to indicate a unicode string. Note we have to encode the
string to print it, or will get this error:
</p>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeEncodeError: 'ascii' codec can't encode character u'\u212b' in position 0: ordinal not in range(128)
</pre>

<p>
Do more, do more, we wish we could! Unicode also supports some
superscripted and subscripted numbers
(<a href="http://en.wikipedia.org/wiki/Unicode_subscripts_and_superscripts">http://en.wikipedia.org/wiki/Unicode_subscripts_and_superscripts</a> ). Let
us see that in action.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> u<span style="color: #228b22;">'\u212B\u00B3'</span>.encode(<span style="color: #228b22;">'utf-8'</span>)
</pre>
</div>

<pre class="example">
Å³
</pre>

<p>
Pretty sweet. The code is not all that readable if you aren't fluent
in unicode, but if it was buried in some library it would just print
something nice looking. We can use this to print chemical formulas
too.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> u<span style="color: #228b22;">'''The chemical formula of water is H\u2082O.</span>
<span style="color: #228b22;">Water dissociates into H\u207A and OH\u207B'''</span>.encode(<span style="color: #228b22;">'utf-8'</span>)
</pre>
</div>

<p>
=The chemical formula of water is H₂O.
Water dissociates into H⁺ and OH⁻
</p>

<p>
There are other encodings too. See the symbols here: <a href="http://en.wikipedia.org/wiki/Number_Forms">http://en.wikipedia.org/wiki/Number_Forms</a> 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> u<span style="color: #228b22;">'1/4 or \u00BC'</span>.encode(<span style="color: #228b22;">'latin-1'</span>)
</pre>
</div>

<pre class="example">
1/4 or ¼
</pre>

<p>
That seems like:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> u<span style="color: #228b22;">'A good idea\u00AE'</span>.encode(<span style="color: #228b22;">'latin-1'</span>)
</pre>
</div>

<pre class="example">
A good idea®
</pre>

<p>
I can not tell how you know exactly what encoding to use. If you use
utf-8 in the example above, you get a stray character in front of the
desired trademark symbol. Still, it is interesting you can get
prettier symbols!
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/02/02/Printing-unicode-characters-in-Python-strings.org">org-mode source</a><p><p>Org-mode version = 8.2.5g</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/02/02/Printing-unicode-characters-in-Python-strings#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Using-tags-to-filter-lists-in-Python"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/01/29/Using-tags-to-filter-lists-in-Python/" rel="bookmark" title="Permanent Link to Using tags to filter lists in Python">Using tags to filter lists in Python</a></h2>
      <p><small><span class="blog_post_date">Posted January 29, 2014 at 12:52 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/01/29/Using-tags-to-filter-lists-in-Python#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated January 29, 2014 at 12:52 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Suppose you have a collection of items in a list, and you want to filter the list based on some properties of the items, and then accumulate some other property on the filtered items. We will look at some strategies for this here.
</p>

<p>
The particular application is that I have a list of courses that make up a curriculum, and I want to summarize the curriculum in a variety of ways. For example, I might want to know how many Gen Ed courses there are, or how many math, chemistry, biology and physics courses there are. I may want to know how may units overall are required. 
</p>

<p>
A course will be represented by a class, which simply holds the data about the course. Here we consider the course number (which is really a string), the number of units of the course, and what category the course fits into. There will be 7 categories here: chemistry, biology, physics, math, engineering, general education, and free elective.
</p>

<p>
We will use some binary math to represent the categories. Essentially we define tags as if they are binary numbers, and then we can use binary operators to tell if an item is tagged a particular way. We use &amp; to do a logical AND between a variable and a TAG. If it comes out True, the variable has that tag.
</p>

<p>
This works basically by defining a TAG like a binary number, e.g. TAG1 = 100,
TAG2 = 010, TAG3 = 001. Then, if you have a number like 110, you know it is tagged with TAG1 and TAG2, but not TAG3. We can figure that out with code too. 
</p>
<pre class="example">
100 &amp; 110 = 100 = 1
010 &amp; 110 = 010 = 2
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> 1 &amp; 3
<span style="color: #8b0000;">print</span> 2 &amp; 3
</pre>
</div>

<pre class="example">
1
2
</pre>

<p>
Let us try out an example. The easiest way to define the tags, is as powers of two.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">define some tags</span>
<span style="color: #8b008b;">TAG1</span> = 2**0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">100</span>
<span style="color: #8b008b;">TAG2</span> = 2**1  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">010</span>

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now define a variable that is "tagged"</span>
<span style="color: #8b008b;">a</span> = TAG1
<span style="color: #8b0000;">print</span> a &amp; TAG1 <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">remember that 0 = False, everything else is true</span>
<span style="color: #8b0000;">print</span> a &amp; TAG2
</pre>
</div>

<pre class="example">
1
0
</pre>

<p>
We can use multiple tags by adding them together.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">define some tags</span>
<span style="color: #8b008b;">TAG1</span> = 2**0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">100</span>
<span style="color: #8b008b;">TAG2</span> = 2**1  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">010</span>
<span style="color: #8b008b;">TAG3</span> = 2**2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">001</span>

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now define a variable that is "tagged"</span>
<span style="color: #8b008b;">a</span> = TAG1 + TAG2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">1 + 2 = 3 = 110 in binary</span>
<span style="color: #8b0000;">print</span> a &amp; TAG1 
<span style="color: #8b0000;">print</span> a &amp; TAG2
<span style="color: #8b0000;">print</span> a &amp; TAG3
</pre>
</div>

<pre class="example">
1
2
0
</pre>

<p>
You can see that the variable is not tagged by TAG3, but is tagged with TAG1 and TAG2. We might want to tag an item with more than one tag.  We create groups of tags by simply adding them together. We can still check if a variable has a particular tag like we did before.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">define some tags</span>
<span style="color: #8b008b;">TAG1</span> = 2**0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">100</span>
<span style="color: #8b008b;">TAG2</span> = 2**1  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">010</span>
<span style="color: #8b008b;">TAG3</span> = 2**2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">001</span>

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now define a variable that is "tagged"</span>
<span style="color: #8b008b;">a</span> = TAG1 + TAG2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">1 + 2 = 3 = 110 in binary</span>
<span style="color: #8b0000;">print</span> a &amp; TAG1
<span style="color: #8b0000;">print</span> a &amp; TAG2
<span style="color: #8b0000;">print</span> a &amp; TAG3
</pre>
</div>

<pre class="example">
1
2
0
</pre>

<p>
It is trickier to say if a variable is tagged with a particular set of tags. Let us consider why. The binary representation of TAG1 + TAG2 is 110. The binary representation of TAG2 + TAG3 is 011. If we simply consider (TAG1 + TAG2) &amp; (TAG2 &amp; TAG3) we get 010. That actually tells us that we do not have a match, because 010 is not equal to (TAG2 &amp; TAG3 = 011). In other words, the logical AND of the tag with some sum of tags is equal to the sum of tags when there is a match. So, we can check if that is the case with an equality comparison.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">define some tags</span>
<span style="color: #8b008b;">TAG1</span> = 2**0  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">100</span>
<span style="color: #8b008b;">TAG2</span> = 2**1  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">010</span>
<span style="color: #8b008b;">TAG3</span> = 2**2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">001</span>

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Now define a variable that is "tagged"</span>
<span style="color: #8b008b;">a</span> = TAG1 + TAG2  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">1 + 2 = 3 = 110 in binary</span>
<span style="color: #8b0000;">print</span> (a &amp; (TAG1 + TAG2)) == TAG1 + TAG2
<span style="color: #8b0000;">print</span> (a &amp; (TAG1 + TAG3)) == TAG1 + TAG3
<span style="color: #8b0000;">print</span> (a &amp; (TAG2 + TAG3)) == TAG2 + TAG3
</pre>
</div>

<pre class="example">
True
False
False
</pre>

<p>
Ok, enough binary math, let us see an application. Below we create a set of tags indicating the category a course falls into, a class definition to store course data in attributes of an object, and a list of courses. Then, we show some examples of list comprehension filtering based on the tags to summarize properties of the list. The logical comparisons are simple below, as the courses are not multiply tagged at this point.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b008b;">CHEMISTRY</span> = 2**0
<span style="color: #8b008b;">BIOLOGY</span> = 2**1
<span style="color: #8b008b;">PHYSICS</span> = 2**2
<span style="color: #8b008b;">MATH</span> = 2**3
<span style="color: #8b008b;">ENGINEERING</span> = 2**4
<span style="color: #8b008b;">GENED</span> = 2**5
<span style="color: #8b008b;">FREE</span> = 2**6

<span style="color: #8b0000;">class</span> <span style="color: #4682b4;">Course</span>:
    <span style="color: #228b22;">'''simple container for course information'''</span>
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__init__</span>(<span style="color: #8b0000;">self</span>, number, units, category):
        <span style="color: #8b0000;">self</span>.number = number
        <span style="color: #8b0000;">self</span>.units = units
        <span style="color: #8b0000;">self</span>.category = category
    <span style="color: #8b0000;">def</span> <span style="color: #8b2323;">__repr__</span>(<span style="color: #8b0000;">self</span>):
        <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">self</span>.number


<span style="color: #8b008b;">courses</span> = [Course(<span style="color: #228b22;">'09-105'</span>, 9, CHEMISTRY),
           Course(<span style="color: #228b22;">'09-106'</span>, 9, CHEMISTRY),
           Course(<span style="color: #228b22;">'33-105'</span>, 12, PHYSICS),
           Course(<span style="color: #228b22;">'33-106'</span>, 12, PHYSICS),
           Course(<span style="color: #228b22;">'21-120'</span>, 10, MATH),
           Course(<span style="color: #228b22;">'21-122'</span>, 10, MATH),
           Course(<span style="color: #228b22;">'21-259'</span>, 10, MATH),
           Course(<span style="color: #228b22;">'06-100'</span>, 12, ENGINEERING),
           Course(<span style="color: #228b22;">'xx-xxx'</span>, 9, GENED),     
           Course(<span style="color: #228b22;">'xx-xxx'</span>, 9, FREE), 
           Course(<span style="color: #228b22;">'03-232'</span>, 9, BIOLOGY)]

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">print the total units</span>
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">' Total units = {0}'</span>.<span style="color: #cd0000;">format</span>(<span style="color: #cd0000;">sum</span>([x.units <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> courses]))

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">get units of math required</span>
<span style="color: #8b008b;">math_units</span> = <span style="color: #cd0000;">sum</span>([x.units  <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> courses <span style="color: #8b0000;">if</span> x.category &amp; MATH])

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">get total units of math, chemistry, physics and biology a | b is a</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">logical OR. This gives a prescription for tagged with MATH OR</span>
<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">CHEMISTRY OR PHYSICS OR BIOLOGY</span>
<span style="color: #8b008b;">BASIC_MS</span> = MATH | CHEMISTRY | PHYSICS | BIOLOGY

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">total units in those categories</span>
<span style="color: #8b008b;">basic_math_science</span> = <span style="color: #cd0000;">sum</span>([x.units <span style="color: #8b0000;">for</span> x <span style="color: #8b0000;">in</span> courses <span style="color: #8b0000;">if</span> x.category &amp; BASIC_MS])

<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'We require {0} units of math out of {1} units of basic math and science courses.'</span>.<span style="color: #cd0000;">format</span>(math_units, basic_math_science)

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">We are required to have at least 96 units of Math and Sciences.</span>
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'We are compliant on number of Math and science: '</span>,basic_math_science &gt;= 96
</pre>
</div>

<pre class="example">
 Total units = 111
We require 30 units of math out of 81 units of basic math and science courses.
We are compliant on number of Math and science:  False
</pre>

<p>
That is all for this example. With more data for each course, you could see what courses are taken in what semesters, how many units are in each semester, maybe create a prerequisite map, and view the curriculum by categories of courses, etc&#x2026;</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/01/29/Using-tags-to-filter-lists-in-Python.org">org-mode source</a><p><p>Org-mode version = 8.2.5g</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/01/29/Using-tags-to-filter-lists-in-Python#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Python-as-alternative-to-Matlab-for-engineering-calculations"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/12/30/Python-as-alternative-to-Matlab-for-engineering-calculations/" rel="bookmark" title="Permanent Link to Python as alternative to Matlab for engineering calculations">Python as alternative to Matlab for engineering calculations</a></h2>
      <p><small><span class="blog_post_date">Posted December 30, 2013 at 03:20 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/12/30/Python-as-alternative-to-Matlab-for-engineering-calculations#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated December 30, 2013 at 09:15 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. The significance of an open-source alternative</a></li>
<li><a href="#sec-2">2. Easy to install Python distributions</a></li>
<li><a href="#sec-3">3. Python + numpy/scipy/matplotlib does almost everything you need</a></li>
<li><a href="#sec-4">4. Python from the educator perspective</a></li>
<li><a href="#sec-5">5. Final thoughts</a></li>
</ul>
</div>
</div>
<p>
For the past year I have been seriously exploring whether Python could be used as a practical alternative to Matlab in engineering calculations, particularly in chemical engineering undergraduate and graduate courses. Matlab is very well suited for these calculations, and I have used it extensively in teaching in the past. For example, there is my Matlab blog (<a href="http://matlab.cheme.cmu.edu">http://matlab.cheme.cmu.edu</a> ), and my cmu Matlab package that contains a very nice units package (<a href="https://github.com/jkitchin/matlab-cmu">https://github.com/jkitchin/matlab-cmu</a> ). Matlab is widely used and recognized as a standard software package in engineering. My university has a site license for Matlab, so it doesn't cost me or my students anything to use. Matlab is easy to install, and has almost everything we need out of the box. So why try using something else then? Here are the main reasons:
</p>

<ol class="org-ol">
<li>Not everyone has access to a "free" Matlab license, and Matlab may not be available to my students when they leave the University. Python offers a free, always available option to them.
</li>
<li>There are several recent Python distributions that are easy to install, and contain almost everything we need for engineering calculations. 
</li>
<li>I have been increasingly integrating code into my lecture notes, and this is not easy with Matlab, but it is easy with Python.
</li>
<li>I use Python exclusively in my research, and although Matlab and Python are similar, they are different enough that switching between them is bothersome to me. I do not like teaching students to use tools I do not regularly use, and I believe I can provide them with more value by teaching with tools I have a high level of proficiency in. 
</li>
</ol>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> The significance of an open-source alternative</h2>
<div class="outline-text-2" id="text-1">
<p>
Many people will be able to use Matlab or some other proprietary software that someone has paid for the license to use. Some people, however, will not have that option for a variety of reasons. Maybe the company they work for will not pay for the license, maybe they are unemployed, or entrepeneurs in a small startup that cannot afford it, maybe they are students at a University without a site license,&#x2026; For these people Python is a viable option that is always available. That makes me happy.
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Easy to install Python distributions</h2>
<div class="outline-text-2" id="text-2">
<p>
An important development in using Python as an alternative to Matlab is the development of many "one-click" installers. Ten years ago it took me about 2 weeks to download and build a Python environment suitable for scientific and engineering calculations. That has kept me from trying to use Python in teaching in the past. Today, I can download a package and install one in about 10 minutes! More importantly, so can my students.
</p>

<p>
My favorite distribution is the Enthought Canopy distribution (<a href="https://www.enthought.com/products/canopy/">https://www.enthought.com/products/canopy/</a> ). This distribution comes with all the essential python modules, and an integrated editor with IPython. It is available for Windows, Macs and Linux. They offer free academic licenses.
</p>

<p>
Another good alternative is the Anaconda distribution (<a href="https://store.continuum.io/cshop/anaconda/">https://store.continuum.io/cshop/anaconda/</a> ) by Continuum Analytics. It is also available for Windows, Macs and Linux. I have not used this one, but it looks like it would be very good. Anaconda comes with the Spyder editor. They offer free academic licenses.
</p>

<p>
Python(x,y) is available for Windows (<a href="http://code.google.com/p/pythonxy/">http://code.google.com/p/pythonxy/</a> ) and comes with the Spyder editor. 
</p>

<p>
WinPython (<a href="http://winpython.sourceforge.net/">http://winpython.sourceforge.net/</a> ) is also available for Windows, and comes with the Spyder editor.
</p>

<p>
The point here is that there are many options available now that make installing a Python distribution as easy as installing packages like Matlab. Enthought Canopy also provides a "desktop environment" similar to Matlab with an editor, documentation browser, package manager and console that is pretty easy to use. 
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Python + numpy/scipy/matplotlib does almost everything you need</h2>
<div class="outline-text-2" id="text-3">
<p>
Python by itself is not suitable for typical engineering calculations. You need the numerical, scientific and plotting libraries that provide that functionality. These are provided in numpy, scipy and matplotlib, which are included in the distributions described above. 
</p>

<p>
Typical chemical engineering calculations involve one or more of the following kinds of math problems:
</p>

<ul class="org-ul">
<li><a href="http://docs.scipy.org/doc/numpy-dev/reference/routines.linalg.html">Linear algebra</a> 
</li>
<li><a href="http://docs.scipy.org/doc/scipy-dev/reference/generated/scipy.optimize.fsolve.html#scipy.optimize.fsolve">Root finding</a> (nonlinear algebra)
</li>
<li><a href="http://docs.scipy.org/doc/scipy-dev/reference/generated/scipy.optimize.leastsq.html#scipy.optimize.leastsq">linear regression</a> 
</li>
<li><a href="http://docs.scipy.org/doc/scipy-dev/reference/generated/scipy.optimize.curve_fit.html#scipy.optimize.curve_fit">Nonlinear regression</a> 
</li>
<li><a href="http://docs.scipy.org/doc/scipy-dev/reference/tutorial/integrate.html">Integration and ordinary differential equations</a> 
</li>
<li><a href="http://docs.scipy.org/doc/scipy-dev/reference/tutorial/stats.html">statistics</a> 
</li>
<li><a href="http://matplotlib.org/">plotting</a> 
</li>
</ul>

<p>
All of these are doable out of the box with the Python distributions discussed above. You can find many examples of using these, and more on my PYCSE blog (<a href="http://kitchingroup.cheme.cmu.edu">http://kitchingroup.cheme.cmu.edu</a> ) and <a href="http://kitchingroup.cheme.cmu.edu/pycse/">http://kitchingroup.cheme.cmu.edu/pycse/</a> . In short, almost every example I put in the Matlab blog has been done in Python. The only ones I did not do yet are some of the interactive graphics with the steam tables. I have not had time to work those out in detail.
</p>

<p>
I have found it convenient to augment theses with a package I wrote called pycse (<a href="https://github.com/jkitchin/pycse">https://github.com/jkitchin/pycse</a> ). 
</p>

<ul class="org-ul">
<li>an ode integrator with events similar to the one in Matlab
</li>
<li>some numerical differentiation functions
</li>
<li>linear and nonlinear regression with confidence intervals
</li>
<li>some boundary value problem solvers
</li>
<li>a publish function to convert python scripts to PDF via LaTeX
</li>
</ul>

<p>
This package is still a work in progress. Notably, there is not a really good units package in Python that works as well as my Matlab units package does. Two that come close are <a href="http://pythonhosted.org/quantities/">quantities</a> and <a href="https://pint.readthedocs.org/en/latest/">pint</a> . Both have some nuances that make them tricky for regular use, and both have some challenges in covering all the functions you might want to use them for.
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Python from the educator perspective</h2>
<div class="outline-text-2" id="text-4">
<p>
Make that my perspective. I have developed an approach to using code in my lectures where I use the code to reinforce the structure of the problems, and to analyze the solutions that result. Doing that means I need to have code to show students, and the output, and sometimes to run the code to illustrate something. I also like these examples integrated into my lecture notes, so they have the right context around them.
</p>

<p>
I have found that <a href="http://www.youtube.com/watch?v=1-dUkyn_fZA">Emacs+org-mode+python</a> allows me to easily integrate notes, equations, images, code and output in one place, and then export it to a PDF which I can annotate in class. This ensures that the code and output stay synchronized, that the code is always right where it needs to be, in the right context, and that I can annotate actual code in class, and not pseudocode. This heavily influenced my decision to use Python because it leverages what I already know and want to do. In fact, using it makes me even better at what I already know and helps me learn more about it. That makes me happy!
</p>

<p>
Not everyone will be a content developer like this, but that is what I like to do. Python makes that process fun, and worth doing for me. 
</p>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Final thoughts</h2>
<div class="outline-text-2" id="text-5">
<p>
In my opinion Python is and is becoming a more viable alternative to other packages like Matlab for scientific and engineering calculations. I have used it exclusively for about a year solving all kinds of engineering problems that I used to solve in Matlab.
</p>

<p>
Python is different, for sure. The main differences in my opinion are:
</p>
<ul class="org-ul">
<li>Python is less consistent in syntax than Matlab. For example, there are two ODE solvers in scipy with incompatible syntax. That is a result of the fact that you install a Python distribution made of packages written by many different people with different needs. 
</li>
<li>There is duplicated functionality between numpy and scipy. 
</li>
<li>Some functionality in scipy is provided by external "scikits" (<a href="http://scikits.appspot.com/">http://scikits.appspot.com/</a> ). 
</li>
<li>Support for boundary value problems and partial differential equations is not as good in Python as it is in Matlab <sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>. At the undergraduate level, this is not a big deal. It is not like the Matlab functions are that easy to use!
</li>
<li>Data regression in Python is not as complete as in Matlab.
</li>
<li>indexing in Python starts at 0, and uses [], whereas in Matlab it starts at 1 and uses ()
</li>
<li>You have to import most functions into Python. In contrast, Matlab has them all in one big namespace.
</li>
</ul>


<p>
It is certainly doable to use Python for many scientific and engineering calculations. This past Fall I took the plunge, and taught a whole core course in chemical reaction engineering using Python! It was a Master's level course with 59 graduate students in it. I have also taught a graduate elective course in Molecular Simulation using Python. I still have some polishing to do before I would teach this to undergraduates, but I think it is definitely worth trying!</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p>
It is true there are packages like FiPy (nil) for PDEs, and scikits for BVPS, (nil, nil). But these are not easily installed on all platforms, and typically require some developer experience in compiling. 
</p></div>


</div>
</div><p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/12/30/Python-as-alternative-to-Matlab-for-engineering-calculations.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/12/30/Python-as-alternative-to-Matlab-for-engineering-calculations#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Posting-articles-to-CiteULike-from-bibtex"></div>
      <h2 class="blog_post_title"><a href="/blog/2013/10/20/Posting-articles-to-CiteULike-from-bibtex/" rel="bookmark" title="Permanent Link to Posting articles to CiteULike from bibtex">Posting articles to CiteULike from bibtex</a></h2>
      <p><small><span class="blog_post_date">Posted October 20, 2013 at 03:33 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/citeulike/'>citeulike</a>, <a href='/blog/category/python/'>python</a>, <a href='/blog/category/emacs/'>emacs</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2013/10/20/Posting-articles-to-CiteULike-from-bibtex#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated October 20, 2013 at 07:35 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Doing this in emacs</a></li>
</ul>
</div>
</div>

<p>
I have been using <a href="http://www.citeulike.org/user/jkitchin">CiteULike</a> for a while now to keep a list of articles that are probably worth reading. Basically, each month I get a table of contents from many journals, and as I read through them, if an article catches my attention I add it to my CiteULike account. 
</p>

<p>
This list is not synchronized with my bibtex database however. These serve different purposes. The CiteULike list is for articles that are probably worth reading, while the bibtex file contains articles I am probably going to cite. It should be that every article in my bibtex file is on CiteULike, but not necessarily the other way around. The problem is I do not have a way to push files from my bibtex file to CiteULike easily.
</p>

<p>
CiteULike allows you to <a href="http://www.citeulike.org/profile/jkitchin/import_go">import</a> a bibtex file though. I want to explore automatically importing a bibtex file by simulating the form. We need a set of cookies to make this happen so CiteULike knows who we are. I stored my username and password in a file called citeulike.json and use them to get cookies that I save here in a pickle file. I think this cookie gives you access to your CiteULike account, so it should be kept secret.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> json, pickle, requests

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'citeulike.json'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b008b;">d</span> = json.loads(f.read())

<span style="color: #8b008b;">url</span> = <span style="color: #228b22;">'http://www.citeulike.org/login.do'</span>

<span style="color: #8b008b;">data</span> = <span style="color: #228b22;">"username={0}&amp;password={1}&amp;perm=1"</span>.<span style="color: #cd0000;">format</span>(d[<span style="color: #228b22;">'username'</span>], d[<span style="color: #228b22;">'password'</span>])

<span style="color: #8b008b;">r</span> = requests.post(url, data=data, allow_redirects=<span style="color: #cd0000;">False</span>)

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'cookies.pckl'</span>, <span style="color: #228b22;">'wb'</span>) <span style="color: #8b0000;">as</span> f:
    pickle.dump(r.cookies, f)
</pre>
</div>

<p>
By inspecting the <a href="http://www.citeulike.org/profile/jkitchin/import_go">import</a> page with Firebug, I constructed this http request to upload a bibtex string.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> pickle, requests

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">reload cookies</span>
<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'cookies.pckl'</span>, <span style="color: #228b22;">'rb'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b008b;">cookies</span> = pickle.load(f)

<span style="color: #8b008b;">url</span> = <span style="color: #228b22;">'http://www.citeulike.org/profile/jkitchin/import_do'</span>

<span style="color: #8b008b;">bibtex</span> = <span style="color: #228b22;">'''</span>
<span style="color: #228b22;">@article{zhuo-2010-co2-induc,</span>
<span style="color: #228b22;">  author =       {Zhuo, Shengchi and Huang, Yongmin and Peng, Changjun</span>
<span style="color: #228b22;">                  and Liu, Honglai and Hu, Ying and Jiang, Jianwen},</span>
<span style="color: #228b22;">  title =        {CO2-Induced Microstructure Transition of Surfactant</span>
<span style="color: #228b22;">                  in Aqueous Solution: Insight from Molecular Dynamics</span>
<span style="color: #228b22;">                  Simulation},</span>
<span style="color: #228b22;">  journal =      {The Journal of Physical Chemistry B},</span>
<span style="color: #228b22;">  volume =       114,</span>
<span style="color: #228b22;">  number =       19,</span>
<span style="color: #228b22;">  pages =        {6344-6349},</span>
<span style="color: #228b22;">  year =         2010,</span>
<span style="color: #228b22;">  doi =          {10.1021/jp910253b},</span>
<span style="color: #228b22;">  URL =          {http://pubs.acs.org/doi/abs/10.1021/jp910253b},</span>
<span style="color: #228b22;">  eprint =       {http://pubs.acs.org/doi/pdf/10.1021/jp910253b}</span>
<span style="color: #228b22;">}'''</span>

<span style="color: #8b008b;">data</span> = {<span style="color: #228b22;">'pasted'</span>:bibtex,
        <span style="color: #228b22;">'to_read'</span>:2,
        <span style="color: #228b22;">'tag_parsing'</span>:<span style="color: #228b22;">'simple'</span>,
        <span style="color: #228b22;">'strip_brackets'</span>:<span style="color: #228b22;">'no'</span>,
        <span style="color: #228b22;">'update_id'</span>:<span style="color: #228b22;">'bib-key'</span>,
        <span style="color: #228b22;">'btn_bibtex'</span>:<span style="color: #228b22;">'Import BibTeX file ...'</span>}

<span style="color: #8b008b;">headers</span> = {<span style="color: #228b22;">'content-type'</span>: <span style="color: #228b22;">'multipart/form-data'</span>,
           <span style="color: #228b22;">'User-Agent'</span>:<span style="color: #228b22;">'jkitchin/johnrkitchin@gmail.com bibtexupload'</span>}

<span style="color: #8b008b;">r</span> = requests.post(url, headers=headers, data=data, cookies=cookies, files={})
</pre>
</div>

<p>
The result is that article is now listed in my CiteULike at <a href="http://www.citeulike.org/user/jkitchin/article/12728895">http://www.citeulike.org/user/jkitchin/article/12728895</a> .  This opens the possibility of integrating this into my bibtex workflow. I could implement this in emacs-lisp, and have it automatically upload new entries in the bibtex file to CiteULike. 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Doing this in emacs</h2>
<div class="outline-text-2" id="text-1">
<p>
I think the easiest thing to do here is to write a python script that takes the bibtex string and posts it. We will use emacs to get the bibtex string. We will use the example at  <a href="http://ergoemacs.org/emacs/elisp_perl_wrapper.html">http://ergoemacs.org/emacs/elisp_perl_wrapper.html</a> to put this together. This example uses an external script that takes a string on stdin, and returns a result on stdout.
</p>

<p>
We will run the function in a bibtex buffer. We will narrow the buffer to the current entry, and use that to define the boundaries of the string. We do the command in a temp-buffer to prevent it from modifying our bibtex file. There is some way to make the command not do this with optional arguments, but I did not figure it out. It is a little ugly I had to use an absolute path below. An alternative would be to put the script into a directory on your path. Here is the function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">j/upload-bibtex-entry-to-citeulike</span> ()
  <span style="color: #228b22;">"get bibtex string and submit to citeulike"</span>
  (interactive)
  (<span style="color: #8b0000;">save-restriction</span>
    (bibtex-narrow-to-entry)
    (<span style="color: #8b0000;">let</span> ((startpos (point-min))
          (endpos (point-max))
          (bibtex-string (buffer-string))
          (script <span style="color: #228b22;">"python c:/Users/jkitchin/Dropbox/blogofile-jkitchin.github.com/_blog/upload_bibtex_citeulike.py"</span>))
      (<span style="color: #8b0000;">with-temp-buffer</span> (insert bibtex-string)
                        (shell-command-on-region (point-min) (point-max) script t nil nil t)))))
</pre>
</div>

<p>
Now, let us define the python script.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">!python</span>
<span style="color: #8b0000;">import</span> pickle, requests, sys

<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">reload cookies</span>
<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'c:/Users/jkitchin/Dropbox/blogofile-jkitchin.github.com/_blog/cookies.pckl'</span>, <span style="color: #228b22;">'rb'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b008b;">cookies</span> = pickle.load(f)

<span style="color: #8b008b;">url</span> = <span style="color: #228b22;">'http://www.citeulike.org/profile/jkitchin/import_do'</span>

<span style="color: #8b008b;">bibtex</span> = sys.stdin.read()

<span style="color: #8b008b;">data</span> = {<span style="color: #228b22;">'pasted'</span>:bibtex,
        <span style="color: #228b22;">'to_read'</span>:2,
        <span style="color: #228b22;">'tag_parsing'</span>:<span style="color: #228b22;">'simple'</span>,
        <span style="color: #228b22;">'strip_brackets'</span>:<span style="color: #228b22;">'no'</span>,
        <span style="color: #228b22;">'update_id'</span>:<span style="color: #228b22;">'bib-key'</span>,
        <span style="color: #228b22;">'btn_bibtex'</span>:<span style="color: #228b22;">'Import BibTeX file ...'</span>}

<span style="color: #8b008b;">headers</span> = {<span style="color: #228b22;">'content-type'</span>: <span style="color: #228b22;">'multipart/form-data'</span>,
           <span style="color: #228b22;">'User-Agent'</span>:<span style="color: #228b22;">'jkitchin/johnrkitchin@gmail.com bibtexupload'</span>}

<span style="color: #8b008b;">r</span> = requests.post(url, headers=headers, data=data, cookies=cookies, files={})
</pre>
</div>

<p>
That is it. Now, in my bibtex file with the cursor in an entry, I type M-x j/upload-bibtex-entry-to-citeulike, and a few seconds later the entry has been uploaded! 
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/10/20/Posting-articles-to-CiteULike-from-bibtex.org">org-mode source</a><p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2013/10/20/Posting-articles-to-CiteULike-from-bibtex#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/category/python/9">« Previous Page</a>
  --  
 <a href="/blog/category/python/11">Next Page »</a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2017/01/31/New-publication-in-J-Phys-Chem-C/">New publication in J. Phys. Chem. C</a></li>
      <li><a href="/blog/2017/01/29/ob-ipython-and-inline-figures-in-org-mode/">ob-ipython and inline figures in org-mode</a></li>
      <li><a href="/blog/2017/01/21/Exporting-org-mode-to-Jupyter-notebooks/">Exporting org-mode to Jupyter notebooks</a></li>
      <li><a href="/blog/2017/01/16/A-simple-emacs-lisp-interface-to-CRUD-operations-in-mongodb/">A simple emacs-lisp interface to CRUD operations in mongodb</a></li>
      <li><a href="/blog/2017/01/15/Querying-a-MongoDB-bibtex-database-with-Python-and-emacs-lisp/">Querying a MongoDB bibtex database with Python and emacs-lisp</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2017
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



