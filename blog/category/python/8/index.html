

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: python</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>
      <li><a href="/group.html">Group</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Making-org-mode-Python-sessions-look-better"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/03/12/Making-org-mode-Python-sessions-look-better/" rel="bookmark" title="Permanent Link to Making org-mode Python sessions look better">Making org-mode Python sessions look better</a></h2>
      <p><small><span class="blog_post_date">Posted March 12, 2015 at 10:45 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/03/12/Making-org-mode-Python-sessions-look-better#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated March 12, 2015 at 06:58 PM</span>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
Using sessions for python in org-mode has always bugged me a little bit. Mostly the appearance of &gt;&gt;&gt; and &#x2026; in the output. For example:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">print</span> 8
</pre>
</div>

<pre class="example">
&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 8
</pre>

<p>
Today on the org-mode mailing list someone suggested a <a href="http://thread.gmane.org/gmane.emacs.orgmode/95980/focus=96011">patch</a> that might fix that up. Hopefully that patch makes it into org-mode, but if you run off of ELPA like I do it will be some time before it appears in your working version.
</p>

<p>
In the meantime, inspired by my <a href="http://kitchingroup.cheme.cmu.edu/blog/2015/03/11/Updating-Multiple-RESULTS-blocks-in-org-mode/">recent post</a> on updating multiple results, here we add a new hook function that removes these annoying characters from a Python session results section. Here is my version of this code.
"^: &gt;&gt;&gt;$"
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-babel-python-strip-session-chars</span> ()
  <span style="color: #036A07;">"Remove &gt;&gt;&gt; and ... from a Python session output."</span>
  (<span style="color: #0000FF;">when</span> (and (string=
              <span style="color: #008000;">"python"</span>
              (org-element-property <span style="color: #006FE0;">:language</span> (org-element-at-point)))
             (string-match
              <span style="color: #008000;">":session"</span>
              (org-element-property <span style="color: #006FE0;">:parameters</span> (org-element-at-point))))

    (<span style="color: #0000FF;">save-excursion</span>
      (<span style="color: #0000FF;">when</span> (org-babel-where-is-src-block-result)
        (goto-char (org-babel-where-is-src-block-result))
        (end-of-line 1)
        <span style="color: #8D8D84;">;</span><span style="color: #8D8D84; font-style: italic;">(while (looking-at "[\n\r\t\f ]") (forward-char 1))</span>
        (<span style="color: #0000FF;">while</span> (re-search-forward
                <span style="color: #008000;">"</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">(</span><span style="color: #008000;">&gt;&gt;&gt; </span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">\\.\\.\\. </span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">: $</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">: &gt;&gt;&gt;$</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">)</span><span style="color: #008000;">"</span>
                (org-element-property <span style="color: #006FE0;">:end</span> (org-element-at-point))
                t)
          (replace-match <span style="color: #008000;">""</span>)
          <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">this enables us to get rid of blank lines and blank : &gt;&gt;&gt;</span>
          (beginning-of-line)
          (<span style="color: #0000FF;">when</span> (looking-at <span style="color: #008000;">"^$"</span>)
            (kill-line)))))))

(add-hook 'org-babel-after-execute-hook 'org-babel-python-strip-session-chars)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">org-babel-python-strip-session-chars</td>
<td class="left">(lambda nil (org-refresh-images))</td>
</tr>
</tbody>
</table>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot([3, 4, 5])
plt.show()

<span style="color: #0000FF;">def</span> <span style="color: #006699;">f</span>(s):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span> = 2 * s
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">blank lines look like indentation errors</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> x

<span style="color: #0000FF;">print</span> f(4)
</pre>
</div>

<pre class="example">
[&lt;matplotlib.lines.Line2D object at 0x10955c290&gt;]
8
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">print</span> f(9)
</pre>
</div>

<pre class="example">
18
</pre>

<p>
Here we can make an inline figure.
</p>
<div class="org-src-container">

<pre class="src src-python">plt.figure()
plt.plot([3, 4.5, 5])
plt.savefig(<span style="color: #008000;">'images/session-fig.png'</span>)
<span style="color: #008000;">'images/session-fig.png'</span>
</pre>
</div>

<p>
<img src="/media/2015-03-12-Making-org-mode-Python-sessions-look-better/session-fig.png"> 
Not bad. It seems to work! Maybe this will make sessions more usable for me.
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2015-03-12 Thu]</span></span> New corner case, do not cause an error when results are silenced.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">print</span> 6
</pre>
</div>


<p>
Testing getting rid of blank lines and empty : &gt;&gt;&gt; lines.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">a</span> = 2
<span style="color: #BA36A5;">b</span> = 3
<span style="color: #BA36A5;">c</span> = 4
<span style="color: #0000FF;">print</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'a=      '</span>, a
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'b =     '</span>, b
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'a + b = '</span>, a+b
</pre>
</div>

<pre class="example">
a=       2
b =      3
a + b =  5
</pre>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/03/12/Making-org-mode-Python-sessions-look-better.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/03/12/Making-org-mode-Python-sessions-look-better#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Equation-of-a-plane-through-three-points"></div>
      <h2 class="blog_post_title"><a href="/blog/2015/01/18/Equation-of-a-plane-through-three-points/" rel="bookmark" title="Permanent Link to Equation of a plane through three points">Equation of a plane through three points</a></h2>
      <p><small><span class="blog_post_date">Posted January 18, 2015 at 10:48 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2015/01/18/Equation-of-a-plane-through-three-points#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
We are given three points, and we seek the equation of the plane that goes through them. The method is straight forward. A plane is defined by the equation:
</p>

<p>
\(a x + b y + c z = d\)
</p>

<p>
and we just need the coefficients. The \(a, b, c\) coefficients are obtained from a vector normal to the plane, and \(d\) is calculated separately. We get the normal vector from the cross-product of two vectors connecting the points, and we get \(d\) from the dot product of the normal vector with any one of the point position vectors.
</p>

<p>
Finally, given the equation, we want to generate a mesh that samples the plane, and plot the mesh and original points to verify the plane goes through the points. Here is the implementation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">p1</span> = np.array([1, 2, 3])
<span style="color: #BA36A5;">p2</span> = np.array([4, 6, 9])
<span style="color: #BA36A5;">p3</span> = np.array([12, 11, 9])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">These two vectors are in the plane</span>
<span style="color: #BA36A5;">v1</span> = p3 - p1
<span style="color: #BA36A5;">v2</span> = p2 - p1

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the cross product is a vector normal to the plane</span>
<span style="color: #BA36A5;">cp</span> = np.cross(v1, v2)
<span style="color: #BA36A5;">a</span>, <span style="color: #BA36A5;">b</span>, <span style="color: #BA36A5;">c</span> = cp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">This evaluates a * x3 + b * y3 + c * z3 which equals d</span>
<span style="color: #BA36A5;">d</span> = np.dot(cp, p3)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The equation is {0}x + {1}y + {2}z = {3}'</span>.<span style="color: #006FE0;">format</span>(a, b, c, d))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> mpl_toolkits.mplot3d <span style="color: #0000FF;">import</span> Axes3D
<span style="color: #BA36A5;">fig</span> = plt.figure()
<span style="color: #BA36A5;">ax</span> = fig.add_subplot(111, projection=<span style="color: #008000;">'3d'</span>)

<span style="color: #BA36A5;">x</span> = np.linspace(-2, 14, 5)
<span style="color: #BA36A5;">y</span> = np.linspace(-2, 14, 5)
<span style="color: #BA36A5;">X</span>, <span style="color: #BA36A5;">Y</span> = np.meshgrid(x, y)

<span style="color: #BA36A5;">Z</span> = (d - a * X - b * Y) / c

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the mesh. Each array is 2D, so we flatten them to 1D arrays</span>
ax.plot(X.flatten(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Y.flatten(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Z.flatten(), <span style="color: #008000;">'bo '</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the original points. We use zip to get 1D lists of x, y and z</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">coordinates.</span>
ax.plot(*<span style="color: #006FE0;">zip</span>(p1, p2, p3), color=<span style="color: #008000;">'r'</span>, linestyle=<span style="color: #008000;">' '</span>, marker=<span style="color: #008000;">'o'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">adjust the view so we can see the point/plane alignment</span>
ax.view_init(0, 22)
plt.tight_layout()
plt.savefig(<span style="color: #008000;">'images/plane.png'</span>)
plt.show()
</pre>
</div>

<pre class="example">
The equation is 30x + -48y + 17z = -15
</pre>

<p>
<img src="/media/2015-01-18-Equation-of-a-plane-through-three-points/plane.png"> 
It looks like the blue points form a plane that contains the red points.
</p>
<p>Copyright (C) 2015 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2015/01/18/Equation-of-a-plane-through-three-points.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2015/01/18/Equation-of-a-plane-through-three-points#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Building-atomic-clusters-in-ase"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/22/Building-atomic-clusters-in-ase/" rel="bookmark" title="Permanent Link to Building atomic clusters in ase">Building atomic clusters in ase</a></h2>
      <p><small><span class="blog_post_date">Posted December 22, 2014 at 08:55 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/ase/'>ase</a>, <a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/22/Building-atomic-clusters-in-ase#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
I was perusing the <a href="https://wiki.fysik.dtu.dk/ase/epydoc/">ase</a> codebase, and came across the <a href="https://wiki.fysik.dtu.dk/ase/epydoc/ase.cluster-module.html">cluster module</a> . This does not seem to be documented in the main docs, so here are some examples of using it. The module provides some functions to make atomic clusters for simulations.
</p>

<p>
Below I show some typical usage. First, we look at an icosahedron with three shells.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.icosahedron <span style="color: #8b0000;">import</span> Icosahedron
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = Icosahedron(<span style="color: #228b22;">'Au'</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">noshells</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">3</span>)
<span style="color: #8b0000;">print</span> atoms

write(<span style="color: #228b22;">'images/Au-icosahedron-3.png'</span>, atoms)
</pre>
</div>

<pre class="example">
Atoms(symbols='Au55', positions=..., tags=..., cell=[9.816495585723144, 9.816495585723144, 9.816495585723144], pbc=[False, False, False])
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/Au-icosahedron-3.png"> 
</p>
</div>

<p>
Even with only three shells, there are already 55 atoms in this cluster!
</p>


<p>
How about a decahedron? There are more parameters to set here. I am not sure what the depth of the Marks re-entrance is.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.decahedron <span style="color: #8b0000;">import</span> Decahedron
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = Decahedron(<span style="color: #228b22;">'Pt'</span>,
                   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">p</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>,  <span style="color: #ff0000; font-weight: bold;"># natoms on 100 face normal to 5-fold axis</span>
                   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">q</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">2</span>,  <span style="color: #ff0000; font-weight: bold;"># natoms 0n 100 parallel to 5-fold axis</span>
                   <span style="color: #000000; background-color: #cccccc; font-weight: bold;">r</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>)  <span style="color: #ff0000; font-weight: bold;"># depth of the Marks re-entrance?</span>

<span style="color: #8b0000;">print</span>(<span style="color: #228b22;">'#atoms = {}'</span>.format<span style="color: #cd0000;">(len</span>(atoms)))

write(<span style="color: #228b22;">'images/decahedron.png'</span>, atoms)
</pre>
</div>

<pre class="example">
#atoms = 156
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/decahedron.png"> 
</p>
</div>

<p>
You can see the 5-fold symmetry here. We can make octahedra too. Here, the length is the number of atoms on the edge.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.octahedron <span style="color: #8b0000;">import</span> Octahedron
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = Octahedron(<span style="color: #228b22;">'Cu'</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">length</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>)
<span style="color: #8b0000;">print</span> atoms
write(<span style="color: #228b22;">'images/octahedron.png'</span>, atoms)
</pre>
</div>

<pre class="example">
Cluster(symbols='Cu85', positions=..., cell=[14.44, 14.44, 14.44], pbc=[False, False, False])
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/octahedron.png"> 
</p>
</div>

<p>
Finally, we can make particles based on a Wulff construction! We provide a list of surfaces, and their surface energies, with an approximate size we want, the structure to make the particle in, and what to do if there is not an exact number of atoms matching our size. We choose to round below here, so that the particle is not bigger than our size. In this example I totally made up the surface energies, with (100) as the lowest, so the particle comes out looking like a cube.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase.cluster.wulff <span style="color: #8b0000;">import</span> wulff_construction
<span style="color: #8b0000;">from</span> ase.io <span style="color: #8b0000;">import</span> write

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">atoms</span> = wulff_construction(<span style="color: #228b22;">'Pd'</span>,
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">surfaces</span>=[(<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>),
                                     (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>),
                                     (<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>)],
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">energies</span>=[<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">5</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>.<span style="color: #000000; background-color: #cccccc; font-weight: bold;">15</span>],
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">size</span>=<span style="color: #000000; background-color: #cccccc; font-weight: bold;">100</span>,
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">structure</span>=<span style="color: #228b22;">'fcc'</span>,
                           <span style="color: #000000; background-color: #cccccc; font-weight: bold;">rounding</span>=<span style="color: #228b22;">'below'</span>)

<span style="color: #8b0000;">print</span> atoms
write(<span style="color: #228b22;">'images/wulff.png'</span>, atoms)
</pre>
</div>
<pre class="example">
Cluster(symbols='Pd63', positions=..., cell=[7.779999999999999, 7.779999999999999, 7.779999999999999], pbc=[False, False, False])
</pre>


<div class="figure">
<p><img src="/media/2014-12-22-Building-atomic-clusters-in-ase/wulff.png"> 
</p>
</div>

<p>
This is one handy module, if you need to make clusters for some kind of simulation!</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/22/Building-atomic-clusters-in-ase.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/12/22/Building-atomic-clusters-in-ase#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="Capturing-stderr-from-Python-in-org-mode-take-2"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/21/Capturing-stderr-from-Python-in-org-mode-take-2/" rel="bookmark" title="Permanent Link to Capturing stderr from Python in org-mode - take 2">Capturing stderr from Python in org-mode - take 2</a></h2>
      <p><small><span class="blog_post_date">Posted December 21, 2014 at 11:46 AM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/orgmode/'>orgmode</a>, <a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/21/Capturing-stderr-from-Python-in-org-mode-take-2#disqus_thread">View Comments</a>
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
In a previous <a href="http://kitchingroup.cheme.cmu.edu/blog/2013/09/27/Capturing-stderr-and-exceptions-from-python-in-org-mode/">post</a> I wrote about a sandbox module to help capture stderr in Python code blocks in org-mode. That module worked, but ran as a script. 
</p>

<p>
stderr is not captured in the output of a code block in org-mode. For example:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys
<span style="color: #8b0000;">print</span> &gt;&gt;sys.stdout, <span style="color: #228b22;">"message on stdout"</span>
<span style="color: #8b0000;">print</span> &gt;&gt;sys.stderr, <span style="color: #228b22;">"testing stderr"</span>
</pre>
</div>

<pre class="example">
message on stdout
</pre>

<p>
The messages to stderr just disappears. Not good for code like this:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
[[ 1.]
 [ 1.]]
</pre>

<p>
There is an error in that code, k is not defined. If you run that as a script, you get this output:
</p>
<pre class="example">
&gt;&gt;&gt; Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "/var/folders/5q/lllv2yf95hg_n6h6kjttbmdw0000gn/T//python-69413hLF.py", line 4, in ode
    return -k * x
NameError: global name 'k' is not defined
</pre>

<p>
But, that is evidently going to stderr, and not getting captured in org-mode. Boo. A silent error that returns a value! This behavior of odeint may be <a href="https://github.com/scipy/scipy/pull/4052">fixed</a> in scipy 0.15, but it is a general deficiency of org-mode babel code blocks. So, today I am looking back into a way to fix it. We try something as mundane as just redefining stderr in Python at runtime.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sys.stderr</span> = sys.stdout

<span style="color: #8b0000;">print</span> &gt;&gt;sys.stdout, <span style="color: #228b22;">"message on stdout"</span>
<span style="color: #8b0000;">print</span> &gt;&gt;sys.stderr, <span style="color: #228b22;">"testing stderr"</span>
</pre>
</div>

<pre class="example">
message on stdout
testing stderr
</pre>

<p>
That works fine. Let us test it with the other block.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> sys
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sys.stderr</span> = sys.stdout

<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 6, in ode
NameError: global name 'k' is not defined
[[ 1.]
 [ 1.]]
</pre>

<p>
Sweet, we get the errors. We still get the returned value, but it is immediately obvious something is wrong. I have wrapped that little tidbit into a Python module in <a href="https://github.com/jkitchin/pycse/blob/master/pycse/orgmode.py">pycse.orgmode</a> , which you can import to get the same effect.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> pycse.orgmode

<span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined

[[ 1.]
 [ 1.]]
</pre>

<p>
Finally, you can avoid the import by setting your org-babel Python command like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-babel-python-command <span style="color: #228b22;">"python -i -c \"import pycse.orgmode\""</span>)
</pre>
</div>

<pre class="example">
python -i -c "import pycse.orgmode"
</pre>

<p>
Now, we run our faulty block again:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> scipy.integrate <span style="color: #8b0000;">import</span> odeint

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">ode</span>(y, x):
    <span style="color: #8b0000;">return</span> -k * x

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">xspan</span> = [<span style="color: #000000; background-color: #cccccc; font-weight: bold;">0</span>, <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>]
<span style="color: #000000; background-color: #cccccc; font-weight: bold;">y0</span> = <span style="color: #000000; background-color: #cccccc; font-weight: bold;">1</span>

<span style="color: #000000; background-color: #cccccc; font-weight: bold;">sol</span> = odeint(ode, y0, xspan)
<span style="color: #8b0000;">print</span> sol
</pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in ode
NameError: global name 'k' is not defined

[[ 1.]
 [ 1.]]
</pre>

<p>
Excellent. The stderr is captured.
</p>

<p>
And we get basically the same output as before for regular code blocks. There is an extra line before and after the output for some reason. I can live with that!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> <span style="color: #000000; background-color: #cccccc; font-weight: bold;">6</span> + <span style="color: #000000; background-color: #cccccc; font-weight: bold;">7</span>
</pre>
</div>

<pre class="example">
13
</pre>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/21/Capturing-stderr-from-Python-in-org-mode---take-2.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/12/21/Capturing-stderr-from-Python-in-org-mode-take-2#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  





<article>
  <div class="blog_post">
    <header>
      <div id="A-new-mode-for-Python-documentation"></div>
      <h2 class="blog_post_title"><a href="/blog/2014/12/20/A-new-mode-for-Python-documentation/" rel="bookmark" title="Permanent Link to A new mode for Python documentation">A new mode for Python documentation</a></h2>
      <p><small><span class="blog_post_date">Posted December 20, 2014 at 03:02 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/emacs/'>emacs</a>, <a href='/blog/category/python/'>python</a></span> | tags: 
        | <a href="http://jkitchin.github.io/blog/2014/12/20/A-new-mode-for-Python-documentation#disqus_thread">View Comments</a>
      <p><small><span class="blog_post_date">Updated December 22, 2014 at 10:12 AM</span>
      </small></p>
    </header>
    <div class="post_prose">
      




<p>
<span class="timestamp-wrapper"><span class="timestamp">[2014-12-22 Mon]</span></span> update: See this in action at <a href="http://www.youtube.com/watch?v=G_r7wTcVK54">http://www.youtube.com/watch?v=G_r7wTcVK54</a> , and see the latest source at <a href="https://github.com/jkitchin/jmax/blob/master/pydoc.el">https://github.com/jkitchin/jmax/blob/master/pydoc.el</a> .
</p>

<p>
The emacs-lisp documentation in Emacs is inspiring. It is interlinked, you can click on links to open source files, other commands, etc&#x2026; Python documentation is not that nice. It should be.
</p>

<p>
I wrote a little pydoc function:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc</span> (name)
  <span style="color: #228b22;">"Display pydoc information for NAME in a buffer named *pydoc*."</span>
  (interactive <span style="color: #228b22;">"sName of function or module: "</span>)
  (switch-to-buffer-other-window <span style="color: #228b22;">"*pydoc*"</span>)
  (erase-buffer)
  (insert (shell-command-to-string (format <span style="color: #228b22;">"python -m pydoc %s"</span> name)))
  (goto-char (point-min)))
</pre>
</div>

<p>
which at least accesses python documentation in emacs. It looks like this:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-jasp.png"> 
</p>
</div>

<p>
But, this lacks functionality. I want there to be useful links in this, so I can click on the filename to open the source, or click on the packages to get their documentation. Below, we walk through a few functions that will operate on the buffer and put text properties on different pieces.
</p>

<p>
First, let us make the source file clickable so it opens the source.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-file-link</span> ()
  <span style="color: #228b22;">"Find FILE in a pydoc buffer and make it a clickable link"</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^FILE</span>
<span style="color: #228b22;">    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">.*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">$"</span> nil t)

    (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
          (start (match-beginning 1))
          (end (match-end 1))
          (source-file (match-string 1)))
      
      ;; <span style="color: #ff0000; font-weight: bold;">set file to be clickable to open the source</span>
      (define-key map [mouse-1]
        `(<span style="color: #8b0000;">lambda</span> ()
          (interactive)
          (find-file ,source-file)))

      (set-text-properties
       start end
       `(local-map, map
                   font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                   mouse-face highlight
                   help-echo <span style="color: #228b22;">"mouse-1: click to open"</span>)))))
</pre>
</div>

<pre class="example">
pydoc-make-file-link
</pre>

<p>
Next, sometimes there are URLs in the python documentation. These should all open up in a browser when you click on them. Here we propertize anything we recognize as a URL to make it open when clicked on.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-url-links</span> ()
  (goto-char (point-min))
  (<span style="color: #8b0000;">while</span> (re-search-forward <span style="color: #228b22;">"</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">http</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">s</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">?://.*$</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">"</span> nil t)
    (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
          (start (match-beginning 1))
          (end (match-end 1)))
        
      (define-key map [mouse-1]
        `(<span style="color: #8b0000;">lambda</span> ()
          (interactive)
          (browse-url ,(buffer-substring start end))))
        
      (set-text-properties
       start end
       `(local-map ,map
                   font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                   mouse-face highlight
                   help-echo (format <span style="color: #228b22;">"mouse-1: click to open"</span>))))))
</pre>
</div>

<p>
When we get documentation for a package, we should make each entry of the package clickable, so we can get to the documentation for that package easily. We store the name of the current package so we can construct the path to the subpackage.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-get-name</span> ()
  <span style="color: #228b22;">"get NAME and store locally"</span>
  (make-variable-buffer-local 'pydoc-name)
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^NAME</span>
<span style="color: #228b22;">\\s-*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">-][a-zA-Z]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">"</span> nil t)
    (setq pydoc-name (match-string 1))))


(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-make-package-links</span> ()
  <span style="color: #228b22;">"make links in PACKAGE CONTENTS"</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^PACKAGE CONTENTS"</span> nil t)
    (forward-line)

    (<span style="color: #8b0000;">while</span> (string-match
            <span style="color: #228b22;">"^    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[a-zA-Z0-9_]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">[ ]?</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">(package)</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">?"</span>
            (buffer-substring
             (line-beginning-position)
             (line-end-position)))
                
      (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap))
            (start (match-beginning 1))
            (end (match-end 1))
            (package (concat
                      pydoc-name <span style="color: #228b22;">"."</span>
                      (match-string 1
                                    (buffer-substring
                                     (line-beginning-position)
                                     (line-end-position))))))
        
        (define-key map [mouse-1]
          `(<span style="color: #8b0000;">lambda</span> ()
            (interactive)
            (pydoc ,package)))
          
        (set-text-properties
         (+ (line-beginning-position) start)
         (+ (line-beginning-position) end)
         `(local-map, map
                      font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                      mouse-face highlight
                      help-echo (format <span style="color: #228b22;">"mouse-1: click to open %s"</span> ,package))))
      (forward-line))))
</pre>
</div>

<p>
Next, we put some eye candy on function names and arguments. This won't do anything functionally, but it breaks up the monotony of all black text.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-colorize-functions</span> ()
  <span style="color: #228b22;">"Change color of function names and args."</span>
  (goto-char (point-min))
  (<span style="color: #8b0000;">when</span> (re-search-forward <span style="color: #228b22;">"^Functions"</span> nil t)  
    (<span style="color: #8b0000;">while</span> (re-search-forward <span style="color: #228b22;">"    </span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[a-zA-z0-9-]+</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">(</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">(</span><span style="color: #228b22;">[</span><span style="color: #228b22;">^</span><span style="color: #228b22;">)]*</span><span style="color: #228b22;">\\</span><span style="color: #228b22;">)</span><span style="color: #228b22;">)"</span> nil t)
      (set-text-properties
       (match-beginning 1)
       (match-end 1)
       '(font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"brown"</span>)))

      (set-text-properties
       (match-beginning 2)
       (match-end 2)
       '(font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"red"</span>))))))
</pre>
</div>

<p>
I have gotten used to the [back] link in emacs-lisp documentation, so we try to emulate it here.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc-insert-back-link</span> ()
  <span style="color: #228b22;">"Insert link to previous buffer"</span>
  (goto-char (point-max)) 
  (insert <span style="color: #228b22;">"</span>
<span style="color: #228b22;">[back]"</span>)
  (<span style="color: #8b0000;">let</span> ((map (make-sparse-keymap)))
    
    ;; <span style="color: #ff0000; font-weight: bold;">set file to be clickable to open the source</span>
    (define-key map [mouse-1]
      (<span style="color: #8b0000;">lambda</span> ()
        (interactive)
        (pydoc *pydoc-last*)))

      (set-text-properties
       (line-beginning-position)
       (line-end-position)
       `(local-map, map
                    font-lock-face (<span style="color: #cd0000;">:foreground</span> <span style="color: #228b22;">"blue"</span>  <span style="color: #cd0000;">:underline</span> t)
                    mouse-face highlight
                    help-echo <span style="color: #228b22;">"mouse-1: click to return"</span>))))
</pre>
</div>

<pre class="example">
pydoc-insert-back-link
</pre>

<p>
Ok, finally we remake the pydoc function. 
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defvar</span> <span style="color: #8b008b;">*pydoc-current*</span> nil
 <span style="color: #228b22;">"Stores current pydoc command"</span>)

(<span style="color: #8b0000;">defvar</span> <span style="color: #8b008b;">*pydoc-last*</span> nil
 <span style="color: #228b22;">"Stores the last pydoc command"</span>)

(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">pydoc</span> (name)
  <span style="color: #228b22;">"Display pydoc information for NAME in a buffer named *pydoc*."</span>
  (interactive <span style="color: #228b22;">"sName of function or module: "</span>)

  (switch-to-buffer-other-window <span style="color: #228b22;">"*pydoc*"</span>)
  (setq buffer-read-only nil)
  (erase-buffer)
  (insert (shell-command-to-string (format <span style="color: #228b22;">"python -m pydoc %s"</span> name)))
  (goto-char (point-min))

  ;; <span style="color: #ff0000; font-weight: bold;">save </span>
  (<span style="color: #8b0000;">when</span> *pydoc-current*
      (setq *pydoc-last* *pydoc-current*))
  (setq *pydoc-current* name)


  (<span style="color: #8b0000;">save-excursion</span>
    (pydoc-get-name)
    (pydoc-make-url-links)
    (pydoc-make-file-link)
    (pydoc-make-package-links)
    (pydoc-colorize-functions)
    (pydoc-insert-back-link))

  ;; <span style="color: #ff0000; font-weight: bold;">make read-only and press q to quit</span>
  (setq buffer-read-only t)
  (use-local-map (copy-keymap org-mode-map))
  (local-set-key <span style="color: #228b22;">"q"</span> #'(<span style="color: #8b0000;">lambda</span> () (interactive) (kill-buffer)))

  (font-lock-mode))
</pre>
</div>

<pre class="example">
pydoc
</pre>

<p>
Now, we get a much more functional pydoc:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-enhanced-jasp.png"> 
</p>
<p><span class="figure-number">Figure 2:</span> Annotated screenshot</p>
</div>

<p>
and with the colorized function names:
</p>


<div class="figure">
<p><img src="/media/2014-12-20-A-new-mode-for-Python-documentation/pydoc-potcar.png"> 
</p>
</div>

<p>
Admittedly, there seems to be a lot of boilerplate code for propertizing the strings, but it doesn't seem too bad. I will probably use this documentation tool this spring, so maybe I will think of new functionality to add to pydoc. Any ideas?
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/12/20/A-new-mode-for-Python-documentation.org">org-mode source</a><p><p>Org-mode version = 8.2.10</p>

    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="after_post"><a href="http://jkitchin.github.io/blog/2014/12/20/A-new-mode-for-Python-documentation#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="/blog/category/python/7"> Previous Page</a>
  --  
 <a href="/blog/category/python/9">Next Page </a>

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2017/11/20/Timing-Lennard-Jones-implementations-ASE-vs-autograd/">Timing Lennard-Jones implementations - ASE vs autograd</a></li>
      <li><a href="/blog/2017/11/19/Training-the-ASE-Lennard-Jones-potential-to-DFT-calculations/">Training the ASE Lennard-Jones potential to DFT calculations</a></li>
      <li><a href="/blog/2017/11/18/Neural-networks-for-regression-with-autograd/">Neural networks for regression with autograd</a></li>
      <li><a href="/blog/2017/11/17/Using-autograd-in-nonlinear-regression/">Using autograd in nonlinear regression</a></li>
      <li><a href="/blog/2017/11/15/Sensitivity-analysis-using-automatic-differentiation-in-Python/">Sensitivity analysis using automatic differentiation in Python</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
        <a href="http://kitchinresearchgroup.disqus.com/latest.rss">Comments RSS Feed</a>.
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2017
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
  <script>
  (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/kitchinresearchgroup/get_num_replies.js' + query + '"></' + 'script>');
  })();
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



