

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Kitchin Research Group: biblio</title>
  <meta name="google-site-verification" content="CGcacJdHc2YoZyI0Vey9XRA5qwhhFDzThKJezbRFcJ4" />
  <meta name="description" content="Chemical Engineering at Carnegie Mellon University">
  <meta name="author" content="John Kitchin">
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/blog/feed/atom" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  <link rel="stylesheet" href="/css/base.css?v=1">
  <link rel="stylesheet" href="/css/grid.css?v=1">
  <link rel="stylesheet" media="handheld" href="/css/handheld.css?v=1">
  <link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />

  <script src="/js/libs/modernizr-1.7.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
  <link rel="stylesheet" href="/themes/theme1/style.css?v=1">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

</head>
  <body>
    <div id="container" class="container container_12">
      <div id="main" role="main">
        <div id="main_block">
          <header>
<div id="header" class="header_gradient theme_font">
<table><tr><td>
    <h1><a href="/">The Kitchin Research Group</a></h1>
    <h2>Chemical Engineering at Carnegie Mellon University</h2>
</td>
<td colspan=100%><div style="float:right;width:100%;text-align:right;"> <span id='badgeCont737515' style='width:126px'><script src='http://labs.researcherid.com/mashlets?el=badgeCont737515&mashlet=badge&showTitle=false&className=a&rid=A-2363-2010'></script></span></div>
</td></tr>
</table>
</div>
  <div id="navigation" class="grid_12">

    <ul class="theme_font">
      <li><a href="/blog"
             class="">Blog</a></li>

      <li><a href="/blog/archive"
             class="">Archives</a></li>

      <li><a href="/publications.html">Publications</a></li>

      <li><a href="/research.html"
             class="">Research</a></li>

      <li><a href="/categories.html"
             class="">Categories</a></li>

      <li><a href="/about.html"
             class="">About us</a></li>

      <li><a href="/subscribe.html">Subscribe</a></li>

    </ul>
  </div>
</header>

          <div id="prose_block" class="grid_8">
            
  





<article>
  <div class="blog_post">
    <header>
      <div id="Caching-searches-using-biblio-and-only-seeing-new-results"></div>
      <h2 class="blog_post_title"><a href="/blog/2018/04/11/Caching-searches-using-biblio-and-only-seeing-new-results/" rel="bookmark" title="Permanent Link to Caching searches using biblio and only seeing new results">Caching searches using biblio and only seeing new results</a></h2>
      <p><small><span class="blog_post_date">Posted April 11, 2018 at 08:46 PM</span> | categories:
        <span class="blog_post_categories"><a href='/blog/category/elisp/'>elisp</a>, <a href='/blog/category/arxiv/'>arxiv</a>, <a href='/blog/category/biblio/'>biblio</a></span> | tags: 
      </small></p>
    </header>
    <div class="post_prose">
      



<p>
In this <a href="https://github.com/jkitchin/scimax/issues/196">issue</a> in scimax, Robert asked if it was possible to save searches, and then to repeat them every so often and only see the new results. This needs some persistent caching of the records, and a comparison of the current search results with the previous search results.
</p>

<p>
<a href="https://github.com/cpitclaudel/biblio.el">biblio</a> provides a nice interface to searching a range of resources for bibliographic references. In this post, I will focus on arxiv. Out of the box, biblio does not seem to support this use case, but as you will see, it has many of the pieces required to achieve it. Let's start picking those pieces apart.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">biblio</span>)
</pre>
</div>

<pre class="example">
biblio

</pre>

<p>
Here is the first piece we need: a way to run a query, and get results back as a data structure. Here we just look at the first result.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">let*</span> ((query <span style="color: #008000;">"alloy segregration"</span>)
       (backend 'biblio-arxiv-backend)
       (cb (url-retrieve-synchronously (funcall backend 'url query)))
       (results (<span style="color: #0000FF;">with-current-buffer</span> cb
                  (funcall backend 'parse-buffer))))
  (car results))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">((doi . <span style="color: #008000;">"10.1103/PhysRevB.76.014112"</span>)
 (identifier . <span style="color: #008000;">"0704.2752v2"</span>)
 (year . <span style="color: #008000;">"2007"</span>)
 (title . <span style="color: #008000;">"Modelling Thickness-Dependence of Ferroelectric Thin Film Properties"</span>)
 (authors nil nil nil nil nil nil nil nil nil nil nil nil nil <span style="color: #008000;">"L. Palova"</span> nil <span style="color: #008000;">"P. Chandra"</span> nil <span style="color: #008000;">"K. M. Rabe"</span> nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil)
 (container . <span style="color: #008000;">"PRB 76, 014112 (2007)"</span>)
 (category . <span style="color: #008000;">"cond-mat.mtrl-sci"</span>)
 (references <span style="color: #008000;">"10.1103/PhysRevB.76.014112"</span> <span style="color: #008000;">"0704.2752v2"</span>)
 (type . <span style="color: #008000;">"eprint"</span>)
 (url . <span style="color: #008000;">"https://doi.org/10.1103/PhysRevB.76.014112"</span>)
 (direct-url . <span style="color: #008000;">"http://arxiv.org/pdf/0704.2752v2"</span>))
</pre>
</div>

<p>
Next, we need a database to store the results in. I will just use a flat file database with a file for each record. The filename will be the md5 hash of the doi or the record itself. Why is that a good idea? Well, the doi is a constant, so if it exists the md5 will also be a constant. The doi itself is not a good filename in general, but the md5 is. The md5 of the record itself will be fragile to any changes, so if it has a doi, we should use it. If it doesn't and later gets one, we should see it again since that could mean it has been published. Also, if it changes because of some new version we might want to see it again. In any case, the existence of that file will be evidence we have seen that record before, and will indicate we need to remove it from the current view.
</p>

<p>
The flat file database is not super inspired. It is modeled a little after elfeed, but other solutions might work better for large sets of records, but this approach will work fine for this post.
</p>

<p>
Here is a function that returns nil if the record has been seen, and if not, saves the record and returns it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">db-dir</span> <span style="color: #008000;">"~/.arxiv-db/"</span>)

(<span style="color: #0000FF;">unless</span> (f-dir? db-dir) (make-directory db-dir t))

(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">unseen-record-p</span> (record)
  <span style="color: #036A07;">"Given a RECORD return it if it is unseen.</span>
<span style="color: #036A07;">Also, save the record so next time it will be marked seen. A</span>
<span style="color: #036A07;">record is seen if we have seen the DOI or the record as a string</span>
<span style="color: #036A07;">before."</span>
  (<span style="color: #0000FF;">let*</span> ((doi (cdr (assoc 'doi record)))
         (contents (<span style="color: #0000FF;">with-temp-buffer</span>
                     (prin1 record (current-buffer))
                     (buffer-string)))
         (hash (md5 (<span style="color: #0000FF;">or</span> doi contents)))
         (fname (expand-file-name hash db-dir)))

    (<span style="color: #0000FF;">if</span> (f-exists? fname)
        nil
      (<span style="color: #0000FF;">with-temp-file</span> fname
        (insert contents))
      record)))
</pre>
</div>

<pre class="example">
unseen-record-p

</pre>

<p>
Now we can use that as a filter that saves records by side effect.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">defun</span> <span style="color: #006699;">scimax-arxiv</span> (query)
  (<span style="color: #0000FF;">interactive</span> <span style="color: #008000;">"Query: "</span>)

  (<span style="color: #0000FF;">let*</span> ((backend 'biblio-arxiv-backend)
         (cb (url-retrieve-synchronously (funcall backend 'url query)))
         (results (-filter 'unseen-record-p (<span style="color: #0000FF;">with-current-buffer</span> cb
                                              (funcall backend 'parse-buffer))))
         (results-buffer (biblio--make-results-buffer (current-buffer) query backend)))
    (<span style="color: #0000FF;">with-current-buffer</span> results-buffer
      (biblio-insert-results results <span style="color: #008000;">""</span>))
    (pop-to-buffer results-buffer)))

(scimax-arxiv <span style="color: #008000;">"alloy segregation"</span>)
</pre>
</div>

<pre class="example">
#&lt;buffer *arXiv search*&gt;

</pre>

<p>
Now, when I run that once I see something like this:
</p>

<p>
<img src="/media/date-11-04-2018-time-20-19-52.png">
</p>


<p>
and if I run it again:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(scimax-arxiv <span style="color: #008000;">"alloy segregation"</span>)
</pre>
</div>

<pre class="example">
#&lt;buffer *arXiv search*&gt;

</pre>

<p>
Then the buffer is empty, since we have seen all the entries before.
</p>


<p>
<img src="/media/date-11-04-2018-time-20-20-37.png">
</p>

<p>
Here are the files in our database:
</p>

<div class="org-src-container">
<pre class="src src-sh">ls ~/.arxiv-db/
</pre>
</div>

<p>
Here are the contents of one of those files:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">with-temp-buffer</span>
 (insert-file-contents <span style="color: #008000;">"~/.arxiv-db/18085fe2512e15d66addc7dfb71f7cd2"</span>)
 (read (buffer-string)))
</pre>
</div>

<pre class="example">
((doi) (identifier . 1101.3464v3) (year . 2011) (title . Characterizing Solute Segregation and Grain Boundary Energy in a Binary
  Alloy Phase Field Crystal Model) (authors nil nil nil nil nil nil nil nil nil nil nil nil nil Jonathan Stolle nil Nikolas Provatas nil nil nil nil nil nil nil nil nil nil nil) (container) (category . cond-mat.mtrl-sci) (references nil 1101.3464v3) (type . eprint) (url . http://arxiv.org/abs/1101.3464v3) (direct-url . http://arxiv.org/pdf/1101.3464v3))

</pre>

<p>
So, if you need to read this in again later, no problem.
</p>

<p>
Now, what could go wrong? I don't know much about how the search results from arxiv are returned. For example, this query returns 10 hits.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">let*</span> ((query <span style="color: #008000;">"alloy segregration"</span>)
       (backend 'biblio-arxiv-backend)
       (cb (url-retrieve-synchronously (funcall backend 'url query)))
       (results (<span style="color: #0000FF;">with-current-buffer</span> cb
                  (funcall backend 'parse-buffer))))
  (length results))
</pre>
</div>

<pre class="example">
10

</pre>

<p>
There is just no way there are only 10 hits for this query. So, there must be a bunch more that you get by either changing the requested number in some argument, or by using subsequent queries to get the rest of them. I don't know if there are more advanced query options with biblio, e.g. to find entries newer than the last time it was run. On the advanced search <a href="https://arxiv.org/find">page</a> for arxiv, it looks like there is only a by year option.
</p>

<p>
This is still a good idea, and a lot of the pieces are here,
</p>
<p>Copyright (C) 2018 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2018/04/11/Caching-searches-using-biblio-and-only-seeing-new-results.org">org-mode source</a></p>
<p>Org-mode version = 9.1.6</p>


    </div>
  </div>
</article>



<a href="https://twitter.com/share" class="twitter-share-button" data-via="johnkitchin">Share on Twitter</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<a href="https://twitter.com/search?q=https://kitchingroup.cheme.cmu.edu/blog/2018/04/11/Caching-searches-using-biblio-and-only-seeing-new-results">Discuss on Twitter</a>

  <hr class="interblog" />

          </div>
          <div id="sidebar" class="grid_4">
            <aside>
<section>
<script>
  (function() {
    var cx = '002533177287215655227:l7uvu35ssbc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</section>

<section>
    <h1 class="post_header_gradient theme_font">Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/johnkitchin" data-widget-id="545217643582881792">Tweets by @johnkitchin</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


  <section>
    <h1 class="post_header_gradient theme_font">Links</h1>
    <ul>
      <li><a href="https://www.continuum.io">Anaconda Python</a></li>
      <li><a href="/pycse">Pycse</a></li>
      <li><a href="/dft-book">DFT-book</a></li>
    </ul>
  </section>

  <section>
    <h1 class="post_header_gradient theme_font">Latest Posts</h1>
    <ul>
      <li><a href="/blog/2021/06/21/New-publication-Machine-learning-accelerated-geometry-optimization-in-molecular-simulation/">New publication "Machine-learning accelerated geometry optimization in molecular simulation"</a></li>
      <li><a href="/blog/2021/03/07/New-publication-Semi-grand-Canonical-Monte-Carlo-Simulation-of-the-Acrolein-induced-Surface-Segregation-and-Aggregation-of-AgPd-with-Machine-Learning-Surrogate-Models/">New publication - Semi-grand Canonical Monte Carlo Simulation of the Acrolein induced Surface Segregation and Aggregation of AgPd with Machine Learning Surrogate Models</a></li>
      <li><a href="/blog/2020/07/09/New-publication-SingleNN-Modified-Behler-Parrinello-Neural-Network-with-Shared-Weights-for-Atomistic-Simulations-with-Transferability/">New publication SingleNN - Modified Behler–Parrinello Neural Network with Shared Weights for Atomistic Simulations with Transferability</a></li>
      <li><a href="/blog/2020/03/10/New-publication-Parallelized-Screening-of-Characterized-and-DFT-Modelled-Bimetallic-Colloidal-Co-Catalysts-for-Photocatalytic-Hydrogen-Evolution/">New publication - Parallelized Screening of Characterized and DFT-Modelled Bimetallic Colloidal Co-Catalysts for Photocatalytic Hydrogen Evolution</a></li>
      <li><a href="/blog/2019/10/02/Using-autograd-to-plot-implicit-functions/">Using autograd to plot implicit functions</a></li>
    </ul>
  </section>

<section>
<h1 class="post_header_gradient theme_font">Latest GitHub Repos</h1>
  <a href="https://github.com/jkitchin">@jkitchin</a> on GitHub.
  <ul id="my-github-projects">
        <li class="loading">Status updating&#8230;</li>
  </ul>

</section>
</aside>

          </div>
          <div class="clear"></div>
        </div>
      </div>
      
<footer>
  <div id="footer" class="grid_12">
    <div class="grid_8">
      <p>
        <a href="/blog/feed/index.xml">RSS</a>
      </p>
    </div>
    <div class="grid_4" id="credits">
      <p>
        Copyright 2021
        John Kitchin
      </p>
      <p>
        Powered by <a href="http://www.blogofile.com">Blogofile</a>
      </p>
    </div>
  </div>
</footer>

    </div>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/js/libs/jquery-1.5.1.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/jquery.tweet.js"></script>  
  <script src="/js/site.js"></script>
  <!--[if lt IE 7 ]>
  <script src="js/libs/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg');</script>
  <![endif]-->
  <script>
      var _gaq=[['_setAccount','UA-35731398-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

  </body>
</html>






<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="/js/git.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function() {
     $("#my-github-projects").loadRepositories("jkitchin");
    });
</script>



