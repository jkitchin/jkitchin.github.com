<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:wfw="http://wellformedweb.org/CommentAPI/"
     >
  <channel>
    <title>The Kitchin Research Group</title>
    <link>http://jkitchin.github.io/blog</link>
    <description>Chemical Engineering at Carnegie Mellon University</description>
    <pubDate>Thu, 03 Apr 2014 23:30:52 GMT</pubDate>
    <generator>Blogofile</generator>
    <sy:updatePeriod>hourly</sy:updatePeriod>
    <sy:updateFrequency>1</sy:updateFrequency>
    <item>
      <title>Git archives for data sharing</title>
      <link>http://jkitchin.github.io/blog/2013/10/26/Git-archives-for-data-sharing</link>
      <pubDate>Sat, 26 Oct 2013 18:49:02 EDT</pubDate>
      <category><![CDATA[data]]></category>
      <guid isPermaLink="false">fF3ZY_ixudfAXztyPT5Y-OCknvo=</guid>
      <description>Git archives for data sharing</description>
      <content:encoded><![CDATA[


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. A molecule</a></li>
<li><a href="#sec-2">2. A bulk calculation</a></li>
<li><a href="#sec-3">3. Analysis via the JSON files</a></li>
<li><a href="#sec-4">4. Create the archive file</a></li>
<li><a href="#sec-5">5. Summary</a></li>
</ul>
</div>
</div>
<p>
in some past posts we have looked at <a href="http://jkitchin.github.io/blog/2013/10/22/Sharing-data-via-JSON-files/">constructing</a> JSON files for data sharing. While functional, that approach requires some extra work to create the data files for sharing, and may not be useful for all sorts of data. For instance you may not want to store electron density in a JSON file. 
</p>

<p>
Here we consider using <a href="http://git-scm.com/book/ch5-3.html#Preparing-a-Release">git archives</a> for packaging exactly the data you used in the same hierarchy as on your file system. The idea is to store your work in a git repository. You commit any data files you would want to share, and then create an archive of that data. This enables you to control what gets shared, while keeping the data that should not be shared out of the archive. 
</p>

<p>
We will run a few VASP calculations, and summarize each one in a JSON file. We will commit those JSON files to the git repository, and finally make a small archive that contains them.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> A molecule</h2>
<div class="outline-text-2" id="text-1">
<p>
Calculate the total energy of a CO molecule.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> ase <span style="color: #8b0000;">import</span> Atoms, Atom
<span style="color: #8b0000;">from</span> jasp <span style="color: #8b0000;">import</span> *
<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">import</span> json
np.set_printoptions(precision=3, suppress=<span style="color: #cd0000;">True</span>)

<span style="color: #8b008b;">co</span> = Atoms([Atom(<span style="color: #228b22;">'C'</span>,[0,   0, 0]),
            Atom(<span style="color: #228b22;">'O'</span>,[1.2, 0, 0])],
            cell=(6., 6., 6.))

<span style="color: #8b0000;">with</span> jasp(<span style="color: #228b22;">'molecules/simple-co'</span>, <span style="color: #ff0000; font-weight: bold;">#</span><span style="color: #ff0000; font-weight: bold;">output dir</span>
          xc=<span style="color: #228b22;">'PBE'</span>,  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">the exchange-correlation functional</span>
          nbands=6,  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">number of bands</span>
          encut=350, <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">planewave cutoff</span>
          ismear=1,  <span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Methfessel-Paxton smearing</span>
          sigma=0.01,<span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">very small smearing factor for a molecule</span>
          atoms=co) <span style="color: #8b0000;">as</span> calc:
    <span style="color: #8b0000;">print</span> <span style="color: #228b22;">'energy = {0} eV'</span>.<span style="color: #cd0000;">format</span>(co.get_potential_energy())
    <span style="color: #8b0000;">print</span> co.get_forces()
    <span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'JSON'</span>, <span style="color: #228b22;">'wb'</span>) <span style="color: #8b0000;">as</span> f:
        f.write(json.dumps(calc.<span style="color: #cd0000;">dict</span>))
    os.system(<span style="color: #228b22;">'git add JSON'</span>)
</pre>
</div>

<pre class="example">
energy = -14.687906 eV
[[ 5.095  0.     0.   ]
 [-5.095  0.     0.   ]]
</pre>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> A bulk calculation</h2>
<div class="outline-text-2" id="text-2">
<p>
Now we run a bulk calculation
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">from</span> jasp <span style="color: #8b0000;">import</span> *

<span style="color: #8b0000;">from</span> ase <span style="color: #8b0000;">import</span> Atom, Atoms

<span style="color: #8b008b;">atoms</span> = Atoms([Atom(<span style="color: #228b22;">'Cu'</span>,  [0.000,      0.000,      0.000])],
              cell=  [[ 1.818,  0.000,  1.818],
                      [ 1.818,  1.818,  0.000],
                      [ 0.000,  1.818,  1.818]])

<span style="color: #8b0000;">with</span> jasp(<span style="color: #228b22;">'bulk/alloy/cu'</span>,
          xc=<span style="color: #228b22;">'PBE'</span>,
          encut=350,
          kpts=(13,13,13),
          nbands=9,
          ibrion=2,
          isif=4,
          nsw=10,
          atoms=atoms) <span style="color: #8b0000;">as</span> calc:
    <span style="color: #8b0000;">print</span> atoms.get_potential_energy()
    <span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'JSON'</span>, <span style="color: #228b22;">'wb'</span>) <span style="color: #8b0000;">as</span> f:
        f.write(json.dumps(calc.<span style="color: #cd0000;">dict</span>))
    os.system(<span style="color: #228b22;">'git add JSON'</span>)
</pre>
</div>

<pre class="example">
-3.723306
</pre>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Analysis via the JSON files</h2>
<div class="outline-text-2" id="text-3">
<p>
This analysis is independent of <code>jasp</code> and therefore is portable
</p>

<p>
We can retrieve the bulk data
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> json

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'bulk/alloy/cu/JSON'</span>, <span style="color: #228b22;">'rb'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b008b;">d</span> = json.loads(f.read())
    <span style="color: #8b0000;">print</span> d[<span style="color: #228b22;">'data'</span>][<span style="color: #228b22;">'total_energy'</span>]
</pre>
</div>

<pre class="example">
-3.723306
</pre>

<p>
Or the molecule data:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> json

<span style="color: #8b0000;">with</span> <span style="color: #cd0000;">open</span>(<span style="color: #228b22;">'molecules/simple-co/JSON'</span>, <span style="color: #228b22;">'rb'</span>) <span style="color: #8b0000;">as</span> f:
    <span style="color: #8b008b;">d</span> = json.loads(f.read())
    <span style="color: #8b0000;">print</span> d[<span style="color: #228b22;">'data'</span>][<span style="color: #228b22;">'total_energy'</span>]
</pre>
</div>

<pre class="example">
-14.687906
</pre>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Create the archive file</h2>
<div class="outline-text-2" id="text-4">
<p>
As you do your work, you add and commit files as needed. For this project all that needs to be shared are the JSON files, and the scripts (which are in this document) that we used to run the calculations and do the analysis. If we are satisfied with the state of the git repository, we create an archive like this:
</p>

<div class="org-src-container">

<pre class="src src-sh">git archive --format zip HEAD -o archive.zip
</pre>
</div>

<p>
Here is the result: <a href="/media/2013-10-26-Git-archives-for-data-sharing/archive.zip">archive.zip</a> .
</p>

<p>
You can download the zip file, unzip it, and rerun the analysis to extract the total energies on any system with a modern Python installation.
</p>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Summary</h2>
<div class="outline-text-2" id="text-5">
<p>
This seems to be an easy way to share data from a single project, i.e. a single git repository. It isn't obvious how you would package data from multiple projects, or how you would run multiple projects in a single directory.
</p>
</div>
</div>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/10/26/Git-archives-for-data-sharing.org">org-mode source</a><p>]]></content:encoded>
    </item>
  </channel>
</rss>
