---
title: Is your ice cream float bigger than mine
date: 2013/05/27 07:46:36
updated: 2013/05/28 08:59:01
categories: math
tags:
---



<p>
Float numbers (i.e. the ones with decimals) cannot be perfectly represented in a computer. This can lead to some artifacts when you have to compare float numbers that on paper should be the same, but in silico are not. Let us look at some examples. In this example, we do some simple math that should result in an answer of 1, and then see if the answer is &ldquo;equal&rdquo; to one.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> 3.0 * (1.0/3.0)
<span style="color: #8b0000;">print</span> 1.0 == 3.0 * (1.0/3.0)
</pre>
</div>

<pre class="example">
1.0
True
</pre>

<p>
Everything looks fine. Now, consider this example.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> 49.0 * (1.0/49.0)
<span style="color: #8b0000;">print</span> 1.0 == 49.0 * (1.0/49.0)
</pre>
</div>

<pre class="example">
1.0
False
</pre>

<p>
The first line looks like everything is find, but the equality fails!
</p>

<pre class="example">
1.0
False
</pre>

<p>
You can see here why the equality statement fails. We will print the two numbers to sixteen decimal places.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0:1.16f}'</span>.format(49.0 * (1.0/49.0) )
<span style="color: #8b0000;">print</span> <span style="color: #228b22;">'{0:1.16f}'</span>.format(1.0)
<span style="color: #8b0000;">print</span> 1 - 49.0 * (1.0/49.0)
</pre>
</div>

<pre class="example">
0.9999999999999999
1.0000000000000000
1.11022302463e-16
</pre>

<p>
The two numbers actually are not equal to each other because of float math. They are <i>very, very</i> close to each other, but not the same.
</p>

<p>
This leads to the idea of asking if two numbers are equal to each other within some tolerance. The question of what tolerance to use requires thought. Should it be an absolute tolerance? a relative tolerance? How large should the tolerance be? We will use the distance between 1 and the nearest floating point number (this is <code>eps</code> in Matlab). <code>numpy</code> can tell us this number with the <code>np.spacing</code> command.
</p>

<p>
Below, we implement a comparison function from <a href="https://doi.org/10.1107/S010876730302186X" ><a href="10.1107/S010876730302186X" >10.1107/S010876730302186X</a></a> that allows comparisons with tolerance.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #ff0000; font-weight: bold;"># </span><span style="color: #ff0000; font-weight: bold;">Implemented from Acta Crystallographica A60, 1-6 (2003). doi:10.1107/S010876730302186X</span>

<span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np
<span style="color: #8b0000;">print</span> np.spacing(1)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">feq</span>(x, y, epsilon):
    <span style="color: #228b22;">'x == y'</span>
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">not</span>((x &lt; (y - epsilon)) <span style="color: #8b0000;">or</span> (y &lt; (x - epsilon)))

<span style="color: #8b0000;">print</span> feq(1.0, 49.0 * (1.0/49.0), np.spacing(1))
</pre>
</div>

<pre class="example">
2.22044604925e-16
True
</pre>

<p>
For completeness, here are the other float comparison operators from that paper. We also show a few examples.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8b0000;">import</span> numpy <span style="color: #8b0000;">as</span> np

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">flt</span>(x, y, epsilon):
    <span style="color: #228b22;">'x &lt; y'</span>
    <span style="color: #8b0000;">return</span> x &lt; (y - epsilon)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fgt</span>(x, y, epsilon):
    <span style="color: #228b22;">'x &gt; y'</span>
    <span style="color: #8b0000;">return</span> y &lt; (x - epsilon)

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fle</span>(x, y, epsilon):
    <span style="color: #228b22;">'x &lt;= y'</span>
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">not</span>(y &lt; (x - epsilon))

<span style="color: #8b0000;">def</span> <span style="color: #8b2323;">fge</span>(x, y, epsilon):
    <span style="color: #228b22;">'x &gt;= y'</span>
    <span style="color: #8b0000;">return</span> <span style="color: #8b0000;">not</span>(x &lt; (y - epsilon))

<span style="color: #8b0000;">print</span> fge(1.0, 49.0 * (1.0/49.0), np.spacing(1))
<span style="color: #8b0000;">print</span> fle(1.0, 49.0 * (1.0/49.0), np.spacing(1))

<span style="color: #8b0000;">print</span> fgt(1.0 + np.spacing(1), 49.0 * (1.0/49.0), np.spacing(1))
<span style="color: #8b0000;">print</span> flt(1.0 - 2 * np.spacing(1), 49.0 * (1.0/49.0), np.spacing(1))
</pre>
</div>

<pre class="example">
True
True
True
True
</pre>

<p>
As you can see, float comparisons can be tricky. You have to give a lot of thought to how to make the comparisons, and the functions shown above are not the only way to do it. You need to build in testing to make sure your comparisons are doing what you want.
</p>
<p>Copyright (C) 2013 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2013/05/27/Is-your-ice-cream-float-bigger-than-mine.org">org-mode source</a><p>
