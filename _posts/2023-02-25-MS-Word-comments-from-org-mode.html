---
title: MS Word comments from org-mode
date: 2023/02/25 11:49:07
updated: 2023/02/25 11:49:07
categories: orgmode, docx
tags: 
---


<p>
Today I <a href="https://www.reddit.com/r/orgmode/comments/11bkt2h/is_it_possible_to_pass_html_in_org_to_pandoc_word/">learned</a> you can make a Word document from org-mode with Word comments in them. This could be useful when working with collaborators maybe. A subtlety is it works by using pandoc to convert markdown into docx. Within markdown you designate the comments using HTML like this:
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;span <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-start"</span> <span style="color: #BA36A5;">author</span>=<span style="color: #008000;">"jkitchin"</span>&gt;Comment text&lt;/span&gt;The text being commented on &lt;span <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"comment-end"</span>&gt;&lt;/span&gt; 
</pre>
</div>

<p>
Let's wrap that in a link for convenience. I use a full display so it is easy to see the comment. I only export the comment for markdown export, for everything else we just use the path. We somewhat abuse the link syntax here by using the path for the text to comment on, and the description for the comment.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-link-set-parameters <span style="color: #008000;">"comment"</span>
                         <span style="color: #006FE0;">:export</span> (<span style="color: #0000FF;">lambda</span> (path desc backend)
                                   (<span style="color: #0000FF;">if</span> (eql backend 'md)
                                       (format <span style="color: #008000;">"&lt;span class=\"comment-start\" author=\"%s\"&gt;%s&lt;/span&gt;%s&lt;span class=\"comment-end\"&gt;&lt;/span&gt;"</span>
                                               (user-full-name)
                                               desc
                                               path)
                                     <span style="color: #8D8D84;">;; </span><span style="color: #8D8D84; font-style: italic;">ignore for other backends and just use path</span>
                                     path))
                         <span style="color: #006FE0;">:display</span> 'full
                         <span style="color: #006FE0;">:face</span> '(<span style="color: #006FE0;">:foreground</span> <span style="color: #008000;">"orange"</span>))                  
</pre>
</div>

<p>
Now, we use it like this This is the text commented on.
</p>

<p>
In org-mode it looks like:
</p>



<p>
<figure><img src="/media/date-25-02-2023-time-11-44-11.png"></figure> 
</p>

<p>
To get the Word doc, we need some code that first exports to Markdown, and then calls pandoc to convert that to docx. Here is my solution to that. Usually you would put this in a subsection tagged with :noexport: but I show it here to see it. Running this block generates the docx file and opens it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">let*</span> ((md (org-md-export-to-markdown))
       (docx (concat (file-name-sans-extension md) <span style="color: #008000;">".docx"</span>)))
  (shell-command (format <span style="color: #008000;">"pandoc -s %s -o %s"</span> md docx))
  (org-open-file docx '(16)))
</pre>
</div>

<p>
The result looks like this in MS Word:
</p>


<p>
<figure><img src="/media/date-25-02-2023-time-11-41-37.png"></figure> 
</p>

<p>
That is pretty remarkable. I guess this has some limitations in going through markdown, e.g. usually I have found something doesn't work like an equation or table, or caption, cross-reference, etc. Still, this might be inspiration to test it out further!
</p>
<p>Copyright (C) 2023 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p>
<p><a href="/org/2023/02/25/MS-Word-comments-from-org-mode.org">org-mode source</a></p>
<p>Org-mode version = 9.5.5</p>