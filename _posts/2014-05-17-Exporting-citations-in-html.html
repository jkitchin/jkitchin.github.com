---
title: Exporting citations in html
date: 2014/05/17 14:41:43
updated: 2014/07/15 16:52:09
categories: org-mode
tags:
---



<p>
Now that org-ref works well for LaTeX, I want to explore a simple approach to exporting citations with a bibliography in html. This will enable me to put citations in blogposts, like this one <a href="#armiento-2014-high">armiento-2014-high</a> and these ones <a href="#daza-2014-carbon-dioxid">daza-2014-carbon-dioxid</a>,<a href="#mehta-2014-ident-poten">mehta-2014-ident-poten</a>,<a href="#suntivich-2014-estim-hybrid">suntivich-2014-estim-hybrid</a>. We should be able to have the same citation in more than one place like this  <a href="#armiento-2014-high">armiento-2014-high</a>, but only have one entry in the bibliography. The bibliography should be sorted if we ask for it <a href="#alesi-2012-evaluat-primar">alesi-2012-evaluat-primar</a>. I am curious to see this book citation: <a href="#day-1995-scien-englis">day-1995-scien-englis</a>.
</p>

<p>
The first thing we need is a list of bibtex keys cited in this buffer.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">org-ref-get-bibtex-keys</span> ()
  <span style="color: #228b22;">"return a list of unique keys in the buffer"</span>
  (interactive)
  (<span style="color: #8b0000;">let</span> ((keys '()))
    (org-element-map (org-element-parse-buffer) 'link
      (<span style="color: #8b0000;">lambda</span> (link)
        (<span style="color: #8b0000;">let</span> ((plist (nth 1 link)))
          (<span style="color: #8b0000;">when</span> (-contains? org-ref-cite-types (plist-get plist '<span style="color: #cd0000;">:type</span>))
            (<span style="color: #8b0000;">dolist</span>
                (key
                 (org-ref-split-and-strip-string (plist-get plist '<span style="color: #cd0000;">:path</span>)))
              (<span style="color: #8b0000;">when</span> (not (-contains? keys key))
                (setq keys (append keys (list key)))))))))
    keys))

(org-ref-get-bibtex-keys)
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">armiento-2014-high</td>
<td class="left">daza-2014-carbon-dioxid</td>
<td class="left">mehta-2014-ident-poten</td>
<td class="left">suntivich-2014-estim-hybrid</td>
<td class="left">alesi-2012-evaluat-primar</td>
<td class="left">day-1995-scien-englis</td>
</tr>
</tbody>
</table>

<p>
Good. Now, we need to create an HTML string for the bibliography. For each key, we will create an unordered list of simple citations. Each citation will be a named anchor in html. Let us start with a function that takes a key, and generates the HTML for that entry.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">org-ref-get-bibtex-entry-html</span> (key)
(interactive)

 (<span style="color: #8b0000;">let</span> ((org-ref-bibliography-files (org-ref-find-bibliography))
       (cb (current-buffer))
       (file) (entry))

   (setq file (<span style="color: #8b0000;">catch</span> '<span style="color: #cd0000;">result</span>
                (loop for file in org-ref-bibliography-files do
                      (message <span style="color: #228b22;">"looking for %s in %s"</span> key file)
                      (<span style="color: #8b0000;">if</span> (org-ref-key-in-file-p key (file-truename file))
                          (<span style="color: #8b0000;">throw</span> '<span style="color: #cd0000;">result</span> file)
                        (message <span style="color: #228b22;">"%s not found in %s"</span> key (file-truename file))))))
   (set-buffer (find-file-noselect file))
   (<span style="color: #8b0000;">prog1</span>
       (bibtex-search-entry key nil 0)
     (setq entry (org-ref-bib-citation))
     (set-buffer cb))

   (format <span style="color: #228b22;">"&lt;li&gt;&lt;a name=\"#%s\"&gt;[%s] %s&lt;\\a&gt;&lt;li&gt;"</span> key key entry)))

(org-ref-get-bibtex-entry-html <span style="color: #228b22;">"mehta-2014-ident-poten"</span>)
</pre>
</div>

<pre class="example">
&lt;li&gt;&lt;a name="#mehta-2014-ident-poten"&gt;[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \&amp; Interfaces, 0:null (2014)&lt;\a&gt;&lt;li&gt;
</pre>

<p>
That looks excellent. Now we simply map that function over the list of keys.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #8b0000;">defun</span> <span style="color: #8b2323;">org-ref-get-html-bibliography</span> ()
(interactive)
(<span style="color: #8b0000;">let</span> ((keys (org-ref-get-bibtex-keys)))
(<span style="color: #8b0000;">when</span> keys
(concat <span style="color: #228b22;">"&lt;h1&gt;Bibliography&lt;/h1&gt;</span>
<span style="color: #228b22;">&lt;ul&gt;"</span>
(mapconcat (<span style="color: #8b0000;">lambda</span> (x) (org-ref-get-bibtex-entry-html x)) keys <span style="color: #228b22;">"\n"</span>)
<span style="color: #228b22;">"\n&lt;/ul&gt;"</span>))))

(org-ref-get-html-bibliography)
</pre>
</div>

<p>
&lt;h1&gt;Bibliography&lt;/h1&gt;
&lt;ul&gt;&lt;li&gt;&lt;a name="#armiento-2014-high"&gt;[armiento-2014-high] Armiento, R. and Kozinsky, B. and Hautier, G. and  Fornari, M. and Ceder, G., "High-throughput screening of perovskite alloys for  piezoelectric performance and thermodynamic  stability", Phys. Rev. B, 89:134103 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#daza-2014-carbon-dioxid"&gt;[daza-2014-carbon-dioxid] Daza, Yolanda A. and Kent, Ryan A. and Yung, Matthew  M. and Kuhn, John N., "Carbon Dioxide Conversion by Reverse Water-Gas Shift  Chemical Looping on Perovskite-Type Oxides", Industrial \&amp; Engineering Chemistry Research, 53:5828-5837 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#mehta-2014-ident-poten"&gt;[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \&amp; Interfaces, 0:null (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#suntivich-2014-estim-hybrid"&gt;[suntivich-2014-estim-hybrid] Suntivich, Jin and Hong, Wesley T. and Lee, Yueh-Lin  and Rondinelli, James M. and Yang, Wanli and  Goodenough, John B. and Dabrowski, Bogdan and  Freeland, John W. and Shao-Horn, Yang, "Estimating Hybridization of Transition Metal and  Oxygen States in Perovskites from O K-edge X-ray  Absorption Spectroscopy", The Journal of Physical Chemistry C, 118:1856-1863 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#alesi-2012-evaluat-primar"&gt;[alesi-2012-evaluat-primar] Alesi, W. Richard and Kitchin, John R., "Evaluation of a Primary Amine-Functionalized  Ion-Exchange Resin for \ce{CO_2} Capture", Industrial \&amp; Engineering Chemistry Research, 51:6907-6915 (2012)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#day-1995-scien-englis"&gt;[day-1995-scien-englis] Robert A. Day, "Scientific English: A Guide for Scientists and Other Profesionals", , : (1995)&lt;\a&gt;&lt;li&gt;
&lt;/ul&gt;
&lt;h1&gt;Bibliography&lt;/h1&gt;
&lt;ul&gt;&lt;li&gt;&lt;a name="#armiento-2014-high"&gt;[armiento-2014-high] Armiento, R. and Kozinsky, B. and Hautier, G. and  Fornari, M. and Ceder, G., "High-throughput screening of perovskite alloys for  piezoelectric performance and thermodynamic  stability", Phys. Rev. B, 89:134103 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#daza-2014-carbon-dioxid"&gt;[daza-2014-carbon-dioxid] Daza, Yolanda A. and Kent, Ryan A. and Yung, Matthew  M. and Kuhn, John N., "Carbon Dioxide Conversion by Reverse Water-Gas Shift  Chemical Looping on Perovskite-Type Oxides", Industrial \&amp; Engineering Chemistry Research, 53:5828-5837 (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#mehta-2014-ident-poten"&gt;[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \&amp; Interfaces, 0:null (2014)&lt;\a&gt;&lt;li&gt;
&lt;li&gt;&lt;a name="#suntivich-2014-estim-hybrid"&gt;[suntivich-2014-estim-hybrid] Suntivich, Jin and Hong, Wesley T. and Lee, Yueh-Lin  and Rondinelli, James M. and Yang, Wanli and  Goodenough, John B. and Dabrowski, Bogdan and  Freeland, John W. and Shao-Horn, Yang, "Estimating Hybridization of Transition Metal and  Oxygen States in Perovskites from O K-edge X-ray  Absorption Spectroscopy", The Journal of Physical Chemistry C, 118:1856-1863 (2014)&lt;\a&gt;&lt;li&gt;
&lt;/ul&gt;
</p>


<p>
That is basically all we need. The citation links will export as hrefs to these named targets, so they should work fine. All we need to do is modify the blogofile code a bit to use this, and add those functions to org-ref, and we should get a bibliography in our blogposts.
</p>

<p>
<h1>Bibliography</h1>
<ul><li><a id="armiento-2014-high">[armiento-2014-high] Armiento, R. and Kozinsky, B. and Hautier, G. and  Fornari, M. and Ceder, G., "High-throughput screening of perovskite alloys for  piezoelectric performance and thermodynamic  stability", Phys. Rev. B, 89:134103 (2014). <a href="http://link.aps.org/doi/10.1103/PhysRevB.89.134103">link</a> <a href="https://doi.org/10.1103/PhysRevB.89.134103">doi</a></a></li>
<li><a id="daza-2014-carbon-dioxid">[daza-2014-carbon-dioxid] Daza, Yolanda A. and Kent, Ryan A. and Yung, Matthew  M. and Kuhn, John N., "Carbon Dioxide Conversion by Reverse Water-Gas Shift  Chemical Looping on Perovskite-Type Oxides", Industrial \& Engineering Chemistry Research, 53:5828-5837 (2014). <a href="http://pubs.acs.org/doi/abs/10.1021/ie5002185">link</a> <a href="https://doi.org/10.1021/ie5002185">doi</a></a></li>
<li><a id="mehta-2014-ident-poten">[mehta-2014-ident-poten] Mehta, Prateek and Salvador, Paul A. and Kitchin,  John R., "Identifying Potential \ce{BO_2} Oxide Polymorphs for  Epitaxial Growth Candidates", ACS Applied Materials \& Interfaces, 0:null (2014). <a href="http://pubs.acs.org/doi/abs/10.1021/am4059149">link</a> <a href="https://doi.org/10.1021/am4059149">doi</a></a></li>
<li><a id="suntivich-2014-estim-hybrid">[suntivich-2014-estim-hybrid] Suntivich, Jin and Hong, Wesley T. and Lee, Yueh-Lin  and Rondinelli, James M. and Yang, Wanli and  Goodenough, John B. and Dabrowski, Bogdan and  Freeland, John W. and Shao-Horn, Yang, "Estimating Hybridization of Transition Metal and  Oxygen States in Perovskites from O K-edge X-ray  Absorption Spectroscopy", The Journal of Physical Chemistry C, 118:1856-1863 (2014). <a href="http://pubs.acs.org/doi/abs/10.1021/jp410644j">link</a> <a href="https://doi.org/10.1021/jp410644j">doi</a></a></li>
<li><a id="alesi-2012-evaluat-primar">[alesi-2012-evaluat-primar] Alesi, W. Richard and Kitchin, John R., "Evaluation of a Primary Amine-Functionalized  Ion-Exchange Resin for \ce{CO_2} Capture", Industrial \& Engineering Chemistry Research, 51:6907-6915 (2012). <a href="https://doi.org/10.1021/ie300452c">link</a> <a href="https://doi.org/10.1021/ie300452c">doi</a></a></li>
<li><a id="day-1995-scien-englis">[day-1995-scien-englis] Robert A. Day, "Scientific English: A Guide for Scientists and Other Profesionals", , : (1995). <a href="">link</a> <a href="https://doi.org/">doi</a></a></li>
</ul>
</p>
<p>Copyright (C) 2014 by John Kitchin. See the <a href="/copying.html">License</a> for information about copying.<p><p><a href="/org/2014/05/17/Exporting-citations-in-html.org">org-mode source</a><p><p>Org-mode version = 8.2.6</p>
